#!/bin/bash

# ğŸ¯ QUICK START - Test de persistance images annotÃ©es
# ====================================================

echo "ğŸš€ DEMARRAGE RAPIDE - Test persistance images"
echo "=============================================="
echo ""
echo "âœ… Le code est prÃªt. Voici comment le tester :"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Ã‰TAPE 1 : Lancer le serveur"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  $ npm run dev"
echo ""
echo "  Attendre: 'Local: http://localhost:5173'"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Ã‰TAPE 2 : Ouvrir le navigateur + DevTools"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  $ open http://localhost:5173"
echo ""
echo "  Ouvrir DevTools:"
echo "  - Mac: Cmd+Option+I"
echo "  - Windows/Linux: F12"
echo ""
echo "  Aller Ã  l'onglet 'Console'"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Ã‰TAPE 3 : CrÃ©er un nÅ“ud IMAGE et uploader une image"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  1. CrÃ©er/Ã‰diter un formulaire TreeBranchLeaf"
echo "  2. Ajouter un champ de type IMAGE"
echo "  3. Uploader une photo (ou utiliser SmartCamera)"
echo "  4. SÃ©lectionner 'IA photo + mesure'"
echo ""
echo "  ğŸ‘€ Observer les logs dans la Console:"
echo "     ğŸ“¸ [TBLImageFieldWithAI] MOUNTED (nodeId=...)"
echo "     ğŸ’¾ SAVE sessionStorage"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Ã‰TAPE 4 : Recharger la page (F5)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  VÃ©rifier dans la Console:"
echo "  âœ… âœ… Image annotÃ©e restaurÃ©e depuis sessionStorage"
echo ""
echo "  L'image ANNOTÃ‰E doit persister avec ses tracÃ©s!"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Ã‰TAPE 5 (BONUS) : Dupliquer le nÅ“ud et tester"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  1. Dupliquer le nÅ“ud depuis la UI"
echo "  2. Voir les logs du nouveau nÅ“ud (nodeId diffÃ©rent)"
echo "  3. La nouvelle clÃ© sessionStorage:"
echo "     tbl_image_annot_{NEW_nodeId}"
echo "  4. Recharger (F5) â†’ nouvelle image doit persister"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ” COMMANDES DEVTOOLS - Inspecter sessionStorage"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  Dans la Console, taper:"
echo ""
echo "  // Voir toutes les clÃ©s image"
echo "  Object.keys(sessionStorage).filter(k => k.startsWith('tbl_image_annot_'))"
echo ""
echo "  // Voir la taille d'une image"
echo "  sessionStorage.getItem('tbl_image_annot_YOUR_NODE_ID').length"
echo ""
echo "  // VÃ©rifier si l'image est lÃ "
echo "  sessionStorage.getItem('tbl_image_annot_YOUR_NODE_ID')?.substring(0, 50)"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âŒ SI PROBLÃˆMES - Chercher ces logs:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  âŒ ERREUR sessionStorage.setItem"
echo "     â†’ Quota sessionStorage dÃ©passÃ© (rare)"
echo ""
echo "  âŒ sessionStorage vide"
echo "     â†’ L'image n'a pas Ã©tÃ© sauvegardÃ©e"
echo "     â†’ VÃ©rifier que handleMeasurementsComplete est appelÃ©"
echo ""
echo "  âŒ Pas d'image Ã  restaurer"
echo "     â†’ Hydration Ã©chouÃ©e"
echo "     â†’ VÃ©rifier value du backend"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ¨ Code modifiÃ©:"
echo "   - TBLImageFieldWithAI.tsx: sessionStorage save/restore + forceRenderKey"
echo "   - ImageMeasurementCanvas.tsx: polygon ordering + surface/perimeter"
echo "   - ImageMeasurementPreview.tsx: overlay + completion flow"
echo ""
