// REMPLACER LES LIGNES 3730-3751 dans treebranchleaf-routes.ts

        }
        const ordered = Array.from(delSet).sort((a, b) => (ddepth.get(b)! - ddepth.get(a)!));
        let deletedExtra = 0;
        const deletedExtraIds: string[] = []; // ‚ú® COLLECTER LES IDS SUPPRIM√âS
        await prisma.$transaction(async (tx) => {
          for (const id of ordered) {
            try {
              await tx.treeBranchLeafNode.delete({ where: { id } });
              deletedExtra++;
              deletedExtraIds.push(id); // ‚ú® AJOUTER L'ID
            } catch (e) {
              console.warn('[DELETE EXTRA] Failed to delete node', id, (e as Error).message);
            }
          }
        });
        console.log('[DELETE] Extra display nodes deleted:', deletedExtra);
        console.log('üéØ [DELETE FINAL] Total supprim√©:', toDelete.length, '+ extra:', deletedExtra, '= ', toDelete.length + deletedExtra);
        
        // ‚ú® RETOURNER TOUS LES IDS SUPPRIM√âS
        const allDeletedIds = [...toDelete, ...deletedExtraIds];
        res.json({ 
          success: true, 
          message: `Sous-arbre supprim√© (${toDelete.length} n≈ìud(s)), orphelines supprim√©es: ${deletedOrphans}`, 
          deletedCount: allDeletedIds.length, 
          deletedOrphans,
          deletedIds: allDeletedIds // ‚ú® LISTE COMPL√àTE
        });
        return; // ‚ú® IMPORTANT: SORTIR ICI
      }
    } catch (e) {
      console.warn('[DELETE] Extra cleanup failed', (e as Error).message);
    }

    // ‚ú® FALLBACK: Si pas d'extra cleanup, retourner quand m√™me les IDs CASCADE
    res.json({ 
      success: true, 
      message: `Sous-arbre supprim√© (${toDelete.length} n≈ìud(s)), orphelines supprim√©es: ${deletedOrphans}`, 
      deletedCount: toDelete.length, 
      deletedOrphans,
      deletedIds: toDelete // ‚ú® IDS CASCADE
    });
