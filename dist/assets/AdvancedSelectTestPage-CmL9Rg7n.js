import{j as e}from"./index-C0S0DpaX.js";import{r as s}from"./react-vendor-Al_k-ZB6.js";import{u as i}from"./useAuthenticatedApi-BbQI8SDU.js";import{T as t,an as r,a2 as n,a3 as o,ay as l,a,au as d,I as c,bk as m,cX as u,$ as v,aC as p,b as D,co as N,B as x,aV as f}from"./antd-vendor-zFcGztvE.js";import{g as b}from"./fieldMapping-DdWz-wC8.js";const{Option:h}=r,{Text:S,Title:C}=t,g=({field:t,value:x,onChange:f,relatedFields:b={},disabled:g=!1,size:E="middle"})=>{var A;const[V,k]=s.useState((null==x?void 0:x.option)||null),[y,R]=s.useState((null==x?void 0:x.input)||null),[j,P]=s.useState(null),[M,U]=s.useState(null),[O,T]=s.useState(!1),[w,z]=s.useState(0),{api:_}=i(),q=s.useMemo(()=>V&&t.options?t.options.find(e=>e.value===V):null,[V,t.options]),F=s.useMemo(()=>{var e;return(null==(e=null==q?void 0:q.data)?void 0:e.nextField)?q.data.nextField.type:null},[q]),I=s.useCallback(async(e,s)=>{var i;if((null==(i=null==q?void 0:q.data)?void 0:i.formula)&&s){T(!0);try{const i=await _.post(`/advanced-select/${t.id}/calculate`,{optionValue:e,inputData:s,relatedFieldsData:b,organizationId:t.organization_id.toString()});if(i.success){if(P(i.data),void 0!==i.data.result){const e=await _.post("/advanced-select/validate",{value:i.data.result,unit:i.data.unit});e.success&&U(e.data)}z(2)}}catch(r){P({success:!1,error:"Erreur lors du calcul automatique"})}finally{T(!1)}}},[q,t.id,b,t.organization_id,_]),L=s.useCallback(e=>{k(e),R(null),P(null),U(null),z(1),f({option:e,input:null})},[f]),B=s.useCallback(e=>{var s;R(e),f({option:V,input:e}),(null==(s=null==q?void 0:q.data)?void 0:s.formula)&&null!=e&&I(V,e)},[V,q,f,I]);s.useEffect(()=>{V?!y&&F?z(1):j&&z(2):z(0)},[V,y,F,j]);return e.jsxDEV("div",{style:{width:"100%"},children:[e.jsxDEV(C,{level:5,style:{marginBottom:12},children:[t.name,t.is_required&&e.jsxDEV("span",{style:{color:"#ff4d4f"},children:" *"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:360,columnNumber:39},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:358,columnNumber:13},void 0),(()=>{var s,i,r,n;if(!(null==(s=t.capabilities)?void 0:s.includes("workflow")))return null;const c=[{title:"SÃ©lection",description:"Choisir une option",icon:w>=0?e.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:225,columnNumber:42},void 0):void 0},{title:"Saisie",description:(null==(r=null==(i=null==q?void 0:q.data)?void 0:i.nextField)?void 0:r.placeholder)||"Entrer une valeur",icon:w>=1?1===w?e.jsxDEV(l,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:230,columnNumber:63},void 0):e.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:230,columnNumber:85},void 0):void 0}];return(null==(n=null==q?void 0:q.data)?void 0:n.formula)&&c.push({title:"Calcul",description:"RÃ©sultat automatique",icon:w>=2?O?e.jsxDEV(l,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:238,columnNumber:59},void 0):e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:238,columnNumber:81},void 0):void 0}),e.jsxDEV(a,{size:"small",style:{marginBottom:16},children:e.jsxDEV(d,{current:w,size:"small",items:c},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:244,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:243,columnNumber:13},void 0)})(),e.jsxDEV(r,{size:E,placeholder:"SÃ©lectionnez une option...",value:V,onChange:L,disabled:g,style:{width:"100%",marginBottom:16},loading:O,children:null==(A=t.options)?void 0:A.map(s=>e.jsxDEV(h,{value:s.value,children:s.label},s.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:377,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:367,columnNumber:13},void 0),(()=>{var s,i;if(!(null==(s=null==q?void 0:q.data)?void 0:s.nextField)||!V)return null;const{type:t,placeholder:r,validation:n}=q.data.nextField,o=null==n?void 0:n.required;switch(t){case"number":return e.jsxDEV(m,{size:E,placeholder:r,value:y,onChange:B,disabled:g,style:{width:"100%"},min:null==n?void 0:n.min,max:null==n?void 0:n.max,step:(null==n?void 0:n.step)||1,precision:null==n?void 0:n.precision,addonAfter:null==(i=q.data.businessLogic)?void 0:i.unit,status:o&&!y?"error":void 0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:259,columnNumber:21},void 0);case"text":return e.jsxDEV(c,{size:E,placeholder:r,value:y,onChange:e=>B(e.target.value),disabled:g,status:o&&!y?"error":void 0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:277,columnNumber:21},void 0);default:return e.jsxDEV(c,{size:E,placeholder:r,value:y,onChange:e=>B(e.target.value),disabled:g},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:289,columnNumber:21},void 0)}})(),j?e.jsxDEV(a,{size:"small",style:{marginTop:16},children:[e.jsxDEV(C,{level:5,children:[e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:307,columnNumber:21},void 0)," RÃ©sultat du calcul"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:306,columnNumber:17},void 0),j.success?e.jsxDEV(v,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV(S,{strong:!0,style:{fontSize:"18px",color:"#52c41a"},children:j.formatted||`${j.result} ${j.unit}`},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:312,columnNumber:25},void 0),j.metadata&&e.jsxDEV(S,{type:"secondary",children:[j.metadata.operation," â€¢ ",j.metadata.calculationTime,"ms"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:317,columnNumber:29},void 0),M&&e.jsxDEV("div",{style:{marginTop:12},children:[e.jsxDEV(p,{style:{margin:"12px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:324,columnNumber:33},void 0),e.jsxDEV(S,{strong:!0,children:"Validation :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:325,columnNumber:33},void 0),e.jsxDEV("div",{style:{marginTop:8},children:M.validations.map((s,i)=>e.jsxDEV(D,{type:"error"===s.severity?"error":"warning"===s.severity?"warning":"success",message:s.message,size:"small",style:{marginBottom:4},showIcon:!0},i,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:328,columnNumber:41},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:326,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:323,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:311,columnNumber:21},void 0):e.jsxDEV(D,{type:"error",message:"Erreur de calcul",description:j.error,showIcon:!0,icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:348,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:343,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:305,columnNumber:13},void 0):null,t.capabilities&&t.capabilities.length>0&&e.jsxDEV("div",{style:{marginTop:16},children:e.jsxDEV(S,{type:"secondary",style:{fontSize:"12px"},children:["CapacitÃ©s : ",t.capabilities.join(", ")]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:392,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:391,columnNumber:17},void 0),O&&e.jsxDEV("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(255, 255, 255, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxDEV(n,{size:"large"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:412,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:400,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AdvancedSelectProfessional.tsx",lineNumber:356,columnNumber:9},void 0)},{Title:E,Text:A}=t,V=()=>{const{api:t}=i(),[r,n]=s.useState([]),[l,d]=s.useState(!1),c=b();return e.jsxDEV("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxDEV(E,{level:2,children:"ðŸ§ª Tests Advanced Select Professional"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:127,columnNumber:13},void 0),e.jsxDEV(A,{type:"secondary",children:"Cette page teste l'intÃ©gralitÃ© du systÃ¨me Advanced Select avec calculs automatiques, validation et templates no-code."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:130,columnNumber:13},void 0),e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:135,columnNumber:13},void 0),e.jsxDEV(a,{title:"ðŸŽ¯ Composant de Test en Direct",style:{marginBottom:"24px"},children:e.jsxDEV(g,{field:{id:c.prix_kwh,name:"Prix Kw/h Test",type:"advanced_select",organization_id:1,is_required:!1,capabilities:["dynamic_calculation","validation","workflow"],options:[{label:"Calcul automatique du prix",value:"calcul-du-prix-kwh",data:{nextField:{type:"number",placeholder:"Montant total facturÃ© (â‚¬)",validation:{required:!0,min:0}},formula:{type:"division",denominator:c.consommation,result_field:c.prix_mois,precision:3},businessLogic:{category:"energy_calculation",unit:"EUR/kWh"}}},{label:"Prix Kw/h connu",value:"prix-kwh",data:{nextField:{type:"number",placeholder:"Prix par Kw/h (â‚¬)",validation:{required:!0,min:0,step:.001}},workflow:{target_field:c.prix_mois,action:"copy_value"},businessLogic:{category:"direct_input",unit:"EUR/kWh"}}}]},value:null,onChange:e=>{},relatedFields:{[c.consommation]:8e3,[c.prix_mois]:null}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:139,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:138,columnNumber:13},void 0),e.jsxDEV(a,{title:"ðŸš€ Tests Automatiques",style:{marginBottom:"24px"},children:e.jsxDEV(v,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV(x,{type:"primary",icon:e.jsxDEV(f,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:204,columnNumber:31},void 0),onClick:async()=>{var e;d(!0),n([]);try{const s=await t.get(`/advanced-select/${c.prix_kwh}?organizationId=1`);n(e=>[...e,{test:"RÃ©cupÃ©ration champ Prix Kw/h",status:s.success?"success":"error",data:s.data,timestamp:(new Date).toLocaleTimeString()}]);const i={optionValue:"calcul-du-prix-kwh",inputData:1200,relatedFieldsData:{[c.consommation_kwh]:8e3},organizationId:"1"},r=await t.post(`/advanced-select/${c.prix_kwh}/calculate`,i);n(e=>[...e,{test:"Calcul automatique (1200â‚¬ / 8000 kWh)",status:r.success?"success":"error",data:r.data,expectedResult:"0.150 â‚¬/kWh",timestamp:(new Date).toLocaleTimeString()}]);const o=await t.post("/advanced-select/validate",{value:(null==(e=r.data)?void 0:e.result)||.15,unit:"EUR/kWh",rules:["realistic_energy_price"]});n(e=>{var s;return[...e,{test:"Validation Prix Ã‰nergÃ©tique",status:(null==(s=o.data)?void 0:s.isValid)?"success":"warning",data:o.data,timestamp:(new Date).toLocaleTimeString()}]});const l=await t.post("/advanced-select/templates",{templateType:"energy_pricing",fieldConfig:{consumptionFieldId:c.consommation,resultFieldId:c.prix_mois},organizationId:"1"});n(e=>[...e,{test:"Template Energy Pricing",status:l.success?"success":"error",data:l.data,timestamp:(new Date).toLocaleTimeString()}])}catch(s){n(e=>[...e,{test:"Erreur gÃ©nÃ©rale",status:"error",data:{error:s.message},timestamp:(new Date).toLocaleTimeString()}])}finally{d(!1)}},loading:l,size:"large",children:"Lancer la Suite de Tests ComplÃ¨te"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:202,columnNumber:21},void 0),e.jsxDEV(A,{type:"secondary",children:"Tests: RÃ©cupÃ©ration field â†’ Calcul automatique â†’ Validation â†’ Template no-code"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:211,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:201,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:200,columnNumber:13},void 0),r.length>0&&e.jsxDEV(a,{title:"ðŸ“Š RÃ©sultats des Tests",children:e.jsxDEV(v,{direction:"vertical",style:{width:"100%"},size:"large",children:r.map((s,i)=>e.jsxDEV(a,{size:"small",title:e.jsxDEV(v,{children:["success"===s.status&&e.jsxDEV(o,{style:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:227,columnNumber:73},void 0),"warning"===s.status&&e.jsxDEV(o,{style:{color:"#faad14"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:228,columnNumber:73},void 0),"error"===s.status&&e.jsxDEV(o,{style:{color:"#ff4d4f"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:229,columnNumber:71},void 0),e.jsxDEV("span",{children:s.test},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:230,columnNumber:41},void 0),e.jsxDEV(A,{type:"secondary",style:{fontSize:"12px"},children:s.timestamp},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:231,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:226,columnNumber:37},void 0),children:[s.expectedResult&&e.jsxDEV(A,{strong:!0,children:["RÃ©sultat attendu: ",s.expectedResult]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:238,columnNumber:37},void 0),e.jsxDEV("pre",{style:{background:"#f5f5f5",padding:"12px",borderRadius:"4px",fontSize:"12px",maxHeight:"300px",overflow:"auto"},children:JSON.stringify(s.data,null,2)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:240,columnNumber:33},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:222,columnNumber:29},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:220,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:219,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AdvancedSelectTestPage.tsx",lineNumber:126,columnNumber:9},void 0)};export{V as default};
