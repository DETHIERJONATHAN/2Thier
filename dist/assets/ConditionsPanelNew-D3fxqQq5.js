import{j as e}from"./index-C0S0DpaX.js";import{r as n,R as i}from"./react-vendor-Al_k-ZB6.js";import{u as r}from"./useAuthenticatedApi-BbQI8SDU.js";import{N as o}from"./NodeTreeSelector-BPMc5QXk.js";import{T as s}from"./TokenChip-CxHEbEuw.js";import{a as t,$ as a,T as c,I as l,B as m,an as d,a7 as p,b5 as u,s as h,aF as b,aC as f}from"./antd-vendor-zFcGztvE.js";const{Text:D}=c,v=e=>e.startsWith("@value.")?{kind:"nodeValue",ref:e}:e.startsWith("@select.")?{kind:"nodeOption",ref:e}:!e.startsWith("@")||e.startsWith("@value.")||e.startsWith("@select.")?e.startsWith("#")?{kind:"marker",ref:e}:{kind:"const",value:e}:{kind:"variable",ref:e},C=[{value:"==",label:"est √©gal √†"},{value:"!=",label:"est diff√©rent de"},{value:">",label:">"},{value:">=",label:">="},{value:"<",label:"<"},{value:"<=",label:"<="},{value:"contains",label:"contient"},{value:"startsWith",label:"commence par"},{value:"endsWith",label:"se termine par"},{value:"isEmpty",label:"est vide",needsRight:!1},{value:"isNotEmpty",label:"n'est pas vide",needsRight:!1}],N=({label:n,content:i,onClear:r,readOnly:o})=>e.jsxDEV("div",{style:{minWidth:220,minHeight:36,padding:"4px 8px",border:"1px solid #d9d9d9",borderRadius:6,background:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[e.jsxDEV(p,{title:n,children:e.jsxDEV("span",{style:{display:"inline-flex",alignItems:"center",gap:6,overflow:"hidden"},children:i||e.jsxDEV(D,{type:"secondary",children:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:68,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:67,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:66,columnNumber:5},void 0),!!i&&!o&&e.jsxDEV(m,{size:"small",type:"text",icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:72,columnNumber:46},void 0),onClick:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:72,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:57,columnNumber:3},void 0),x=({nodeId:r,value:c,onChange:p,readOnly:u})=>{var h,b,f,x,E,V,S,w;const k=n.useMemo(()=>{return(e=c).branches&&e.branches.length?e.branches[0]:{id:"b_"+Math.random().toString(36).slice(2),label:"Alors",actions:[]};var e},[c]),y=n.useMemo(()=>{return(e=k.when)&&"binary"===e.type?e:{id:"bin_"+Math.random().toString(36).slice(2),type:"binary",op:"==",left:void 0,right:void 0};var e},[k.when]),P=(null==(h=y.left)?void 0:h.ref)||(void 0!==(null==(b=y.left)?void 0:b.value)?String(null==(f=y.left)?void 0:f.value):void 0),g=(null==(x=y.right)?void 0:x.ref)||(void 0!==(null==(E=y.right)?void 0:E.value)?String(null==(V=y.right)?void 0:V.value):void 0),A=y.op,O=!1!==(null==(S=C.find(e=>e.value===A))?void 0:S.needsRight),[R,T]=n.useState(""),[j,M]=n.useState(""),L=n.useMemo(()=>{var e;return(null==(e=C.find(e=>e.value===A))?void 0:e.label)||String(A)},[A]),B=n.useCallback((e,n)=>{if(!A)return null;const i=A;if("isEmpty"===i)return 0===e.trim().length;if("isNotEmpty"===i)return e.trim().length>0;const r=Number(e),o=Number(n),s=!Number.isNaN(r)&&!Number.isNaN(o);switch(i){case"==":return s?r===o:e===n;case"!=":return s?r!==o:e!==n;case">":return s?r>o:e>n;case">=":return s?r>=o:e>=n;case"<":return s?r<o:e<o;case"<=":return s?r<=o:e<=o;case"contains":return e.includes(n);case"startsWith":return e.startsWith(n);case"endsWith":return e.endsWith(n);default:return null}},[A]),U=n.useMemo(()=>B(R,j),[R,j,B]),W=e=>{const n={...y,...e},i={...k,when:n},r=c.branches&&c.branches.length?[i,...c.branches.slice(1)]:[i];p({...c,branches:r})},I=(k.actions||[]).find(e=>"SHOW"===e.type),z=(null==I?void 0:I.nodeIds)||[],$=e=>{const n=[...k.actions||[]],i=n.findIndex(e=>"SHOW"===e.type);i>=0?n[i]={...n[i],nodeIds:e}:n.push({id:"a_"+Math.random().toString(36).slice(2),type:"SHOW",nodeIds:e});const r={...k,actions:n},o=c.branches&&c.branches.length?[r,...c.branches.slice(1)]:[r];p({...c,branches:o})},_=((null==(w=c.fallback)?void 0:w.actions)||[]).find(e=>"SHOW"===e.type),H=(null==_?void 0:_.nodeIds)||[],F=e=>{const n=c.fallback?{...c.fallback}:{id:"fb_"+Math.random().toString(36).slice(2),label:"Sinon",actions:[]},i=[...n.actions||[]],r=i.findIndex(e=>"SHOW"===e.type);r>=0?i[r]={...i[r],nodeIds:e}:i.push({id:"a_"+Math.random().toString(36).slice(2),type:"SHOW",nodeIds:e});const o={...n,actions:i};p({...c,fallback:o})},[q,J]=i.useState(!1),[X,Z]=i.useState(!1),[G,K]=i.useState(!1),[Q,Y]=i.useState(!1),ee=n=>n?e.jsxDEV(s,{token:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:162,columnNumber:12},void 0):null,ne=e=>n=>{if("left"===e)W({left:v(n.ref)});else if("right"===e)W({right:v(n.ref)});else if("then"===e){let e;e=n.ref.startsWith("node-formula:")||n.ref.startsWith("formula:")?n.ref:n.ref.startsWith("@value.")?n.ref.slice(7):n.ref,$(Array.from(new Set([...z||[],e])))}else if("else"===e){let e;e=n.ref.startsWith("node-formula:")||n.ref.startsWith("formula:")?n.ref:n.ref.startsWith("@value.")?n.ref.slice(7):n.ref,F(Array.from(new Set([...H||[],e])))}};return e.jsxDEV(t,{size:"small",variant:"outlined",style:{background:"#fff"},children:[e.jsxDEV(a,{direction:"vertical",style:{width:"100%"},size:8,children:[e.jsxDEV("div",{style:{padding:"4px 6px",background:"#fafafa",border:"1px solid #f0f0f0",borderRadius:6},children:[e.jsxDEV("div",{style:{display:"flex",flexWrap:"wrap",gap:6,alignItems:"center"},children:[e.jsxDEV(D,{type:"secondary",children:"R√©sum√©:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:207,columnNumber:13},void 0),e.jsxDEV("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.jsxDEV(D,{children:"SI"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:209,columnNumber:15},void 0),ee(P)||e.jsxDEV(D,{type:"secondary",children:"(champ)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:210,columnNumber:42},void 0),e.jsxDEV(D,{children:L},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:211,columnNumber:15},void 0),O?ee(g)||e.jsxDEV(D,{type:"secondary",children:"(valeur)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:212,columnNumber:57},void 0):null,e.jsxDEV(D,{children:["‚Üí ALORS (",(z||[]).length,") / SINON (",(H||[]).length,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:213,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:208,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:206,columnNumber:11},void 0),e.jsxDEV("div",{style:{display:"flex",flexWrap:"wrap",gap:6,alignItems:"center",marginTop:6},children:[e.jsxDEV(D,{type:"secondary",children:"Test:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:217,columnNumber:13},void 0),e.jsxDEV(l,{size:"small",placeholder:"Valeur test gauche",value:R,onChange:e=>T(e.target.value),style:{width:160}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:218,columnNumber:13},void 0),O&&e.jsxDEV(l,{size:"small",placeholder:"Valeur test droite",value:j,onChange:e=>M(e.target.value),style:{width:160}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:220,columnNumber:15},void 0),e.jsxDEV(D,{children:["R√©sultat: "," ",null===U?e.jsxDEV(D,{type:"secondary",children:"‚Äî"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:225,columnNumber:17},void 0):U?e.jsxDEV(D,{type:"success",children:"VRAI ‚Üí ALORS"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:227,columnNumber:17},void 0):e.jsxDEV(D,{type:"danger",children:"FAUX ‚Üí SINON"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:229,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:222,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:216,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:205,columnNumber:9},void 0),e.jsxDEV(D,{strong:!0,children:"SI"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:234,columnNumber:9},void 0),e.jsxDEV(a,{wrap:!0,children:[e.jsxDEV(N,{label:"R√©f√©rence (gauche)",content:ee(P),onClear:()=>W({left:void 0}),readOnly:u},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:236,columnNumber:11},void 0),e.jsxDEV(m,{size:"small",onClick:()=>J(!0),children:"S√©lectionner‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:242,columnNumber:11},void 0),e.jsxDEV(d,{size:"small",value:y.op,style:{minWidth:160},onChange:e=>W({op:e}),options:C.map(e=>({value:e.value,label:e.label})),disabled:u},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:243,columnNumber:11},void 0),O&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV(N,{label:"Valeur (droite)",content:ee(g),onClear:()=>W({right:void 0}),readOnly:u},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:253,columnNumber:15},void 0),e.jsxDEV(m,{size:"small",onClick:()=>Z(!0),children:"S√©lectionner‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:259,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:252,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:235,columnNumber:9},void 0),e.jsxDEV(D,{type:"secondary",style:{fontSize:12},children:"Utilisez les boutons ¬´ S√©lectionner‚Ä¶ ¬ª pour choisir vos r√©f√©rences. Le glisser-d√©poser depuis la Structure est d√©sactiv√© ici."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:263,columnNumber:9},void 0),e.jsxDEV("div",{style:{height:1,background:"#f0f0f0",margin:"4px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:266,columnNumber:9},void 0),e.jsxDEV(D,{strong:!0,children:"ALORS"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:267,columnNumber:9},void 0),z&&z.length?e.jsxDEV(a,{wrap:!0,children:z.map(n=>{const i=n.startsWith("formula:")||n.startsWith("node-formula:")?n:`@value.${n}`;return e.jsxDEV(s,{token:i,onRemove:()=>!u&&$(z.filter(e=>e!==n))},n,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:276,columnNumber:17},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:271,columnNumber:11},void 0):e.jsxDEV(D,{type:"secondary",children:"Aucun n≈ìud s√©lectionn√©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:269,columnNumber:11},void 0),e.jsxDEV(m,{size:"small",onClick:()=>K(!0),children:"S√©lectionner des n≈ìuds‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:281,columnNumber:9},void 0),e.jsxDEV("div",{style:{height:1,background:"#f0f0f0",margin:"4px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:283,columnNumber:9},void 0),e.jsxDEV(D,{strong:!0,children:"SINON"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:284,columnNumber:9},void 0),H&&H.length?e.jsxDEV(a,{wrap:!0,children:H.map(n=>{const i=n.startsWith("formula:")||n.startsWith("node-formula:")?n:`@value.${n}`;return e.jsxDEV(s,{token:i,onRemove:()=>!u&&F(H.filter(e=>e!==n))},n,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:293,columnNumber:17},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:288,columnNumber:11},void 0):e.jsxDEV(D,{type:"secondary",children:"Aucun n≈ìud s√©lectionn√©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:286,columnNumber:11},void 0),e.jsxDEV(m,{size:"small",onClick:()=>Y(!0),children:"S√©lectionner des n≈ìuds‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:298,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:203,columnNumber:7},void 0),e.jsxDEV(o,{nodeId:r,open:q,onClose:()=>J(!1),onSelect:ne("left")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:300,columnNumber:3},void 0),e.jsxDEV(o,{nodeId:r,open:X,onClose:()=>Z(!1),onSelect:ne("right")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:301,columnNumber:3},void 0),e.jsxDEV(o,{nodeId:r,open:G,onClose:()=>K(!1),onSelect:ne("then"),selectionContext:"nodeId"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:302,columnNumber:3},void 0),e.jsxDEV(o,{nodeId:r,open:Q,onClose:()=>Y(!1),onSelect:ne("else"),selectionContext:"nodeId"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:303,columnNumber:3},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/conditions/ConditionsDnDComposer.tsx",lineNumber:202,columnNumber:5},void 0)},{Title:E,Text:V}=c,S=e=>({id:`cond_${e}`,tokens:[],mode:"first-match",branches:[]}),w=({nodeId:i,value:o,onChange:s,onNodeUpdate:c,readOnly:p})=>{var D;const{api:v}=r(),[C,N]=n.useState([]),[w,k]=n.useState(null),[y,P]=n.useState(null),[g,A]=n.useState(""),[O,R]=n.useState(""),[T,j]=n.useState(!1),[M,L]=n.useState(!1),[B,U]=n.useState(!1),W=n.useRef(null),I=n.useRef(0),z=n.useCallback((e,n=600)=>{W.current&&window.clearTimeout(W.current),W.current=window.setTimeout(e,n)},[]),$=n.useCallback(async e=>{if(!i)return;const{id:n,name:r,conditionSet:t,description:a}=e;if(r&&t)try{if(L(!0),n.startsWith("temp_")){const e=await v.post(`/api/treebranchleaf/nodes/${i}/conditions`,{name:r.trim()||"Conditions",conditionSet:t,description:a||""});N(i=>i.map(i=>i.id===n?{...i,id:e.id,name:e.name,conditionSet:e.conditionSet,description:e.description||""}:i)),k(e.id),I.current=Date.now(),L(!1),U(!1);try{await(null==c?void 0:c({id:i,hasCondition:!0}))}catch(l){}return null==s||s({...o||{},activeConditionId:e.id,conditions:C.map(i=>i.id===n?{id:e.id,name:e.name}:{id:i.id,name:i.name}),lastSavedAt:I.current}),e}{const e=await v.put(`/api/treebranchleaf/nodes/${i}/conditions/${n}`,{name:r.trim()||"Conditions",conditionSet:t,description:a||""});return N(i=>i.map(i=>i.id===n?{...i,name:e.name,conditionSet:e.conditionSet,description:e.description||""}:i)),I.current=Date.now(),L(!1),U(!1),null==s||s({...o||{},activeConditionId:n,conditions:C.map(e=>({id:e.id,name:e.name})),lastSavedAt:I.current}),e}}catch(l){n.startsWith("temp_")&&h.error("Impossible de sauvegarder la condition"),L(!1)}},[v,i,s,o,C,c]),_=n.useCallback(e=>{z(()=>{$(e)})},[z,$]),H=n.useCallback(e=>{if(!e||"object"!=typeof e)return S(i);const n=e;return{id:"string"==typeof n.id?n.id:`cond_${i}`,tokens:Array.isArray(n.tokens)?n.tokens:[],mode:"first-match"===n.mode||"all-match"===n.mode?n.mode:"first-match",branches:Array.isArray(n.branches)?n.branches:[],fallback:n.fallback||void 0}},[i]),F=n.useCallback(async()=>{if(i)try{j(!0);const e=(await v.get(`/api/treebranchleaf/nodes/${i}/conditions`)).conditions||[];if(0===e.length){const e={id:`temp_${Date.now()}`,nodeId:i,name:"Conditions 1",conditionSet:S(i),description:"",isDefault:!0,order:0};N([e]),k(e.id),P(e.conditionSet),A(e.name),R(e.description||"")}else{N(e);const n=e[0];n&&(k(n.id),P(H(n.conditionSet)),A(n.name),R(n.description||""))}}catch(e){h.error("Impossible de charger les conditions")}finally{j(!1)}},[v,i,H]);n.useEffect(()=>{F()},[F]);const q=n.useCallback(e=>{A(e),U(!0),w&&y&&_({id:w,name:e,conditionSet:y,description:O})},[w,y,O,_]),J=n.useCallback(e=>{R(e),U(!0),w&&y&&_({id:w,name:g,conditionSet:y,description:e})},[w,g,y,_]),X=n.useCallback(async()=>{const e={id:`temp_${Date.now()}`,nodeId:i,name:`Conditions ${C.length+1}`,conditionSet:S(i),description:"",isDefault:!1,order:C.length};N(n=>[...n,e]),k(e.id),P(e.conditionSet),A(e.name),R(e.description||"")},[C,i]),Z=n.useCallback(e=>{const n=C.find(n=>n.id===e);n&&(k(e),P(H(n.conditionSet)),A(n.name),R(n.description||""))},[C,H]),G=n.useCallback(async()=>{if(!w||!i)return;const e=C.find(e=>e.id===w);if(!e)return;if(window.confirm(`Supprimer d√©finitivement la condition "${e.name}" ?`))try{w.startsWith("temp_")||await v.delete(`/api/treebranchleaf/nodes/${i}/conditions/${w}`);const r=C.filter(e=>e.id!==w);N(r);try{await(null==c?void 0:c({id:i,hasCondition:r.length>0}))}catch(n){}const o=r[0]||null;if(k(o?o.id:null),o)P(H(o.conditionSet)),A(o.name),R(o.description||"");else{const e=S(i);P(e),A(""),R("")}h.success(`Condition "${e.name}" supprim√©e`)}catch(r){h.error("Impossible de supprimer la condition")}},[v,w,C,H,i,c]),K=n.useCallback(e=>{P(e),U(!0),w&&g&&_({id:w,name:g,conditionSet:e,description:O})},[w,g,O,_]);return T?e.jsxDEV(t,{size:"small",variant:"outlined",children:[e.jsxDEV(E,{level:5,children:"‚öñÔ∏è Conditions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:402,columnNumber:9},void 0),e.jsxDEV(V,{children:"Chargement..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:403,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:401,columnNumber:7},void 0):e.jsxDEV(t,{size:"small",variant:"outlined",children:[e.jsxDEV(E,{level:5,children:"‚öñÔ∏è Conditions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:410,columnNumber:7},void 0),e.jsxDEV(a,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[e.jsxDEV("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxDEV(V,{type:"secondary",children:"Condition:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:415,columnNumber:11},void 0),e.jsxDEV(d,{size:"small",style:{minWidth:200,flex:1},value:w||void 0,onChange:Z,options:C.map(e=>({value:e.id,label:e.name||"Sans nom"})),placeholder:"S√©lectionner une condition"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:416,columnNumber:11},void 0),e.jsxDEV(m,{size:"small",icon:e.jsxDEV(b,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:427,columnNumber:40},void 0),onClick:X,disabled:p,children:"Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:427,columnNumber:13},void 0),e.jsxDEV(m,{size:"small",disabled:p||!w,onClick:()=>{if(!w)return;const e=C.find(e=>e.id===w);if(!e)return;const n={...e,id:`temp_${Date.now()}`,name:e.name+" (copie)",conditionSet:JSON.parse(JSON.stringify(e.conditionSet)),isDefault:!1,order:C.length};N(e=>[...e,n]),k(n.id),P(n.conditionSet),A(n.name),R(n.description||""),U(!0)},children:"Dupliquer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:428,columnNumber:13},void 0),e.jsxDEV(m,{size:"small",danger:!0,icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:450,columnNumber:19},void 0),onClick:G,disabled:p||!w,children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:447,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:414,columnNumber:9},void 0),e.jsxDEV("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxDEV(V,{type:"secondary",children:"Nom:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:460,columnNumber:11},void 0),e.jsxDEV(l,{size:"small",style:{flex:1,maxWidth:300},placeholder:"Nom de la condition",value:g,onChange:e=>q(e.target.value),disabled:p},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:461,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:459,columnNumber:9},void 0),e.jsxDEV("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxDEV(V,{type:"secondary",children:"Description:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:473,columnNumber:11},void 0),e.jsxDEV(l.TextArea,{size:"small",style:{flex:1},placeholder:"Description de la condition (optionnel)",value:O,onChange:e=>J(e.target.value),disabled:p,rows:2},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:474,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:472,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:413,columnNumber:7},void 0),e.jsxDEV(f,{style:{margin:"12px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:486,columnNumber:7},void 0),e.jsxDEV("div",{style:{marginBottom:12,padding:"8px 12px",background:"#fafafa",border:"1px solid #f0f0f0",borderRadius:6},children:[e.jsxDEV(V,{strong:!0,style:{marginRight:8},children:"R√©sum√©:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:496,columnNumber:9},void 0),e.jsxDEV("div",{children:e.jsxDEV(V,{type:"secondary",children:["Branches: ",(null==(D=null==y?void 0:y.branches)?void 0:D.length)||0," | Mode: ",(null==y?void 0:y.mode)||"first-match"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:498,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:497,columnNumber:9},void 0),e.jsxDEV("div",{style:{marginTop:4},children:e.jsxDEV(V,{type:"secondary",style:{fontSize:12},children:"Utilisez l'√©diteur ci-dessous pour configurer les r√®gles conditionnelles."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:504,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:503,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:489,columnNumber:7},void 0),y&&e.jsxDEV(x,{nodeId:i,value:y,onChange:K,readOnly:p},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:512,columnNumber:9},void 0),e.jsxDEV("div",{style:{marginTop:8,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[e.jsxDEV(V,{type:"secondary",style:{fontSize:12},children:M?"üíæ Sauvegarde‚Ä¶":B?"‚è≥ (non sauvegard√©)":"‚úÖ Enregistr√©"+(I.current?" ‚Ä¢ "+new Date(I.current).toLocaleTimeString():"")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:520,columnNumber:9},void 0),e.jsxDEV(V,{type:"secondary",style:{fontSize:12},children:["‚Ä¢ ",C.length," condition(s)"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:523,columnNumber:9},void 0),w&&e.jsxDEV(V,{type:"secondary",style:{fontSize:12},children:["‚Ä¢ Actif: ",g||w]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:524,columnNumber:22},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:519,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/ConditionsPanelNew.tsx",lineNumber:409,columnNumber:5},void 0)};export{w as default};
