import{u as e,j as s}from"./index-C0S0DpaX.js";import{r as i,R as r}from"./react-vendor-Al_k-ZB6.js";import{u as a}from"./useAuthenticatedApi-BbQI8SDU.js";import{a as n}from"./Notifications-Bhgc2wzd.js";import{aZ as l,a0 as o,ab as t,aM as m,$ as d,a7 as c,B as u,y as p,b3 as g,b5 as h,bp as N,aF as b,a as v,aj as D,bM as x,a3 as C,f as A,z as E,an as f,b as R,aG as V,F as S,I as k,a8 as y}from"./antd-vendor-zFcGztvE.js";const{useBreakpoint:j}=l;function M({open:e,initial:a,organizations:n,isSuperAdmin:l,onCancel:t,onSubmit:m,confirmLoading:c}){const[p]=S.useForm(),g=!j().md,h=!!(null==a?void 0:a.id),N="super_admin"===(null==a?void 0:a.name);r.useEffect(()=>{e&&(p.resetFields(),p.setFieldsValue({name:(null==a?void 0:a.name)??"",label:(null==a?void 0:a.label)??"",description:(null==a?void 0:a.description)??"",organizationId:l?a?a.organizationId??"global":"global":void 0}))},[e,a,l,p]);const b=i.useCallback(async e=>{const s={...e};l&&"global"===s.organizationId&&(s.organizationId=null);try{await m(s)}catch{}},[l,m]);return s.jsxDEV(o,{title:h?`Modifier le rôle : ${null==a?void 0:a.label}`:"Nouveau rôle",open:e,onCancel:t,destroyOnClose:!0,maskClosable:!1,centered:!g,width:g?"100%":520,style:g?{top:16}:void 0,bodyStyle:{padding:g?16:void 0},footer:s.jsxDEV(d,{direction:g?"vertical":"horizontal",style:{width:"100%",justifyContent:g?"stretch":"flex-end"},size:12,children:[s.jsxDEV(u,{onClick:t,block:g,children:"Annuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:122,columnNumber:11},this),s.jsxDEV(u,{type:"primary",htmlType:"submit",form:"role-form-modal",loading:!!c,block:g,children:h?"Enregistrer":"Créer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:125,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:117,columnNumber:9},this),children:[s.jsxDEV(R,{className:"mb-3",message:"Conseil",description:"Le nom technique sert d'identifiant unique (ex: admin, manager). Le rôle 'super_admin' est réservé et non modifiable.",type:"info",showIcon:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:137,columnNumber:7},this),s.jsxDEV(S,{form:p,layout:"vertical",id:"role-form-modal",name:"role-form-modal",onFinish:b,className:"space-y-4",children:[s.jsxDEV(S.Item,{name:"name",label:"Nom technique",rules:[{required:!0,message:"Veuillez entrer un nom technique"},{min:2,message:"Minimum 2 caractères"},{max:50,message:"Maximum 50 caractères"},{pattern:/^[a-zA-Z0-9_\-\s]+$/,message:"Caractères non autorisés"}],children:s.jsxDEV(k,{disabled:N,placeholder:"ex: admin, manager, support"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:162,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:152,columnNumber:9},this),s.jsxDEV(S.Item,{name:"label",label:"Label",rules:[{required:!0,message:"Veuillez entrer un label"}],children:s.jsxDEV(k,{placeholder:"Nom affiché (ex: Administrateur, Manager)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:165,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:164,columnNumber:9},this),s.jsxDEV(S.Item,{name:"description",label:"Description",children:s.jsxDEV(k.TextArea,{placeholder:"Description du rôle (optionnel)",autoSize:{minRows:2,maxRows:4}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:168,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:167,columnNumber:9},this),l&&s.jsxDEV(S.Item,{name:"organizationId",label:"Portée du rôle",children:s.jsxDEV(f,{options:[{value:"global",label:"Rôle Global (visible par toutes les organisations)"},...n.map(e=>({value:e.id,label:e.name}))],showSearch:!0,optionFilterProp:"label",placeholder:"Sélectionner une organisation ou global",popupMatchSelectWidth:!1},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:172,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:171,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:144,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:106,columnNumber:5},this)}function O({role:e,open:r,onClose:l}){const{api:t,isLoading:c}=a(),p=!j().md,[g,h]=i.useState([]),[N,b]=i.useState([]),[v,D]=i.useState(!1),[x,C]=i.useState(""),A=i.useCallback(async()=>{if(null==e?void 0:e.id)try{const s=e.organizationId?`/api/permissions?roleId=${e.id}&organizationId=${e.organizationId}`:`/api/permissions?roleId=${e.id}`,i=await t.get(s);if(!i.success)throw new Error(i.message||"Erreur lors du chargement des permissions");h(Array.isArray(i.data)?i.data:[])}catch(s){const e=s.message||"Erreur lors du chargement des permissions";C(e),n.error(e)}},[t,e.id,e.organizationId]),E=i.useCallback(async()=>{try{const s=e.organizationId?`/api/modules?organizationId=${e.organizationId}`:"/api/modules",i=await t.get(s);if(!i.success)throw new Error(i.message||"Erreur lors du chargement des modules");{const s=Array.isArray(i.data)?i.data:[],r=e.organizationId?s.filter(e=>e.isActiveForOrg):s.filter(e=>e.active);b(r)}}catch(s){const e=s.message||"Erreur lors du chargement des modules";C(e),n.error(e)}},[t,e.organizationId]);i.useEffect(()=>{r&&(C(""),A(),E())},[r,A,E]);const f=i.useCallback((s,i)=>{var r;const a=[...g],n=a.findIndex(e=>e.moduleId===s&&"access"===e.action),l=null==(r=N.find(e=>e.id===s))?void 0:r.key;n>-1?a[n]={...a[n],allowed:i}:i&&a.push({roleId:e.id,organizationId:e.organizationId,moduleId:s,action:"access",resource:l,allowed:!0}),h(a)},[g,N,e.id,e.organizationId]),S=i.useCallback(async()=>{D(!0);try{const s={roleId:e.id,organizationId:e.organizationId,permissions:g.map(({moduleId:e,action:s,resource:i,allowed:r})=>({moduleId:e,action:s,resource:i,allowed:r}))},i=await t.post("/api/permissions/bulk",s);if(!i.success)throw new Error(i.message||"Erreur lors de la sauvegarde des permissions");n.success("Permissions sauvegardées avec succès."),l()}catch(s){const e=s.message||"Erreur lors de la sauvegarde des permissions";C(e),n.error(e)}finally{D(!1)}},[t,e.id,e.organizationId,g,l]),k=i.useMemo(()=>[{title:"Module",dataIndex:"label",key:"label",render:(e,i)=>s.jsxDEV("span",{children:[i.label," ",s.jsxDEV("span",{style:{color:"#999",fontSize:12},children:["(",i.key,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:298,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:297,columnNumber:11},this)},{title:"Accès",key:"access",width:p?120:160,render:(e,i)=>{const r=g.find(e=>e.moduleId===i.id&&"access"===e.action),a=!(!r||!r.allowed);return s.jsxDEV(m,{checked:a,onChange:e=>f(i.id,e),size:p?"small":"default"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:310,columnNumber:13},this)}}],[g,f,p]),M=N.length>0&&N.every(e=>g.find(s=>s.moduleId===e.id&&s.allowed)),O=c&&!g.length&&!N.length;return s.jsxDEV(o,{title:s.jsxDEV("span",{children:["Permissions du rôle ",s.jsxDEV(y,{color:"gold",text:e.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:329,columnNumber:31},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:328,columnNumber:9},this),open:r,onCancel:l,footer:s.jsxDEV(d,{direction:p?"vertical":"horizontal",style:{width:"100%",justifyContent:p?"stretch":"flex-end"},size:12,children:[s.jsxDEV(u,{onClick:l,block:p,children:"Annuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:340,columnNumber:11},this),s.jsxDEV(u,{type:"primary",loading:v,onClick:S,block:p,children:"Sauvegarder"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:343,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:335,columnNumber:9},this),destroyOnClose:!0,centered:!p,width:p?"100%":720,style:p?{top:16}:void 0,bodyStyle:{padding:p?16:void 0},children:[x&&s.jsxDEV(R,{type:"error",message:x,className:"mb-3"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:354,columnNumber:17},this),s.jsxDEV("div",{className:"flex items-center gap-3 mb-3 "+(p?"flex-wrap text-sm":""),children:[s.jsxDEV("span",{className:"font-semibold",children:"Tout activer/désactiver"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:356,columnNumber:9},this),s.jsxDEV(m,{checked:M,onChange:s=>{const i=[...g];N.forEach(r=>{const a=i.findIndex(e=>e.moduleId===r.id&&"access"===e.action);a>-1?i[a].allowed=s:s&&i.push({roleId:e.id,organizationId:e.organizationId,moduleId:r.id,action:"access",resource:r.key,allowed:!0})}),h(i)},size:p?"small":"default"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:357,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:355,columnNumber:7},this),s.jsxDEV(V,{size:p?"small":"middle",rowKey:e=>e.id,columns:k,dataSource:N,pagination:!1,loading:O,scroll:{x:"max-content"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:359,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:326,columnNumber:5},this)}function P(){const{isSuperAdmin:r,selectedOrganization:l}=e(),S=null==l?void 0:l.id,{api:k,isLoading:y}=a(),P=!j().md,[U,w]=i.useState([]),[z,I]=i.useState([]),[G,F]=i.useState(""),[$,L]=i.useState(null),[T,q]=i.useState(null),[_,B]=i.useState(!1),[K,W]=i.useState(!1),[Z,H]=i.useState(null),J=i.useCallback(async e=>{const s=r?G:S;if(!e.isGlobal||!s)return;const i=!e.isActiveForOrg;try{const r=await k.patch("/api/roles/status",{roleId:e.id,organizationId:s,active:i});if(!r.success)throw new Error(r.message||"Erreur lors de la mise à jour du statut.");n.success(`Statut du rôle '${e.label}' mis à jour.`),w(s=>s.map(s=>s.id===e.id?{...s,isActiveForOrg:i}:s))}catch(a){n.error(a.message||"Erreur lors de la mise à jour du statut.")}},[k,r,G,S]);i.useEffect(()=>{r&&k.get("/api/organizations").then(e=>{e.success&&Array.isArray(e.data)&&I(e.data)})},[r,k]),i.useEffect(()=>{!r&&S&&F(S)},[S,r]);const Q=i.useCallback(async()=>{const e=r?G:S;if(!r&&!e)return w([]),void L(null);L(null);try{const s=e?`/api/roles?organizationId=${e}`:"/api/roles",i=await k.get(s);if(!i.success)throw new Error(i.message||"Erreur lors du chargement des rôles.");w(Array.isArray(i.data)?i.data:[])}catch(s){const e=s.message||"Erreur lors du chargement des rôles";L(e),n.error(e),w([])}},[k,S,r,G]);i.useEffect(()=>{Q()},[Q]);const X=i.useCallback(async e=>{o.confirm({title:`Supprimer le rôle « ${e.label} » ?`,content:"Cette action est irréversible.",okText:"Supprimer",okButtonProps:{danger:!0},cancelText:"Annuler",onOk:async()=>{try{const s=await k.delete(`/api/roles/${e.id}`);if(!s.success)throw new Error(s.message||"La suppression du rôle a échoué.");n.success("Rôle supprimé avec succès."),Q()}catch(s){n.error(s.message||"La suppression du rôle a échoué.")}}})},[k,Q]),Y=i.useMemo(()=>{const e=r?G:S;return[{title:"Nom",dataIndex:"name",key:"name",ellipsis:!0,render:e=>s.jsxDEV("span",{className:"font-medium text-gray-800",children:e},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:537,columnNumber:36},this)},{title:"Label",dataIndex:"label",key:"label",ellipsis:!0,render:e=>s.jsxDEV("span",{className:"text-gray-600",children:e},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:544,columnNumber:36},this)},{title:"Organisation",key:"organization",responsive:["sm"],render:(e,i)=>{var r;return i.organizationId?s.jsxDEV(t,{color:"blue",children:(null==(r=i.organization)?void 0:r.name)||"N/A"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:551,columnNumber:30},this):s.jsxDEV(t,{children:"Global"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:551,columnNumber:88},this)}},{title:"Statut",key:"status",align:"center",width:P?120:140,render:(i,r)=>r.isGlobal&&e?s.jsxDEV(m,{checked:!!r.isActiveForOrg,onChange:()=>J(r),disabled:"super_admin"===r.name,size:P?"small":"default"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:560,columnNumber:13},this):s.jsxDEV("span",{style:{color:"#999"},children:"—"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:567,columnNumber:13},this)},{title:"Actions",key:"actions",width:P?void 0:160,render:(e,i)=>s.jsxDEV(d,{size:P?8:12,wrap:!0,className:P?"w-full":void 0,children:[s.jsxDEV(c,{title:r||!i.isGlobal||i.isActiveForOrg?"Gérer les permissions":"Activer le rôle pour modifier les permissions",children:s.jsxDEV(u,{size:"small",icon:s.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:583,columnNumber:23},this),onClick:()=>H(i),disabled:!r&&i.isGlobal&&!i.isActiveForOrg,shape:"circle","aria-label":"Gérer les permissions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:581,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:580,columnNumber:13},this),s.jsxDEV(c,{title:"Modifier le rôle",children:s.jsxDEV(u,{size:"small",icon:s.jsxDEV(g,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:593,columnNumber:23},this),disabled:"super_admin"===i.name||i.isGlobal&&!r,onClick:()=>{q(i),B(!0)},shape:"circle","aria-label":"Modifier le rôle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:591,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:590,columnNumber:13},this),s.jsxDEV(c,{title:"Supprimer le rôle",children:s.jsxDEV(u,{size:"small",danger:!0,icon:s.jsxDEV(h,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:607,columnNumber:23},this),disabled:"super_admin"===i.name||i.isGlobal&&!r,onClick:()=>X(i),shape:"circle","aria-label":"Supprimer le rôle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:604,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:603,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:575,columnNumber:11},this)}]},[r,G,S,J,X,P]),ee=i.useMemo(()=>{if(P)return{expandedRowRender:e=>{var i;return s.jsxDEV("div",{className:"space-y-2 text-sm",children:[s.jsxDEV("div",{children:[s.jsxDEV("span",{className:"font-semibold text-gray-600",children:"Organisation :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:626,columnNumber:13},this)," ",e.organizationId?(null==(i=e.organization)?void 0:i.name)??"N/A":"Global"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:625,columnNumber:11},this),e.description&&s.jsxDEV("div",{children:[s.jsxDEV("span",{className:"font-semibold text-gray-600",children:"Description :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:631,columnNumber:15},this)," ",e.description]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:630,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:624,columnNumber:9},this)},expandRowByClick:!0,showExpandColumn:!1}},[P]);return s.jsxDEV("div",{className:"min-h-screen bg-gray-50 p-4 md:p-6",children:[s.jsxDEV("style",{children:"\n.roles-compact-table .ant-table-thead > tr > th,\n.roles-compact-table .ant-table-tbody > tr > td {\n  padding: 6px 10px;\n}\n\n.roles-compact-table .ant-table-tbody > tr > td {\n  line-height: 1.2;\n}\n"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:643,columnNumber:7},this),s.jsxDEV("div",{className:"mb-4 flex flex-wrap items-start gap-3 md:items-center md:justify-between",children:[s.jsxDEV("h1",{className:"flex items-center text-xl font-semibold text-gray-900 md:text-2xl",children:[s.jsxDEV(N,{className:"mr-2 text-orange-500 md:mr-3"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:646,columnNumber:11},this),s.jsxDEV("span",{children:"Gestion des Rôles"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:647,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:645,columnNumber:9},this),s.jsxDEV(u,{type:"primary",icon:s.jsxDEV(b,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:651,columnNumber:17},this),onClick:()=>{q(null),B(!0)},block:P,size:P?"large":"middle",children:"Nouveau Rôle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:649,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:644,columnNumber:7},this),s.jsxDEV("div",{className:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[s.jsxDEV(v,{size:P?"small":"default",className:"shadow-sm",bodyStyle:{padding:P?16:20},children:s.jsxDEV(D,{title:"Total Rôles",value:U.length,prefix:s.jsxDEV(x,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:666,columnNumber:71},this),valueStyle:{color:"#1890ff"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:666,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:665,columnNumber:9},this),s.jsxDEV(v,{size:P?"small":"default",className:"shadow-sm",bodyStyle:{padding:P?16:20},children:s.jsxDEV(D,{title:"Rôles Actifs",value:U.filter(e=>!e.isGlobal||e.isActiveForOrg).length,prefix:s.jsxDEV(C,{style:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:672,columnNumber:21},this),valueStyle:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:669,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:668,columnNumber:9},this),s.jsxDEV(v,{size:P?"small":"default",className:"shadow-sm",bodyStyle:{padding:P?16:20},children:s.jsxDEV(D,{title:"Rôles Globaux",value:U.filter(e=>e.isGlobal).length,prefix:s.jsxDEV(A,{style:{color:"#722ed1"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:680,columnNumber:21},this),valueStyle:{color:"#722ed1"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:677,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:676,columnNumber:9},this),s.jsxDEV(v,{size:P?"small":"default",className:"shadow-sm",bodyStyle:{padding:P?16:20},children:s.jsxDEV(D,{title:"Organisations",value:new Set(U.filter(e=>e.organization).map(e=>{var s;return null==(s=e.organization)?void 0:s.id})).size,prefix:s.jsxDEV(E,{style:{color:"#fa8c16"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:688,columnNumber:21},this),valueStyle:{color:"#fa8c16"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:685,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:684,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:664,columnNumber:7},this),r&&s.jsxDEV(v,{className:"mb-4 shadow-sm",size:"small",bodyStyle:{padding:P?12:16},children:s.jsxDEV(d,{direction:P?"vertical":"horizontal",className:"w-full",align:P?"start":"center",size:12,children:[s.jsxDEV("span",{className:"font-semibold text-sm md:text-base",children:"Filtrer par organisation :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:706,columnNumber:13},this),s.jsxDEV(f,{value:G,onChange:e=>F(e??""),style:{width:P?"100%":320},options:[{value:"",label:"Toutes les organisations & Rôles Globaux"},...z.map(e=>({value:e.id,label:e.name}))],showSearch:!0,allowClear:!0,placeholder:"Toutes les organisations & Rôles Globaux",optionFilterProp:"label",dropdownMatchSelectWidth:!1},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:707,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:700,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:695,columnNumber:9},this),$&&s.jsxDEV(R,{type:"error",message:$,className:"mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:722,columnNumber:17},this),s.jsxDEV(v,{className:"shadow-sm",bodyStyle:{padding:P?0:24},children:s.jsxDEV("div",{className:P?"overflow-x-auto":void 0,children:s.jsxDEV(V,{rowKey:e=>e.id,columns:Y,dataSource:U,loading:y,size:"small",pagination:{pageSize:P?5:10,showSizeChanger:!P,position:P?["bottomCenter"]:["bottomRight"]},scroll:P?{x:720}:void 0,expandable:ee,locale:{emptyText:"Aucun rôle à afficher pour le filtre sélectionné."},className:"roles-compact-table",rowClassName:()=>"text-sm"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:726,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:725,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:724,columnNumber:7},this),s.jsxDEV(M,{open:_,initial:T,organizations:z,isSuperAdmin:!!r,onCancel:()=>{B(!1),q(null)},onSubmit:async e=>{W(!0);try{const s={...e};let i;if(r||(s.organizationId=S),null==T?void 0:T.id){if(i=await k.patch(`/api/roles/${T.id}`,s),!i.success)throw new Error(i.message||"La mise à jour du rôle a échoué.");Q()}else if(i=await k.post("/api/roles",s),!i.success)throw new Error(i.message||"La création du rôle a échoué.");n.success(`Rôle ${(null==T?void 0:T.id)?"mis à jour":"créé"} avec succès.`),q(null),B(!1),Q()}catch(s){n.error(s.message||"Une erreur est survenue.")}W(!1)},confirmLoading:K},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:746,columnNumber:7},this),Z&&s.jsxDEV(O,{role:Z,open:!!Z,onClose:()=>H(null)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:760,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/RolesAdminPage.tsx",lineNumber:642,columnNumber:5},this)}export{P as default};
