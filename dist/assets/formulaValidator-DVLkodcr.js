const e=(e,r="Validator")=>{if(!e)return{isValid:!1,message:"Formule non définie",type:"complete"};if(!e.id||"string"!=typeof e.id||""===e.id.trim())return{isValid:!1,message:"ID de formule invalide",details:{id:e.id,type:typeof e.id},type:"complete"};if(e.sequence&&!Array.isArray(e.sequence))return{isValid:!1,message:"Séquence de formule invalide",details:{sequence:e.sequence,type:typeof e.sequence},type:"sequence"};if(e.sequence&&Array.isArray(e.sequence)){const r=t(e.sequence);e.sequence.filter(e=>!e||!e.id||"string"!=typeof e.id||""===e.id.trim()).length,r.hasInvalidTypes,r.hasOperatorSequenceIssues,e.sequence.length>0&&r.typeCounts.field}return!e.name||e.name,{isValid:!0,message:"Formule valide"}},t=e=>{const t={typeCounts:{field:0,operator:0,value:0,function:0,unknown:0},hasInvalidTypes:!1,invalidTypes:[],hasOperatorSequenceIssues:!1,operatorSequenceIssues:[]};if(!Array.isArray(e)||0===e.length)return t;e.forEach((e,r)=>{if(!e||"object"!=typeof e)return t.hasInvalidTypes=!0,void t.invalidTypes.push(`Element à l'index ${r} n'est pas un objet valide`);switch(e.type){case"field":t.typeCounts.field++;break;case"operator":t.typeCounts.operator++;break;case"value":t.typeCounts.value++;break;case"function":t.typeCounts.function++;break;default:t.typeCounts.unknown++,t.hasInvalidTypes=!0,t.invalidTypes.push(`Type inconnu: "${e.type}" à l'index ${r}`)}});let r="";return e.forEach((e,n)=>{e&&e.type&&("operator"===e.type?"operator"===r&&(t.hasOperatorSequenceIssues=!0,t.operatorSequenceIssues.push(`Deux opérateurs consécutifs aux index ${n-1} et ${n}`)):""!==r&&"operator"!==r&&(t.hasOperatorSequenceIssues=!0,t.operatorSequenceIssues.push(`Deux non-opérateurs consécutifs sans opérateur entre eux aux index ${n-1} et ${n}`)),r=e.type)}),t},r=(e,t="Validator")=>{if(!e)throw new Error("Formule non définie");const r={...e};if(!r.id||"string"!=typeof r.id||""===r.id.trim())throw new Error("ID de formule invalide");return r.sequence&&Array.isArray(r.sequence)||(r.sequence=[]),Array.isArray(r.sequence)&&(r.sequence=r.sequence.map((e,t)=>e?e.id&&"string"==typeof e.id&&""!==e.id.trim()?e.type&&["field","operator","value","function"].includes(e.type)?void 0===e.value||null===e.value?{...e,value:"operator"===e.type?"+":""}:e:{...e,type:"value"}:{...e,id:`auto-fix-${e.type||"item"}-${Date.now()}-${t}-${Math.random().toString(36).substring(2,9)}`}:{id:`auto-fix-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,type:"operator",value:"+",label:"Opérateur par défaut"})),r.name&&""!==r.name.trim()||(r.name="Formule sans nom"),void 0!==r.targetProperty&&null!==r.targetProperty||(r.targetProperty=""),r},n=()=>{const e=localStorage.getItem("token"),t=localStorage.getItem("organizationId"),r={Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"};return t&&(r["X-Organization-Id"]=t),r};export{n as g,r as p,e as v};
