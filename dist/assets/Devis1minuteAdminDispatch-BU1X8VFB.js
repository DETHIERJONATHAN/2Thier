import{j as e}from"./index-C0S0DpaX.js";import{r as i}from"./react-vendor-Al_k-ZB6.js";import{u as s}from"./useAuthenticatedApi-BbQI8SDU.js";import{F as t,s as n,a0 as r,ab as m,$ as a,B as d,bX as c,b3 as l,b5 as u,T as o,aF as D,b9 as p,a as v,aG as h,I as N,aM as b}from"./antd-vendor-zFcGztvE.js";const{Title:C,Paragraph:x}=o;function A(){const{api:A}=s(),[E,V]=i.useState([]),[g,f]=i.useState(!1),[S,k]=i.useState(!1),[O,j]=i.useState(null),[R]=t.useForm(),M=i.useCallback(async()=>{f(!0);try{const e=await A.get("/api/dispatch/rules");V((null==e?void 0:e.data)||[])}catch(e){n.error("Impossible de charger les règles")}finally{f(!1)}},[A]);i.useEffect(()=>{M()},[M]);const U=i.useCallback(e=>{j(e),R.setFieldsValue({...e,params:JSON.stringify(e.params??{},null,2)}),k(!0)},[R]),y=i.useCallback(async e=>{r.confirm({title:"Supprimer cette règle ?",onOk:async()=>{try{await A.delete(`/api/dispatch/rules/${e.id}`),n.success("Règle supprimée"),M()}catch{n.error("Suppression échouée")}}})},[A,M]),w=i.useCallback(async()=>{try{const i={source:"landing",sector:"solar",postalCode:"1000"},s=await A.post("/api/dispatch/simulate",{lead:i});r.info({title:"Résultats de la simulation",content:e.jsxDEV("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(null==s?void 0:s.data,null,2)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:76,columnNumber:66},this),width:600})}catch(i){n.error("Simulation échouée")}},[A]),I=i.useMemo(()=>[{title:"Créé le",dataIndex:"createdAt",width:160,render:e=>new Date(e).toLocaleString()},{title:"Événement",dataIndex:"event",render:i=>e.jsxDEV(m,{color:"blue",children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:85,columnNumber:70},this)},{title:"Action",dataIndex:"action",render:i=>e.jsxDEV(m,{color:"purple",children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:86,columnNumber:68},this)},{title:"Actif",dataIndex:"active",render:i=>e.jsxDEV(m,{color:i?"green":"default",children:i?"Oui":"Non"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:87,columnNumber:68},this)},{title:"Paramètres",dataIndex:"params",ellipsis:!0,render:i=>e.jsxDEV("span",{className:"text-xs text-gray-500",children:i?JSON.stringify(i):"—"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:88,columnNumber:96},this)},{title:"Actions",key:"actions",render:(i,s)=>e.jsxDEV(a,{children:[e.jsxDEV(d,{icon:e.jsxDEV(c,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:91,columnNumber:23},this),onClick:()=>w(),children:"Simuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:91,columnNumber:9},this),e.jsxDEV(d,{icon:e.jsxDEV(l,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:92,columnNumber:23},this),onClick:()=>U(s),children:"Modifier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:92,columnNumber:9},this),e.jsxDEV(d,{danger:!0,icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:93,columnNumber:30},this),onClick:()=>y(s),children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:93,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:90,columnNumber:7},this)}],[y,U,w]);return e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV(o,{children:[e.jsxDEV(C,{level:3,children:"Règles de dispatch"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:101,columnNumber:9},this),e.jsxDEV(x,{type:"secondary",children:"Configurez les règles d'orientation des leads."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:102,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:100,columnNumber:7},this),e.jsxDEV("div",{className:"mb-3 flex items-center gap-2",children:[e.jsxDEV(d,{type:"primary",icon:e.jsxDEV(D,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:105,columnNumber:38},this),onClick:()=>{j(null),R.resetFields(),R.setFieldsValue({active:!0,event:"lead_received",action:"send_to_crm",params:'{"conditions": {}}'}),k(!0)},children:"Ajouter une règle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:105,columnNumber:9},this),e.jsxDEV(d,{icon:e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:106,columnNumber:23},this),onClick:M,children:"Rafraîchir"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:106,columnNumber:9},this),e.jsxDEV(d,{icon:e.jsxDEV(c,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:107,columnNumber:23},this),onClick:()=>w(),children:"Simulation globale"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:107,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:104,columnNumber:7},this),e.jsxDEV(v,{children:e.jsxDEV(h,{rowKey:"id",loading:g,dataSource:E,columns:I,pagination:{pageSize:10}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:110,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:109,columnNumber:7},this),e.jsxDEV(r,{open:S,onCancel:()=>k(!1),title:O?"Modifier la règle":"Nouvelle règle",onOk:async()=>{try{const e=await R.validateFields(),i={...e,params:JSON.parse(e.params||"{}")};O?(await A.put(`/api/dispatch/rules/${O.id}`,i),n.success("Règle mise à jour")):(await A.post("/api/dispatch/rules",i),n.success("Règle créée")),k(!1),M()}catch(e){n.error("Enregistrement échoué")}},okText:"Enregistrer",width:720,children:e.jsxDEV(t,{layout:"vertical",form:R,children:[e.jsxDEV(t.Item,{name:"event",label:"Événement",rules:[{required:!0}],children:e.jsxDEV(N,{placeholder:"lead_received"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:116,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:115,columnNumber:11},this),e.jsxDEV(t.Item,{name:"action",label:"Action",rules:[{required:!0}],children:e.jsxDEV(N,{placeholder:"send_to_crm | send_to_partner | webhook"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:119,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:118,columnNumber:11},this),e.jsxDEV(t.Item,{name:"params",label:"Paramètres (JSON)",children:e.jsxDEV(N.TextArea,{rows:8,placeholder:'{"conditions": {"source": "landing"}}'},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:122,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:121,columnNumber:11},this),e.jsxDEV(t.Item,{name:"active",label:"Actif",valuePropName:"checked",children:e.jsxDEV(b,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:125,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:124,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:114,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:113,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminDispatch.tsx",lineNumber:99,columnNumber:5},this)}export{A as default};
