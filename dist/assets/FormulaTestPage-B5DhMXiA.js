import{j as e}from"./index-C0S0DpaX.js";import{r as s}from"./react-vendor-Al_k-ZB6.js";import{e as r,a as o}from"./formulaEvaluator-C6uT_5ZT.js";import"./antd-vendor-zFcGztvE.js";const i=({formula:o,initialValues:i={}})=>{const m=o.sequence.filter(e=>"field"===e.type).map(e=>({id:e.fieldId||String(e.value),label:e.label||String(e.value)})),[l,t]=s.useState(()=>{const e={};return m.forEach(s=>{e[s.id]=void 0!==i[s.id]?i[s.id]:0}),e}),a=r(o,l);return e.jsxDEV("div",{className:"p-4 bg-white border rounded-md shadow-sm",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-4",children:["Test de la formule: ",o.name||o.id]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:57,columnNumber:7},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("h3",{className:"text-sm font-medium mb-2",children:"Séquence actuelle:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:62,columnNumber:9},void 0),e.jsxDEV("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded-md flex flex-wrap gap-2",children:o.sequence.map((s,r)=>e.jsxDEV("span",{className:"px-2 py-1 rounded text-sm "+("field"===s.type?"bg-blue-100 border border-blue-300":"operator"===s.type?"bg-yellow-100 border border-yellow-300":"value"===s.type?"bg-green-100 border border-green-300":"bg-gray-100 border border-gray-300"),children:s.label||String(s.value)},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:65,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:63,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:61,columnNumber:7},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("h3",{className:"text-sm font-medium mb-2",children:"Valeurs de test:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:78,columnNumber:9},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:m.map(s=>e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:[s.label||s.id,":"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:82,columnNumber:15},void 0),e.jsxDEV("input",{type:"number",value:l[s.id],onChange:e=>((e,s)=>{const r=parseFloat(s);t(s=>({...s,[e]:isNaN(r)?0:r}))})(s.id,e.target.value),className:"w-full p-2 border border-gray-300 rounded-md text-sm"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:85,columnNumber:15},void 0)]},s.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:81,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:79,columnNumber:9},void 0),e.jsxDEV("button",{onClick:()=>{const e={};m.forEach(s=>{e[s.id]=0}),t(e)},className:"mt-2 px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300",children:"Réinitialiser les valeurs"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:94,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:77,columnNumber:7},void 0),e.jsxDEV("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsxDEV("h3",{className:"text-sm font-medium mb-2",children:"Résultat:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:103,columnNumber:9},void 0),e.jsxDEV("div",{className:"p-3 rounded-md "+(a.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:a.success?e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-bold",children:["Valeur: ","boolean"==typeof a.result?a.result?"Vrai":"Faux":a.result]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:109,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-xs text-gray-600 mt-1",children:["Type: ",typeof a.result]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:114,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:108,columnNumber:13},void 0):e.jsxDEV("div",{className:"text-red-700",children:["Erreur: ",a.error||"Erreur inconnue"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:119,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:104,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:102,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-4",children:[e.jsxDEV("h3",{className:"text-sm font-medium mb-2",children:"Étapes de calcul:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:128,columnNumber:9},void 0),e.jsxDEV("div",{className:"bg-gray-50 border border-gray-200 rounded-md p-2 text-sm",children:e.jsxDEV("table",{className:"w-full text-left",children:[e.jsxDEV("thead",{children:e.jsxDEV("tr",{className:"border-b border-gray-300",children:[e.jsxDEV("th",{className:"p-1",children:"Étape"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:133,columnNumber:17},void 0),e.jsxDEV("th",{className:"p-1",children:"Opération"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:134,columnNumber:17},void 0),e.jsxDEV("th",{className:"p-1",children:"Résultat"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:135,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:132,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:131,columnNumber:13},void 0),e.jsxDEV("tbody",{children:a.debug.map((s,r)=>e.jsxDEV("tr",{className:r%2==0?"bg-gray-100":"",children:[e.jsxDEV("td",{className:"p-1",children:s.step},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:141,columnNumber:19},void 0),e.jsxDEV("td",{className:"p-1",children:s.operation},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:142,columnNumber:19},void 0),e.jsxDEV("td",{className:"p-1 font-mono",children:null===s.value?"-":"boolean"==typeof s.value?s.value?"Vrai":"Faux":s.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:143,columnNumber:19},void 0)]},r,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:140,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:138,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:130,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:129,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:127,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaTestTool.tsx",lineNumber:56,columnNumber:5},void 0)},m=()=>{const[m,l]=s.useState(!0),[t,a]=s.useState([]),[n,c]=s.useState(null),[d,u]=s.useState(null);s.useEffect(()=>{N()},[]);const N=async()=>{try{l(!0);const e=localStorage.getItem("token"),s=localStorage.getItem("organizationId"),r={Authorization:e?`Bearer ${e}`:"","Content-Type":"application/json"};s&&(r["X-Organization-Id"]=s);const o=await fetch("/api/formulas",{method:"GET",headers:r});if(!o.ok)throw new Error(`Erreur lors du chargement des formules: ${o.statusText}`);const i=await o.json();a(Array.isArray(i)?i:[]),i&&i.length>0&&c(i[0].id)}catch(e){o()}finally{l(!1)}},v=t.find(e=>e.id===n);return e.jsxDEV("div",{className:"container mx-auto py-6 px-4",children:[e.jsxDEV("header",{className:"mb-6",children:[e.jsxDEV("h1",{className:"text-2xl font-bold mb-2",children:"Test des formules"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:102,columnNumber:9},void 0),e.jsxDEV("p",{className:"text-gray-600",children:"Cet outil vous permet de tester les formules avec des valeurs réelles pour vérifier qu'elles fonctionnent correctement."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:103,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:101,columnNumber:7},void 0),e.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxDEV("div",{children:e.jsxDEV("div",{className:"bg-white p-4 rounded-md shadow-sm border",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-3",children:"Formules disponibles"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:112,columnNumber:13},void 0),m?e.jsxDEV("div",{className:"p-4 text-center",children:"Chargement des formules..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:115,columnNumber:15},void 0):0===t.length?e.jsxDEV("div",{className:"p-4 text-center text-gray-500",children:"Aucune formule trouvée"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:117,columnNumber:15},void 0):e.jsxDEV("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:t.map(s=>{var r;return e.jsxDEV("div",{className:"p-2 border rounded cursor-pointer "+(n===s.id?"border-blue-500 bg-blue-50":"hover:bg-gray-50"),onClick:()=>{c(s.id),u(null)},children:[e.jsxDEV("div",{className:"font-medium",children:s.name||"Sans nom"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:133,columnNumber:21},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:[(null==(r=s.sequence)?void 0:r.length)||0," éléments"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:134,columnNumber:21},void 0)]},s.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:121,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:119,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:111,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:110,columnNumber:9},void 0),e.jsxDEV("div",{className:"lg:col-span-2",children:v?e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"bg-white p-4 rounded-md shadow-sm border mb-4",children:[e.jsxDEV("div",{className:"flex justify-between items-center mb-4",children:[e.jsxDEV("h2",{className:"text-lg font-semibold",children:["Tester: ",v.name||"Sans nom"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:150,columnNumber:19},void 0),e.jsxDEV("button",{onClick:()=>{if(!v)return;const e=v.sequence.filter(e=>"field"===e.type).map(e=>({id:e.fieldId||String(e.value),label:e.label||String(e.value)})),s={};e.forEach(e=>{s[e.id]=10});const o=r(v,s);u({formula:v,values:s,result:o.result,success:o.success,error:o.error,debug:o.debug})},className:"px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"Exécuter le test"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:151,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:149,columnNumber:17},void 0),e.jsxDEV(i,{formula:v},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:160,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:148,columnNumber:15},void 0),d&&e.jsxDEV("div",{className:"bg-white p-4 rounded-md shadow-sm border",children:[e.jsxDEV("h2",{className:"text-lg font-semibold mb-3",children:"Résultat du test"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:166,columnNumber:19},void 0),e.jsxDEV("div",{className:"p-4 rounded-md "+(d.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("span",{className:"font-medium",children:"Statut: "},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:172,columnNumber:23},void 0),e.jsxDEV("span",{className:d.success?"text-green-600":"text-red-600",children:d.success?"Succès":"Échec"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:173,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:171,columnNumber:21},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("span",{className:"font-medium",children:"Résultat: "},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:179,columnNumber:23},void 0),e.jsxDEV("span",{className:"font-mono",children:"boolean"==typeof d.result?d.result?"Vrai":"Faux":d.result},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:180,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:178,columnNumber:21},void 0),d.error&&e.jsxDEV("div",{className:"text-red-600",children:[e.jsxDEV("span",{className:"font-medium",children:"Erreur: "},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:189,columnNumber:25},void 0),d.error]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:188,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:168,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:165,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:147,columnNumber:13},void 0):e.jsxDEV("div",{className:"bg-white p-8 text-center rounded-md shadow-sm border",children:e.jsxDEV("p",{className:"text-gray-500",children:"Sélectionnez une formule pour la tester"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:199,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:198,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:145,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:108,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Diagnostics/FormulaTestPage.tsx",lineNumber:100,columnNumber:5},void 0)};export{m as default};
