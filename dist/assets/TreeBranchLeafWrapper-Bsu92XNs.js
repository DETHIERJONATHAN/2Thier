const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TextPanel-GpiBx9dg.js","assets/index-C0S0DpaX.js","assets/react-vendor-Al_k-ZB6.js","assets/antd-vendor-zFcGztvE.js","assets/index-Dwtry91m.css","assets/useAuthenticatedApi-BbQI8SDU.js","assets/dnd-vendor-D0spq1w0.js","assets/NumberPanel-ClcPnCqc.js","assets/BoolPanel-C0ZDTfx2.js","assets/SelectPanel-ERI_oLj-.js","assets/MultiSelectPanel-Bx6DOBQG.js","assets/DateTimePanel-N7WXmpul.js","assets/FilePanel-D7P05Vk7.js","assets/ImagePanel-QqBKGXGW.js","assets/RepeaterPanel-CSA1I4ib.js","assets/DataPanel-CGrnXOJJ.js","assets/NodeTreeSelector-BPMc5QXk.js","assets/evalBridge-C5EkhzJm.js","assets/FormulaPanel-DGBDp14m.js","assets/TokenDropZone-DC6IWn53.js","assets/TokenChip-CxHEbEuw.js","assets/ConditionsPanelNew-D3fxqQq5.js","assets/TablePanel-Ki-kBiWH.js","assets/xlsx-C5xT2hrF.js","assets/APIPanel-BCye9Zl6.js","assets/LinkPanel-Ew9IvUwO.js","assets/MarkersPanel-ZrbCYeVG.js"])))=>i.map(i=>d[i]);
import{j as e,_ as r,u as n}from"./index-C0S0DpaX.js";import{r as t,R as a,m as i}from"./react-vendor-Al_k-ZB6.js";import{u as o}from"./useAuthenticatedApi-BbQI8SDU.js";import{u as s,a as c,D as l}from"./dnd-vendor-D0spq1w0.js";import{F as d,s as m,b3 as u,bC as p,bb as h,bD as f,bE as b,l as v,b5 as N,$ as D,an as x,a7 as C,B as E,aF as S,a0 as g,I as T,bF as V,T as y,a as k,bG as w,bH as M,bz as O,aH as R,bi as L,be as A,h as P,bI as B,bJ as j,bK as U,a8 as I,ba as _,ao as z,aC as $,aM as F,by as q,bg as W,b4 as H,bL as G,b as K,f as X,bM as Z,aI as J,W as Y,bN as Q,bO as ee,b1 as re,bk as ne,aZ as te,L as ae,af as ie,ag as oe,aY as se,a2 as ce}from"./antd-vendor-zFcGztvE.js";const{Option:le}=x,{TextArea:de}=T,{Text:me,Paragraph:ue}=y,pe={name:"",description:"",category:"formulaire",color:"#10b981",icon:void 0,status:"draft"},he=({tree:r,trees:n=[],organizationId:a,readOnly:i=!1,onAction:o,onTreeSelect:s,onSave:c,onPreview:l})=>{const[y]=d.useForm(),[k]=d.useForm(),[w,M]=t.useState(!1),[O,R]=t.useState(!1),[L,A]=t.useState(!1),[P,B]=t.useState(!1),j=t.useRef(null),U=t.useRef(null),I=t.useRef(0),_=t.useRef("");t.useEffect(()=>{},[null==r?void 0:r.id,n.length,i,a]),t.useEffect(()=>{},[P]),t.useEffect(()=>{},[w]),t.useEffect(()=>{},[O,null==r?void 0:r.id]),t.useEffect(()=>{},[L,null==r?void 0:r.id]),I.current+=1;const z=JSON.stringify({createModalVisible:w,editModalVisible:O,deleteModalVisible:L,actionsMenuOpen:P,treeId:(null==r?void 0:r.id)??null,treesCount:n.length,readOnly:i});_.current!==z&&(_.current=z);const $=t.useCallback(()=>{M(!1),R(!1),A(!1)},[]),F=t.useCallback(()=>{y.setFieldsValue(pe),M(!0)},[y]),q=t.useCallback(()=>{r&&(k.setFieldsValue({name:r.name,description:r.description,category:r.category,color:r.color,icon:r.icon,status:r.status}),R(!0))},[k,r]),W=t.useCallback(async e=>{$(),y.resetFields(),await o("create",{...e,organizationId:a})},[$,y,o,a]),H=t.useCallback(async e=>{r&&($(),await o("update",{id:r.id,...e}))},[$,o,r]),G=t.useCallback(async()=>{r&&($(),await o("delete"))},[$,o,r]),K=t.useCallback(async()=>{r&&await o("duplicate")},[o,r]);t.useCallback(()=>{r&&(c?c(r):o("update",{id:r.id}))},[o,c,r]),t.useCallback(()=>{r?l?l(r):m.info("PrÃ©visualisation non disponible"):m.warning("Aucun arbre sÃ©lectionnÃ© pour l'aperÃ§u")},[l,r]),t.useEffect(()=>{O&&r&&k.setFieldsValue({name:r.name,description:r.description,category:r.category,color:r.color,icon:r.icon,status:r.status})},[O,k,r]),t.useEffect(()=>{if(!P)return;const e=e=>{var r,n;const t=e.target;(null==(r=j.current)?void 0:r.contains(t))||(null==(n=U.current)?void 0:n.contains(t))||B(!1)};return document.addEventListener("pointerdown",e,{capture:!0}),()=>{document.removeEventListener("pointerdown",e,{capture:!0})}},[P]),t.useMemo(()=>[{key:"edit",label:"Modifier",icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:288,columnNumber:13},void 0),disabled:i,onClick:q},{key:"duplicate",label:"Dupliquer",icon:e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:295,columnNumber:13},void 0),disabled:i,onClick:K},{type:"divider"},{key:"export",label:"Exporter",icon:e.jsxDEV(h,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:303,columnNumber:13},void 0),onClick:()=>m.info("Export - TODO")},{key:"import",label:"Importer",icon:e.jsxDEV(f,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:309,columnNumber:13},void 0),disabled:i,onClick:()=>m.info("Import - TODO")},{type:"divider"},{key:"history",label:"Historique",icon:e.jsxDEV(b,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:317,columnNumber:13},void 0),onClick:()=>m.info("Historique - TODO")},{key:"settings",label:"ParamÃ¨tres",icon:e.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:323,columnNumber:13},void 0),disabled:i,onClick:()=>m.info("ParamÃ¨tres - TODO")},{type:"divider"},{key:"delete",label:"Supprimer",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:331,columnNumber:13},void 0),danger:!0,disabled:i,onClick:()=>A(!0)}],[K,q,i]);const X=t.useCallback(e=>{const r=n.find(r=>r.id===e);r&&s&&s(r)},[s,n]);return e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"tree-manager-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"8px 16px",backgroundColor:"#fafafa",borderRadius:"6px",border:"1px solid #f0f0f0",minHeight:"60px"},children:[e.jsxDEV(D,{align:"center",size:"middle",children:n.length>0&&e.jsxDEV(x,{value:null==r?void 0:r.id,placeholder:"SÃ©lectionner un arbre...",style:{minWidth:200},size:"middle",showSearch:!0,optionFilterProp:"label",onChange:X,styles:{popup:{root:{backgroundColor:"#1f2937",color:"#fff"}}},children:n.map(r=>e.jsxDEV(le,{value:r.id,label:r.name,children:[r.name," (",r.category,")"]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:375,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:364,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:362,columnNumber:9},void 0),e.jsxDEV(D,{size:"small",children:e.jsxDEV(C,{title:"CrÃ©er un nouvel arbre",children:e.jsxDEV(E,{type:"primary",icon:e.jsxDEV(S,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:387,columnNumber:21},void 0),size:"middle",onClick:F,disabled:i,children:"Nouveau"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:385,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:384,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:383,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:348,columnNumber:7},void 0),w&&e.jsxDEV(g,{title:"CrÃ©er un nouvel arbre",open:!0,onCancel:()=>{M(!1),y.resetFields()},onOk:()=>y.submit(),okText:"CrÃ©er",cancelText:"Annuler",children:e.jsxDEV(d,{form:y,layout:"vertical",onFinish:W,initialValues:pe,children:[e.jsxDEV(d.Item,{name:"name",label:"Nom de l'arbre",rules:[{required:!0,message:"Le nom est obligatoire"}],children:e.jsxDEV(T,{placeholder:"Mon arbre de dÃ©cision"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:421,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:416,columnNumber:13},void 0),e.jsxDEV(d.Item,{name:"description",label:"Description",children:e.jsxDEV(de,{rows:3,placeholder:"Description de l'arbre..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:425,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:424,columnNumber:13},void 0),e.jsxDEV("div",{style:{display:"flex",gap:12},children:[e.jsxDEV(d.Item,{name:"category",label:"CatÃ©gorie",style:{flex:1},children:e.jsxDEV(x,{children:[e.jsxDEV(le,{value:"formulaire",children:"ðŸ“‹ Formulaire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:431,columnNumber:19},void 0),e.jsxDEV(le,{value:"diagnostic",children:"ðŸ©º Diagnostic"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:432,columnNumber:19},void 0),e.jsxDEV(le,{value:"devis",children:"ðŸ’° Devis"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:433,columnNumber:19},void 0),e.jsxDEV(le,{value:"configuration",children:"âš™ï¸ Configuration"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:434,columnNumber:19},void 0),e.jsxDEV(le,{value:"evaluation",children:"ðŸ“Š Ã‰valuation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:435,columnNumber:19},void 0),e.jsxDEV(le,{value:"autre",children:"ðŸ“ Autre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:436,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:430,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:429,columnNumber:15},void 0),e.jsxDEV(d.Item,{name:"color",label:"Couleur",children:e.jsxDEV(V,{showText:!0,format:"hex",disabled:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:441,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:440,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:428,columnNumber:13},void 0),e.jsxDEV(d.Item,{name:"icon",label:"IcÃ´ne",children:e.jsxDEV(x,{placeholder:"Choisir une icÃ´ne",allowClear:!0,children:[e.jsxDEV(le,{value:"TreeOutlined",children:"ðŸŒ³ Arbre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:447,columnNumber:17},void 0),e.jsxDEV(le,{value:"BranchesOutlined",children:"ðŸŒ¿ Branches"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:448,columnNumber:17},void 0),e.jsxDEV(le,{value:"SettingOutlined",children:"âš™ï¸ Configuration"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:449,columnNumber:17},void 0),e.jsxDEV(le,{value:"FormOutlined",children:"ðŸ“‹ Formulaire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:450,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:446,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:445,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:410,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:399,columnNumber:9},void 0),O&&e.jsxDEV(g,{title:"Modifier l'arbre",open:!0,onCancel:()=>{R(!1),k.resetFields()},onOk:()=>k.submit(),okText:"Sauvegarder",cancelText:"Annuler",children:e.jsxDEV(d,{form:k,layout:"vertical",onFinish:H,children:[e.jsxDEV(d.Item,{name:"name",label:"Nom de l'arbre",rules:[{required:!0,message:"Le nom est obligatoire"}],children:e.jsxDEV(T,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:475,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:470,columnNumber:13},void 0),e.jsxDEV(d.Item,{name:"description",label:"Description",children:e.jsxDEV(de,{rows:3},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:479,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:478,columnNumber:13},void 0),e.jsxDEV("div",{style:{display:"flex",gap:12},children:[e.jsxDEV(d.Item,{name:"category",label:"CatÃ©gorie",style:{flex:1},children:e.jsxDEV(x,{children:[e.jsxDEV(le,{value:"formulaire",children:"ðŸ“‹ Formulaire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:485,columnNumber:19},void 0),e.jsxDEV(le,{value:"diagnostic",children:"ðŸ©º Diagnostic"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:486,columnNumber:19},void 0),e.jsxDEV(le,{value:"devis",children:"ðŸ’° Devis"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:487,columnNumber:19},void 0),e.jsxDEV(le,{value:"configuration",children:"âš™ï¸ Configuration"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:488,columnNumber:19},void 0),e.jsxDEV(le,{value:"evaluation",children:"ðŸ“Š Ã‰valuation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:489,columnNumber:19},void 0),e.jsxDEV(le,{value:"autre",children:"ðŸ“ Autre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:490,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:484,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:483,columnNumber:15},void 0),e.jsxDEV(d.Item,{name:"status",label:"Statut",children:e.jsxDEV(x,{children:[e.jsxDEV(le,{value:"draft",children:"ðŸš§ Brouillon"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:496,columnNumber:19},void 0),e.jsxDEV(le,{value:"published",children:"âœ… PubliÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:497,columnNumber:19},void 0),e.jsxDEV(le,{value:"archived",children:"ðŸ“¦ ArchivÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:498,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:495,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:494,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:482,columnNumber:13},void 0),e.jsxDEV("div",{style:{display:"flex",gap:12},children:[e.jsxDEV(d.Item,{name:"color",label:"Couleur",children:e.jsxDEV(V,{showText:!0,format:"hex",disabled:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:505,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:504,columnNumber:15},void 0),e.jsxDEV(d.Item,{name:"icon",label:"IcÃ´ne",style:{flex:1},children:e.jsxDEV(x,{placeholder:"Choisir une icÃ´ne",allowClear:!0,children:[e.jsxDEV(le,{value:"TreeOutlined",children:"ðŸŒ³ Arbre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:510,columnNumber:19},void 0),e.jsxDEV(le,{value:"BranchesOutlined",children:"ðŸŒ¿ Branches"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:511,columnNumber:19},void 0),e.jsxDEV(le,{value:"SettingOutlined",children:"âš™ï¸ Configuration"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:512,columnNumber:19},void 0),e.jsxDEV(le,{value:"FormOutlined",children:"ðŸ“‹ Formulaire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:513,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:509,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:508,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:503,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:469,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:458,columnNumber:9},void 0),L&&e.jsxDEV(g,{title:"Supprimer l'arbre",open:!0,onCancel:()=>A(!1),onOk:G,okText:"Supprimer",cancelText:"Annuler",okButtonProps:{danger:!0},children:[e.jsxDEV(ue,{children:["ÃŠtes-vous sÃ»r de vouloir supprimer l'arbre ",e.jsxDEV("strong",{children:null==r?void 0:r.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:532,columnNumber:56},void 0)," ?"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:531,columnNumber:11},void 0),e.jsxDEV(me,{type:"secondary",children:"Cette action est irrÃ©versible."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:534,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:522,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/TreeManager/TreeManager.tsx",lineNumber:347,columnNumber:5},void 0)},{Text:fe}=y,be=({id:r,nodeType:n,emoji:t,label:a,description:i,color:o,readOnly:c=!1})=>{const{attributes:l,listeners:d,setNodeRef:m,transform:u,isDragging:p}=s({id:r,data:{type:"palette-item",nodeType:n,label:a,description:i},disabled:c}),h={transform:u?`translate3d(${u.x}px, ${u.y}px, 0)`:void 0,opacity:p?.5:1,cursor:c?"not-allowed":"grab"};return e.jsxDEV(C,{title:`${t} ${a} - ${i}`,placement:"right",open:!p&&void 0,children:e.jsxDEV("div",{ref:m,style:h,...d,...l,children:e.jsxDEV(k,{size:"small",hoverable:!c,style:{marginBottom:"8px",borderColor:o,borderWidth:"2px",borderStyle:p?"dashed":"solid",backgroundColor:p?"#f0f0f0":"white",filter:c?"grayscale(100%)":"none",textAlign:"center",minHeight:"45px"},styles:{body:{padding:"6px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},children:[e.jsxDEV("div",{style:{fontSize:"18px",color:c?"#ccc":o,marginBottom:"4px"},children:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:105,columnNumber:11},void 0),e.jsxDEV("div",{style:{fontSize:"10px",fontWeight:500,color:c?"#ccc":"#333",textAlign:"center",lineHeight:"1.1"},children:a},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:112,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:84,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:78,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:73,columnNumber:5},void 0)},ve=({onItemCreate:r,readOnly:n=!1,registry:t})=>{const a=t.getAllNodeTypes(),i=[{key:"structure",label:"ðŸ—ï¸ Structure",items:a.filter(e=>"branch"===e.key)},{key:"sections",label:"ðŸ“‹ Sections",items:a.filter(e=>"section"===e.key)},{key:"leafs",label:"ðŸƒ Feuilles",items:a.filter(e=>e.key.startsWith("leaf_"))}];return e.jsxDEV("div",{style:{height:"100%",overflow:"auto",overscrollBehavior:"contain"},children:[e.jsxDEV("div",{style:{marginBottom:"16px",padding:"8px"},children:e.jsxDEV(fe,{type:"secondary",style:{fontSize:"12px"},children:"ðŸ–±ï¸ Glisser ces Ã©lÃ©ments dans la Structure pour crÃ©er votre arbre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:163,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:162,columnNumber:7},void 0),i.map(t=>e.jsxDEV("div",{style:{marginBottom:"20px"},children:[e.jsxDEV("div",{style:{marginBottom:"12px",padding:"4px 8px",backgroundColor:"#f5f5f5",borderRadius:"4px"},children:e.jsxDEV(fe,{strong:!0,style:{fontSize:"13px"},children:t.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:177,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:171,columnNumber:11},void 0),t.items.map(t=>e.jsxDEV("div",{onDoubleClick:()=>!n&&r(t.key),children:e.jsxDEV(be,{id:`palette-${t.key}`,nodeType:t.key,emoji:t.emoji,label:t.label,description:t.description,color:t.color,readOnly:n},`palette-${t.key}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:184,columnNumber:13},void 0)},`wrap-${t.key}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:183,columnNumber:13},void 0))]},t.key,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:170,columnNumber:9},void 0)),e.jsxDEV(k,{size:"small",style:{marginTop:"20px"},children:e.jsxDEV("div",{style:{fontSize:"12px",color:"#666"},children:[e.jsxDEV("div",{style:{marginBottom:"8px",fontWeight:500},children:"ðŸ’¡ Mode d'emploi :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:202,columnNumber:11},void 0),e.jsxDEV("div",{style:{lineHeight:"1.4"},children:["â€¢ ",e.jsxDEV("strong",{children:"ðŸŒ¿ Branche"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:206,columnNumber:15},void 0)," : Conteneur hiÃ©rarchique",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:206,columnNumber:67},void 0),"â€¢ ",e.jsxDEV("strong",{children:"ðŸ“‹ Section"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:207,columnNumber:15},void 0)," : Zone calculatrice avec champs d'affichage",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:207,columnNumber:86},void 0),"â€¢ ",e.jsxDEV("strong",{children:"â—‹ Option (O)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:208,columnNumber:15},void 0)," : Choix simple",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:208,columnNumber:59},void 0),"â€¢ ",e.jsxDEV("strong",{children:"â— Option+Champ (O+C)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:209,columnNumber:15},void 0)," : Choix + saisie",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:209,columnNumber:69},void 0),"â€¢ ",e.jsxDEV("strong",{children:"â— Champ (C)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:210,columnNumber:15},void 0)," : Saisie pure",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:210,columnNumber:57},void 0),e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:210,columnNumber:63},void 0),e.jsxDEV(fe,{type:"secondary",children:["DÃ©posez ",e.jsxDEV("strong",{children:"entre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:213,columnNumber:23},void 0)," deux Ã©lÃ©ments pour crÃ©er un frÃ¨re,",e.jsxDEV("strong",{children:"sur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:214,columnNumber:15},void 0)," un Ã©lÃ©ment pour crÃ©er un enfant."]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:212,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:205,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:201,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:200,columnNumber:7},void 0),n&&e.jsxDEV("div",{style:{textAlign:"center",padding:"16px",backgroundColor:"#fff7e6",borderRadius:"4px",margin:"16px 0"},children:e.jsxDEV(fe,{type:"warning",style:{fontSize:"12px"},children:"ðŸ”’ Mode lecture seule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:228,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:221,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Palette/Palette.tsx",lineNumber:154,columnNumber:5},void 0)},Ne={TEXT:{key:"TEXT",label:"Texte",icon:"FormOutlined",description:"Champ de saisie de texte",category:"input",variants:["singleline","textarea"],defaultVariant:"singleline",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","formula","validation"],appearanceConfig:{variants:[{key:"singleline",label:"Ligne simple",icon:"EditOutlined"},{key:"textarea",label:"Zone de texte",icon:"FileTextOutlined"}],properties:["placeholder","maxLength","minLength","validation"]}},NUMBER:{key:"NUMBER",label:"Nombre",icon:"NumberOutlined",description:"Champ numÃ©rique avec calculs",category:"input",variants:["input","stepper","slider","dial"],defaultVariant:"input",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","formula","validation"],appearanceConfig:{variants:[{key:"input",label:"Saisie libre",icon:"EditOutlined"},{key:"stepper",label:"Compteur",icon:"PlusMinusOutlined"},{key:"slider",label:"Curseur",icon:"SliderOutlined"},{key:"dial",label:"Cadran",icon:"DashboardOutlined"}],properties:["min","max","step","decimals","unit","prefix","suffix"]}},BOOL:{key:"BOOL",label:"BoolÃ©en",icon:"CheckSquareOutlined",description:"Choix vrai/faux",category:"choice",variants:["checkbox","switch","segmented"],defaultVariant:"checkbox",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","validation"],appearanceConfig:{variants:[{key:"checkbox",label:"Case Ã  cocher",icon:"CheckSquareOutlined"},{key:"switch",label:"Interrupteur",icon:"SwapOutlined"},{key:"segmented",label:"Boutons",icon:"AppstoreOutlined"}],properties:["defaultValue","trueLabel","falseLabel"]}},SELECT:{key:"SELECT",label:"SÃ©lection",icon:"UnorderedListOutlined",description:"Choix parmi des options",category:"choice",variants:["dropdown","radio","pills","segmented","autocomplete"],defaultVariant:"dropdown",hasOptions:!0,hasSubfields:!1,capabilities:["data","condition","api","validation"],appearanceConfig:{variants:[{key:"dropdown",label:"Liste dÃ©roulante",icon:"CaretDownOutlined"},{key:"radio",label:"Boutons radio",icon:"RadiusSettingOutlined"},{key:"pills",label:"Pastilles",icon:"TagsOutlined"},{key:"segmented",label:"Segments",icon:"AppstoreOutlined"},{key:"autocomplete",label:"AutocomplÃ©tion",icon:"SearchOutlined"}],properties:["searchable","allowCustom","optionsSource"]}},MULTISELECT:{key:"MULTISELECT",label:"SÃ©lection multiple",icon:"CheckboxOutlined",description:"Choix multiples parmi des options",category:"choice",variants:["checkboxes","tags","dual-list"],defaultVariant:"checkboxes",hasOptions:!0,hasSubfields:!1,capabilities:["data","condition","api","validation"],appearanceConfig:{variants:[{key:"checkboxes",label:"Cases Ã  cocher",icon:"CheckboxOutlined"},{key:"tags",label:"Ã‰tiquettes",icon:"TagsOutlined"},{key:"dual-list",label:"Double liste",icon:"SwapOutlined"}],properties:["maxSelections","searchable","optionsSource"]}},DATE:{key:"DATE",label:"Date",icon:"CalendarOutlined",description:"SÃ©lecteur de date/heure",category:"temporal",variants:["date","time","datetime","month","range"],defaultVariant:"date",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","validation"],appearanceConfig:{variants:[{key:"date",label:"Date",icon:"CalendarOutlined"},{key:"time",label:"Heure",icon:"ClockCircleOutlined"},{key:"datetime",label:"Date et heure",icon:"FieldTimeOutlined"},{key:"month",label:"Mois",icon:"CalendarOutlined"},{key:"range",label:"PÃ©riode",icon:"CalendarOutlined"}],properties:["format","locale","minDate","maxDate","disabledDates"]}},IMAGE:{key:"IMAGE",label:"Image",icon:"PictureOutlined",description:"Upload et gestion d'images avancÃ©e",category:"media",variants:["upload","gallery","camera"],defaultVariant:"upload",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","validation"],appearanceConfig:{variants:[{key:"upload",label:"Upload simple",icon:"UploadOutlined"},{key:"gallery",label:"Galerie",icon:"AppstoreOutlined"},{key:"camera",label:"Prise de vue",icon:"CameraOutlined"}],properties:["formats","maxSize","maxCount","ratio","crop","thumbnails","compression","transforms","annotations"]}},FILE:{key:"FILE",label:"Fichier",icon:"FileOutlined",description:"Upload de fichiers",category:"media",variants:["single","multiple","drag-drop"],defaultVariant:"single",hasOptions:!1,hasSubfields:!1,capabilities:["data","condition","validation"],appearanceConfig:{variants:[{key:"single",label:"Fichier unique",icon:"FileOutlined"},{key:"multiple",label:"Plusieurs fichiers",icon:"FolderOutlined"},{key:"drag-drop",label:"Glisser-dÃ©poser",icon:"CloudUploadOutlined"}],properties:["accept","maxSize","maxCount","preview","extraction"]}}},De={data:{key:"data",label:"DonnÃ©e",icon:"BarChartOutlined",emoji:"ðŸ“Š",description:"Exposer comme variable utilisable",category:"calculation",autoOpen:!0,requiresConfig:!0,compatibleWith:["branch","leaf"],panelComponent:"DataConfigPanel",validationRules:["exposedKey","format"],dependencies:[]},formula:{key:"formula",label:"Formule",icon:"CalculatorOutlined",emoji:"ðŸ§®",description:"Calcul automatique avec blocs",category:"calculation",autoOpen:!0,requiresConfig:!0,compatibleWith:["branch","leaf"],panelComponent:"FormulaConfigPanel",validationRules:["formula","variables"],dependencies:["data"]},condition:{key:"condition",label:"Conditions",icon:"BranchesOutlined",emoji:"âš–ï¸",description:"RÃ¨gles de navigation et affichage",category:"logic",autoOpen:!0,requiresConfig:!0,compatibleWith:["branch","leaf"],panelComponent:"ConditionConfigPanel",validationRules:["rules","outcomes"],dependencies:[]},table:{key:"table",label:"Tableau",icon:"TableOutlined",emoji:"ðŸ§©",description:"Lookup 2D avec interpolation",category:"data",autoOpen:!0,requiresConfig:!0,compatibleWith:["leaf"],panelComponent:"TableConfigPanel",validationRules:["xAxis","yAxis","matrix"],dependencies:["data"]},api:{key:"api",label:"API",icon:"ApiOutlined",emoji:"ðŸ”Œ",description:"Connexion externe avec cache",category:"integration",autoOpen:!0,requiresConfig:!0,compatibleWith:["branch","leaf"],panelComponent:"APIConfigPanel",validationRules:["method","url","responsePath"],dependencies:["data"]},link:{key:"link",label:"Lien",icon:"LinkOutlined",emoji:"ðŸ”—",description:"Navigation et rebouclage",category:"navigation",autoOpen:!0,requiresConfig:!0,compatibleWith:["branch","leaf"],panelComponent:"LinkConfigPanel",validationRules:["targetTree","mode"],dependencies:[]},markers:{key:"markers",label:"Marqueurs",icon:"TagsOutlined",emoji:"ðŸ“",description:"Tags et catÃ©gorisation",category:"organization",autoOpen:!1,requiresConfig:!1,compatibleWith:["branch","leaf"],panelComponent:"MarkerConfigPanel",validationRules:[],dependencies:[]}},xe={branch:{key:"branch",label:"Branche",icon:"BranchesOutlined",emoji:"ðŸŒ¿",description:"Conteneur hiÃ©rarchique",color:"#52c41a",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["data","condition","formula","api","link","markers"]},leaf_option:{key:"leaf_option",label:"Option (O)",icon:"NodeIndexOutlined",emoji:"â—‹",description:"Option simple de sÃ©lection",color:"#1890ff",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["data","condition","markers"],defaultFieldType:"SELECT",fieldRequired:!1},leaf_option_field:{key:"leaf_option_field",label:"Option + Champ (O+C)",icon:"AppstoreOutlined",emoji:"â—",description:"Option avec champ de saisie",color:"#722ed1",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["data","condition","formula","table","api","markers"],defaultFieldType:"TEXT",fieldRequired:!0},leaf_field:{key:"leaf_field",label:"Champ (C)",icon:"FormOutlined",emoji:"â—",description:"Champ de saisie pur",color:"#fa8c16",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["data","condition","formula","table","api","validation","markers"],defaultFieldType:"TEXT",fieldRequired:!0},leaf_repeater:{key:"leaf_repeater",label:"Bloc rÃ©pÃ©table",icon:"PlusSquareOutlined",emoji:"âž•",description:"Permet Ã  lâ€™utilisateur dâ€™ajouter plusieurs occurrences dâ€™un groupe de champs.",color:"#eb2f96",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["markers"]},section:{key:"section",label:"Section",icon:"CalculatorOutlined",emoji:"ðŸ“‹",description:"Section calculatrice avec champs d'affichage",color:"#13c2c2",canHaveChildren:!0,canBeChild:!0,acceptsDropFrom:["palette","structure"],capabilities:["data","condition","markers"]}},Ce={TEXT:()=>r(()=>import("./TextPanel-GpiBx9dg.js"),__vite__mapDeps([0,1,2,3,4,5,6])),NUMBER:()=>r(()=>import("./NumberPanel-ClcPnCqc.js"),__vite__mapDeps([7,1,2,3,4])),BOOL:()=>r(()=>import("./BoolPanel-C0ZDTfx2.js"),__vite__mapDeps([8,1,2,3,4])),SELECT:()=>r(()=>import("./SelectPanel-ERI_oLj-.js"),__vite__mapDeps([9,1,2,3,4])),MULTISELECT:()=>r(()=>import("./MultiSelectPanel-Bx6DOBQG.js"),__vite__mapDeps([10,1,2,3,4])),DATE:()=>r(()=>import("./DateTimePanel-N7WXmpul.js"),__vite__mapDeps([11,1,2,3,4])),FILE:()=>r(()=>import("./FilePanel-D7P05Vk7.js"),__vite__mapDeps([12,1,2,3,4])),IMAGE:()=>r(()=>import("./ImagePanel-QqBKGXGW.js"),__vite__mapDeps([13,1,2,3,4])),DATA:()=>r(()=>import("./RepeaterPanel-CSA1I4ib.js"),__vite__mapDeps([14,1,2,3,4,0,5,6])),LEAF_REPEATER:()=>r(()=>import("./RepeaterPanel-CSA1I4ib.js"),__vite__mapDeps([14,1,2,3,4,0,5,6]))},Ee={data:()=>r(()=>import("./DataPanel-CGrnXOJJ.js"),__vite__mapDeps([15,1,2,3,4,5,16,17,6])),formula:()=>r(()=>import("./FormulaPanel-DGBDp14m.js"),__vite__mapDeps([18,1,2,3,4,19,6,20,5,16])),condition:()=>r(()=>import("./ConditionsPanelNew-D3fxqQq5.js"),__vite__mapDeps([21,1,2,3,4,5,16,20])),table:()=>r(()=>import("./TablePanel-Ki-kBiWH.js"),__vite__mapDeps([22,1,2,3,4,5,23,6])),api:()=>r(()=>import("./APIPanel-BCye9Zl6.js"),__vite__mapDeps([24,1,2,3,4,19,6,20,5])),link:()=>r(()=>import("./LinkPanel-Ew9IvUwO.js"),__vite__mapDeps([25,1,2,3,4,5,6])),markers:()=>r(()=>import("./MarkersPanel-ZrbCYeVG.js"),__vite__mapDeps([26,1,2,3,4,5,6]))},Se={NODE_VALUE:{key:"NODE_VALUE",label:"Valeur de champ",format:"@value.{nodeKey}",acceptedBy:["formula","condition","api"],color:"#52c41a"},NODE_OPTION:{key:"NODE_OPTION",label:"Option sÃ©lectionnÃ©e",format:"@select.{nodeKey}.{optionKey}",acceptedBy:["condition","api"],color:"#1890ff"},VARIABLE:{key:"VARIABLE",label:"Variable exposÃ©e",format:"@{exposedKey}",acceptedBy:["formula","condition","table","api"],color:"#fa8c16"},CONSTANT:{key:"CONSTANT",label:"Constante",format:"{value}",acceptedBy:["formula","condition"],color:"#6b7280"},MARKER:{key:"MARKER",label:"Marqueur",format:"@marker.{markerKey}",acceptedBy:["condition"],color:"#eb2f96"}},ge={structure_root:{key:"structure_root",label:"Racine de l'arbre",acceptsFrom:["palette"],acceptsTypes:["branch","section"],dropPosition:"child"},structure_branch:{key:"structure_branch",label:"Dans une branche",acceptsFrom:["palette","structure"],acceptsTypes:["branch","section","leaf_option","leaf_option_field","leaf_field"],dropPosition:"child"},structure_leaf:{key:"structure_leaf",label:"AprÃ¨s une feuille",acceptsFrom:["palette","structure"],acceptsTypes:["leaf_option","leaf_option_field","leaf_field"],dropPosition:"child"},structure_section:{key:"structure_section",label:"Dans une section calculatrice",acceptsFrom:["palette","structure"],acceptsTypes:["leaf_option","leaf_option_field","leaf_field"],dropPosition:"child"},structure_between:{key:"structure_between",label:"Entre les Ã©lÃ©ments",acceptsFrom:["palette","structure"],acceptsTypes:["branch","section","leaf_option","leaf_option_field","leaf_field"],dropPosition:"sibling"},formula_input:{key:"formula_input",label:"Zone de formule",acceptsFrom:["structure","reusables"],acceptsTypes:["NODE_VALUE","VARIABLE","CONSTANT"],dropPosition:"token"},condition_input:{key:"condition_input",label:"Zone de condition",acceptsFrom:["structure","reusables"],acceptsTypes:["NODE_VALUE","NODE_OPTION","VARIABLE","MARKER"],dropPosition:"token"}},Te={formula:{key:"formula",label:"Formules",icon:"CalculatorOutlined",emoji:"ðŸ§®",description:"Formules sauvegardÃ©es",category:"calculation",attachableTo:["formula"],canLink:!0,canCopy:!0},condition:{key:"condition",label:"Conditions",icon:"BranchesOutlined",emoji:"âš–ï¸",description:"RÃ¨gles conditionnelles",category:"logic",attachableTo:["condition"],canLink:!0,canCopy:!0},table:{key:"table",label:"Tableaux",icon:"TableOutlined",emoji:"ðŸ§©",description:"Matrices de lookup",category:"data",attachableTo:["table"],canLink:!0,canCopy:!0},api:{key:"api",label:"Connexions API",icon:"ApiOutlined",emoji:"ðŸ”Œ",description:"Endpoints configurÃ©s",category:"integration",attachableTo:["api"],canLink:!0,canCopy:!1},fieldStyle:{key:"fieldStyle",label:"Styles de champ",icon:"BgColorsOutlined",emoji:"ðŸŽ¨",description:"Apparence rÃ©utilisable",category:"appearance",attachableTo:["appearance"],canLink:!0,canCopy:!0},optionSet:{key:"optionSet",label:"Jeux d'options",icon:"UnorderedListOutlined",emoji:"ðŸ“‹",description:"Listes prÃ©dÃ©finies",category:"data",attachableTo:["options"],canLink:!0,canCopy:!0},markerSet:{key:"markerSet",label:"Sets de marqueurs",icon:"TagsOutlined",emoji:"ðŸ“",description:"Collections de tags",category:"organization",attachableTo:["markers"],canLink:!0,canCopy:!0},variable:{key:"variable",label:"Variables @key",icon:"KeyOutlined",emoji:"ðŸ”‘",description:"Variables globales",category:"data",attachableTo:["formula","condition","table","api"],canLink:!1,canCopy:!1}},Ve={nodeTypes:{branch:"branch",leaf:"leaf_field",option:"leaf_option","option-field":"leaf_option_field"},subTypes:{field:"leaf_field",option:"leaf_option",data:"leaf_field"}};class ye{static getFieldType(e){return Ne[e]||null}static getCapabilityModule(e){return De[e]||null}static getNodeType(e){return xe[e]||null}static getTokenType(e){return Se[e]||null}static getReusableType(e){return Te[e]||null}static getDropZone(e){return ge[e]||null}static getAllFieldTypes(){return Object.values(Ne)}static getAllCapabilities(){return Object.values(De)}static getAllNodeTypes(){return Object.values(xe)}static getFieldTypesByCategory(e){return Object.values(Ne).filter(r=>r.category===e)}static getCapabilitiesByCategory(e){return Object.values(De).filter(r=>r.category===e)}static validateDropOperation(e,r,n){const t=this.getNodeType(e),a=this.getNodeType(r);if(!t||!a)return!1;switch(n){case"child":return a.canHaveChildren;case"before":case"after":return t.canBeChild;default:return!1}}static resolveTokenFromDrop(e,r){if(!e)return null;if(!this.getNodeType(e.type))return null;switch(r){case"formula":return e.hasData?`@value.${e.key}`:null;case"condition":return e.type.includes("option")?`@select.${e.key}`:e.hasData?`@value.${e.key}`:null;default:return null}}static convertFromLegacy(e){const r=Ve.nodeTypes[e.type]||e.type,n=Ve.subTypes[e.subType]||null;return{...e,type:r,subType:n}}static isFieldInSection(e,r){if(!e.parentId)return!1;const n=e=>{const t=r.find(r=>r.id===e);return!!t&&("section"===t.type||!!t.parentId&&n(t.parentId))};return n(e.parentId)}static getSectionDisplayConfig(e){return{isDisplayOnly:!0,hasCalculatorIcon:!0,specialStyle:{backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"6px",padding:"8px 12px",position:"relative"}}}static getDefaultAppearanceConfig(e){switch(null==e?void 0:e.toUpperCase()){case"TEXT":return{size:"md",variant:"singleline",placeholder:"",maxLength:255,mask:"",regex:""};case"NUMBER":return{size:"md",variant:"input",min:null,max:null,step:1,decimals:0,prefix:"",suffix:""};case"BOOL":return{size:"md",variant:"checkbox",defaultValue:!1,trueLabel:"Oui",falseLabel:"Non"};case"SELECT":return{size:"md",variant:"dropdown",searchable:!1,allowCustom:!1};case"MULTISELECT":return{size:"md",variant:"checkboxes",maxSelections:null,searchable:!1,allowCustom:!1};case"DATE":return{size:"md",variant:"date",format:"YYYY-MM-DD",locale:"fr-BE"};case"IMAGE":return{size:"md",variant:"upload",formats:["jpeg","png","webp"],maxSize:5,ratio:null,crop:!1,thumbnails:[]};case"FILE":return{size:"md",variant:"single",accept:".pdf,.docx,.xlsx",maxSize:10,multiple:!1};default:return{size:"md",variant:"default"}}}static mapAppearanceConfigToTBL(e){const r=e.size||"md",n=e.variant||"default",t={appearance_size:r,appearance_width:{sm:"200px",md:"300px",lg:"400px"}[r]||"300px",appearance_variant:n,text_placeholder:e.placeholder||null,text_maxLength:e.maxLength?Number(e.maxLength):null,text_minLength:e.minLength?Number(e.minLength):null,text_mask:e.mask||null,text_regex:e.regex||null,number_min:e.min?Number(e.min):null,number_max:e.max?Number(e.max):null,number_step:e.step?Number(e.step):null,number_decimals:e.decimals?Number(e.decimals):null,number_prefix:e.prefix||null,number_suffix:e.suffix||null,number_unit:e.unit||null,date_format:e.format||null,date_showTime:e.showTime?Boolean(e.showTime):null,date_minDate:e.minDate||null,date_maxDate:e.maxDate||null,select_mode:e.mode||null,select_allowClear:e.allowClear?Boolean(e.allowClear):null,select_showSearch:e.showSearch?Boolean(e.showSearch):null,text_helpTooltipType:e.helpTooltipType||"none",text_helpTooltipText:e.helpTooltipText||null,text_helpTooltipImage:e.helpTooltipImage||null};return Object.keys(t).forEach(e=>{null!==t[e]&&void 0!==t[e]||delete t[e]}),t}static mapTBLToAppearanceConfig(e){const r={size:e.appearance_size||"md",variant:e.appearance_variant||"default",placeholder:e.text_placeholder||null,maxLength:e.text_maxLength||null,minLength:e.text_minLength||null,mask:e.text_mask||null,regex:e.text_regex||null,min:e.number_min||null,max:e.number_max||null,step:e.number_step||null,decimals:e.number_decimals||null,prefix:e.number_prefix||null,suffix:e.number_suffix||null,unit:e.number_unit||null,format:e.date_format||null,showTime:e.date_showTime||null,minDate:e.date_minDate||null,maxDate:e.date_maxDate||null,mode:e.select_mode||null,allowClear:e.select_allowClear||null,showSearch:e.select_showSearch||null,helpTooltipType:e.text_helpTooltipType||"none",helpTooltipText:e.text_helpTooltipText||null,helpTooltipImage:e.text_helpTooltipImage||null};return Object.keys(r).forEach(e=>{null!==r[e]&&void 0!==r[e]||delete r[e]}),r}}const ke=({node:r,readOnly:n=!1,isExpanded:a,onEdit:i,onDuplicate:o,onDelete:s,onMoveUp:c,onMoveDown:l,onToggleVisibility:d,onOpenSettings:m,onMoveToRoot:h,onToggleExpand:f})=>{const[b,D]=t.useState(!1),x=t.useRef(null),C=t.useRef(null),E=r.id&&"undefined"!==r.id,S=e=>{const{key:n}=e;switch(n){case"edit":i&&i(r);break;case"duplicate":o&&o(r);break;case"delete":(()=>{if(!E)return;if(!s)return;if(window.confirm(`ÃŠtes-vous sÃ»r de vouloir supprimer l'Ã©lÃ©ment "${r.label}" ?`))try{s(r)}catch(e){e instanceof Error&&e.message}})();break;case"moveUp":E&&c&&c(r);break;case"moveDown":E&&l&&l(r);break;case"toggleVisibility":E&&d&&d(r);break;case"settings":m&&m(r)}},g=t.useMemo(()=>[{key:"edit",icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:158,columnNumber:13},void 0),label:"Modifier",disabled:n||!i},{key:"duplicate",icon:e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:164,columnNumber:13},void 0),label:"Dupliquer",disabled:n||!o},{key:"delete",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:170,columnNumber:13},void 0),label:"Supprimer",disabled:n||!s||!E,danger:!0},{type:"divider",key:"divider-1"},{key:"moveUp",icon:e.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:181,columnNumber:13},void 0),label:"Monter",disabled:n||!c||!E},{key:"moveDown",icon:e.jsxDEV(M,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:187,columnNumber:13},void 0),label:"Descendre",disabled:n||!l||!E},{key:"toggleVisibility",icon:r.visible?e.jsxDEV(O,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:193,columnNumber:28},void 0):e.jsxDEV(R,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:193,columnNumber:55},void 0),label:r.visible?"Masquer":"Afficher",disabled:n||!d||!E},{type:"divider",key:"divider-2"},{key:"settings",icon:e.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:203,columnNumber:13},void 0),label:"ParamÃ¨tres",disabled:n||!m||!E}],[n,i,o,s,c,l,d,m,E,r.visible]);t.useEffect(()=>{}),t.useEffect(()=>{},[b,r.id]),t.useEffect(()=>{if(!b)return;const e=e=>{var r,n;const t=e.target;(null==(r=x.current)?void 0:r.contains(t))||(null==(n=C.current)?void 0:n.contains(t))||D(!1)};return document.addEventListener("pointerdown",e,{capture:!0}),()=>{document.removeEventListener("pointerdown",e,{capture:!0})}},[b]);const T=t.useCallback(e=>{e.preventDefault(),e.stopPropagation(),D(e=>!e)},[]),V=t.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]);return e.jsxDEV(e.Fragment,{children:e.jsxDEV("div",{ref:C,className:"flex items-center justify-center w-6 h-6 hover:bg-gray-100 rounded cursor-pointer opacity-60 hover:opacity-100",style:{zIndex:1e3,position:"relative"},onClick:T,onMouseDown:V,onPointerDown:V,onDragStart:e=>{e.preventDefault(),e.stopPropagation()},draggable:!1,children:[e.jsxDEV(L,{className:"text-xs text-gray-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:281,columnNumber:9},void 0),b&&e.jsxDEV("div",{ref:x,style:{position:"absolute",top:"110%",right:0,background:"#fff",border:"1px solid #d9d9d9",borderRadius:6,boxShadow:"0 6px 16px rgba(0,0,0,0.12)",padding:"4px 0",minWidth:160,zIndex:2e3},onClick:e=>{e.stopPropagation()},children:[g.map(n=>{if("type"in n&&"divider"===n.type)return e.jsxDEV("div",{style:{height:1,margin:"4px 0",backgroundColor:"#f0f0f0"}},n.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:304,columnNumber:19},void 0);const{key:t,icon:i,label:o,disabled:s,danger:c}=n;return e.jsxDEV("button",{type:"button",disabled:s,onClick:()=>(e=>{D(!1),S({key:e})})(t),style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 12px",gap:8,background:"transparent",border:"none",color:c?"#ff4d4f":s?"#aaa":"#333",fontSize:12,cursor:s?"not-allowed":"pointer",textAlign:"left"},onPointerDown:e=>{e.preventDefault(),e.stopPropagation()},children:[e.jsxDEV("span",{style:{display:"inline-flex",alignItems:"center",fontSize:12},children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:340,columnNumber:19},void 0),e.jsxDEV("span",{style:{flex:1},children:o},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:343,columnNumber:19},void 0),"toggleVisibility"===t&&e.jsxDEV("span",{style:{fontSize:10,color:"#999"},children:r.visible?"Visible":"MasquÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:345,columnNumber:21},void 0),"edit"===t&&void 0!==a&&e.jsxDEV("span",{style:{fontSize:10,color:"#bbb"},children:a?"â–¼":"â–¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:350,columnNumber:21},void 0)]},t,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:317,columnNumber:17},void 0)}),h&&!n&&e.jsxDEV("button",{type:"button",onClick:()=>{D(!1),h(r)},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 12px",gap:8,background:"transparent",border:"none",color:"#333",fontSize:12,cursor:"pointer",textAlign:"left"},onPointerDown:e=>{e.preventDefault(),e.stopPropagation()},children:[e.jsxDEV("span",{style:{fontSize:12},children:"â¤´ï¸"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:383,columnNumber:17},void 0),e.jsxDEV("span",{children:"Envoyer Ã  la racine"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:384,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:359,columnNumber:15},void 0),f&&E&&e.jsxDEV("button",{type:"button",onClick:()=>{D(!1),f(r)},style:{display:"flex",alignItems:"center",width:"100%",padding:"6px 12px",gap:8,background:"transparent",border:"none",color:"#333",fontSize:12,cursor:"pointer",textAlign:"left"},onPointerDown:e=>{e.preventDefault(),e.stopPropagation()},children:[e.jsxDEV("span",{style:{fontSize:12},children:a?"âž–":"âž•"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:413,columnNumber:17},void 0),e.jsxDEV("span",{children:a?"RÃ©duire":"DÃ©velopper"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:414,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:389,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:283,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:267,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/NodeActionMenu.tsx",lineNumber:266,columnNumber:5},void 0)},we=t.memo(({node:r,isSelected:n,isExpanded:a,hasChildren:i,depth:o,readOnly:l=!1,allNodes:d,onSelect:m,onToggleExpanded:u,onDoubleClick:p,onEditNode:h,onDuplicateNode:f,onDeleteNode:b,onMoveUpNode:v,onMoveDownNode:N,onToggleNodeVisibility:D,onOpenNodeSettings:x,onMoveNodeToRoot:C,onToggleExpandNode:E})=>{const S=t.useMemo(()=>({type:"node",nodeType:r.type,nodeId:r.id,id:r.id,node:r}),[r]),{attributes:g,listeners:T,setNodeRef:V,isDragging:y}=s({id:`structure-node-${r.id}`,data:S,disabled:l}),k=t.useMemo(()=>({type:"structure",nodeId:r.id,accepts:["palette-item","node"],position:"child"}),[r]),{isOver:w,setNodeRef:M}=c({id:`droppable-${r.id}`,data:k,disabled:l}),O=t.useMemo(()=>({type:"structure",nodeId:r.id,accepts:["palette-item","node"],position:"before"}),[r]),{isOver:R,setNodeRef:L}=c({id:`droppable-before-${r.id}`,data:O,disabled:l}),A=t.useMemo(()=>({type:"structure",nodeId:r.id,accepts:["palette-item","node"],position:"after"}),[r]),{isOver:P,setNodeRef:B}=c({id:`droppable-after-${r.id}`,data:A,disabled:l}),j=t.useCallback(()=>{try{return!(!d||!r.parentId)&&ye.isFieldInSection(r,d)}catch(e){return!1}},[r,d])(),U=t.useCallback(e=>{if(e.stopPropagation(),m(r),x)try{x(r)}catch(n){}},[r,m,x]),I=t.useCallback(e=>{e.stopPropagation(),p(r)},[r,p]),_=t.useCallback(e=>{e.stopPropagation(),u(r.id)},[r.id,u]),z={marginLeft:12*o+"px"},$=(e=>{const r=ye.getNodeType(e);if(null==r?void 0:r.emoji)return r.emoji;switch(e){case"branch":case"section":case"groupe":case"category":return"ðŸŒ¿";case"leaf_option":return"â—‹";case"leaf_option_field":return"â—";case"leaf_field":return"â—";case"text":case"input":return"ðŸ“";case"number":case"numeric":return"ðŸ”¢";case"select":case"dropdown":return"ðŸ“‹";case"checkbox":case"boolean":return"â˜‘ï¸";case"date":return"ðŸ“…";case"email":return"ðŸ“§";case"phone":return"ðŸ“ž";case"textarea":default:return"ðŸ“„";case"file":case"upload":return"ðŸ“Ž";case"url":case"link":return"ðŸ”—";case"color":return"ðŸŽ¨";case"range":return"ðŸŽšï¸"}})(r.type);return e.jsxDEV("div",{style:{position:"relative"},children:[e.jsxDEV("div",{ref:L,style:{position:"absolute",left:0,right:0,top:-6,height:14,borderRadius:2,marginLeft:z.marginLeft,background:R?"#ffe58f":"transparent",zIndex:2,pointerEvents:"auto",borderTop:R?"2px solid #faad14":"2px solid transparent"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:314,columnNumber:7},void 0),e.jsxDEV("div",{ref:M,style:{...z,display:"flex",alignItems:"center",position:"relative",backgroundColor:w?"#f6ffed":"transparent",border:w?"1px dashed #52c41a":"1px solid transparent",borderRadius:"4px",transition:"background 120ms, border 120ms"},children:[e.jsxDEV("div",{ref:V,style:{width:"12px",height:"12px",backgroundColor:"#fafafa",border:"1px solid #e8e8e8",borderRadius:"1px",cursor:l?"default":"grab",marginRight:"4px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"5px",color:"#bbb",opacity:y?.5:1,flexShrink:0,position:"relative"},...g,...T,"data-testid":`structure-drag-${r.id}`,title:"Glisser pour dÃ©placer",children:e.jsxDEV("div",{style:{display:"flex",flexDirection:"column",gap:"1px",opacity:.5},children:[e.jsxDEV("div",{style:{width:"6px",height:"1px",backgroundColor:"#bbb"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:376,columnNumber:13},void 0),e.jsxDEV("div",{style:{width:"6px",height:"1px",backgroundColor:"#bbb"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:377,columnNumber:13},void 0),e.jsxDEV("div",{style:{width:"6px",height:"1px",backgroundColor:"#bbb"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:378,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:370,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:345,columnNumber:9},void 0),e.jsxDEV("div",{style:{flex:1,minWidth:0,cursor:"pointer",padding:"1px 4px",margin:0,borderRadius:"2px",backgroundColor:n?"#e6f4ff":"transparent",border:n?"1px solid #1890ff":"1px solid transparent",boxShadow:n?"inset 0 0 0 1px #1890ff":void 0,transition:"background 100ms, border 100ms",display:"flex",alignItems:"center",minHeight:"18px"},onClick:U,onDoubleClick:I,"data-testid":`structure-node-${r.id}`,children:[e.jsxDEV("div",{style:{display:"flex",alignItems:"center",marginRight:4,position:"relative"},children:[o>0&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{style:{position:"absolute",left:"6px",top:"-12px",width:"1px",height:"36px",backgroundColor:"#e8e8e8",zIndex:1}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:409,columnNumber:17},void 0),e.jsxDEV("div",{style:{position:"absolute",left:"6px",top:"6px",width:"12px",height:"1px",backgroundColor:"#e8e8e8",zIndex:1}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:419,columnNumber:17},void 0),e.jsxDEV("div",{style:{width:"14px",height:"1px"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:429,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:407,columnNumber:15},void 0),e.jsxDEV("span",{onClick:i?_:void 0,style:{width:12,height:12,display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:i?"pointer":"default",backgroundColor:i?"#fafafa":"transparent",border:i?"1px solid #e8e8e8":"none",borderRadius:"1px",fontSize:"9px",color:"#999",userSelect:"none",transition:"all 0.15s",zIndex:2,position:"relative"},title:i?a?"RÃ©duire":"DÃ©velopper":void 0,children:i?a?"âˆ’":"+":""},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:434,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:404,columnNumber:11},void 0),e.jsxDEV("span",{style:{fontSize:11,width:12,textAlign:"center",marginRight:4,opacity:.7},children:$},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:460,columnNumber:11},void 0),e.jsxDEV("span",{style:{fontWeight:n?600:400,color:j?"#0958d9":"#333",fontSize:"11px",marginRight:"4px",flex:1,minWidth:0,display:"inline-flex",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap"},title:r.label||`${r.type}_${r.id}`,children:r.label||`${r.type}_${r.id}`},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:465,columnNumber:11},void 0),e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:"1px"},children:(()=>{const n=[];return r.hasFormula&&n.push(e.jsxDEV("span",{title:"Formule",style:{color:"#52c41a",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"ðŸ§®"},"formula",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:259,columnNumber:9},void 0)),r.hasCondition&&n.push(e.jsxDEV("span",{title:"Condition",style:{color:"#1890ff",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"âš–ï¸"},"condition",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:268,columnNumber:9},void 0)),r.hasAPI&&n.push(e.jsxDEV("span",{title:"API",style:{color:"#fa8c16",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"ðŸ”Œ"},"api",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:277,columnNumber:9},void 0)),r.hasTable&&n.push(e.jsxDEV("span",{title:"Tableau",style:{color:"#722ed1",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"ðŸ§©"},"table",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:286,columnNumber:9},void 0)),r.markers&&r.markers.length>0&&n.push(e.jsxDEV("span",{title:"Marqueurs",style:{color:"#eb2f96",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"ðŸ“"},"markers",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:294,columnNumber:9},void 0)),r.linkConfig&&Object.keys(r.linkConfig).length>0&&n.push(e.jsxDEV("span",{title:"Lien",style:{color:"#13c2c2",fontSize:"9px",marginLeft:"1px",opacity:.7},children:"ðŸ”—"},"link",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:302,columnNumber:9},void 0)),n})()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:485,columnNumber:11},void 0),j&&e.jsxDEV("span",{style:{fontSize:10,background:"#1890ff",color:"#fff",padding:"1px 4px",borderRadius:8,marginLeft:"6px"},children:"Section"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:491,columnNumber:13},void 0),e.jsxDEV("span",{style:{fontSize:9,color:"#999",fontStyle:"italic",marginLeft:"6px"},children:r.type},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:504,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:383,columnNumber:9},void 0),!l&&e.jsxDEV("div",{style:{marginLeft:"4px",flexShrink:0},children:e.jsxDEV(ke,{node:r,isExpanded:a,onEdit:(e,r)=>{h&&h(e,r)},onDuplicate:e=>{f&&f(e)},onDelete:e=>{b&&b(e)},onMoveUp:v,onMoveDown:N,onToggleVisibility:D,onOpenSettings:x,onMoveToRoot:C,onToggleExpand:E},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:517,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:516,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:331,columnNumber:7},void 0),e.jsxDEV("div",{ref:B,style:{position:"absolute",left:0,right:0,bottom:-6,height:14,borderRadius:2,marginLeft:z.marginLeft,background:P?"#ffe58f":"transparent",zIndex:2,pointerEvents:"auto",borderBottom:P?"2px solid #faad14":"2px solid transparent"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:546,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/OptimizedStructureNode.tsx",lineNumber:312,columnNumber:5},void 0)},(e,r)=>e.node.id===r.node.id&&e.node.label===r.node.label&&e.node.type===r.node.type&&e.isSelected===r.isSelected&&e.isExpanded===r.isExpanded&&e.hasChildren===r.hasChildren&&e.depth===r.depth&&e.readOnly===r.readOnly);we.displayName="OptimizedStructureNode";const{Text:Me}=y,Oe=a.memo(({tree:r,nodes:n,selectedNode:a,expandedNodes:i,searchState:o,onSelectNode:s,onToggleExpanded:l,onSearch:d,readOnly:m=!1,onEditNode:u,onDuplicateNode:p,onDeleteNode:h,onMoveUpNode:f,onMoveDownNode:b,onToggleNodeVisibility:v,onOpenNodeSettings:N,onMoveNodeToRoot:x})=>{var S;t.useMemo(()=>({tree:(null==r?void 0:r.label)||"aucun arbre",nodesCount:(null==n?void 0:n.length)||0,nodesData:null==n?void 0:n.slice(0,3),selectedNode:(null==a?void 0:a.label)||"aucun nÅ“ud sÃ©lectionnÃ©"}),[null==r?void 0:r.label,n,null==a?void 0:a.label]);const[g,V]=t.useState(o.query),[y,k]=t.useState(o.filters),w=t.useRef(null),[M,O]=t.useState(!1);t.useRef("");const{setNodeRef:R,isOver:L}=c({id:"structure-main-drop",data:{type:"structure",nodeId:null,accepts:["palette-item","node"]},disabled:m}),q=t.useCallback(e=>{const r=[],n=e=>{for(const t of e)t.children&&t.children.length&&(r.push(t.id),n(t.children))};return n(e),r},[]),W=t.useCallback(()=>{q(n).forEach(e=>{i.has(e)||l(e)})},[i,q,n,l]),H=t.useCallback(()=>{q(n).forEach(e=>{i.has(e)&&l(e)})},[i,q,n,l]);t.useEffect(()=>{const e=JSON.stringify(o.filters??{});w.current!==e&&(w.current=e,k(o.filters))},[o.filters]);const G=null==(S=o.filters)?void 0:S.type,K=t.useMemo(()=>{let e=0;return(null==y?void 0:y.nodeTypes)&&y.nodeTypes.length&&e++,G&&G.length&&e++,(null==y?void 0:y.capabilities)&&y.capabilities.length&&e++,(null==y?void 0:y.markers)&&y.markers.length&&e++,"boolean"==typeof(null==y?void 0:y.hasData)&&e++,"boolean"==typeof(null==y?void 0:y.isRequired)&&e++,e},[y,G]),X=t.useCallback(e=>{k(e),d(g,e)},[d,g]),Z=t.useCallback((e,r)=>{const n=e?[...e]:[],t=n.findIndex(e=>e===r);return t>=0?n.splice(t,1):n.push(r),n},[]),J=t.useCallback((e,r=0,n=[])=>{for(const t of e){if(g&&!t.label.toLowerCase().includes(g.toLowerCase()))continue;let e=!0;const a=y||{},o=a.nodeTypes||G;if(e&&o&&o.length&&(e=o.includes(t.type)),e&&a.capabilities&&a.capabilities.length)for(const r of a.capabilities){const n={data:"hasData",formula:"hasFormula",condition:"hasCondition",table:"hasTable",api:"hasAPI",link:"hasLink",markers:"hasMarkers",validation:"hasCondition"}[r];if(n&&!t[n]){e=!1;break}}e&&"boolean"==typeof a.hasData&&(e=!!t.hasData===a.hasData),e&&"boolean"==typeof a.isRequired&&(e=!!t.isRequired===a.isRequired),e&&(n.push({node:t,level:r}),t.children&&i.has(t.id)&&J(t.children,r+1,n))}return n},[g,i,y,G]),Y=t.useMemo(()=>J(n),[J,n]),Q=t.useMemo(()=>Y.map(e=>e.node),[Y]),ee=t.useCallback(e=>{l(e.id)},[l]),re=t.useCallback(e=>{l(e.id)},[l]),ne=t.useCallback(e=>{V(e),d(e,y)},[y,d]);return r?0===n.length?e.jsxDEV("div",{ref:R,style:{padding:"40px",minHeight:"200px",backgroundColor:L?"#f6ffed":"transparent",border:L?"2px dashed #52c41a":"1px dashed #d9d9d9",borderRadius:"4px",transition:"all 0.3s ease"},children:e.jsxDEV(A,{description:"Arbre vide",image:A.PRESENTED_IMAGE_SIMPLE,children:e.jsxDEV(Me,{type:"secondary",children:"Glissez des Ã©lÃ©ments de la Palette pour commencer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:307,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:303,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:292,columnNumber:7},void 0):e.jsxDEV("div",{style:{height:"100%",display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxDEV("div",{style:{marginBottom:"8px",padding:"6px",backgroundColor:"#fafafa",borderRadius:"4px"},children:e.jsxDEV(D,{style:{width:"100%",justifyContent:"space-between"},children:[e.jsxDEV(T,{placeholder:"Rechercher...",prefix:e.jsxDEV(P,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:324,columnNumber:21},void 0),value:g,onChange:e=>ne(e.target.value),style:{width:"200px"},allowClear:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:322,columnNumber:11},void 0),e.jsxDEV(D,{children:[e.jsxDEV(C,{title:"Tout dÃ©plier",children:e.jsxDEV(E,{type:"text",size:"small",icon:e.jsxDEV(B,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:337,columnNumber:23},void 0),onClick:W},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:334,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:333,columnNumber:13},void 0),e.jsxDEV(C,{title:"Tout replier",children:e.jsxDEV(E,{type:"text",size:"small",icon:e.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:346,columnNumber:23},void 0),onClick:H},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:343,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:342,columnNumber:13},void 0),e.jsxDEV(U,{trigger:"click",open:M,onOpenChange:O,placement:"bottomRight",content:e.jsxDEV("div",{style:{width:260},children:[e.jsxDEV(Me,{strong:!0,children:"Types"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:358,columnNumber:19},void 0),e.jsxDEV("div",{style:{marginTop:6},children:["branch","leaf_option","leaf_option_field","leaf_field"].map(r=>e.jsxDEV("div",{style:{marginBottom:4},children:e.jsxDEV(z,{checked:!!(y.nodeTypes||G||[]).includes(r),onChange:()=>{const e=y.nodeTypes||G||[],n=Z(e,r);X({...y,nodeTypes:n})},children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:362,columnNumber:25},void 0)},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:361,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:359,columnNumber:19},void 0),e.jsxDEV($,{style:{margin:"8px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:374,columnNumber:19},void 0),e.jsxDEV(Me,{strong:!0,children:"CapacitÃ©s"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:375,columnNumber:19},void 0),e.jsxDEV("div",{style:{marginTop:6},children:["data","formula","condition","table","api","link","markers"].map(r=>e.jsxDEV("div",{style:{marginBottom:4},children:e.jsxDEV(z,{checked:!!(y.capabilities||[]).includes(r),onChange:()=>{const e=Z(y.capabilities,r);X({...y,capabilities:e})},children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:379,columnNumber:25},void 0)},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:378,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:376,columnNumber:19},void 0),e.jsxDEV($,{style:{margin:"8px 0"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:390,columnNumber:19},void 0),e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxDEV(Me,{children:"Avec donnÃ©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:393,columnNumber:23},void 0),e.jsxDEV(F,{checked:"boolean"==typeof y.hasData?y.hasData:void 0,onChange:e=>X({...y,hasData:e})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:394,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:392,columnNumber:21},void 0),e.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxDEV(Me,{children:"Obligatoire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:400,columnNumber:23},void 0),e.jsxDEV(F,{checked:"boolean"==typeof y.isRequired?y.isRequired:void 0,onChange:e=>X({...y,isRequired:e})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:401,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:399,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:391,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:357,columnNumber:17},void 0),children:e.jsxDEV(C,{title:"Filtres",children:e.jsxDEV(I,{count:K,size:"small",children:e.jsxDEV(E,{type:"text",size:"small",icon:e.jsxDEV(_,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:415,columnNumber:27},void 0),onClick:()=>O(e=>!e)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:412,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:411,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:410,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:351,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:332,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:320,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:319,columnNumber:7},void 0),e.jsxDEV("div",{ref:R,style:{flex:1,minHeight:0,border:"1px solid #f0f0f0",borderRadius:"4px",overflow:"auto",backgroundColor:L?"#f6ffed":"transparent"},children:Y.length>0?e.jsxDEV("div",{style:{padding:"2px",textAlign:"left"},children:Y.map(r=>{var n;const{node:t,level:o}=r,c=(null==a?void 0:a.id)===t.id,d=i.has(t.id),D=((null==(n=t.children)?void 0:n.length)||0)>0;return e.jsxDEV(we,{node:t,depth:o,isSelected:c,isExpanded:d,hasChildren:D,allNodes:Q,onSelect:s,onToggleExpanded:l,onDoubleClick:ee,readOnly:m,onEditNode:u,onDuplicateNode:p,onDeleteNode:h,onMoveUpNode:f,onMoveDownNode:b,onToggleNodeVisibility:v,onOpenNodeSettings:N,onMoveNodeToRoot:x,onToggleExpandNode:re},t.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:446,columnNumber:17},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:438,columnNumber:11},void 0):e.jsxDEV("div",{style:{padding:"20px"},children:e.jsxDEV(Me,{type:"secondary",children:"Aucun rÃ©sultat trouvÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:473,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:472,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:426,columnNumber:7},void 0),e.jsxDEV("div",{style:{marginTop:"6px",padding:"2px 6px",fontSize:"10px",color:"#666",backgroundColor:"#fafafa",borderRadius:"4px"},children:[Y.length," Ã©lÃ©ment",Y.length>1?"s":"",g&&` â€¢ FiltrÃ©s par "${g}"`]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:479,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:316,columnNumber:5},void 0):e.jsxDEV("div",{ref:R,style:{padding:"40px",minHeight:"200px",backgroundColor:L?"#f6ffed":"transparent",border:L?"2px dashed #52c41a":"1px dashed #d9d9d9",borderRadius:"4px",transition:"all 0.3s ease"},children:e.jsxDEV(A,{description:"Aucun arbre sÃ©lectionnÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:283,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Structure/Structure.tsx",lineNumber:272,columnNumber:7},void 0)});function Re(e,r=400){const n=t.useRef(null),a=t.useRef(e),i=t.useRef(r);return t.useEffect(()=>{a.current=e,i.current=r},[e,r]),t.useCallback((...e)=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>{a.current(...e)},i.current)},[])}const{Text:Le}=y,{Option:Ae}=x,{TextArea:Pe}=T,Be=({nodeId:r,treeId:n,value:a,onChange:i,onNodeUpdate:s,readOnly:c=!1})=>{const{api:l}=o(),[d,h]=t.useState((null==a?void 0:a.isSharedReference)?"reference":"copy"),[f,b]=t.useState((null==a?void 0:a.sharedReferenceIds)||((null==a?void 0:a.sharedReferenceId)?[a.sharedReferenceId]:[])),[v,C]=t.useState(""),[V,y]=t.useState(""),[w,M]=t.useState([]),[O,R]=t.useState(null),[L,A]=t.useState(!1),[P,B]=t.useState(!1),[j,U]=t.useState(null),[I,_]=t.useState(null),[z,F]=t.useState(""),[H,G]=t.useState(""),[K,X]=t.useState(!1),[Z,J]=t.useState(null),[Y,Q]=t.useState(!1);t.useEffect(()=>{(async()=>{if(r)try{const e=await l.get(`/api/treebranchleaf/nodes/${r}`);U(e)}catch(e){}})()},[r,l]);const ee=t.useCallback(async()=>{try{A(!0);const e=await l.get("/api/treebranchleaf/shared-references");M(e||[])}catch(e){m.error("Impossible de charger les rÃ©fÃ©rences disponibles")}finally{A(!1)}},[l]),re=t.useCallback(async e=>{try{const r=await l.get(`/api/treebranchleaf/shared-references/${e}`);R(r)}catch(r){}},[l]),ne=t.useCallback(async e=>{if(!j)return;h(e);const r={id:j.id,isSharedReference:"reference"===e};"copy"===e&&(r.sharedReferenceId=null,r.sharedReferenceName=null,r.sharedReferenceDescription=null,r.sharedReferenceIds=[],j.options&&j.options.length>0&&(r.options=j.options.map(e=>({...e,sharedReferenceIds:[]})))),s&&await s(r),null==i||i({...a,...r})},[j,s,i,a]),te=t.useCallback(async()=>{if(v.trim())if(n)try{B(!0);await l.post(`/api/treebranchleaf/trees/${n}/create-shared-reference`,{name:v.trim(),description:V.trim()||void 0,fieldType:"TEXT",label:v.trim()});m.success("RÃ©fÃ©rence partagÃ©e crÃ©Ã©e avec succÃ¨s"),C(""),y(""),await ee()}catch(e){m.error("Impossible de crÃ©er la rÃ©fÃ©rence")}finally{B(!1)}else m.error("Impossible de dÃ©terminer l'arbre du nÅ“ud");else m.warning("Veuillez saisir un nom pour la rÃ©fÃ©rence")},[n,v,V,l,ee]),ae=t.useCallback(e=>{_(e),F(e.label),G(e.description||""),X(!0)},[]),ie=t.useCallback(async()=>{if(I&&z.trim())try{await l.put(`/api/treebranchleaf/shared-references/${I.id}`,{name:z.trim(),description:H.trim()||void 0}),m.success("RÃ©fÃ©rence modifiÃ©e avec succÃ¨s"),X(!1),_(null),await ee()}catch(e){m.error("Impossible de modifier la rÃ©fÃ©rence")}else m.warning("Le nom est requis")},[I,z,H,l,ee]),oe=t.useCallback(async e=>{var n,t;try{await l.delete(`/api/treebranchleaf/shared-references/${e}`);m.success("RÃ©fÃ©rence supprimÃ©e avec succÃ¨s");const n=((null==a?void 0:a.sharedReferenceIds)||[]).filter(r=>r!==e);if(0===n.length)null==i||i({isSharedReference:!1,sharedReferenceId:null,sharedReferenceName:null,sharedReferenceDescription:null,sharedReferenceIds:[]});else{const e=w.find(e=>e.id===n[0]);null==i||i({...a,sharedReferenceIds:n,sharedReferenceId:(null==e?void 0:e.id)||null,sharedReferenceName:(null==e?void 0:e.label)||"",sharedReferenceDescription:(null==e?void 0:e.description)||null})}s&&r&&await s({id:r,sharedReferenceIds:n,sharedReferenceId:n[0]||null}),await ee()}catch(o){(null==(t=null==(n=o.response)?void 0:n.data)?void 0:t.message)?m.error(o.response.data.message):m.error("Impossible de supprimer la rÃ©fÃ©rence")}},[l,ee,a,i,s,r,w]);return t.useEffect(()=>{"reference"===d&&ee()},[d,ee]),t.useEffect(()=>{f.length>0?re(f[0]):R(null)},[f,re]),e.jsxDEV(k,{title:e.jsxDEV(D,{children:[e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:322,columnNumber:11},void 0),e.jsxDEV("span",{children:"Mode de rÃ©utilisation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:323,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:321,columnNumber:9},void 0),children:[e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsxDEV(q.Group,{value:d,onChange:e=>ne(e.target.value),disabled:c,style:{width:"100%"},children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV(q,{value:"copy",children:[e.jsxDEV(D,{children:[e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:337,columnNumber:17},void 0),e.jsxDEV(Le,{strong:!0,children:"Copie indÃ©pendante"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:338,columnNumber:17},void 0),e.jsxDEV(Le,{type:"secondary",children:"(par dÃ©faut)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:339,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:336,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginLeft:24,marginTop:8},children:e.jsxDEV(Le,{type:"secondary",children:"Ce champ est unique et modifiable librement"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:342,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:341,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:335,columnNumber:13},void 0),e.jsxDEV(q,{value:"reference",children:[e.jsxDEV(D,{children:[e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:350,columnNumber:17},void 0),e.jsxDEV(Le,{strong:!0,children:"RÃ©fÃ©rence partagÃ©e"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:351,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:349,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginLeft:24,marginTop:8},children:e.jsxDEV(Le,{type:"secondary",children:"Ce champ est liÃ© Ã  un template rÃ©utilisable"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:354,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:353,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:348,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:334,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:328,columnNumber:9},void 0),"reference"===d&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV($,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:364,columnNumber:13},void 0),e.jsxDEV(k,{size:"small",title:"âœ… Choisir une ou plusieurs rÃ©fÃ©rences",children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV(x,{mode:"multiple",style:{width:"100%"},placeholder:"Choisir une ou plusieurs rÃ©fÃ©rences...",value:(null==a?void 0:a.sharedReferenceIds)||[],onChange:async(e,n)=>{const t=r;if(t)try{await l.post(`/api/treebranchleaf/nodes/${t}/link-shared-references`,{referenceIds:e});const r=n[0],o={sharedReferenceIds:e,sharedReferenceId:(null==r?void 0:r.value)||null,sharedReferenceName:(null==r?void 0:r.label)||"",sharedReferenceDescription:(null==r?void 0:r.description)||null};s&&await s({id:t,...o}),null==i||i({...a,...o}),m.success("RÃ©fÃ©rence(s) mise(s) Ã  jour.")}catch(o){m.error("Erreur lors de la liaison des rÃ©fÃ©rences")}else m.error("ID du nÅ“ud de travail manquant.")},disabled:c||L,loading:L,showSearch:!0,allowClear:!0,maxTagCount:"responsive",filterOption:(e,r)=>{var n;return null==(n=null==r?void 0:r.children)?void 0:n.toLowerCase().includes(e.toLowerCase())},children:w.map(r=>e.jsxDEV(Ae,{value:r.id,children:e.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxDEV("strong",{children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:429,columnNumber:25},void 0),e.jsxDEV(Le,{type:"secondary",style:{fontSize:"12px"},children:[r.usageCount,"Ã— utilisÃ©"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:430,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:428,columnNumber:23},void 0)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:427,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:369,columnNumber:17},void 0),(null==a?void 0:a.sharedReferenceIds)&&a.sharedReferenceIds.length>0&&e.jsxDEV(k,{size:"small",title:"GÃ©rer les rÃ©fÃ©rences sÃ©lectionnÃ©es",style:{marginTop:8},children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},size:"small",children:w.filter(e=>{var r;return null==(r=null==a?void 0:a.sharedReferenceIds)?void 0:r.includes(e.id)}).map(r=>e.jsxDEV(k,{size:"small",style:{width:"100%"},children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},size:"small",children:[e.jsxDEV("div",{children:[e.jsxDEV(D,{align:"center",children:[e.jsxDEV("strong",{children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:449,columnNumber:35},void 0),e.jsxDEV(Le,{copyable:{text:r.id},type:"secondary",code:!0,style:{fontSize:"10px"},children:["ID: ",r.id]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:450,columnNumber:35},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:448,columnNumber:33},void 0),e.jsxDEV("div",{children:e.jsxDEV(Le,{type:"secondary",children:r.description||"Aucune description"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:455,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:454,columnNumber:33},void 0),e.jsxDEV("div",{children:e.jsxDEV(Le,{type:"secondary",style:{fontSize:"12px"},children:["UtilisÃ© ",r.usageCount," fois"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:458,columnNumber:35},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:457,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:447,columnNumber:31},void 0),e.jsxDEV(D,{children:[e.jsxDEV(E,{size:"small",icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:466,columnNumber:41},void 0),onClick:e=>{e.preventDefault(),e.stopPropagation(),ae(r)},children:"Modifier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:464,columnNumber:33},void 0),e.jsxDEV(E,{size:"small",danger:!0,icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:478,columnNumber:41},void 0),onClick:e=>{e.preventDefault(),e.stopPropagation(),J(r),Q(!0)},children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:475,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:463,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:446,columnNumber:29},void 0)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:445,columnNumber:27},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:441,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:440,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:368,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:367,columnNumber:13},void 0),e.jsxDEV(k,{size:"small",title:"Ou crÃ©er une nouvelle rÃ©fÃ©rence",children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV("div",{children:[e.jsxDEV(Le,{children:"Nom de la rÃ©fÃ©rence *"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:503,columnNumber:19},void 0),e.jsxDEV(T,{placeholder:"Ex: Template Surface Habitable",value:v,onChange:e=>C(e.target.value),disabled:c||P,style:{marginTop:4}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:504,columnNumber:19},void 0),e.jsxDEV(Le,{type:"secondary",style:{fontSize:12},children:"ðŸ’¡ Ce nom sera visible quand vous rÃ©utiliserez ce champ ailleurs"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:511,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:502,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV(Le,{children:"Description (optionnel)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:519,columnNumber:19},void 0),e.jsxDEV(Pe,{placeholder:"Ex: Champ standard pour la surface habitable d'un bien",value:V,onChange:e=>y(e.target.value),disabled:c||P,rows:2,style:{marginTop:4}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:520,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:518,columnNumber:17},void 0),e.jsxDEV(E,{type:"primary",icon:e.jsxDEV(S,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:532,columnNumber:25},void 0),onClick:te,loading:P,disabled:c||!v.trim(),block:!0,children:"CrÃ©er et utiliser cette rÃ©fÃ©rence"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:530,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:501,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:500,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:363,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:327,columnNumber:7},void 0),e.jsxDEV(g,{title:"Modifier la rÃ©fÃ©rence partagÃ©e",open:K,onOk:ie,onCancel:()=>X(!1),okText:"Enregistrer",cancelText:"Annuler",children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxDEV("div",{children:[e.jsxDEV(Le,{children:"Nom de la rÃ©fÃ©rence *"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:557,columnNumber:13},void 0),e.jsxDEV(T,{value:z,onChange:e=>F(e.target.value),placeholder:"Ex: Template Surface Habitable",style:{marginTop:4}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:558,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:556,columnNumber:11},void 0),e.jsxDEV("div",{children:[e.jsxDEV(Le,{children:"Description (optionnel)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:567,columnNumber:13},void 0),e.jsxDEV(Pe,{value:H,onChange:e=>G(e.target.value),placeholder:"Ex: Champ standard pour la surface habitable d'un bien",rows:3,style:{marginTop:4}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:568,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:566,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:555,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:547,columnNumber:7},void 0),e.jsxDEV(g,{title:"Supprimer cette rÃ©fÃ©rence ?",open:Y,onOk:async()=>{Z&&await oe(Z.id),Q(!1),J(null)},onCancel:()=>{Q(!1),J(null)},okText:"Supprimer",okType:"danger",cancelText:"Annuler",okButtonProps:{danger:!0},children:Z&&e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:Z.usageCount>0?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(Le,{strong:!0,children:"âš ï¸ ATTENTION"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:605,columnNumber:17},void 0),e.jsxDEV(Le,{children:["Cette rÃ©fÃ©rence est utilisÃ©e ",e.jsxDEV("strong",{children:[Z.usageCount," fois"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:607,columnNumber:48},void 0),". La supprimer peut affecter les champs qui l'utilisent."]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:606,columnNumber:17},void 0),e.jsxDEV(Le,{type:"danger",children:"ÃŠtes-vous sÃ»r de vouloir continuer ?"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:610,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:604,columnNumber:15},void 0):e.jsxDEV(Le,{children:"Cette action est irrÃ©versible. ÃŠtes-vous sÃ»r ?"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:613,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:602,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:580,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/capabilities/SharedReferencePanel.tsx",lineNumber:319,columnNumber:5},void 0)},je=r=>{const{tree:n,selectedNode:i,nodes:s=[],panelState:c,registry:l,onNodeUpdate:d,refreshTree:m,onDeleteNode:u,onSelectNodeId:p,onExpandNodeId:h}=r,f=t.useRef(!0),{api:b}=o(),[S,g]=t.useState(!1),[V,y]=t.useState(!1),w=t.useRef(new Map),M=t.useMemo(()=>l.getAllCapabilities(),[l]),[O,R]=t.useState(new Set(Array.from(c.openCapabilities||[]))),[L,P]=t.useState(!1),B=t.useRef({}),j=t.useRef(null),[U,I]=t.useState(""),[z,$]=t.useState(""),[F,q]=t.useState(!1),[re,ne]=t.useState(!0),[te,ae]=t.useState(!1),[ie,oe]=t.useState(void 0),[se,ce]=t.useState({}),le=t.useRef({}),de=t.useRef(null),me=c.openCapabilities,ue=(null==i?void 0:i.id)??null,pe="Ajouter une entrÃ©e",[he,fe]=t.useState([]),[be,ve]=t.useState(void 0),[Ne,De]=t.useState(void 0),[xe,Se]=t.useState(pe),ge=t.useRef(!1),Te=t.useRef(null);t.useEffect(()=>(f.current=!0,()=>{f.current=!1}),[]);const Ve=t.useCallback(async()=>{if(i)try{if("function"==typeof u)return void(await Promise.resolve(u(i)));n&&i&&(await b.delete(`/api/treebranchleaf/trees/${n.id}/nodes/${i.id}`),"function"==typeof m&&await Promise.resolve(m()))}catch(e){}},[b,u,m,i,n]),ke=t.useCallback(async e=>{if((null==i?void 0:i.id)&&b)try{const n=await b.post(`/api/treebranchleaf/nodes/${i.id}/duplicate-templates`,{templateNodeIds:e}),t=Array.isArray(null==n?void 0:n.duplicated)?n.duplicated:[];t.forEach((e,r)=>{});try{await Promise.all(t.map(e=>b.post(`/api/treebranchleaf/nodes/${e.id}/apply-shared-references-from-original`)))}catch(r){}try{"function"==typeof m&&await Promise.resolve(m())}catch(r){}try{if(t.length>0){const e=t[t.length-1].id;"function"==typeof h&&h(i.id),"function"==typeof p&&p(e)}}catch(r){}}catch(n){try{if(null==i?void 0:i.id){const r=w.current,n=r.get(i.id);n&&(e.forEach(e=>n.delete(e)),0===n.size?r.delete(i.id):r.set(i.id,n))}}catch(r){}}},[i,b,m,h,p]),we=t.useRef(d);t.useEffect(()=>{we.current=d},[d]);const Me=Re(async e=>{if(ue)try{const r={...e};if(e.appearanceConfig){const n=e.appearanceConfig;n.repeater?r.metadata={...r.metadata||{},repeater:n.repeater,appearance:e.appearanceConfig}:r.metadata={...r.metadata||{},appearance:e.appearanceConfig}}await we.current({...r,id:ue})}catch(r){}},800),Oe=t.useMemo(()=>{if(!i)return null;const e=[...s];for(;e.length>0;){const r=e.pop();if(r.id===i.id)return r;if(r.children&&r.children.length>0)for(const n of r.children)e.push(n)}return null},[s,i]),Le=t.useCallback(e=>{if(!i)return;const r={...{templateNodeIds:he,minItems:be??void 0,maxItems:Ne??void 0,addButtonLabel:xe!==pe?xe:void 0},...e};if(Array.isArray(r.templateNodeIds)||delete r.templateNodeIds,void 0===r.minItems&&delete r.minItems,void 0===r.maxItems&&delete r.maxItems,"string"==typeof r.addButtonLabel){const e=r.addButtonLabel.trim();0===e.length||e===pe?delete r.addButtonLabel:r.addButtonLabel=e}const n={metadata:{...i.metadata||{},repeater:r},repeater_addButtonLabel:r.addButtonLabel||null,repeater_buttonSize:r.buttonSize||"middle",repeater_buttonWidth:r.buttonWidth||"auto",repeater_iconOnly:r.iconOnly||!1,repeater_minItems:r.minItems??0,repeater_maxItems:r.maxItems||null};if(Me(n),window.dispatchEvent(new CustomEvent("tbl-repeater-updated",{detail:{nodeId:i.id,treeId:i.tree_id}})),r.templateNodeIds&&r.templateNodeIds.length>0)try{const e=(e,r)=>{if(!r)return[];const n=[...e],t=[];for(;n.length;){const e=n.pop();e.parentId===r&&t.push(e),e.children&&e.children.length&&n.push(...e.children)}return t},n=(null==Oe?void 0:Oe.id)||i.id,t=e(s,n),a=new Set;t.forEach(e=>{const r=e.metadata||{};(null==r?void 0:r.sourceTemplateId)&&a.add(r.sourceTemplateId)});(e=>{if(!e)return[];const r=[],n=[...e];for(;n.length;){const e=n.pop();r.push(e),e.children&&e.children.length&&n.push(...e.children)}return r})(s).forEach(e=>{const r=e.metadata||{};(null==r?void 0:r.duplicatedFromRepeater)===n&&(null==r?void 0:r.sourceTemplateId)&&a.add(r.sourceTemplateId)});const o=w.current.get(n);o&&o.size>0&&o.forEach(e=>a.add(e));const c=r.templateNodeIds.filter(e=>!a.has(e));if(c.length>0){const e=w.current,r=e.get(n)||new Set;c.forEach(e=>r.add(e)),e.set(n,r),ke(c)}}catch(t){ke(r.templateNodeIds)}},[Me,i,Oe,s,he,be,Ne,xe,pe,ke]);t.useEffect(()=>{if(!(null==i?void 0:i.id)||0===w.current.size)return;const e=i.id,r=w.current.get(e);if(!r||0===r.size)return;const n=((e,r)=>{if(!r)return[];const n=[...e],t=[];for(;n.length;){const e=n.pop();e.parentId===r&&t.push(e),e.children&&e.children.length&&n.push(...e.children)}return t})(s,e),t=new Set;n.forEach(e=>{const r=e.metadata||{};(null==r?void 0:r.sourceTemplateId)&&t.add(r.sourceTemplateId)});let a=!1;r.forEach(e=>{t.has(e)&&(r.delete(e),a=!0)}),a&&(0===r.size?w.current.delete(e):w.current.set(e,r))},[s,null==i?void 0:i.id]),t.useEffect(()=>{var e,r,n;if(!i)return;const t=de.current!==i.id;de.current=i.id,I(i.label||""),$(i.description||""),q(!!i.isRequired),ne(!1!==i.isVisible),ae(!!i.isMultiple),t&&P(!1);const a=l.getNodeType(i.type),o=i.subType||(null==(e=i.metadata)?void 0:e.fieldType)||(null==a?void 0:a.defaultFieldType)||i.type;oe(o);const s=!!i.hasCondition;if(ce({data:!!i.hasData,formula:!!i.hasFormula,condition:s,table:!!i.hasTable,api:!!i.hasAPI,link:!!i.hasLink,markers:!!i.hasMarkers}),t&&R(new Set(Array.from(me||[]))),"leaf_repeater"===i.type){if(ge.current)return;const e=(null==(r=i.metadata)?void 0:r.repeater)||{},t=Array.isArray(e.templateNodeIds)?e.templateNodeIds:(null==(n=null==Oe?void 0:Oe.children)?void 0:n.map(e=>e.id))??[];fe(t),ve("number"==typeof e.minItems?e.minItems:void 0),De("number"==typeof e.maxItems?e.maxItems:void 0),Se("string"==typeof e.addButtonLabel&&e.addButtonLabel.trim().length>0?e.addButtonLabel:pe)}else fe([]),ve(void 0),De(void 0),Se(pe)},[i,l,me,Oe]),t.useEffect(()=>{if(!ue)return;const e=window.setTimeout(()=>{var e,r;try{null==(r=null==(e=j.current)?void 0:e.focus)||r.call(e,{cursor:"end"})}catch{}},50);return()=>{window.clearTimeout(e)}},[ue]),t.useEffect(()=>{le.current={...se}},[se]);const Ae=t.useCallback(e=>{I(e),Me({label:e})},[Me]),Pe=t.useCallback(e=>{$(e),Me({description:e})},[Me]),je=t.useCallback(e=>{ne(e),Me({isVisible:e})},[Me]),Ue=t.useCallback(e=>{q(e),Me({isRequired:e})},[Me]),Ie=t.useCallback(e=>{ae(e),Me({isMultiple:e})},[Me]),_e=t.useCallback(e=>{oe(e),P(!1);const r=ye.getDefaultAppearanceConfig(e),n=ye.mapAppearanceConfigToTBL(r);Me({subType:e,appearanceConfig:r,...n})},[Me]);if(!i)return e.jsxDEV(k,{children:e.jsxDEV(A,{image:A.PRESENTED_IMAGE_SIMPLE,description:"SÃ©lectionnez un nÅ“ud pour voir ses paramÃ¨tres"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:655,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:654,columnNumber:7},void 0);const ze="branch"===i.type||"section"===i.type;return e.jsxDEV(k,{title:e.jsxDEV(D,{children:[e.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:669,columnNumber:11},void 0),e.jsxDEV("span",{children:"ParamÃ¨tres du nÅ“ud"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:670,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:668,columnNumber:9},void 0),size:"small",children:e.jsxDEV("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[e.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[e.jsxDEV(D,{size:6,children:[e.jsxDEV(C,{title:"Appliquer les rÃ©fÃ©rences partagÃ©es depuis le gabarit original sur cette copie (crÃ©e/associe les copies -1)",children:e.jsxDEV(E,{size:"small",onClick:async()=>{if(null==i?void 0:i.id)try{g(!0),await b.post(`/api/treebranchleaf/nodes/${i.id}/apply-shared-references-from-original`),"function"==typeof m&&await Promise.resolve(m())}catch(e){}finally{g(!1)}},loading:S,disabled:!i||r.readOnly,children:"Appliquer rÃ©f. partagÃ©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:681,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:680,columnNumber:13},void 0),e.jsxDEV(H,{title:"DÃ©lier et supprimer les rÃ©fÃ©rences partagÃ©es ?",description:"Les liens vers les rÃ©fÃ©rences partagÃ©es seront supprimÃ©s dans cette sous-arborescence. Les copies -1 orphelines seront supprimÃ©es.",okText:"Oui, nettoyer",cancelText:"Annuler",onConfirm:async()=>{if(null==i?void 0:i.id)try{y(!0),await b.post(`/api/treebranchleaf/nodes/${i.id}/unlink-shared-references`,{deleteOrphans:!0}),"function"==typeof m&&await Promise.resolve(m())}catch(e){}finally{y(!1)}},okButtonProps:{danger:!0},disabled:!i||r.readOnly,children:e.jsxDEV(E,{danger:!0,size:"small",loading:V,disabled:!i||r.readOnly,children:"Supprimer rÃ©f. partagÃ©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:722,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:702,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:679,columnNumber:11},void 0),e.jsxDEV(H,{title:"Supprimer ce nÅ“ud ?",description:"Cette action supprimera Ã©galement ses enfants.",okText:"Supprimer",cancelText:"Annuler",okButtonProps:{danger:!0},onConfirm:Ve,disabled:!i||r.readOnly,children:e.jsxDEV(E,{danger:!0,size:"small",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:737,columnNumber:47},void 0),disabled:!i||r.readOnly,children:"Supprimer ce nÅ“ud"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:737,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:728,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:677,columnNumber:9},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h5",{style:{marginBottom:12,fontSize:14,fontWeight:600,margin:0},children:[e.jsxDEV(G,{style:{marginRight:8}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:745,columnNumber:13},void 0),"Apparence"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:744,columnNumber:11},void 0),e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},children:[e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxDEV("div",{style:{flex:1},children:[e.jsxDEV("strong",{style:{fontSize:12},children:"LibellÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:753,columnNumber:17},void 0),e.jsxDEV(T,{ref:j,value:U,onChange:e=>Ae(e.target.value),placeholder:"LibellÃ© du champ",disabled:r.readOnly,size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:754,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:752,columnNumber:15},void 0),e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:20},children:[e.jsxDEV(C,{title:"Visible",children:e.jsxDEV(E,{type:re?"primary":"default",size:"small",style:{width:24,height:24,padding:0},onClick:()=>je(!re),disabled:r.readOnly,children:"ðŸ‘"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:767,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:766,columnNumber:17},void 0),e.jsxDEV(C,{title:"Requis",children:e.jsxDEV(E,{type:F?"primary":"default",size:"small",style:{width:24,height:24,padding:0},onClick:()=>Ue(!F),disabled:r.readOnly||ze,children:"*"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:779,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:778,columnNumber:17},void 0),"branch"===(null==i?void 0:i.type)&&null!==(null==i?void 0:i.parentId)&&e.jsxDEV(C,{title:"Choix multiple",children:e.jsxDEV(E,{type:te?"primary":"default",size:"small",style:{width:24,height:24,padding:0,fontSize:10},onClick:()=>Ie(!te),disabled:r.readOnly,children:"âœ“"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:793,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:792,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:765,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:751,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("strong",{style:{fontSize:12},children:"Description"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:808,columnNumber:15},void 0),e.jsxDEV(T.TextArea,{value:z,onChange:e=>Pe(e.target.value),placeholder:"Description du champ",rows:2,disabled:r.readOnly},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:809,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:807,columnNumber:13},void 0),e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsxDEV("div",{style:{flex:1},children:[e.jsxDEV("strong",{style:{fontSize:12},children:"Type de champ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:821,columnNumber:17},void 0),ze?e.jsxDEV("div",{style:{padding:"4px 8px",backgroundColor:"#f0f0f0",border:"1px solid #d9d9d9",borderRadius:"4px",fontSize:"11px",color:"#666",textAlign:"center",marginTop:"4px"},children:"branch"===i.type?"ðŸŒ¿ Branche (pas de champ)":"section"===i.type?"ðŸ“‹ Section (pas de champ)":"âž• Bloc rÃ©pÃ©table (conteneur)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:823,columnNumber:19},void 0):e.jsxDEV(x,{value:ie,onChange:_e,style:{width:"100%"},disabled:r.readOnly,size:"small",placeholder:"SÃ©lectionner un type de champ",children:[e.jsxDEV(x.Option,{value:"text",children:"ðŸ“ Texte (TEXT)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:848,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"number",children:"ðŸ”¢ Nombre (NUMBER)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:849,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"boolean",children:"âœ… BoolÃ©en (BOOL)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:850,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"select",children:"ðŸ“‹ SÃ©lection (SELECT)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:851,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"multiselect",children:"ðŸ“‹âœ… SÃ©lection multiple (MULTISELECT)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:852,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"date",children:"ðŸ“… Date/Heure (DATE)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:853,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"image",children:"ðŸ–¼ï¸ Image (IMAGE)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:854,columnNumber:21},void 0),e.jsxDEV(x.Option,{value:"file",children:"ðŸ“Ž Fichier (FILE)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:855,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:840,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:820,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginTop:20},children:e.jsxDEV(C,{title:ze?"Ce type de nÅ“ud n'a pas de panneau d'apparence":"Apparence du champ",children:e.jsxDEV(E,{type:L?"primary":"default",size:"small",icon:e.jsxDEV(G,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:870,columnNumber:27},void 0),style:{width:32,height:24},disabled:r.readOnly||!ie||ze,onClick:()=>{P(!L)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:867,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:862,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:861,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:819,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:749,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:743,columnNumber:9},void 0),!ze&&ie&&e.jsxDEV("div",{style:{marginTop:12},children:e.jsxDEV(Be,{nodeId:i.id,treeId:null==n?void 0:n.id,value:{isSharedReference:i.isSharedReference??!1,sharedReferenceId:i.sharedReferenceId??null,sharedReferenceName:i.sharedReferenceName??null,sharedReferenceDescription:i.sharedReferenceDescription??null,sharedReferenceIds:i.sharedReferenceIds??[]},onChange:e=>{Me(e)},onNodeUpdate:async e=>{Me(e)},readOnly:r.readOnly},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:886,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:885,columnNumber:11},void 0),L&&ie&&e.jsxDEV("div",{style:{marginTop:12,border:"1px solid #e8e8e8",borderRadius:6,backgroundColor:"#fbfbfb"},children:[e.jsxDEV("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid #e8e8e8",backgroundColor:"#f7f7f7"},children:[e.jsxDEV("strong",{style:{fontSize:12},children:[e.jsxDEV(G,{style:{marginRight:6,fontSize:11}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:913,columnNumber:17},void 0),"Configuration Apparence (",null==ie?void 0:ie.toUpperCase(),")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:912,columnNumber:15},void 0),e.jsxDEV(E,{type:"text",size:"small",onClick:()=>P(!1),style:{fontSize:12,padding:0,width:18,height:18,lineHeight:"18px"},children:"Ã—"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:916,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:911,columnNumber:13},void 0),e.jsxDEV("div",{style:{padding:8},children:(()=>{const n=null==ie?void 0:ie.toUpperCase(),t=Ce[n||""];if(!t)return e.jsxDEV("div",{style:{padding:8,fontSize:11,color:"#999",textAlign:"center"},children:["Panneau d'apparence pour \"",ie,'" en cours de dÃ©veloppement...']},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:932,columnNumber:21},void 0);const o=a.lazy(t);return e.jsxDEV(a.Suspense,{fallback:e.jsxDEV("div",{style:{padding:8,fontSize:11,textAlign:"center"},children:"Chargement..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:940,columnNumber:45},void 0),children:e.jsxDEV("div",{style:{fontSize:"11px","--ant-typography-margin-bottom":"4px","--ant-form-item-margin-bottom":"6px"},children:e.jsxDEV(o,{value:(null==i?void 0:i.appearanceConfig)||{},onChange:e=>{const r={appearanceConfig:e,...ye.mapAppearanceConfigToTBL(e),...{repeater_addButtonLabel:e.addButtonLabel&&String(e.addButtonLabel).trim()||null,repeater_buttonSize:e.buttonSize||"middle",repeater_buttonWidth:e.buttonWidth||"auto",repeater_iconOnly:!0===e.iconOnly,repeater_minItems:null!=e.minItems?Number(e.minItems):be??0,repeater_maxItems:null!=e.maxItems?Number(e.maxItems):Ne??null}};Me(r)},readOnly:r.readOnly},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:949,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:941,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:940,columnNumber:19},void 0)})()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:926,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:910,columnNumber:11},void 0),"leaf_repeater"===(null==i?void 0:i.type)&&e.jsxDEV("div",{children:[e.jsxDEV("h5",{style:{marginBottom:12,fontSize:14,fontWeight:600,margin:0},children:"ðŸ” Champs Ã  rÃ©pÃ©ter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:994,columnNumber:13},void 0),e.jsxDEV(D,{direction:"vertical",size:10,style:{width:"100%"},children:[e.jsxDEV(K,{type:0===he.length?"warning":"info",showIcon:!0,message:0===he.length?"SÃ©lectionnez des champs existants dans l'arbre pour qu'ils soient rÃ©pÃ©tables.":'Les champs sÃ©lectionnÃ©s seront dupliquÃ©s Ã  chaque clic sur le bouton "Ajouter".'},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:998,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("strong",{style:{fontSize:12},children:"Champs Ã  rÃ©pÃ©ter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1009,columnNumber:17},void 0),e.jsxDEV(x,{mode:"multiple",size:"small",value:he,style:{width:"100%",marginTop:4},placeholder:"SÃ©lectionnez les champs gabarit",disabled:r.readOnly,onChange:async e=>{const r=e,t=he;fe(r),ge.current=!0,Te.current&&window.clearTimeout(Te.current),Te.current=window.setTimeout(()=>{ge.current=!1},1e3);const a={},i=r;i.forEach(e=>{const r=(e,n,t)=>{if(!e)return null;for(const a of e){const e=[...t,a.label||a.id];if(a.id===n)return e;if(a.children&&a.children.length>0){const t=r(a.children,n,e);if(t)return t}}return null},n=r(s,e,[]);n&&(a[e]=n.join(" / "))});try{const e=(t||[]).filter(e=>!r.includes(e));if(e.length>0){const r=(null==Oe?void 0:Oe.children)||[];for(const t of e){const e=r.filter(e=>{const r=e.metadata||{};return(null==r?void 0:r.sourceTemplateId)===t});for(const r of e)"function"==typeof u?await Promise.resolve(u(r)):n&&await b.delete(`/api/treebranchleaf/trees/${n.id}/nodes/${r.id}`)}"function"==typeof m&&await Promise.resolve(m())}}catch(o){}Le({templateNodeIds:i,templateNodeLabels:a})},allowClear:!0,children:(()=>{const r=["branch","section","leaf_field","leaf_option","leaf_option_field"],n=[],t=(e,r)=>{e&&e.forEach(e=>{const a=[...r,e.label||e.id];e.id!==(null==i?void 0:i.id)&&n.push({node:e,path:a}),e.children&&e.children.length>0&&t(e.children,a)})};return t(s,[]),n.filter(e=>r.includes(e.node.type)).map(r=>{const n=ye.getNodeType(r.node.type),t=(null==n?void 0:n.emoji)||"â€¢";return e.jsxDEV(x.Option,{value:r.node.id,children:[e.jsxDEV("span",{style:{marginRight:6},children:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1126,columnNumber:29},void 0),e.jsxDEV("span",{children:r.path.join(" / ")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1127,columnNumber:29},void 0)]},r.node.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1125,columnNumber:27},void 0)})})()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1010,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1008,columnNumber:15},void 0),he.length>0&&e.jsxDEV("div",{style:{marginTop:8},children:[e.jsxDEV("strong",{style:{fontSize:12},children:"Copies actuelles"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1138,columnNumber:19},void 0),e.jsxDEV("div",{style:{display:"flex",flexDirection:"column",gap:6,marginTop:4},children:(()=>{const r=((e,r)=>{if(!r)return[];const n=[...e],t=[];for(;n.length;){const e=n.pop();e.parentId===r&&t.push(e),e.children&&e.children.length&&n.push(...e.children)}return t})(s,null==Oe?void 0:Oe.id);try{r.map(e=>{var r;return{id:e.id,label:e.label,type:e.type,parentId:e.parentId,sourceTemplateId:null==(r=e.metadata)?void 0:r.sourceTemplateId,metadataKeys:Object.keys(e.metadata||{})}})}catch{}const t=[];for(const a of he){const i=function e(r,n){if(r&&n)for(const t of r){if(t.id===n)return t;const r=e(t.children,n);if(r)return r}}(s,a);let o=r.filter(e=>{const r=e.metadata||{};return(null==r?void 0:r.sourceTemplateId)===a});if(0===o.length&&s&&s.length>0&&(null==Oe?void 0:Oe.id)){const e=(e=>{if(!e)return[];const r=[],n=[...e];for(;n.length;){const e=n.pop();r.push(e),e.children&&e.children.length&&n.push(...e.children)}return r})(s).filter(e=>{const r=e.metadata||{};return(null==r?void 0:r.duplicatedFromRepeater)===Oe.id&&(null==r?void 0:r.sourceTemplateId)===a});if(e.length>0){const r=new Set(o.map(e=>e.id));o=[...o,...e.filter(e=>!r.has(e.id))]}}t.push(e.jsxDEV("div",{style:{border:"1px dashed #e8e8e8",borderRadius:4,padding:6},children:[e.jsxDEV("div",{style:{fontSize:12,fontWeight:600,marginBottom:4},children:["Gabarit: ",(null==i?void 0:i.label)||a," (",o.length," copie",o.length>1?"s":"",")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1237,columnNumber:29},void 0),0===o.length?e.jsxDEV("div",{style:{fontSize:11,color:"#999"},children:"Aucune copie pour ce gabarit."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1241,columnNumber:31},void 0):e.jsxDEV("div",{style:{display:"flex",flexDirection:"column",gap:4},children:o.map(r=>{const t=r.metadata||{};let o=null==t?void 0:t.copySuffix;if(void 0===o&&"string"==typeof r.label){const e=r.label.match(/-(\d+)$/);e&&(o=e[1])}const s=`${(null==i?void 0:i.label)||a}${void 0!==o?`-${o}`:""}`;return e.jsxDEV("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:[e.jsxDEV("div",{style:{fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1258,columnNumber:37},void 0),e.jsxDEV(H,{title:"Supprimer cette copie ?",okText:"Supprimer",cancelText:"Annuler",okButtonProps:{danger:!0},onConfirm:async()=>{try{"function"==typeof u?await Promise.resolve(u(r)):n&&await b.delete(`/api/treebranchleaf/trees/${n.id}/nodes/${r.id}`),"function"==typeof m&&await Promise.resolve(m())}catch(e){}},children:e.jsxDEV(E,{danger:!0,size:"small",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1281,columnNumber:73},void 0),children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1281,columnNumber:39},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1261,columnNumber:37},void 0)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1257,columnNumber:35},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1243,columnNumber:31},void 0)]},`tpl-${a}`,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1236,columnNumber:27},void 0))}return t})()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1139,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1137,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:997,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:993,columnNumber:11},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h5",{style:{marginBottom:12,fontSize:14,fontWeight:600,margin:0},children:[e.jsxDEV(X,{style:{marginRight:8}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1304,columnNumber:13},void 0),"CapacitÃ©s"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1303,columnNumber:11},void 0),e.jsxDEV("div",{style:{display:"flex",flexWrap:"wrap",gap:8},children:M.map(n=>{const t=se[n.key]||!1,a=O.has(n.key),o=(()=>{var e;switch(n.key){case"table":return!!(null==i?void 0:i.hasTable);case"formula":return!!(null==i?void 0:i.hasFormula);case"condition":case"conditions":return!!(null==i?void 0:i.hasCondition);case"data":return!!(null==i?void 0:i.hasData);case"api":return!!(null==i?void 0:i.hasAPI);case"link":return!!(null==i?void 0:i.hasLink);case"markers":return!!(null==i?void 0:i.hasMarkers);default:return(null==(e=null==i?void 0:i.config)?void 0:e[n.key])&&Object.keys(i.config[n.key]).length>0}})();return e.jsxDEV(C,{title:`${n.label}${o?" (avec donnÃ©es)":t?" (activÃ©)":" (dÃ©sactivÃ©)"}`,children:e.jsxDEV(E,{type:o?"primary":t?"default":"text",size:"small",icon:(r=>{switch(r){case"data":return e.jsxDEV(ee,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1338,columnNumber:39},void 0);case"formula":return e.jsxDEV(Q,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1339,columnNumber:42},void 0);case"condition":return e.jsxDEV(_,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1340,columnNumber:44},void 0);case"conditions":return e.jsxDEV(_,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1341,columnNumber:45},void 0);case"table":return e.jsxDEV(Y,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1342,columnNumber:40},void 0);case"api":return e.jsxDEV(J,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1343,columnNumber:38},void 0);case"link":return e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1344,columnNumber:39},void 0);case"markers":return e.jsxDEV(Z,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1345,columnNumber:42},void 0);default:return e.jsxDEV(X,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1346,columnNumber:35},void 0)}})(n.key),onClick:()=>{r.readOnly||R(e=>{const r=new Set(e);return r.has(n.key)?r.delete(n.key):r.add(n.key),r})},disabled:r.readOnly,style:{width:32,height:24,padding:0,display:"flex",alignItems:"center",justifyContent:"center",borderColor:a?"#1890ff":void 0,backgroundColor:o?"#1890ff":a?"#f0f9ff":void 0,color:o?"white":void 0}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1358,columnNumber:19},void 0)},n.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1357,columnNumber:17},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1308,columnNumber:11},void 0),e.jsxDEV("div",{style:{marginTop:12},children:M.map(r=>{if(!O.has(r.key))return null;const t=Ee[r.key];if(!t)return null;const o=a.lazy(t);return e.jsxDEV(a.Suspense,{fallback:e.jsxDEV("div",{style:{padding:8,fontSize:12},children:["Chargement ",r.label,"â€¦"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1402,columnNumber:43},void 0),children:e.jsxDEV("div",{style:{marginTop:8},ref:e=>{B.current[r.key]=e},children:e.jsxDEV(o,{treeId:(null==n?void 0:n.id)||"",nodeId:i.id,onNodeUpdate:d},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1404,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1403,columnNumber:19},void 0)},`cap-panel-${r.key}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1402,columnNumber:17},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1395,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:1302,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:675,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/Parameters.tsx",lineNumber:666,columnNumber:5},void 0)},{Title:Ue,Text:Ie}=y;function _e(r,n){const t=r.label||"Champ",a=r.id;switch((r.subType||"TEXT").toUpperCase()){case"NUMBER":return e.jsxDEV(d.Item,{name:a,label:t,children:e.jsxDEV(ne,{style:{width:"100%"},disabled:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:21,columnNumber:11},this)},a,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:20,columnNumber:9},this);case"EMAIL":return e.jsxDEV(d.Item,{name:a,label:t,children:e.jsxDEV(T,{type:"email",disabled:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:27,columnNumber:11},this)},a,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:26,columnNumber:9},this);case"TEL":return e.jsxDEV(d.Item,{name:a,label:t,children:e.jsxDEV(T,{disabled:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:33,columnNumber:11},this)},a,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:32,columnNumber:9},this);case"DATE":return e.jsxDEV(d.Item,{name:a,label:t,children:e.jsxDEV(re,{style:{width:"100%"},disabled:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:39,columnNumber:11},this)},a,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:38,columnNumber:9},this);default:return e.jsxDEV(d.Item,{name:a,label:t,children:e.jsxDEV(T,{disabled:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:45,columnNumber:11},this)},a,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:44,columnNumber:9},this)}}function ze(r,n,t){return"branch"===r.type?e.jsxDEV("div",{style:{marginLeft:12*n},children:[e.jsxDEV(Ue,{level:5,style:{marginTop:0===n?0:12},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:55,columnNumber:9},this),e.jsxDEV("div",{children:(r.children||[]).map(e=>ze(e,n+1,t))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:56,columnNumber:9},this)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:54,columnNumber:7},this):"leaf_option_field"===r.type?e.jsxDEV("div",{style:{marginLeft:12*n},children:[e.jsxDEV(z,{disabled:t,style:{marginBottom:4},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:67,columnNumber:9},this),e.jsxDEV("div",{style:{marginLeft:20},children:_e(r,t)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:68,columnNumber:9},this)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:66,columnNumber:7},this):"leaf_option"===r.type?e.jsxDEV("div",{style:{marginLeft:12*n},children:[e.jsxDEV(z,{disabled:t,children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:78,columnNumber:9},this),(r.children||[]).map(e=>ze(e,n+1,t))]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:77,columnNumber:7},this):e.jsxDEV("div",{style:{marginLeft:12*n},children:[_e(r,t),(r.children||[]).map(e=>ze(e,n+1,t))]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:86,columnNumber:5},this)}const $e=({nodes:r,readOnly:n})=>{const a=t.useMemo(()=>{const e=r=>[...r].sort((e,r)=>(e.order??0)-(r.order??0)).map(r=>({...r,children:r.children?e(r.children):[]}));return e(r||[])},[r]);return e.jsxDEV(k,{size:"small",style:{height:"100%",overflow:"auto"},children:e.jsxDEV(D,{direction:"vertical",style:{width:"100%"},size:12,children:[e.jsxDEV(Ie,{type:"secondary",children:"AperÃ§u simple du formulaire (lecture seule des capacitÃ©s)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:109,columnNumber:9},void 0),e.jsxDEV(d,{layout:"vertical",onFinish:()=>{},disabled:n,children:[a.map(e=>ze(e,0,n)),!n&&e.jsxDEV(d.Item,{children:e.jsxDEV(E,{type:"primary",htmlType:"submit",children:"Tester la soumission"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:114,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:113,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:110,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:108,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Preview/SimplePreview.tsx",lineNumber:107,columnNumber:5},void 0)},{Content:Fe}=ae,qe=({trees:r,selectedTree:n,nodes:a,readOnly:i=!1,onTreeChange:s,onNodesUpdate:c})=>{var d,u,p;const h=n||(r&&r.length>0?r[0]:null),{api:f}=o(),b=te.useBreakpoint(),v=b.lg??!1,N=!b.md,[x,C]=t.useState({selectedNode:void 0,expandedNodes:new Set,dragState:{isDragging:!1,draggedItem:void 0,hoveredTarget:void 0,validDrop:!1},searchState:{query:"",filters:{}},panelState:{activePanel:"properties",openCapabilities:new Set,previewMode:!1}});t.useRef({count:0}).current.count+=1,t.useRef(null);const[E,S]=t.useState("structure"),g=t.useRef(a||[]);t.useEffect(()=>{g.current=a||[]},[a]);const T=t.useCallback(async e=>{try{const r=await f.post("/api/treebranchleaf/trees",e),n=await f.get("/api/treebranchleaf/trees");return null==onTreesUpdate||onTreesUpdate(n||[]),(null==r?void 0:r.id)&&s(r),r}catch(r){return null}},[f,s]),V=t.useCallback(async e=>{try{const r=await f.put(`/api/treebranchleaf/trees/${e.id}`,e),n=await f.get("/api/treebranchleaf/trees");return null==onTreesUpdate||onTreesUpdate(n||[]),h&&(null==r?void 0:r.id)===h.id&&s(r),r}catch(r){return null}},[f,s,h]),y=t.useCallback(async e=>{try{await f.delete(`/api/treebranchleaf/trees/${e}`);const r=await f.get("/api/treebranchleaf/trees");if(null==onTreesUpdate||onTreesUpdate(r||[]),(null==h?void 0:h.id)===e){const e=(r||[])[0];e&&s(e)}return!0}catch(r){return!1}},[f,s,h]),w=t.useCallback(async(e,r,n="child")=>{var t,a,i,o,s,l,d;if(!h)return!1;try{const p=(e=>{if(!e||0===e.length)return[];const r=[],n=e=>{r.push(e),e.children&&e.children.length>0&&e.children.forEach(n)};return e.forEach(n),r})(g.current),b=p.find(r=>r.id===e),v=p.find(e=>e.id===r);if(!b||!v)return!1;let N;N="child"===n?r:v.parentId||null;const D=N?p.find(e=>e.id===N):null;if("leaf_option"===b.type){if(D){const e=(null==(t=D.type)?void 0:t.startsWith("leaf_"))&&"SELECT"===D.subType,r="branch"===D.type&&null!==D.parentId;if(!e&&!r)return!1}}else if(null==(a=b.type)?void 0:a.startsWith("leaf_")){if(D&&"branch"!==D.type&&!(null==(i=D.type)?void 0:i.startsWith("leaf_")))return!1}else if("branch"===b.type&&D&&"tree"!==D.type&&"branch"!==D.type)return!1;let x;if("child"===n){const e=p.filter(e=>e.parentId===r);x=e.length}else{const t=p.filter(r=>r.parentId===N&&r.id!==e).findIndex(e=>e.id===r);x="before"===n?t:t+1}const E=g.current,S=p.map(r=>{if(r.id===e)return{...r,parentId:N,order:x};if(r.parentId===N&&r.id!==e){const n=p.filter(r=>r.parentId===N&&r.id!==e).findIndex(e=>e.id===r.id);if(n>=x)return{...r,order:n+1}}return r}),T=(e=>{const r=e.filter(e=>!(!0===e.isSharedReference&&null===e.sharedReferenceId&&null===e.parentId)),n=new Map,t=[];r.forEach(e=>{n.set(e.id,{...e,children:[]})}),r.forEach(e=>{const r=n.get(e.id);if(e.parentId&&n.has(e.parentId)){const t=n.get(e.parentId);t.children=t.children||[],t.children.push(r)}else t.push(r)});const a=e=>{e.sort((e,r)=>(e.order||0)-(r.order||0)),e.forEach(e=>{e.children&&e.children.length>0&&a(e.children)})};return a(t),t})(S);c(T);try{await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e}`,{targetId:r,position:n})}catch(m){try{await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e}`,{targetId:r,position:n})}catch(u){c(E);(null==(o=null==u?void 0:u.data)?void 0:o.error)||(null==(s=null==u?void 0:u.data)?void 0:s.message)||(null==u?void 0:u.message)||(null==(l=null==m?void 0:m.data)?void 0:l.error)||(null==(d=null==m?void 0:m.data)?void 0:d.message)||(null==m||m.message);return!1}}return C(e=>{if(!e.selectedNode)return e;const t=r=>{for(const n of r){if(n.id===e.selectedNode.id)return n;if(n.children){const e=t(n.children);if(e)return e}}},a=t(T);let i=e;if(a&&(i={...i,selectedNode:a}),"child"===n&&r){const e=new Set(i.expandedNodes);e.add(r),i={...i,expandedNodes:e}}return i}),!0}catch(p){return!1}},[h,f,c]),M=t.useCallback(async e=>{if(!h)return null;try{const r=await f.post(`/api/treebranchleaf/trees/${h.id}/nodes`,e);if(r){const n=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);return c(n||[]),C(n=>{let t=n;if(e.parentId){const a=new Set(n.expandedNodes);a.add(e.parentId),a.add(r.id),t={...t,expandedNodes:a}}else{const e=new Set(n.expandedNodes);e.add(r.id),t={...t,expandedNodes:e}}return{...t,selectedNode:r}}),r}return null}catch(r){return null}},[h,f,c]),O=t.useCallback(e=>{if(e)return"leaf_repeater"===e?{repeater:{templateNodeIds:[],minItems:0,maxItems:null,addButtonLabel:null,buttonSize:"middle",buttonWidth:"auto",iconOnly:!1}}:void 0},[]),R=t.useCallback(async(e,r)=>{if(!h)return;const n={data:"hasData",formula:"hasFormula",condition:"hasCondition",table:"hasTable",api:"hasAPI",link:"hasLink",markers:"hasMarkers"}[r];if(!n)return;C(r=>{var t;return(null==(t=r.selectedNode)?void 0:t.id)===e?{...r,selectedNode:{...r.selectedNode,[n]:!0}}:r});try{const r=(a||[]).map(r=>r.id===e?{...r,[n]:!1,...clearConfig}:r);c(r)}catch{}await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e}`,{[n]:!1,...clearConfig});const t=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(t||[]),C(e=>{if(!e.selectedNode)return e;const r=(t||[]).find(r=>r.id===e.selectedNode.id);return r?{...e,selectedNode:r}:e})},[f,c,h,a]),L=t.useCallback(async e=>{if(!h)return null;try{try{const r=(g.current||[]).map(r=>r.id===e.id?{...r,...e}:r);c(r)}catch{}const r=await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,e);if(r){const n=t=>t.map(t=>t.id===e.id?{...t,...r}:t.children&&t.children.length>0?{...t,children:n(t.children)}:t),t=n(g.current);c(t),C(n=>{var t;return(null==(t=n.selectedNode)?void 0:t.id)===e.id?{...n,selectedNode:r}:n})}return r||null}catch(r){return null}},[f,c,h]),A=t.useCallback(async(e,r)=>{if(h)try{try{const n=(g.current||[]).map(n=>n.id===e.id?{...n,label:r}:n);c(n),C(n=>{var t;return(null==(t=n.selectedNode)?void 0:t.id)===e.id?{...n,selectedNode:{...n.selectedNode,label:r}}:n})}catch{}try{const n=await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{label:r}),t=(g.current||[]).map(r=>r.id===e.id?n:r);c(t),C(r=>{var t;return(null==(t=r.selectedNode)?void 0:t.id)===e.id?{...r,selectedNode:n}:r})}catch{try{const n=await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{label:r});if(n){const r=(g.current||[]).map(r=>r.id===e.id?n:r);c(r),C(r=>{var t;return(null==(t=r.selectedNode)?void 0:t.id)===e.id?{...r,selectedNode:n}:r})}}catch(n){throw n}}}catch(t){throw t}},[h,f,c]),P=t.useCallback(async e=>{var r;if(h)try{const n=await f.post(`/api/treebranchleaf/nodes/${e.id}/deep-copy`,{targetParentId:e.parentId}),t=(null==(r=null==n?void 0:n.root)?void 0:r.newId)||null,a=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);if(c(a||[]),t){const e=(a||[]).find(e=>e.id===t);C(r=>{let n=r.expandedNodes;if(null==e?void 0:e.parentId){const r=new Set(n);r.add(e.parentId),n=r}return{...r,selectedNode:e||r.selectedNode,expandedNodes:n}})}}catch(n){throw n}},[h,f,c]),B=t.useCallback(async e=>{var r;if(h)try{try{const r=(a||[]).filter(r=>r.id!==e.id);c(r),C(r=>{var n;return(null==(n=r.selectedNode)?void 0:n.id)===e.id?{...r,selectedNode:void 0}:r})}catch{}await f.delete(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`);const n=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(n||[]),(null==(r=x.selectedNode)?void 0:r.id)===e.id&&C(e=>({...e,selectedNode:void 0}))}catch(n){throw n}},[h,f,c,a,null==(d=x.selectedNode)?void 0:d.id]),j=t.useCallback(async e=>{if(h)try{const r=(g.current||[]).filter(r=>(r.parentId||null)===(e.parentId||null)).sort((e,r)=>{var n,t,a,i;const o=(e.order??0)-(r.order??0);if(0!==o)return o;const s="string"==typeof e.createdAt?e.createdAt:(null==(t=null==(n=e.createdAt)?void 0:n.toISOString)?void 0:t.call(n))||"",c="string"==typeof r.createdAt?r.createdAt:(null==(i=null==(a=r.createdAt)?void 0:a.toISOString)?void 0:i.call(a))||"";return s.localeCompare(c)}),n=r.findIndex(r=>r.id===e.id);if(n<=0)return;const t=r[n-1];await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{targetId:t.id,position:"before"});const a=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(a||[]),C(e=>{if(!e.selectedNode)return e;const r=(a||[]).find(r=>r.id===e.selectedNode.id);return r?{...e,selectedNode:r}:e})}catch(r){throw r}},[h,f,c]),U=t.useCallback(async e=>{if(h)try{const r=(g.current||[]).filter(r=>(r.parentId||null)===(e.parentId||null)).sort((e,r)=>{var n,t,a,i;const o=(e.order??0)-(r.order??0);if(0!==o)return o;const s="string"==typeof e.createdAt?e.createdAt:(null==(t=null==(n=e.createdAt)?void 0:n.toISOString)?void 0:t.call(n))||"",c="string"==typeof r.createdAt?r.createdAt:(null==(i=null==(a=r.createdAt)?void 0:a.toISOString)?void 0:i.call(a))||"";return s.localeCompare(c)}),n=r.findIndex(r=>r.id===e.id);if(n>=r.length-1)return;const t=r[n+1];await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{targetId:t.id,position:"after"});const a=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(a||[]),C(e=>{if(!e.selectedNode)return e;const r=(a||[]).find(r=>r.id===e.selectedNode.id);return r?{...e,selectedNode:r}:e})}catch(r){throw r}},[h,f,c]),I=t.useCallback(async e=>{if(h)try{await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{targetId:null,position:"child"});const r=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(r||[]),C(e=>{if(!e.selectedNode)return e;const n=(r||[]).find(r=>r.id===e.selectedNode.id);return n?{...e,selectedNode:n}:e})}catch(r){throw r}},[h,f,c]),_=t.useCallback(async e=>{if(h)try{try{const r=(g.current||[]).map(r=>r.id===e.id?{...r,isVisible:!e.isVisible}:r);c(r),C(r=>{var n;return(null==(n=r.selectedNode)?void 0:n.id)===e.id?{...r,selectedNode:{...r.selectedNode,isVisible:!e.isVisible}}:r})}catch{}try{const r=await f.patch(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{isVisible:!e.isVisible});if(r){const n=(g.current||[]).map(n=>n.id===e.id?r:n);c(n),C(n=>{var t;return(null==(t=n.selectedNode)?void 0:t.id)===e.id?{...n,selectedNode:r}:n})}}catch{const r=await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e.id}`,{isVisible:!e.isVisible});if(r){const n=(g.current||[]).map(n=>n.id===e.id?r:n);c(n),C(n=>{var t;return(null==(t=n.selectedNode)?void 0:t.id)===e.id?{...n,selectedNode:r}:n})}}}catch(r){throw r}},[h,f,c]),z=t.useCallback(e=>{C(r=>({...r,selectedNode:e,panelState:{...r.panelState,activePanel:"properties"}}))},[]),$=t.useCallback(async(e,r)=>{if(!h)return;const n={data:"hasData",formula:"hasFormula",condition:"hasCondition",table:"hasTable",api:"hasAPI",link:"hasLink",markers:"hasMarkers"}[r];if(!n)return;const t=(()=>{switch(r){case"condition":return{conditionConfig:{}};case"formula":return{formulaConfig:{}};case"table":return{tableConfig:{}};case"api":return{apiConfig:{}};case"link":return{linkConfig:{}};case"markers":return{markers:[]};default:return{}}})();C(r=>{var a;return(null==(a=r.selectedNode)?void 0:a.id)===e?{...r,selectedNode:{...r.selectedNode,[n]:!1,...t}}:r});try{const r=(a||[]).map(r=>r.id===e?{...r,[n]:!1,...t}:r);c(r)}catch{}await f.put(`/api/treebranchleaf/trees/${h.id}/nodes/${e}`,{[n]:!1,...t});const i=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(i||[]),C(e=>{if(!e.selectedNode)return e;const r=(i||[]).find(r=>r.id===e.selectedNode.id);return r?{...e,selectedNode:r}:e})},[f,c,h,a]);t.useMemo(()=>({trees:(null==r?void 0:r.length)||0,selectedTree:(null==h?void 0:h.name)||(null==h?void 0:h.label)||"aucun",propNodes:(null==a?void 0:a.length)||0,propNodesData:null==a?void 0:a.slice(0,3)}),[r,h,a]);const[F,q]=t.useState(null),[,W]=t.useState(null),[H,G]=t.useState(!1),K=t.useCallback((e,r)=>{try{const n=new Map,t=[];for(const e of a||[])t.push(e);for(;t.length;){const e=t.pop();if(n.set(e.id,e),e.children)for(const r of e.children)t.push(r)}const i=e=>"branch"===e||"section"===e,o=(e,r)=>"branch"===e?"branch"===r||"tree"===r:"section"===e?"branch"===r||"tree"===r||"section"===r:"leaf_repeater"===e?"branch"===r||"section"===r||"leaf_repeater"===r||"leaf_option"===r||"leaf_option_field"===r:!!e.startsWith("leaf_")&&("leaf_repeater"===r||("branch"===r||"section"===r||r.startsWith("leaf_")));if(!r.nodeId)return i(e);let s;if("before"===r.position||"after"===r.position){const t=n.get(String(r.nodeId));if(!t)return i(e);if(s=t.parentId?n.get(String(t.parentId)):void 0,!s)return i(e)}else if(s=n.get(String(r.nodeId)),!s)return i(e);return o(e,s.type)}catch(n){return!1}},[a]),X=t.useCallback((e,r)=>{var n,t;if(!e||!r)return!1;if("palette-item"===e.type){if("structure"!==r.type||!e.nodeType)return!1;const n=ye.getNodeType(e.nodeType);return!(!n||!n.acceptsDropFrom.includes("palette"))&&K(e.nodeType,r)}if("node"===e.type){const i=(null==(n=e.data)?void 0:n.id)||(null==(t=e.data)?void 0:t.nodeId);if(!i||!e.nodeType||"structure"!==r.type)return!1;if(r.nodeId&&String(r.nodeId)===String(i))return!1;if(("before"===r.position||"after"===r.position)&&r.nodeId===i)return!1;const o=new Map,s=[];for(const e of a||[])s.push(e);for(;s.length;){const e=s.pop();if(o.set(e.id,e),e.children)for(const r of e.children)s.push(r)}if("child"===r.position&&r.nodeId){const e=o.get(String(i));if(e&&e.children){const n=[...e.children];for(;n.length;){const e=n.pop();if(e.id===r.nodeId)return!1;if(e.children)for(const r of e.children)n.push(r)}}}return K(e.nodeType,r)}return!1},[a,K]),Z=t.useCallback(e=>{var r,n,t;const{active:a}=e,i={id:String(a.id),type:(null==(r=a.data.current)?void 0:r.type)||"node",nodeType:null==(n=a.data.current)?void 0:n.nodeType,fieldType:null==(t=a.data.current)?void 0:t.fieldType,data:a.data.current};q(i),W(null),G(!1)},[]),J=t.useCallback(e=>{var r,n,t,a,i,o;const{over:s}=e;if(!s||!F)return W(null),G(!1),!1;const c={type:(null==(r=s.data.current)?void 0:r.type)||"structure",nodeId:null==(n=s.data.current)?void 0:n.nodeId,capability:null==(t=s.data.current)?void 0:t.capability,position:null==(a=s.data.current)?void 0:a.position,accepts:(null==(i=s.data.current)?void 0:i.accepts)||[],slot:null==(o=s.data.current)?void 0:o.slot},l=X(F,c);return W(String(s.id)),G(!!l),!!l},[F,X]),Y=t.useCallback(async e=>{var r,n,t,i,o,s,c,l;const{over:d}=e;if(!d||!F||!H)return q(null),W(null),void G(!1);const u={type:(null==(r=d.data.current)?void 0:r.type)||"structure",nodeId:null==(n=d.data.current)?void 0:n.nodeId,capability:null==(t=d.data.current)?void 0:t.capability,position:null==(i=d.data.current)?void 0:i.position,accepts:(null==(o=d.data.current)?void 0:o.accepts)||[],slot:null==(s=d.data.current)?void 0:s.slot};try{if("palette-item"===F.type){const e=ye.getNodeType(F.nodeType);if(!e)return void m.error("Type de nÅ“ud inconnu.");const r=new Map,n=[];for(const c of a||[])n.push(c);for(;n.length;){const e=n.pop();if(r.set(e.id,e),e.children)for(const r of e.children)n.push(r)}let t=u.nodeId;if("before"===u.position||"after"===u.position){const e=u.nodeId?r.get(String(u.nodeId)):void 0;t=(null==e?void 0:e.parentId)||null}const i=String((null==(c=F.data)?void 0:c.label)||e.label),o="leaf_field"===F.nodeType?i:`Nouveau ${e.label}`,s={type:F.nodeType,label:o,parentId:t||void 0,fieldType:e.defaultFieldType},l=O(F.nodeType);l&&(s.metadata=l);await M(s)}else if("node"===F.type){if(!(null==(l=F.data)?void 0:l.id))return;await w(F.data.id,u.nodeId,u.position)}}catch(p){}finally{q(null),W(null),G(!1)}},[F,H,M,w,a,O]),Q=t.useCallback(e=>{C(r=>({...r,selectedNode:e||void 0}))},[]),ee=t.useRef(null);t.useEffect(()=>{var e;const r=null==(e=x.selectedNode)?void 0:e.id;if(!r)return void(ee.current=null);let n=!1;return(async()=>{try{const e=await f.get(`/api/treebranchleaf/nodes/${r}/full`);if(n)return;ee.current=e,"undefined"!=typeof window&&(window.__TBL_SELECTED_FULL=e)}catch(e){}})(),()=>{n=!0}},[null==(u=x.selectedNode)?void 0:u.id,f]);const re=t.useCallback(e=>{C(r=>{const n=new Set(r.expandedNodes);return n.has(e)?n.delete(e):n.add(e),{...r,expandedNodes:n}})},[]),ne=t.useCallback((e,r)=>{C(n=>({...n,searchState:{query:e,filters:r}}))},[]),ce=t.useCallback((e,r,n)=>{if(n){R(e,r);const n=ye.getCapabilityModule(r);(null==n?void 0:n.autoOpen)&&C(e=>({...e,panelState:{...e.panelState,openCapabilities:new Set([...e.panelState.openCapabilities,r])}}))}else $(e,r),C(e=>{const n=new Set(e.panelState.openCapabilities);return n.delete(r),{...e,panelState:{...e.panelState,openCapabilities:n}}})},[R,$]),le=t.useCallback((e,r)=>{const n=ye.getNodeType(e);if(!n)return;const t={type:e,label:`Nouveau ${n.label}`,parentId:r,fieldType:n.defaultFieldType},a=O(e);a&&(t.metadata=a),M(t)},[M,O]),de=t.useCallback(async(e,r)=>{switch(e){case"create":r&&await T(r);break;case"update":h&&r&&await V({...h,...r});break;case"delete":h&&await y(h.id);break;case"duplicate":h&&await T({...h,id:void 0,name:`${h.name} (Copie)`,status:"draft"})}},[h,T,V,y]);t.useRef(!1);const me=t.useRef(!1);t.useEffect(()=>{if(!a||0===a.length||me.current)return;const e=new Set;for(const r of a)if("leaf_option"===r.type||"leaf_option_field"===r.type){a.some(e=>e.parentId===r.id)&&e.add(r.id)}e.size>0&&(C(r=>({...r,expandedNodes:new Set([...r.expandedNodes,...e])})),me.current=!0)},[a]),t.useRef(null);const ue=e.jsxDEV(k,{title:"ðŸŽ¨ Palette",size:"small",style:{height:v?"100%":"auto",marginBottom:v?0:16},styles:{body:{padding:v?"6px":12,height:v?"calc(100% - 55px)":"auto",overflow:v?"auto":"visible"}},children:e.jsxDEV(ve,{onItemCreate:le,readOnly:i,registry:ye},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1528,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1516,columnNumber:5},void 0),pe=e.jsxDEV(k,{title:x.panelState.previewMode?"ðŸ‘ï¸ AperÃ§u":"ðŸŒ² Structure",size:"small",style:{height:v?"100%":"auto",marginBottom:v?0:16},styles:{body:{padding:v?"12px":12,height:v?"calc(100% - 55px)":"auto",overflow:x.panelState.previewMode?"auto":v?"hidden":"auto"}},children:x.panelState.previewMode?e.jsxDEV($e,{nodes:a||[],readOnly:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1550,columnNumber:9},void 0):e.jsxDEV(Oe,{tree:h,nodes:a||[],selectedNode:x.selectedNode,expandedNodes:x.expandedNodes,searchState:x.searchState,dragState:x.dragState,onSelectNode:Q,onToggleExpanded:re,onSearch:ne,onNodeAction:L,onCapabilityToggle:ce,readOnly:i,registry:ye,onEditNode:A,onDuplicateNode:P,onDeleteNode:B,onMoveUpNode:j,onMoveDownNode:U,onToggleNodeVisibility:_,onOpenNodeSettings:z,onMoveNodeToRoot:I},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1552,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1537,columnNumber:5},void 0),fe=x.panelState.previewMode?null:e.jsxDEV("div",{style:{height:v?"100%":"auto",marginBottom:v?0:16,display:"flex",flexDirection:"column"},children:e.jsxDEV("div",{style:{flex:1,minHeight:0},children:e.jsxDEV(je,{tree:h,selectedNode:x.selectedNode,nodes:a||[],panelState:x.panelState,onNodeUpdate:L,onCapabilityConfig:L,readOnly:i,registry:ye,onDeleteNode:B,refreshTree:async()=>{if(h)try{const e=await f.get(`/api/treebranchleaf/trees/${h.id}/nodes`);c(e||[])}catch(e){}},onSelectNodeId:e=>{const r=(e,n)=>{if(e)for(const t of e){if(t.id===n)return t;const e=r(t.children,n);if(e)return e}},n=r(a||[],e);n&&C(e=>({...e,selectedNode:n}))},onExpandNodeId:e=>{C(r=>({...r,expandedNodes:new Set([...r.expandedNodes,e])}))}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1589,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1588,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1580,columnNumber:5},void 0),be=[{key:"structure",label:x.panelState.previewMode?"AperÃ§u":"Structure",content:pe},{key:"palette",label:"Palette",content:ue}];fe&&be.push({key:"parameters",label:"ParamÃ¨tres",content:fe});const Ne=be.map(e=>e.key),De=Ne.includes(E)?E:Ne[0]??"structure";return e.jsxDEV(l,{onDragStart:Z,onDragOver:J,onDragEnd:Y,children:e.jsxDEV(ae,{style:{minHeight:"100vh",background:"#f0f2f5"},children:[e.jsxDEV(ae.Header,{style:{background:"white",padding:N?"0 12px":"0 24px",borderBottom:"1px solid #f0f0f0",display:"flex",flexWrap:N?"wrap":"nowrap",alignItems:N?"stretch":"center",justifyContent:N?"center":"space-between",gap:N?12:0},children:[e.jsxDEV("div",{style:{flex:1,minWidth:0},children:e.jsxDEV(he,{tree:h,trees:r,organizationId:(null==h?void 0:h.organizationId)||("string"==typeof window.__CURRENT_ORG_ID?window.__CURRENT_ORG_ID:""),readOnly:i,onAction:de,onTreeSelect:e=>{s(e)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1712,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1711,columnNumber:11},void 0),e.jsxDEV(D,{size:N?8:12,wrap:!0,style:{alignSelf:N?"flex-end":"center",flexShrink:0}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1724,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1699,columnNumber:9},void 0),e.jsxDEV(Fe,{style:{padding:N?"12px":"16px"},children:v?e.jsxDEV(ie,{gutter:[16,16],style:{height:"calc(100vh - 120px)"},wrap:!1,children:[e.jsxDEV(oe,{flex:"0 0 280px",style:{minWidth:240},children:ue},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1739,columnNumber:15},void 0),e.jsxDEV(oe,{flex:"1 1 0px",children:pe},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1742,columnNumber:15},void 0),fe&&e.jsxDEV(oe,{flex:"1 1 320px",style:{minWidth:280},children:fe},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1746,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1738,columnNumber:13},void 0):e.jsxDEV("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.jsxDEV(se,{options:be.map(e=>({label:e.label,value:e.key})),block:!0,size:"small",value:De,onChange:e=>S(String(e))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1753,columnNumber:15},void 0),e.jsxDEV("div",{children:null==(p=be.find(e=>e.key===De))?void 0:p.content},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1763,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1752,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1736,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1692,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafEditor.tsx",lineNumber:1687,columnNumber:5},void 0)},We=Object.freeze(Object.defineProperty({__proto__:null,default:({treeId:r,mode:a="edit"})=>{const{id:s}=i(),c=r||s,[l,d]=t.useState([]),[m,u]=t.useState(null),[p,h]=t.useState([]),[f,b]=t.useState(!0),[v,N]=t.useState(null),{user:D}=n(),x=o(),C=t.useMemo(()=>x.api,[x]),E=t.useCallback(e=>{if(!e||0===e.length)return[];const r=e.filter(e=>!(!0===e.isSharedReference&&null===e.sharedReferenceId&&null===e.parentId)),n=new Map,t=[];r.forEach(e=>{n.set(e.id,{...e,children:[]})}),r.forEach(e=>{const r=n.get(e.id);if(e.parentId&&n.has(e.parentId)){const t=n.get(e.parentId);t.children=t.children||[],t.children.push(r)}else t.push(r),e.parentId});const a=e=>{e.sort((e,r)=>(e.order||0)-(r.order||0)),e.forEach(e=>{e.children&&e.children.length>0&&a(e.children)})};return a(t),t.length,t},[]),S=t.useCallback(async e=>{try{const r=`?t=${(new Date).getTime()}`,n=await C.get(`/api/treebranchleaf/trees/${e}/nodes${r}`);null==n||n.forEach((e,r)=>{});const t=E(n||[]);h(t)}catch(r){throw new Error("Impossible de charger les nÅ“uds de l'arbre")}},[C,E]),g=t.useCallback(async()=>{try{b(!0),N(null);const e=await C.get("/api/treebranchleaf/trees");if(d(e),c){const r=e.find(e=>e.id===c);r?(u(r),await S(c)):N(`Arbre avec l'ID ${c} non trouvÃ©`)}else e.length>0&&(u(e[0]),await S(e[0].id))}catch(e){N("Erreur lors du chargement des donnÃ©es TreeBranchLeaf")}finally{b(!1)}},[c,S,C]);t.useEffect(()=>{g()},[g]);const T=t.useCallback(e=>{if(!e||0===e.length)return[];const r=[],n=[...e];for(;n.length>0;){const e=n.pop(),t=e.children;if(r.push({...e,children:void 0}),t&&t.length>0)for(let r=t.length-1;r>=0;r-=1)n.push(t[r])}return r},[]),V=t.useCallback(async e=>{if(!m)return null;try{const r=await C.post(`/api/treebranchleaf/trees/${m.id}/nodes`,e);return await S(m.id),r}catch(r){return null}},[C,m,S]);return f?e.jsxDEV("div",{style:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxDEV(ce,{size:"large",tip:"Chargement de TreeBranchLeaf...",children:e.jsxDEV("div",{style:{width:1,height:1}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:300,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:299,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:292,columnNumber:7},void 0):v?e.jsxDEV("div",{style:{padding:"20px"},children:e.jsxDEV(K,{message:"Erreur",description:v,type:"error",showIcon:!0,action:e.jsxDEV("button",{onClick:g,children:"RÃ©essayer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:315,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:309,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:308,columnNumber:7},void 0):D?e.jsxDEV(qe,{trees:l,selectedTree:m,nodes:p,flatNodes:p.flatMap(function e(r){return[r,...(r.children||[]).flatMap(e)]}),readOnly:"view"===a,onTreeChange:async e=>{u(e),await S(e.id)},onTreesUpdate:e=>{d(e)},onNodesUpdate:e=>{if(e.some(e=>e.children&&e.children.length>0))return void h(e);const r=T(p),n=T(e);if(r.length===n.length&&r.every(e=>n.some(r=>r.id===e.id)))h(e);else{const r=T(e),n=E(r);h(n)}},onNodeCreate:V},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:339,columnNumber:5},void 0):e.jsxDEV("div",{style:{padding:"20px"},children:e.jsxDEV(K,{message:"Authentification requise",description:"Vous devez Ãªtre connectÃ© pour accÃ©der Ã  TreeBranchLeaf",type:"warning",showIcon:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:327,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TreeBranchLeafWrapper.tsx",lineNumber:326,columnNumber:7},void 0)}},Symbol.toStringTag,{value:"Module"}));export{We as T,Re as u};
