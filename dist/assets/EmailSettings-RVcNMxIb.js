import{u as e,j as i}from"./index-C0S0DpaX.js";import{r as s}from"./react-vendor-Al_k-ZB6.js";import{u as n}from"./useAuthenticatedApi-BbQI8SDU.js";import{s as t,B as r,bm as o,a2 as a,aG as m,a0 as l,I as c,ab as d,b3 as u,l as g,c as v}from"./antd-vendor-zFcGztvE.js";const N=()=>{var N;const[E,p]=s.useState([]),[D,x]=s.useState(!1),[b,C]=s.useState(null),[h,S]=s.useState(!1),[V,O]=s.useState(null),[f,k]=s.useState({username:"",password:"",host:"imap.yandex.com",port:993}),{api:z}=n(),{user:A,selectedOrganization:j}=e(),M="admin"===(null==A?void 0:A.role)||"super_admin"===(null==A?void 0:A.role);s.useEffect(()=>{M&&j&&U()},[M,j]);const U=s.useCallback(async()=>{if(j){x(!0);try{const e=await z.get(`/api/admin-password/users-emails?organizationId=${j.id}`);if(!e.success||!Array.isArray(e.data))throw new Error(e.message||"Erreur lors du chargement");{const i=e.data.filter(e=>e.organization.id===j.id);p(i)}}catch(e){t.error("Erreur lors du chargement des utilisateurs de votre organisation"),p([])}finally{x(!1)}}else t.warning("Aucune organisation sÃ©lectionnÃ©e")},[z,j]),R=[{title:"Utilisateur",dataIndex:"firstName",key:"user",render:(e,s)=>i.jsxDEV("div",{children:[i.jsxDEV("div",{className:"font-semibold",children:[s.firstName," ",s.lastName]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:175,columnNumber:11},void 0),i.jsxDEV("div",{className:"text-xs text-gray-500",children:s.email},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:176,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:174,columnNumber:9},void 0)},{title:"Email Professionnel",dataIndex:"generatedEmail",key:"generatedEmail",render:(e,s)=>{var n;return(null==b?void 0:b.id)===s.id?i.jsxDEV(c,{value:b.generatedEmail,onChange:e=>C({...b,generatedEmail:e.target.value}),placeholder:"email@organisation.be"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:187,columnNumber:13},void 0):i.jsxDEV("div",{className:"flex items-center",children:[i.jsxDEV("span",{className:e?"text-green-600":"text-gray-400",children:e||"Non configurÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:199,columnNumber:13},void 0),(null==(n=s.emailAccount)?void 0:n.isConfigured)&&i.jsxDEV(d,{color:"green",className:"ml-2",children:"ConfigurÃ©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:203,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:198,columnNumber:11},void 0)}},{title:"Actions",key:"actions",render:(e,s)=>{var n,a;return i.jsxDEV("div",{className:"flex gap-2",children:(null==b?void 0:b.id)===s.id?i.jsxDEV(i.Fragment,{children:[i.jsxDEV(r,{type:"primary",size:"small",onClick:()=>(async e=>{try{await z.post("/api/admin-password/update-email-config",{userId:e.id,generatedEmail:e.generatedEmail}),t.success("Configuration email mise Ã  jour"),C(null),U()}catch(i){t.error("Erreur lors de la sauvegarde")}})(s),children:"Sauvegarder"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:216,columnNumber:15},void 0),i.jsxDEV(r,{size:"small",onClick:()=>C(null),children:"Annuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:223,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:215,columnNumber:13},void 0):i.jsxDEV(i.Fragment,{children:[i.jsxDEV(r,{icon:i.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:233,columnNumber:23},void 0),size:"small",onClick:()=>C(s),title:"Modifier l'email"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:232,columnNumber:15},void 0),i.jsxDEV(r,{icon:i.jsxDEV(g,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:239,columnNumber:23},void 0),size:"small",onClick:()=>{return O(e=s),k({username:e.generatedEmail||"",password:"",host:"imap.yandex.com",port:993}),void S(!0);var e},title:"Configurer Yandex",disabled:!s.generatedEmail},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:238,columnNumber:15},void 0),i.jsxDEV(r,{icon:i.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:246,columnNumber:23},void 0),size:"small",onClick:()=>(async e=>{try{t.loading("Test de connexion en cours...",2);const i=await z.get(`/api/yandex/test?userId=${e.id}`);i.success?t.success("Connexion email rÃ©ussie !"):t.error("Ã‰chec de la connexion : "+(i.message||"Erreur inconnue"))}catch(i){t.error("Erreur lors du test de connexion")}})(s),title:"Tester la connexion",disabled:!(null==(n=s.emailAccount)?void 0:n.isConfigured)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:245,columnNumber:15},void 0),i.jsxDEV(r,{icon:i.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:253,columnNumber:23},void 0),size:"small",onClick:()=>(async e=>{try{t.loading("Synchronisation en cours...",3),await z.post("/api/yandex/sync",{userId:e.id}),t.success("Synchronisation terminÃ©e")}catch(i){t.error("Erreur lors de la synchronisation")}})(s),title:"Synchroniser les emails",disabled:!(null==(a=s.emailAccount)?void 0:a.isConfigured)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:252,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:231,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:213,columnNumber:9},void 0)}}];return M?j?i.jsxDEV("div",{className:"organization-email-settings",children:[i.jsxDEV("div",{className:"mb-6",children:[i.jsxDEV("h2",{className:"text-xl font-semibold mb-2",children:["ðŸ“§ Gestion des Emails - ",j.name]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:290,columnNumber:9},void 0),i.jsxDEV("p",{className:"text-gray-600",children:"GÃ©rez les adresses email professionnelles des utilisateurs de votre organisation."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:293,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:289,columnNumber:7},void 0),i.jsxDEV("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[i.jsxDEV("h4",{className:"font-semibold text-blue-800 mb-2",children:"â„¹ï¸ Information"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:299,columnNumber:9},void 0),i.jsxDEV("p",{className:"text-blue-700 text-sm",children:["En tant qu'administrateur d'organisation, vous pouvez configurer les emails de vos utilisateurs. Les adresses suivent le format : prÃ©nom.nom@",null==(N=j.name)?void 0:N.toLowerCase(),".be"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:300,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:298,columnNumber:7},void 0),i.jsxDEV("div",{className:"mb-4",children:i.jsxDEV(r,{type:"primary",onClick:U,loading:D,icon:i.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:311,columnNumber:17},void 0),children:"Actualiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:307,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:306,columnNumber:7},void 0),i.jsxDEV(a,{spinning:D,children:i.jsxDEV(m,{columns:R,dataSource:E,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0},locale:{emptyText:"Aucun utilisateur trouvÃ© dans votre organisation"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:318,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:317,columnNumber:7},void 0),i.jsxDEV(l,{title:"ðŸ”§ Configuration Yandex",open:h,onOk:async()=>{if(V&&f.username&&f.password)try{await z.post("/api/yandex/setup",{userId:V.id,config:f}),t.success("Configuration Yandex sauvegardÃ©e"),S(!1),U()}catch(e){t.error("Erreur lors de la configuration Yandex")}else t.error("Veuillez remplir tous les champs obligatoires")},onCancel:()=>S(!1),okText:"Sauvegarder",cancelText:"Annuler",children:i.jsxDEV("div",{className:"space-y-4",children:[i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Nom d'utilisateur Yandex :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:344,columnNumber:13},void 0),i.jsxDEV(c,{value:f.username,onChange:e=>k({...f,username:e.target.value}),placeholder:"votre-email@yandex.com"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:345,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:343,columnNumber:11},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Mot de passe :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:352,columnNumber:13},void 0),i.jsxDEV(c.Password,{value:f.password,onChange:e=>k({...f,password:e.target.value}),placeholder:"Votre mot de passe Yandex"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:353,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:351,columnNumber:11},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Serveur IMAP :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:360,columnNumber:13},void 0),i.jsxDEV(c,{value:f.host,onChange:e=>k({...f,host:e.target.value}),disabled:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:361,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:359,columnNumber:11},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Port :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:368,columnNumber:13},void 0),i.jsxDEV(c,{type:"number",value:f.port,onChange:e=>k({...f,port:parseInt(e.target.value)}),disabled:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:369,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:367,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:342,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:334,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:288,columnNumber:5},void 0):i.jsxDEV("div",{className:"text-center py-8",children:i.jsxDEV("p",{className:"text-gray-500",children:"Veuillez sÃ©lectionner une organisation pour gÃ©rer les emails."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:280,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:279,columnNumber:7},void 0):i.jsxDEV("div",{className:"text-center py-8",children:i.jsxDEV("p",{className:"text-gray-500",children:"Vous n'avez pas les permissions nÃ©cessaires pour accÃ©der Ã  cette section."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:270,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/settings/OrganizationEmailSettings.tsx",lineNumber:269,columnNumber:7},void 0)},E=()=>i.jsxDEV("div",{className:"email-settings-page",children:i.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/settings/EmailSettings.tsx",lineNumber:11,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/settings/EmailSettings.tsx",lineNumber:10,columnNumber:5},void 0);export{E as default};
