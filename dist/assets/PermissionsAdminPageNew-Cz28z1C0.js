import{j as e,u as s}from"./index-C0S0DpaX.js";import{r as i,R as r}from"./react-vendor-Al_k-ZB6.js";import{u as n}from"./useAuthenticatedApi-BbQI8SDU.js";import{e as o}from"./data-vendor-wH_FeJEU.js";import{a as t,d as m,T as a,af as d,ag as l,ad as c,$ as u,aj as p,a3 as v,a4 as N,bj as g,a7 as D,a8 as f,aM as C,l as x,bv as b,b as h,an as E,I as V,h as A,B as P,b9 as S,aW as k,a2 as w,aG as M,aH as j,aF as R,b3 as O,b5 as U}from"./antd-vendor-zFcGztvE.js";const{Title:y,Text:I}=a,z=({permissions:s,modules:i,selectedRole:r})=>{const n=["view","create","edit","delete","manage"],o=s.filter(e=>n.includes(e.action)),a=i.length,g=i.reduce((e,s)=>{const i=o.filter(e=>e.moduleId===s.id&&e.allowed&&n.includes(e.action));return e+Math.min(i.length,5)},0),D=5*a,f=D>0?Math.round(g/D*100):0;null==r||r.label;const C=i.filter(e=>o.filter(s=>s.moduleId===e.id&&s.allowed&&n.includes(s.action)).length>=5).length,x=i.filter(e=>{const s=o.filter(s=>s.moduleId===e.id&&s.allowed&&n.includes(s.action));return s.length>0&&s.length<5}).length,b=a-C-x,h=e=>e>=80?"#52c41a":e>=50?"#faad14":"#ff4d4f";return r?e.jsxDEV(t,{title:`Statistiques pour ${r.label}`,children:e.jsxDEV(d,{gutter:[16,16],children:[e.jsxDEV(l,{xs:24,lg:12,children:e.jsxDEV("div",{style:{textAlign:"center"},children:[e.jsxDEV(c,{type:"circle",percent:f,size:120,strokeColor:h(f),format:()=>e.jsxDEV("div",{children:[e.jsxDEV("div",{style:{fontSize:"24px",fontWeight:"bold",color:h(f)},children:[f,"%"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:119,columnNumber:19},void 0),e.jsxDEV("div",{style:{fontSize:"12px",color:"#666"},children:"des permissions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:122,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:118,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:112,columnNumber:13},void 0),e.jsxDEV(y,{level:4,style:{marginTop:16},children:"Couverture globale"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:128,columnNumber:13},void 0),e.jsxDEV(I,{type:"secondary",children:[g," sur ",D," permissions activées"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:131,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:111,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:110,columnNumber:9},void 0),e.jsxDEV(l,{xs:24,lg:12,children:e.jsxDEV(u,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsxDEV(p,{title:"Modules avec accès complet",value:C,suffix:`/ ${a}`,prefix:e.jsxDEV(v,{style:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:144,columnNumber:23},void 0),valueStyle:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:140,columnNumber:13},void 0),e.jsxDEV(p,{title:"Modules avec accès partiel",value:x,suffix:`/ ${a}`,prefix:e.jsxDEV(N,{style:{color:"#faad14"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:152,columnNumber:23},void 0),valueStyle:{color:"#faad14"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:148,columnNumber:13},void 0),e.jsxDEV(p,{title:"Modules sans accès",value:b,suffix:`/ ${a}`,prefix:e.jsxDEV(m,{style:{color:"#ff4d4f"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:160,columnNumber:23},void 0),valueStyle:{color:b>0?"#ff4d4f":"#999"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:156,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:139,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:138,columnNumber:9},void 0),e.jsxDEV(l,{xs:24,children:e.jsxDEV("div",{style:{marginTop:24},children:[e.jsxDEV(I,{strong:!0,children:"Répartition des accès par module :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:169,columnNumber:13},void 0),e.jsxDEV("div",{style:{marginTop:8},children:[e.jsxDEV(c,{percent:100,success:{percent:C/a*100},strokeColor:x/a*100>0?"#faad14":"#f5f5f5",trailColor:"#f5f5f5",showInfo:!1},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:171,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginTop:8,fontSize:"12px"},children:e.jsxDEV(u,{size:"large",children:[e.jsxDEV("span",{children:[e.jsxDEV("span",{style:{color:"#52c41a"},children:"●"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:181,columnNumber:21},void 0)," Accès complet (",C,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:180,columnNumber:19},void 0),e.jsxDEV("span",{children:[e.jsxDEV("span",{style:{color:"#faad14"},children:"●"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:184,columnNumber:21},void 0)," Accès partiel (",x,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:183,columnNumber:19},void 0),e.jsxDEV("span",{children:[e.jsxDEV("span",{style:{color:"#f5f5f5"},children:"●"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:187,columnNumber:21},void 0)," Aucun accès (",b,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:186,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:179,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:178,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:170,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:168,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:167,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:108,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:107,columnNumber:5},void 0):e.jsxDEV(t,{children:e.jsxDEV("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsxDEV(m,{style:{fontSize:48,color:"#d9d9d9"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:97,columnNumber:11},void 0),e.jsxDEV(y,{level:4,style:{marginTop:16,color:"#999"},children:"Sélectionnez un rôle pour voir les statistiques"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:98,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:96,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/admin/PermissionStats.tsx",lineNumber:95,columnNumber:7},void 0)},q={actions:{view:{label:"Consulter",description:"Permet de lire et consulter les données sans possibilité de modification",details:"L'utilisateur peut voir les informations, générer des rapports et exporter des données en lecture seule."},create:{label:"Créer",description:"Permet d'ajouter de nouveaux éléments au système",details:"L'utilisateur peut créer de nouvelles entrées, saisir des données et initialiser de nouveaux enregistrements."},edit:{label:"Modifier",description:"Permet de modifier les éléments existants",details:"L'utilisateur peut mettre à jour, corriger et modifier les données existantes dans le système."},delete:{label:"Supprimer",description:"Permet de supprimer définitivement des éléments",details:"L'utilisateur peut supprimer des enregistrements. Cette action est souvent irréversible et nécessite des précautions."},manage:{label:"Gérer",description:"Permissions complètes de gestion et d'administration",details:"L'utilisateur dispose de tous les droits sur ce module : consultation, création, modification, suppression et configuration avancée."}},modules:{leads:{name:"Prospects",description:"Gestion des prospects et opportunités commerciales",actions:{view:"Consulter la liste des prospects, voir leurs informations et historiques",create:"Ajouter de nouveaux prospects et saisir leurs informations",edit:"Modifier les informations des prospects, changer leur statut",delete:"Supprimer des prospects de la base de données",manage:"Configuration complète : statuts, étapes de vente, attribution automatique"}},contacts:{name:"Contacts",description:"Carnet d'adresses et gestion des contacts",actions:{view:"Consulter les contacts, voir leurs coordonnées et interactions",create:"Ajouter de nouveaux contacts avec leurs informations détaillées",edit:"Modifier les coordonnées, notes et catégories des contacts",delete:"Supprimer définitivement des contacts du système",manage:"Gestion des catégories, import/export, fusion de doublons"}},organizations:{name:"Organisations",description:"Gestion des entreprises et entités organisationnelles",actions:{view:"Consulter les informations des organisations et leurs structures",create:"Créer de nouvelles organisations avec leur hiérarchie",edit:"Modifier les détails, adresses et configurations des organisations",delete:"Supprimer des organisations (attention aux données liées)",manage:"Configuration complète : modules, utilisateurs, paramètres avancés"}},users:{name:"Utilisateurs",description:"Gestion des comptes utilisateurs et accès",actions:{view:"Consulter la liste des utilisateurs et leurs profils",create:"Créer de nouveaux comptes utilisateurs avec leurs accès",edit:"Modifier les profils, rôles et statuts des utilisateurs",delete:"Désactiver ou supprimer des comptes utilisateurs",manage:"Gestion complète : rôles, permissions, authentification"}},roles:{name:"Rôles",description:"Définition des rôles et niveaux d'accès",actions:{view:"Consulter les rôles existants et leurs permissions",create:"Créer de nouveaux rôles avec leurs définitions",edit:"Modifier les permissions et attributions des rôles",delete:"Supprimer des rôles (vérifier les utilisateurs associés)",manage:"Configuration avancée des hiérarchies et héritages de rôles"}},permissions:{name:"Permissions",description:"Contrôle d'accès granulaire aux fonctionnalités",actions:{view:"Consulter la matrice des permissions par rôle",create:"Définir de nouvelles permissions spécifiques",edit:"Modifier les autorisations et restrictions d'accès",delete:"Supprimer des permissions personnalisées",manage:"Configuration système complète des droits d'accès"}},calendar:{name:"Agenda",description:"Planification et gestion des événements",actions:{view:"Consulter les agendas et événements planifiés",create:"Créer de nouveaux événements et rendez-vous",edit:"Modifier les détails des événements existants",delete:"Supprimer des événements de l'agenda",manage:"Configuration : calendriers partagés, notifications, synchronisation"}},notifications:{name:"Notifications",description:"Système d'alertes et communications",actions:{view:"Consulter les notifications reçues et leur historique",create:"Envoyer de nouvelles notifications aux utilisateurs",edit:"Modifier le contenu et paramètres des notifications",delete:"Supprimer des notifications du système",manage:"Configuration : règles automatiques, canaux, modèles"}},gmail:{name:"Gmail",description:"Intégration et gestion des emails Gmail",actions:{view:"Consulter les emails et conversations Gmail liés",create:"Envoyer de nouveaux emails via l'intégration Gmail",edit:"Modifier les brouillons et paramètres d'emails",delete:"Supprimer des emails ou conversations",manage:"Configuration complète : comptes, synchronisation, règles"}},google_workspace:{name:"Google Workspace",description:"Intégration complète avec Google Workspace",actions:{view:"Consulter les données synchronisées de Google Workspace",create:"Créer du contenu via les outils Google (Drive, Docs, etc.)",edit:"Modifier les configurations et synchronisations",delete:"Supprimer les liaisons et données synchronisées",manage:"Administration complète : domaines, utilisateurs, sécurité"}},modules:{name:"Modules",description:"Gestion des modules et fonctionnalités du système",actions:{view:"Consulter la liste des modules disponibles et leur statut",create:"Activer de nouveaux modules dans l'organisation",edit:"Configurer les paramètres des modules existants",delete:"Désactiver ou supprimer des modules",manage:"Administration complète : installation, mise à jour, dépendances"}},admin_panel:{name:"Panneau d'administration",description:"Accès aux outils d'administration système",actions:{view:"Consulter les statistiques et rapports d'administration",create:"Initier des tâches administratives et configurations",edit:"Modifier les paramètres système et configurations",delete:"Supprimer des configurations ou réinitialiser des paramètres",manage:"Contrôle total du système : maintenance, sécurité, performance"}},forms:{name:"Formulaires",description:"Création et gestion de formulaires dynamiques",actions:{view:"Consulter les formulaires créés et leurs réponses",create:"Créer de nouveaux formulaires avec leurs champs",edit:"Modifier la structure et validation des formulaires",delete:"Supprimer des formulaires et leurs données",manage:"Configuration avancée : logique conditionnelle, intégrations"}},sav:{name:"Service Après-Vente",description:"Gestion du support client et des tickets",actions:{view:"Consulter les tickets de support et leur progression",create:"Créer de nouveaux tickets et demandes de support",edit:"Modifier le statut et réponses des tickets",delete:"Fermer définitivement des tickets résolus",manage:"Configuration : workflow, escalade, SLA, équipes"}},external_apis:{name:"APIs Externes",description:"Gestion des intégrations avec des services tiers",actions:{view:"Consulter les configurations et statuts des APIs",create:"Configurer de nouvelles intégrations API",edit:"Modifier les paramètres de connexion et mapping",delete:"Supprimer des intégrations non utilisées",manage:"Administration complète : clés API, sécurité, monitoring"}}}},G=e=>q.actions[e]||{label:e,description:"Permission personnalisée",details:"Cette permission a été définie spécifiquement pour votre organisation."},T=e=>q.modules[e]||{name:e,description:"Module personnalisé",actions:{}},{Title:$,Text:L}=a,{Option:W}=E,_=[{key:"view",icon:e.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:73,columnNumber:24},void 0),color:"#1890ff"},{key:"create",icon:e.jsxDEV(R,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:74,columnNumber:26},void 0),color:"#52c41a"},{key:"edit",icon:e.jsxDEV(O,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:75,columnNumber:24},void 0),color:"#faad14"},{key:"delete",icon:e.jsxDEV(U,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:76,columnNumber:26},void 0),color:"#ff4d4f"},{key:"manage",icon:e.jsxDEV(x,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:77,columnNumber:26},void 0),color:"#722ed1"}].map(e=>({...e,...G(e.key)})),B=r.memo(({permission:s,moduleId:i,action:r,resource:n,onChange:o,disabled:t=!1})=>{const m=(null==s?void 0:s.allowed)||!1;return e.jsxDEV(C,{checked:m,onChange:e=>o(i,r,n,e),disabled:t,size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:102,columnNumber:5},void 0)});B.displayName="PermissionSwitch";const F=()=>{const{currentOrganization:r,isSuperAdmin:m}=s(),{api:a}=n(),[c,p]=g.useNotification(),[N,j]=i.useState([]),[R,O]=i.useState([]),[U,y]=i.useState([]),[I,q]=i.useState(null),[G,F]=i.useState(!1),[H,K]=i.useState(!1),[J,Q]=i.useState(null),[X,Y]=i.useState(""),[Z,ee]=i.useState("all"),[se,ie]=i.useState(!1),re=i.useMemo(()=>R.filter(e=>{const s=!X||e.label.toLowerCase().includes(X.toLowerCase())||e.key.toLowerCase().includes(X.toLowerCase()),i="all"===Z||e.category===Z;return s&&i}),[R,X,Z]),ne=i.useMemo(()=>Array.from(new Set(R.map(e=>e.category).filter(Boolean))).sort(),[R]),oe=i.useCallback(async()=>{if(r){F(!0),Q(null);try{const e=r.id,[s,i]=await Promise.all([a.get(`/api/roles?organizationId=${e}`),a.get(`/api/modules?organizationId=${e}`)]);if(!s.success)throw new Error("Erreur lors du chargement des rôles");if(j(s.data||[]),!i.success)throw new Error("Erreur lors du chargement des modules");O(i.data||[])}catch(e){const s=e instanceof Error?e.message:"Erreur lors du chargement";Q(s),c.error({message:"Erreur de chargement",description:s})}finally{F(!1)}}},[r,a,c]),te=i.useCallback(async e=>{if(r){F(!0);try{const s=await a.get(`/api/permissions?roleId=${e.id}&organizationId=${r.id}`);if(!s.success)throw new Error("Erreur lors du chargement des permissions");y(s.data||[]),ie(!1)}catch(s){const e=s instanceof Error?s.message:"Erreur lors du chargement des permissions";c.error({message:"Erreur",description:e})}finally{F(!1)}}},[r,a,c]),me=o(async e=>{if(I&&r){K(!0);try{if(!(await a.post("/api/permissions",{roleId:I.id,organizationId:r.id,permissions:e})).success)throw new Error("Erreur lors de la sauvegarde");ie(!1),c.success({message:"Sauvegarde automatique",description:"Les permissions ont été sauvegardées",duration:2})}catch{c.error({message:"Erreur de sauvegarde",description:"Impossible de sauvegarder les permissions"})}finally{K(!1)}}},1500),ae=i.useCallback((e,s,i,r)=>{y(n=>{const o=[...n],t=o.findIndex(r=>r.moduleId===e&&r.action===s&&r.resource===i);return t>-1?o[t].allowed=r:r&&o.push({moduleId:e,action:s,resource:i,allowed:r}),ie(!0),me(o),o})},[me]),de=i.useCallback((e,s)=>{y(i=>{const r=[...i];return _.forEach(({key:i})=>{const n=r.findIndex(s=>s.moduleId===e&&s.action===i);n>-1?r[n].allowed=s:s&&r.push({moduleId:e,action:i,resource:"*",allowed:s})}),ie(!0),me(r),r})},[me]),le=i.useCallback(e=>{const s=N.find(s=>s.id===e);s&&(q(s),te(s))},[N,te]);i.useEffect(()=>{oe()},[oe]);const ce=i.useCallback(e=>{const s=_.map(e=>e.key),i=U.filter(i=>i.moduleId===e&&s.includes(i.action)).filter(e=>!0===e.allowed).length,r=_.length;return{allowed:i,total:r,percentage:r>0?Math.round(i/r*100):0}},[U]),ue=i.useCallback(e=>_.every(({key:s})=>{const i=U.find(i=>i.moduleId===e&&i.action===s);return!0===(null==i?void 0:i.allowed)}),[U]),pe=[{title:"Module",dataIndex:"label",key:"label",width:200,render:(s,i)=>{const r=ce(i.id),n=ue(i.id),o=T(i.key);return e.jsxDEV(u,{direction:"vertical",size:0,children:[e.jsxDEV(u,{children:[e.jsxDEV(D,{title:o.description,children:e.jsxDEV(L,{strong:!0,children:o.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:349,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:348,columnNumber:15},void 0),e.jsxDEV(f,{count:`${r.allowed}/${r.total}`,style:{backgroundColor:n?"#52c41a":r.allowed>0?"#faad14":"#f5f5f5",color:0===r.allowed?"#999":"#fff"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:351,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:347,columnNumber:13},void 0),o.description&&e.jsxDEV(L,{type:"secondary",style:{fontSize:"12px"},children:o.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:360,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:346,columnNumber:11},void 0)}},{title:e.jsxDEV(D,{title:"Activer/désactiver toutes les permissions pour ce module d'un coup",children:e.jsxDEV(u,{style:{cursor:"help"},children:[e.jsxDEV(L,{children:"Toutes les permissions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:372,columnNumber:13},void 0),e.jsxDEV(x,{style:{fontSize:"12px",color:"#999"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:373,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:371,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:370,columnNumber:9},void 0),key:"toggle-all",width:150,align:"center",render:(s,i)=>{const r=ue(i.id),n=T(i.key);return e.jsxDEV(D,{title:`${r?"Désactiver":"Activer"} toutes les permissions pour "${n.name}"`,children:e.jsxDEV(C,{checked:r,onChange:e=>de(i.id,e),disabled:!I},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:386,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:385,columnNumber:11},void 0)}},..._.map(({key:s,name:i,description:r,icon:n,color:o})=>({title:e.jsxDEV(D,{title:e.jsxDEV("div",{children:[e.jsxDEV("div",{children:e.jsxDEV("strong",{children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:400,columnNumber:20},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:400,columnNumber:15},void 0),e.jsxDEV("div",{style:{marginTop:4},children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:401,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:399,columnNumber:13},void 0),placement:"top",children:e.jsxDEV(u,{style:{cursor:"help"},children:[e.jsxDEV("span",{style:{color:o},children:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:407,columnNumber:13},void 0),e.jsxDEV(L,{children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:408,columnNumber:13},void 0),e.jsxDEV(b,{style:{fontSize:"12px",color:"#999"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:409,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:406,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:397,columnNumber:9},void 0),key:s,width:120,align:"center",render:(r,n)=>{const o=U.find(e=>e.moduleId===n.id&&e.action===s),t=T(n.key),m=!!o&&o.allowed;return n.key,e.jsxDEV(D,{title:`${m?"Autoriser":"Interdire"} l'action "${i}" pour le module "${t.name}"`,children:e.jsxDEV(B,{permission:o,moduleId:n.id,action:s,resource:"*",onChange:ae,disabled:!I},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:439,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:436,columnNumber:11},void 0)}}))];return m?e.jsxDEV("div",{className:"p-6 max-w-7xl mx-auto",children:[p,e.jsxDEV("div",{className:"mb-6",children:[e.jsxDEV($,{level:2,children:[e.jsxDEV(x,{className:"mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:470,columnNumber:11},void 0),"Gestion des Permissions"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:469,columnNumber:9},void 0),e.jsxDEV(L,{type:"secondary",children:["Configurez les permissions par rôle pour ",null==r?void 0:r.name]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:473,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:468,columnNumber:7},void 0),e.jsxDEV(t,{className:"mb-6",children:e.jsxDEV(d,{gutter:16,align:"middle",children:[e.jsxDEV(l,{xs:24,sm:12,md:8,lg:6,children:e.jsxDEV("div",{children:[e.jsxDEV(L,{strong:!0,children:"Rôle à modifier :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:483,columnNumber:15},void 0),e.jsxDEV(E,{placeholder:"Sélectionner un rôle",style:{width:"100%",marginTop:8},value:null==I?void 0:I.id,onChange:le,loading:G,children:N.map(s=>{var i;return e.jsxDEV(W,{value:s.id,children:e.jsxDEV(u,{children:[e.jsxDEV(L,{children:s.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:494,columnNumber:23},void 0),(null==(i=s._count)?void 0:i.UserOrganization)&&e.jsxDEV(f,{count:s._count.UserOrganization,size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:496,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:493,columnNumber:21},void 0)},s.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:492,columnNumber:19},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:484,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:482,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:481,columnNumber:11},void 0),e.jsxDEV(l,{xs:24,sm:12,md:8,lg:6,children:e.jsxDEV("div",{children:[e.jsxDEV(L,{strong:!0,children:"Rechercher :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:507,columnNumber:15},void 0),e.jsxDEV(V,{placeholder:"Rechercher un module...",prefix:e.jsxDEV(A,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:510,columnNumber:25},void 0),value:X,onChange:e=>Y(e.target.value),style:{marginTop:8}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:508,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:506,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:505,columnNumber:11},void 0),e.jsxDEV(l,{xs:24,sm:12,md:8,lg:6,children:e.jsxDEV("div",{children:[e.jsxDEV(L,{strong:!0,children:"Catégorie :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:520,columnNumber:15},void 0),e.jsxDEV(E,{placeholder:"Toutes les catégories",style:{width:"100%",marginTop:8},value:Z,onChange:ee,children:[e.jsxDEV(W,{value:"all",children:"Toutes les catégories"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:527,columnNumber:17},void 0),ne.map(s=>e.jsxDEV(W,{value:s,children:s},s,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:529,columnNumber:19},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:521,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:519,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:518,columnNumber:11},void 0),e.jsxDEV(l,{xs:24,sm:12,md:8,lg:6,children:e.jsxDEV(u,{children:[e.jsxDEV(P,{icon:e.jsxDEV(S,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:540,columnNumber:23},void 0),onClick:oe,loading:G,children:"Actualiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:539,columnNumber:15},void 0),se&&e.jsxDEV(D,{title:"Sauvegarde automatique en cours...",children:e.jsxDEV(f,{dot:!0,children:e.jsxDEV(k,{style:{color:H?"#1890ff":"#52c41a",fontSize:16}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:550,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:549,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:548,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:538,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:537,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:480,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:479,columnNumber:7},void 0),e.jsxDEV(h,{message:"Sauvegarde automatique activée",description:"Vos modifications sont automatiquement sauvegardées après 1.5 seconde d'inactivité. Utilisez les tooltips d'aide (ℹ️) pour comprendre chaque permission.",type:"info",showIcon:!0,style:{marginBottom:16}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:565,columnNumber:7},void 0),J&&e.jsxDEV(h,{message:"Erreur",description:J,type:"error",showIcon:!0,closable:!0,onClose:()=>Q(null),className:"mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:574,columnNumber:9},void 0),I&&se&&e.jsxDEV(h,{message:"Modifications en cours",description:"Vos modifications sont automatiquement sauvegardées.",type:"info",showIcon:!0,icon:H?e.jsxDEV(w,{size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:591,columnNumber:26},void 0):e.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:591,columnNumber:50},void 0),className:"mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:586,columnNumber:9},void 0),!I&&e.jsxDEV(h,{message:"Aucun rôle sélectionné",description:"Sélectionnez un rôle pour configurer ses permissions.",type:"warning",showIcon:!0,className:"mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:597,columnNumber:9},void 0),I&&e.jsxDEV("div",{className:"mb-6",children:e.jsxDEV(z,{permissions:U,modules:R,selectedRole:I},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:609,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:608,columnNumber:9},void 0),e.jsxDEV(t,{title:I?`Permissions pour ${I.label}`:"Permissions",extra:I&&e.jsxDEV(u,{children:[e.jsxDEV(L,{type:"secondary",children:[re.length," module",re.length>1?"s":""]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:623,columnNumber:15},void 0),H&&e.jsxDEV(w,{size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:626,columnNumber:26},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:622,columnNumber:13},void 0),children:e.jsxDEV(M,{columns:pe,dataSource:re,rowKey:"id",loading:G,pagination:!1,scroll:{x:"max-content"},size:"middle",className:"permissions-table"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:631,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:618,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:465,columnNumber:5},void 0):e.jsxDEV(h,{message:"Accès restreint",description:"Vous n'avez pas les permissions nécessaires pour accéder à cette page.",type:"warning",showIcon:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/PermissionsAdminPageNew.tsx",lineNumber:455,columnNumber:7},void 0)};export{F as default};
