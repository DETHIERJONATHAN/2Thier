import{j as e}from"./index-C0S0DpaX.js";import{r as o}from"./react-vendor-Al_k-ZB6.js";import{a1 as r,a2 as t,a3 as i,a4 as s}from"./antd-vendor-zFcGztvE.js";function n(){if(function(){try{sessionStorage.removeItem("google_auth_just_completed"),sessionStorage.removeItem("google_auth_error"),"undefined"!=typeof window&&(window.__googleAutoConnectInFlight=!1,window.__googleAutoConnectCooldownUntil=Date.now()+3e5,window.__googleAutoConnectAttemptCount=0)}catch(e){}}(),window.location.search.includes("google_")){const e=new URL(window.location.href),o=new URLSearchParams(e.search);["google_success","google_error","organizationId","user","admin_email"].forEach(e=>o.delete(e));const r=`${e.origin}${e.pathname}${o.toString()?"?"+o.toString():""}`;window.history.replaceState({},document.title,r)}}const l=()=>{o.useEffect(()=>{(function(){try{const e=new URLSearchParams(window.location.search).has("google_error"),o=sessionStorage.getItem("google_auth_error");return e||!!o}catch{return!1}})()&&n();const e=new URLSearchParams(window.location.search),o=e.get("google_success"),r=e.get("google_error"),t=e.get("organizationId"),i=e.get("user")||e.get("admin_email");if("1"===o)try{const e={ts:Date.now(),organizationId:t||null,email:i||null};sessionStorage.setItem("google_auth_just_completed",JSON.stringify(e))}catch{}if(r)try{const e={ts:Date.now(),error:r,organizationId:t||null};sessionStorage.setItem("google_auth_error",JSON.stringify(e))}catch{}if(window.opener&&!window.opener.closed)"1"===o?window.opener.postMessage({type:"GOOGLE_AUTH_SUCCESS",organizationId:t,userEmail:i},window.location.origin):r&&window.opener.postMessage({type:"GOOGLE_AUTH_ERROR",error:r},window.location.origin),setTimeout(()=>{window.close()},1500);else{setTimeout(()=>{"/"!==window.location.pathname&&""!==window.location.pathname&&window.location.replace("/")},r?5e3:2e3)}try{const e=window.location.pathname;window.history.replaceState({},document.title,e)}catch{}},[]);const l=new URLSearchParams(window.location.search),a=l.get("google_success"),c=l.get("google_error"),m=l.get("user");if("1"===a)return e.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxDEV(r,{icon:e.jsxDEV(i,{style:{color:"#52c41a"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:118,columnNumber:17},void 0),title:"Authentification Google r√©ussie !",subTitle:m?`Connect√© en tant que ${decodeURIComponent(m)}`:"Connexion √©tablie avec succ√®s",extra:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV(t,{size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:123,columnNumber:15},void 0),e.jsxDEV("p",{className:"mt-2 text-gray-600",children:"Fermeture automatique de cette fen√™tre..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:124,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:122,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:117,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:116,columnNumber:7},void 0);if(c){const o={token_exchange_failed:"Erreur lors de l'√©change des tokens OAuth",invalid_client_config:"Configuration OAuth invalide (Client ID/Secret incorrect)",invalid_authorization_code:"Code d'autorisation invalide ou expir√©",unauthorized_client:"Client non autoris√©",config_not_found:"Configuration Google Workspace introuvable",user_not_found:"Utilisateur non trouv√© dans l'organisation",missing_params:"Param√®tres OAuth manquants",callback_error:"Erreur g√©n√©rale lors du callback",access_denied:"Acc√®s refus√© par l'utilisateur"}[c]||"Erreur inconnue",t=l.get("details");return e.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxDEV(r,{icon:e.jsxDEV(s,{style:{color:"#ff4d4f"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:151,columnNumber:17},void 0),title:"Erreur d'authentification Google",subTitle:e.jsxDEV("div",{children:[e.jsxDEV("p",{children:o},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:155,columnNumber:15},void 0),t&&e.jsxDEV("p",{className:"text-sm text-gray-600 mt-2",children:["D√©tails: ",decodeURIComponent(t)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:157,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:154,columnNumber:13},void 0),extra:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("p",{className:"text-gray-600",children:"Cette fen√™tre va se fermer automatiquement..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:165,columnNumber:15},void 0),e.jsxDEV("p",{className:"text-sm text-gray-500 mt-2",children:["Code d'erreur: ",e.jsxDEV("code",{children:c},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:167,columnNumber:32},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:166,columnNumber:15},void 0),"invalid_client_config"===c&&e.jsxDEV("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded",children:e.jsxDEV("p",{className:"text-sm text-yellow-800",children:["üí° ",e.jsxDEV("strong",{children:"Conseil:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:172,columnNumber:24},void 0)," V√©rifiez votre configuration OAuth dans Google Cloud Console"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:171,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:170,columnNumber:17},void 0),"invalid_authorization_code"===c&&e.jsxDEV("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded",children:e.jsxDEV("p",{className:"text-sm text-blue-800",children:["üí° ",e.jsxDEV("strong",{children:"Conseil:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:179,columnNumber:24},void 0)," R√©essayez la connexion, le code a peut-√™tre expir√©"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:178,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:177,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:164,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:150,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:149,columnNumber:7},void 0)}return e.jsxDEV("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV(t,{size:"large"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:194,columnNumber:9},void 0),e.jsxDEV("p",{className:"mt-4 text-gray-600",children:"Traitement de l'authentification Google..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:195,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:193,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/GoogleAuthCallback.tsx",lineNumber:192,columnNumber:5},void 0)};export{l as default};
