import{j as e}from"./index-C0S0DpaX.js";import{r as i}from"./react-vendor-Al_k-ZB6.js";import{u as s}from"./useAuthenticatedApi-BbQI8SDU.js";import{F as t,s as n,a0 as m,ab as r,$ as l,B as a,cf as d,b3 as o,b5 as u,T as c,aF as v,b9 as D,a as p,aG as N,I as h,aM as b}from"./antd-vendor-zFcGztvE.js";const{Title:g,Paragraph:S}=c;function x(){const{api:x}=s(),[C,E]=i.useState([]),[A,V]=i.useState(!1),[k,f]=i.useState(!1),[M,O]=i.useState(null),[j]=t.useForm(),R=i.useCallback(async()=>{V(!0);try{const e=await x.get("/api/landing-pages");E((null==e?void 0:e.data)||[])}catch(e){n.error("Impossible de charger les landings")}finally{V(!1)}},[x]);i.useEffect(()=>{R()},[R]);const U=i.useCallback(e=>{O(e),j.resetFields(),(async()=>{var i,s,t,n,m,r,l;try{const a=await x.get(`/api/landing-pages/public/${e.slug}`),d=(null==a?void 0:a.data)||{};j.setFieldsValue({title:d.title||e.title,description:e.description,seoTitle:null==(i=d.seo)?void 0:i.title,seoDescription:null==(s=d.seo)?void 0:s.description,seoKeywords:Array.isArray(null==(t=d.seo)?void 0:t.keywords)?d.seo.keywords.join(","):"",trackingEnable:!!(null==(n=d.tracking)?void 0:n.enable),googleTagId:null==(m=d.tracking)?void 0:m.googleTagId,metaPixelId:null==(r=d.tracking)?void 0:r.metaPixelId,blocksJson:(null==(l=d.content)?void 0:l.blocks)?JSON.stringify(d.content.blocks,null,2):""})}catch{j.setFieldsValue({title:e.title,description:e.description})}finally{f(!0)}})()},[x,j]),I=i.useCallback(e=>{m.confirm({title:"Supprimer cette page ?",onOk:async()=>{try{await x.delete(`/api/landing-pages/${e.id}`),n.success("Supprimé"),R()}catch{n.error("Suppression échouée")}}})},[x,R]),y=i.useCallback(async(e,i)=>{try{await x.patch(`/api/landing-pages/${e.id}/publish`,{publish:i}),n.success(i?"Publiée":"Dépubliée"),R()}catch{n.error("Échec publication")}},[x,R]),w=i.useMemo(()=>[{title:"Titre",dataIndex:"title"},{title:"Statut",dataIndex:"status",render:i=>e.jsxDEV(r,{color:"PUBLISHED"===i?"green":"default",children:i},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:90,columnNumber:68},this)},{title:"Vues",dataIndex:"views"},{title:"Conv.",dataIndex:"conversions"},{title:"Taux",dataIndex:"conversionRate",render:e=>`${e}%`},{title:"MAJ",dataIndex:"updatedAt",render:e=>new Date(e).toLocaleString()},{title:"Actions",key:"actions",render:(i,s)=>e.jsxDEV(l,{children:[e.jsxDEV(a,{icon:e.jsxDEV(d,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:97,columnNumber:23},this),onClick:()=>window.open(`/api/landing-pages/public/${s.slug}`,"_blank"),children:"Voir"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:97,columnNumber:9},this),e.jsxDEV(a,{icon:e.jsxDEV(o,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:98,columnNumber:23},this),onClick:()=>U(s),children:"Modifier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:98,columnNumber:9},this),e.jsxDEV(a,{onClick:()=>y(s,"PUBLISHED"!==s.status),children:"PUBLISHED"===s.status?"Dépublier":"Publier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:99,columnNumber:9},this),e.jsxDEV(a,{danger:!0,icon:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:100,columnNumber:30},this),onClick:()=>I(s),children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:100,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:96,columnNumber:7},this)}],[I,U,y]);return e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV(c,{children:[e.jsxDEV(g,{level:3,children:"Contenus du site"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:108,columnNumber:9},this),e.jsxDEV(S,{type:"secondary",children:"Pages publiques Devis1Minute (landings)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:109,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:107,columnNumber:7},this),e.jsxDEV("div",{className:"mb-3 flex items-center gap-2",children:[e.jsxDEV(a,{type:"primary",icon:e.jsxDEV(v,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:112,columnNumber:38},this),onClick:()=>{O(null),j.resetFields(),f(!0)},children:"Nouvelle page"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:112,columnNumber:9},this),e.jsxDEV(a,{icon:e.jsxDEV(D,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:113,columnNumber:23},this),onClick:R,children:"Rafraîchir"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:113,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:111,columnNumber:7},this),e.jsxDEV(p,{children:e.jsxDEV(N,{rowKey:"id",loading:A,dataSource:C,columns:w,pagination:{pageSize:10}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:116,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:115,columnNumber:7},this),e.jsxDEV(m,{open:k,onCancel:()=>f(!1),onOk:async()=>{try{const e=await j.validateFields();let i;if(e.blocksJson)try{i=JSON.parse(e.blocksJson)}catch{n.warning("Blocs JSON invalide: ignoré")}const s={title:e.title,description:e.description,seo:{title:e.seoTitle,description:e.seoDescription,keywords:(e.seoKeywords||"").split(",").map(e=>e.trim()).filter(Boolean)},...i?{blocks:i}:{}},t={tracking:{enable:!!e.trackingEnable,googleTagId:e.googleTagId||void 0,metaPixelId:e.metaPixelId||void 0}};M?(await x.put(`/api/landing-pages/${M.id}`,{title:e.title,description:e.description,content:s,settings:t}),n.success("Mise à jour")):(await x.post("/api/landing-pages",{title:e.title,description:e.description,status:"DRAFT",content:s,settings:t}),n.success("Créée")),f(!1),R()}catch(e){n.error("Enregistrement échoué")}},title:M?"Modifier la page":"Nouvelle page",okText:"Enregistrer",children:e.jsxDEV(t,{form:j,layout:"vertical",children:[e.jsxDEV(t.Item,{name:"title",label:"Titre",rules:[{required:!0}],children:e.jsxDEV(h,{placeholder:"Titre de la landing"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:122,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:121,columnNumber:11},this),e.jsxDEV(t.Item,{name:"description",label:"Description",children:e.jsxDEV(h.TextArea,{rows:4},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:125,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:124,columnNumber:11},this),e.jsxDEV(p,{size:"small",className:"mb-4",title:"SEO",children:[e.jsxDEV(t.Item,{name:"seoTitle",label:"Titre SEO",children:e.jsxDEV(h,{placeholder:"Balise <title>"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:129,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:128,columnNumber:13},this),e.jsxDEV(t.Item,{name:"seoDescription",label:"Meta description",children:e.jsxDEV(h,{placeholder:"Meta description"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:132,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:131,columnNumber:13},this),e.jsxDEV(t.Item,{name:"seoKeywords",label:"Mots-clés (séparés par des virgules)",children:e.jsxDEV(h,{placeholder:"ex: isolation, rénovation, devis"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:135,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:134,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:127,columnNumber:11},this),e.jsxDEV(p,{size:"small",title:"Tracking & Pixels",children:[e.jsxDEV(t.Item,{name:"trackingEnable",valuePropName:"checked",children:[e.jsxDEV(b,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:140,columnNumber:15},this)," Activer les pixels sur cette page"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:139,columnNumber:13},this),e.jsxDEV(t.Item,{name:"googleTagId",label:"Google Tag ID (G-XXXX)",children:e.jsxDEV(h,{placeholder:"G-XXXXXXX"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:143,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:142,columnNumber:13},this),e.jsxDEV(t.Item,{name:"metaPixelId",label:"Meta Pixel ID",children:e.jsxDEV(h,{placeholder:"1234567890"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:146,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:145,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:138,columnNumber:11},this),e.jsxDEV(p,{size:"small",title:"Blocs (JSON)",children:e.jsxDEV(t.Item,{name:"blocksJson",tooltip:"Saisir un tableau JSON de blocs [{ type, props }]",children:e.jsxDEV(h.TextArea,{rows:6,placeholder:'Ex: [{"type":"hero","props":{"title":"Bienvenue","subtitle":"Sous-titre"}}]'},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:151,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:150,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:149,columnNumber:11},this),e.jsxDEV(t.Item,{label:"Publication",tooltip:"La publication se fait après création via le bouton Publier",children:e.jsxDEV(b,{checked:!1,disabled:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:155,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:154,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:120,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:119,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminSite.tsx",lineNumber:106,columnNumber:5},this)}export{x as default};
