import{j as e,u as r}from"./index-C0S0DpaX.js";import{r as i,m as s,u as t,R as o}from"./react-vendor-Al_k-ZB6.js";import{u as n,C as l,S as a,v as m,e as d,a as c,b as u,c as p,P as v,D as b,d as N,r as x,s as f,K as D,f as h}from"./dnd-vendor-D0spq1w0.js";import{u as E}from"./useAuthenticatedApi-BbQI8SDU.js";import{r as C,W as g,cY as V,as as S,bR as y,bY as A,bN as k,cZ as O,a3 as R,f as j,Y as M,c_ as U,d as F,v as w,c$ as I,aA as T,$ as P,T as q,I as L,an as $,B as _,aF as z,a as G,a7 as B,aM as Z,b5 as W,k as H,n as Y,a4 as J,o as K,bi as X,b3 as Q,a0 as ee,a$ as re,ab as ie,d0 as se,cN as te,d1 as oe,cX as ne,d2 as le,h as ae,aY as me,bA as de,cl as ce,bg as ue,bO as pe,d3 as ve,b4 as be,x as Ne,cS as xe,cT as fe,aC as De,bv as he,i as Ee,aD as Ce}from"./antd-vendor-zFcGztvE.js";import{a as ge,y as Ve}from"./AppLayout-B5YjWTBr.js";import{G as Se,X as ye}from"./ui-vendor-BkcsV9xY.js";import{g as Ae,v as ke,p as Oe}from"./formulaValidator-DVLkodcr.js";import{e as Re}from"./formulaEvaluator-C6uT_5ZT.js";import{g as je}from"./validationHelper-Bf19AZsP.js";import{r as Me,u as Ue,w as Fe}from"./xlsx-C5xT2hrF.js";import{c as we}from"./colorUtils-p3TIaPYL.js";import"./data-vendor-wH_FeJEU.js";import"./Notifications-Bhgc2wzd.js";const Ie=r=>({text:e.jsxDEV(I,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:22,columnNumber:11},void 0),textarea:e.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:23,columnNumber:15},void 0),password:e.jsxDEV(F,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:24,columnNumber:15},void 0),number:e.jsxDEV(U,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:25,columnNumber:13},void 0),date:e.jsxDEV(M,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:26,columnNumber:11},void 0),select:e.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:27,columnNumber:11},void 0),advanced_select:e.jsxDEV(j,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:28,columnNumber:20},void 0),radio:e.jsxDEV(R,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:29,columnNumber:12},void 0),checkboxes:e.jsxDEV(O,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:30,columnNumber:17},void 0),checkbox:e.jsxDEV(O,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:31,columnNumber:15},void 0),donnee:e.jsxDEV(k,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:32,columnNumber:13},void 0),produit:e.jsxDEV(A,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:33,columnNumber:14},void 0),image_admin:e.jsxDEV(y,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:34,columnNumber:18},void 0),image_user:e.jsxDEV(S,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:35,columnNumber:17},void 0),fichier_user:e.jsxDEV(V,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:36,columnNumber:19},void 0),tableau:e.jsxDEV(g,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:37,columnNumber:12},void 0)}[r]||e.jsxDEV(C,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/utils/fieldTypeIcons.tsx",lineNumber:39,columnNumber:23},void 0)),Te=e=>Ie(e),Pe=({fieldType:r})=>{const{attributes:i,listeners:s,setNodeRef:t,transform:o,isDragging:a}=n({id:`palette-field-${r.type}`,data:{type:"palette-field",fieldType:r.type}}),m={transform:l.Translate.toString(o),zIndex:a?1e3:"auto"};return e.jsxDEV("div",{ref:t,style:m,...s,...i,className:"palette-field-item "+(a?"dragging":""),"data-type":r.type,children:e.jsxDEV(P,{size:8,align:"center",children:[e.jsxDEV("span",{className:"field-icon","aria-hidden":!0,children:r.icon},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:37,columnNumber:9},void 0),e.jsxDEV(q.Text,{className:"field-label",ellipsis:!0,children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:40,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:36,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:28,columnNumber:5},void 0)},qe=()=>{const{get:r}=E(),{blocks:s}=ge(),[t,o]=i.useState(()=>{try{const e=window.__fieldsPaletteTypes;return(null==e?void 0:e.data)||[]}catch{return[]}}),[n,l]=i.useState(0===t.length),[a,m]=i.useState(null),[d,c]=i.useState(()=>{var e;try{return(null==(e=window.__fieldsPaletteTypes)?void 0:e.ts)||null}catch{return null}}),u=i.useCallback(e=>{try{window.__fieldsPaletteTypes={data:e,ts:Date.now()}}catch{}},[]),p=i.useCallback(async(e={})=>{if(!(!e.force&&d&&Date.now()-d<3e4)){0===t.length&&l(!0),m(null);try{const e=await r("/api/field-types");let i=[];Array.isArray(e)?i=e:e&&"object"==typeof e&&"data"in e&&(i=e.data||[]),i&&i.length>0&&(o(i),u(i),c(Date.now()))}catch(i){const e=(null==i?void 0:i.message)||"Erreur de chargement des types de champs";m(e)}finally{l(!1)}}},[r,d,u,t.length]);i.useEffect(()=>{p()},[p]),i.useEffect(()=>{const e=setInterval(()=>{"visible"===document.visibilityState&&p()},12e4);return()=>clearInterval(e)},[p]);const v=i.useMemo(()=>{const e=new Set;for(const t of s||[])for(const r of t.sections||[])for(const i of r.fields||[])(null==i?void 0:i.type)&&e.add(String(i.type));const r=new Set((t||[]).map(e=>e.name)),i=new Set([...r,...e,"image_user","donnee","tableau","image_admin","arbre"]),o={text:"Texte",textarea:"Zone de texte",password:"Mot de passe",number:"Nombre",date:"Date",select:"Liste",radio:"Radio",checkboxes:"Cases √† cocher",checkbox:"Case √† cocher",donnee:"Donn√©e",produit:"Produit",image_admin:"Image (statique)",image_user:"Image utilisateur",fichier_user:"Fichier utilisateur",tableau:"Tableau",arbre:"üå≥ Arbre TreeBranchLeaf"},n=Object.fromEntries((t||[]).map(e=>[e.name,e])),l=[];for(const s of i){if(!s)continue;const e=n[s],r=(null==e?void 0:e.label)||o[s]||s;l.push({type:s,label:r,icon:Te(s)})}return l.sort((e,r)=>e.label.localeCompare(r.label,"fr")),l},[s,t]);return e.jsxDEV("div",{className:"fields-palette","data-testid":"fields-palette",children:[a&&e.jsxDEV("div",{className:"error-message",children:[e.jsxDEV("p",{children:a},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:177,columnNumber:11},void 0),e.jsxDEV("button",{onClick:()=>p({force:!0}),children:"R√©essayer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:178,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:176,columnNumber:9},void 0),0===v.length&&n&&e.jsxDEV("div",{className:"loading-skeleton",children:e.jsxDEV("p",{children:"Chargement des types de champs..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:184,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:183,columnNumber:9},void 0),0===v.length&&!n&&!a&&e.jsxDEV("div",{className:"empty-state",children:e.jsxDEV("p",{children:"Aucun type de champ disponible"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:190,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:189,columnNumber:9},void 0),v.length>0&&e.jsxDEV(T,{size:"small",className:"palette-list",dataSource:v,split:!1,renderItem:r=>e.jsxDEV(T.Item,{className:"palette-list-item",style:{padding:2},children:e.jsxDEV(Pe,{fieldType:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:202,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:201,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:195,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/FieldsPalette.tsx",lineNumber:173,columnNumber:3},void 0)},Le=[{value:"normal",label:"Section"},{value:"activity",label:"Activit√©"}],$e=({section:r,children:i,handleEditSectionName:s,editingSectionId:t,editingSectionName:o,setEditingSectionName:n,handleSaveSectionName:a,handleToggleSectionActive:m,toggleSection:u,openSections:p,handleRemoveSection:v,isSectionValid:b,onChangeType:N,onRenameType:x,onDeleteType:f,availableTypes:D,isBuiltinType:h})=>{const{attributes:E,listeners:C,setNodeRef:g,transform:V,transition:S,isDragging:y}=d({id:String(r.id),data:{type:"section",section:r}}),{setNodeRef:A,isOver:k}=c({id:`section-drop-${r.id}`,data:{type:"section",sectionId:String(r.id)}}),O={transform:l.Transform.toString(V),transition:S,zIndex:y?200:"auto"},R={items:[{key:"rename",label:"Renommer ce type",disabled:h(r.sectionType)},{key:"delete",label:"Supprimer ce type",danger:!0,disabled:h(r.sectionType)}],onClick:({key:e})=>{"rename"===e&&r.sectionType&&x(r.sectionType),"delete"===e&&r.sectionType&&f(r.sectionType)}};return e.jsxDEV("div",{ref:g,style:O,className:"sortable-section "+(y?"dragging":""),children:e.jsxDEV(G,{size:"small",className:"section-card",title:e.jsxDEV(P,{size:8,align:"center",wrap:!0,children:[e.jsxDEV(_,{type:"text",size:"small",icon:e.jsxDEV(Y,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:82,columnNumber:52},void 0),...E,...C,style:{cursor:"grab"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:82,columnNumber:13},void 0),t===String(r.id)?e.jsxDEV(L,{size:"small",value:o,onChange:e=>n(e.target.value),onBlur:()=>a(String(r.id)),onPressEnter:()=>a(String(r.id)),style:{width:220}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:84,columnNumber:15},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(q.Text,{strong:!0,className:"section-title",onClick:e=>{e.stopPropagation(),s(String(r.id),r.name)},children:r.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:94,columnNumber:17},void 0),e.jsxDEV("span",{className:"section-count-badge","aria-label":`Nombre de champs: ${(r.fields||[]).length}`,children:(r.fields||[]).length},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:97,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:93,columnNumber:15},void 0),!b(r)&&e.jsxDEV(B,{title:"Certains champs obligatoires ne sont pas remplis",children:e.jsxDEV(J,{style:{color:"#f59e0b"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:104,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:103,columnNumber:15},void 0),e.jsxDEV($,{size:"small",value:r.sectionType||"normal",onChange:e=>N(String(r.id),e),style:{width:160},options:[...D.map(e=>({label:e.label,value:e.value})),{label:"+ Nouveau type‚Ä¶",value:"__new__"}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:107,columnNumber:13},void 0),e.jsxDEV(K,{menu:R,trigger:["click"],children:e.jsxDEV(_,{size:"small",type:"text",icon:e.jsxDEV(X,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:118,columnNumber:54},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:118,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:117,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:81,columnNumber:11},void 0),extra:e.jsxDEV(P,{size:6,children:[e.jsxDEV(B,{title:r.active?"D√©sactiver":"Activer",children:e.jsxDEV(Z,{size:"small",checked:!!r.active,onChange:()=>m(String(r.id),r.active)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:125,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:124,columnNumber:13},void 0),e.jsxDEV(B,{title:"Supprimer la section",children:e.jsxDEV(_,{size:"small",type:"text",danger:!0,icon:e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:128,columnNumber:61},void 0),onClick:e=>{e.stopPropagation(),v(String(r.id))}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:128,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:127,columnNumber:13},void 0),e.jsxDEV(_,{size:"small",type:"text",onClick:()=>u(String(r.id)),icon:e.jsxDEV(H,{rotate:p[String(r.id)]?180:0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:130,columnNumber:102},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:130,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:123,columnNumber:11},void 0),styles:{header:{padding:"6px 10px"},body:{padding:p[String(r.id)]?10:0,display:p[String(r.id)]?"block":"none"}},children:e.jsxDEV("div",{ref:A,className:"section-drop-target "+(k?"active":""),children:[i,0===r.fields.length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-4 border-2 border-dashed rounded-md "+(k?"bg-blue-50 border-blue-400":""),children:"D√©posez des champs ici"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:144,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:141,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:77,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:76,columnNumber:5},void 0)},_e=({field:r,sectionId:i,isSelected:s,setSelectedField:t,onRemove:o})=>{var n,a,m,c;const{fieldMetaCounts:u}=ge(),p=u[r.id]||{formulas:(null==(n=r.formulas)?void 0:n.length)||0,validations:(null==(a=r.validations)?void 0:a.length)||0,dependencies:(null==(m=r.dependencies)?void 0:m.length)||0},{attributes:v,listeners:b,setNodeRef:N,transform:x,transition:f,isDragging:D}=d({id:r.id,data:{type:"form-field",field:r,sectionId:i}}),h={transform:l.Transform.toString(x),transition:f,opacity:D?.5:1,zIndex:D?100:"auto",cursor:"grab"},E=(()=>{const e=r.width||"";if(!e)return"1/1";if(e.startsWith("w-"))return e.replace("w-","");if(["1/1","1/2","1/3","2/3","1/4","3/4"].includes(e))return e;return{full:"1/1",half:"1/2",quarter:"1/4",three_quarters:"3/4"}[e]||e})(),C=Ie(r.type),g=p.formulas>0,V=p.validations>0,S=p.dependencies>0,y=["select","advanced_select","radio","checkbox","checkboxes"].includes(r.type)&&Array.isArray(r.options)&&r.options.length>0,A="tableau"===r.type&&(Array.isArray(r.options)&&r.options.length>0||r.advancedConfig&&Object.keys(r.advancedConfig).length>0);return e.jsxDEV("div",{ref:N,style:h,className:"palette-field-item section-palette-item "+(s?"selected":""),"data-type":r.type,onClick:()=>t({sectionId:i,fieldId:r.id}),draggable:"true",onDragStart:e=>{e.dataTransfer.setData("field-id",r.id),e.dataTransfer.setData("field-label",r.label||r.id),e.dataTransfer.setData("field-value",r.id),e.dataTransfer.setData("formula-element-type","field"),e.dataTransfer.setData("text/plain",`${r.label||r.id} (${r.type})`),e.dataTransfer.effectAllowed="copy"},children:[e.jsxDEV("div",{...v,...b,className:"drag-handle","aria-label":"D√©placer le champ",children:e.jsxDEV(B,{title:"D√©placer le champ",children:e.jsxDEV("span",{children:e.jsxDEV(Se,{size:14},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:231,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:231,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:230,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:229,columnNumber:7},void 0),e.jsxDEV("span",{className:"field-icon","aria-hidden":!0,title:r.type,children:C},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:234,columnNumber:7},void 0),e.jsxDEV("div",{className:"section-field-main",children:[e.jsxDEV("div",{className:"section-field-title",children:[e.jsxDEV("span",{className:"field-label",title:r.label,children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:237,columnNumber:11},void 0),r.required&&e.jsxDEV("span",{className:"field-required-asterisk",children:"*"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:238,columnNumber:30},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:236,columnNumber:9},void 0),e.jsxDEV("div",{className:"section-field-sub",children:[e.jsxDEV("span",{className:"field-type-text",children:r.type},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:241,columnNumber:11},void 0),e.jsxDEV("span",{className:"field-dot",children:"‚Ä¢"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:242,columnNumber:11},void 0),e.jsxDEV("span",{className:"field-width",children:["Largeur: ",E]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:243,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:240,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:235,columnNumber:7},void 0),e.jsxDEV("div",{className:"field-indicators",children:[g&&e.jsxDEV(B,{title:`${p.formulas} formule(s)`,children:e.jsxDEV("div",{className:"field-indicator has-formulas",children:"Œ£"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:249,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:248,columnNumber:11},void 0),V&&e.jsxDEV(B,{title:`${p.validations} validation(s)`,children:e.jsxDEV("div",{className:"field-indicator has-validations",children:"‚úì"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:254,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:253,columnNumber:11},void 0),S&&e.jsxDEV(B,{title:`${p.dependencies} d√©pendance(s)`,children:e.jsxDEV("div",{className:"field-indicator has-dependencies",children:"‚áÑ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:259,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:258,columnNumber:11},void 0),y&&e.jsxDEV(B,{title:`${(null==(c=r.options)?void 0:c.length)??0} option(s) d√©finie(s)`,children:e.jsxDEV("div",{className:"field-indicator has-options",children:"O"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:264,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:263,columnNumber:11},void 0),A&&e.jsxDEV(B,{title:"Tableau configur√©",children:e.jsxDEV("div",{className:"field-indicator has-table",children:"T"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:269,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:268,columnNumber:11},void 0),r.required&&e.jsxDEV(B,{title:"Champ requis",children:e.jsxDEV("div",{className:"field-indicator required",children:"!"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:274,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:273,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:246,columnNumber:7},void 0),e.jsxDEV(B,{title:"Modifier le champ",children:e.jsxDEV(_,{size:"small",type:"text",icon:e.jsxDEV(Q,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:282,columnNumber:17},void 0),onClick:e=>{e.stopPropagation(),t({sectionId:i,fieldId:r.id})}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:279,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:278,columnNumber:7},void 0),e.jsxDEV(B,{title:"Supprimer le champ",children:e.jsxDEV(_,{size:"small",type:"text",danger:!0,icon:e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:287,columnNumber:55},void 0),onClick:e=>{e.stopPropagation(),o(r.id)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:287,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:286,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:213,columnNumber:5},void 0)},ze=({selectedField:o,setSelectedField:n})=>{const{blocks:l,addSectionToBlock:d,removeSectionFromBlock:c,updateSection:u,removeBlock:p,fetchBlocks:v,removeField:b,fetchFieldMetaCounts:N}=ge(),{currentOrganization:x}=r(),{blockId:f}=s(),D=t(),{get:h}=E(),[C,g]=i.useState({});i.useEffect(()=>{let e=!0;return(async()=>{try{const r=await h("/api/field-types");let i=[];Array.isArray(r)?i=r:r&&"object"==typeof r&&"data"in r&&(i=r.data||[]);const s={};i.forEach(e=>{const r=(null==e?void 0:e.config)&&"object"==typeof e.config?e.config.icon:void 0;e.name&&(s[e.name]=r||Ie(e.name))}),e&&g(s)}catch{}})(),()=>{e=!1}},[h]);const V=f,[S,y]=i.useState("normal"),[A,k]=i.useState(""),[O,R]=i.useState(Le),j=l.find(e=>String(e.id)===V);i.useEffect(()=>{const e=((null==j?void 0:j.sections)||[]).map(e=>(e.sectionType||"").trim()).filter(Boolean);R(r=>{const i=[...r];for(const t of e)i.some(e=>e.value===t)||i.push({value:t,label:t});const s=new Set;return i.filter(e=>!s.has(e.value)&&(s.add(e.value),!0))})},[j]);const[M,U]=i.useState(null),[F,w]=i.useState(""),[I,T]=i.useState(!1),[G,B]=i.useState(null),[Z,W]=i.useState(!1),[H,Y]=i.useState({});i.useEffect(()=>{const e=null==x?void 0:x.id,r=localStorage.getItem("organizationId");ge.setState({blocks:[]}),e&&"all"!==e&&(e!==r&&localStorage.setItem("organizationId",e),v())},[x,v]),i.useEffect(()=>{if(j)try{const e=j.sections.flatMap(e=>e.fields.map(e=>e.id));if(0===e.length)return;const{fieldMetaCounts:r}=ge.getState();e.filter(e=>!r[e]).length>0&&N(e).catch(()=>{})}catch{}},[j,N]),i.useEffect(()=>{j&&Array.isArray(j.sections)?Y(e=>{const r={...e};return j.sections.forEach(e=>{String(e.id)in r||(r[String(e.id)]=!1)}),Object.keys(r).forEach(e=>{j.sections.some(r=>String(r.id)===e)||delete r[e]}),r}):Y({})},[j]),i.useEffect(()=>{if(!o&&j&&j.sections&&j.sections.length>0){const e=j.sections.find(e=>e.fields&&e.fields.length>0);if(e){const r=e.fields[0];n({sectionId:e.id,fieldId:r.id})}}},[j,o,n]);const J=async e=>{window.confirm("Voulez-vous vraiment supprimer ce champ ? Cette action est irr√©versible.")&&(W(!0),B(e),o&&o.fieldId===e&&n(null),requestAnimationFrame(async()=>{try{await b(e),Ve.success("Champ supprim√© avec succ√®s !")}catch(r){Ve.error("Erreur lors de la suppression du champ.")}finally{B(null),W(!1)}}))},K=i.useCallback(async()=>{if(!j)return;let e=S;if("__new__"===e){const r=window.prompt("Nom du nouveau type de section :","");if(!r)return;e=r.trim(),R(r=>r.some(r=>r.value===e)?r:[...r,{value:e,label:e}])}if(!e||!A.trim())return alert("Type et nom requis");const r=j.sections.length;await d(j.id,{name:A.trim(),type:e,order:r}),k("")},[d,j,A,S]),X=async e=>{if(!j)return;const r=j.sections.find(r=>String(r.id)===String(e));if(!r)return;if(window.confirm(`√ätes-vous s√ªr de vouloir supprimer la section "${r.name}" ? Cela supprimera √©galement tous les champs, formules et validations associ√©s de mani√®re irr√©versible.`))try{await c(j.id,e),Ve.success("Section supprim√©e avec succ√®s !"),o&&o.sectionId===e&&n(null)}catch(i){Ve.error("Erreur lors de la suppression de la section.")}},Q=(e,r)=>{U(e),w(r)},ee=async e=>{await u(e,{name:F}),U(null),w("")},re=async(e,r)=>{await u(e,{active:!r})},ie=async(e,r)=>{if("__new__"===r){const r=window.prompt("Nom du nouveau type de section :","");if(!r)return;const i=r.trim();return await u(e,{sectionType:i}),void R(e=>e.some(e=>e.value===i)?e:[...e,{value:i,label:i}])}await u(e,{sectionType:r})},se=e=>!!e&&Le.some(r=>r.value===e),te=async e=>{if(!j)return;const r=window.prompt(`Nouveau nom pour le type ¬´ ${e} ¬ª :`,e);if(!r)return;const i=r.trim();if(!i)return;if(se(i))return void alert("Ce nom est r√©serv√© √† un type syst√®me.");const s=(j.sections||[]).filter(r=>(r.sectionType||"")===e);for(const t of s)await u(String(t.id),{sectionType:i});R(r=>{const s=r.filter(r=>r.value!==e);return s.some(e=>e.value===i)?s:[...s,{value:i,label:i}]})},oe=async e=>{if(!j)return;if(se(e))return;if(!window.confirm(`Supprimer le type ¬´ ${e} ¬ª ?\nToutes les sections de ce type seront replac√©es en ¬´ Section ¬ª.`))return;const r=(j.sections||[]).filter(r=>(r.sectionType||"")===e);for(const i of r)await u(String(i.id),{sectionType:"normal"});R(r=>r.filter(r=>r.value!==e))},ne=async()=>{if(j)try{await p(String(j.id)),T(!1),D("/formulaires")}catch(e){}},le=e=>{Y(r=>({...r,[e]:!r[e]}))},ae=e=>!!Array.isArray(e.fields)&&e.fields.filter(e=>e.required).every(e=>e.label&&""!==e.label.trim());i.useEffect(()=>{if(o&&j&&j.sections){const e=j.sections.find(e=>e.id===o.sectionId);e&&e.fields.find(e=>e.id===o.fieldId)||n(null)}},[o,j,n]);return j?Z?e.jsxDEV("div",{className:"p-4 h-full overflow-y-auto opacity-50 pointer-events-none",children:j&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:e.jsxDEV("div",{className:"flex items-center gap-2",children:e.jsxDEV("h2",{className:"text-xl font-semibold",children:j.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:674,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:673,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:672,columnNumber:11},void 0),e.jsxDEV("div",{className:"space-y-6",children:null==(me=j.sections)?void 0:me.map(r=>{var i;return e.jsxDEV("div",{className:"bg-gray-100 p-4 rounded-lg shadow-md",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:e.jsxDEV("h3",{className:"font-semibold text-lg",children:r.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:681,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:680,columnNumber:17},void 0),e.jsxDEV("div",{className:"border-t pt-4 mt-4",children:e.jsxDEV("ul",{className:"space-y-2 mt-4",children:null==(i=r.fields)?void 0:i.map(r=>e.jsxDEV("li",{className:"flex items-center justify-between p-2 rounded bg-white",children:[e.jsxDEV("div",{className:"flex items-center flex-grow gap-2",children:[e.jsxDEV("span",{className:"mr-2",children:C[r.type]||Ie(r.type)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:691,columnNumber:27},void 0),e.jsxDEV("span",{children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:692,columnNumber:27},void 0),r.required&&e.jsxDEV("span",{className:"text-red-500 ml-2",children:"*"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:693,columnNumber:46},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:690,columnNumber:25},void 0),r.id===G&&e.jsxDEV("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:e.jsxDEV("div",{className:"loading loading-spinner loading-xs"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:697,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:696,columnNumber:27},void 0)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:686,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:684,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:683,columnNumber:17},void 0)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:679,columnNumber:15},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:677,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:671,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:669,columnNumber:5},void 0):e.jsxDEV("div",{className:"p-4 h-full overflow-y-auto",children:[I&&e.jsxDEV("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxDEV("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-sm w-full",children:[e.jsxDEV("h3",{className:"text-lg font-semibold mb-4",children:"Confirmation de suppression"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:717,columnNumber:13},void 0),e.jsxDEV("p",{className:"text-sm text-gray-700 mb-4",children:"√ätes-vous s√ªr de vouloir supprimer ce formulaire ? Cette action est irr√©versible."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:718,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex justify-end gap-2",children:[e.jsxDEV("button",{onClick:()=>T(!1),className:"px-4 py-2 text-sm rounded-lg bg-gray-200 hover:bg-gray-300 transition-colors",children:"Annuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:722,columnNumber:15},void 0),e.jsxDEV("button",{onClick:ne,className:"px-4 py-2 text-sm rounded-lg bg-red-500 text-white hover:bg-red-600 transition-colors",children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:728,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:721,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:716,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:715,columnNumber:9},void 0),j?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-4",children:e.jsxDEV("div",{className:"flex items-center gap-2",children:e.jsxDEV("h2",{className:"text-xl font-semibold",children:null==j?void 0:j.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:743,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:742,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:741,columnNumber:11},void 0),e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV(q.Text,{strong:!0,style:{display:"block",marginBottom:6},children:"Cr√©er une section"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:748,columnNumber:13},void 0),e.jsxDEV(P.Compact,{block:!0,size:"small",children:[e.jsxDEV(L,{value:A,onChange:e=>k(e.target.value),placeholder:"Nom de la section",allowClear:!0,onPressEnter:()=>K()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:750,columnNumber:15},void 0),e.jsxDEV($,{value:S,onChange:y,style:{width:180},options:[...O.map(e=>({label:e.label,value:e.value})),{label:"+ Nouveau type‚Ä¶",value:"__new__"}],size:"small"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:757,columnNumber:15},void 0),e.jsxDEV(_,{type:"primary",icon:e.jsxDEV(z,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:767,columnNumber:44},void 0),onClick:K,size:"small",children:"Ajouter section"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:767,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:749,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:747,columnNumber:11},void 0),e.jsxDEV("div",{className:"space-y-6",children:j?e.jsxDEV(a,{items:j.sections.map(e=>String(e.id)),strategy:m,children:j.sections.map(r=>e.jsxDEV($e,{section:r,handleEditSectionName:Q,editingSectionId:M,editingSectionName:F,setEditingSectionName:w,handleSaveSectionName:ee,handleToggleSectionActive:re,toggleSection:le,openSections:H,handleRemoveSection:X,isSectionValid:ae,onChangeType:ie,onRenameType:te,onDeleteType:oe,isBuiltinType:se,availableTypes:O,children:[e.jsxDEV(a,{items:(r.fields||[]).map(e=>e.id),strategy:m,children:e.jsxDEV("ul",{className:"space-y-1 mt-4 list-none p-0 m-0",children:(r.fields||[]).map(i=>e.jsxDEV("li",{className:G===i.id?"opacity-30":"",children:e.jsxDEV(_e,{field:i,sectionId:String(r.id),isSelected:(null==o?void 0:o.fieldId)===i.id,setSelectedField:n,onRemove:J},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:800,columnNumber:29},void 0)},i.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:799,columnNumber:27},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:797,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:796,columnNumber:21},void 0),0===(r.fields||[]).length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-4 border-2 border-dashed rounded-md",children:"D√©posez des champs ici"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:812,columnNumber:23},void 0)]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:777,columnNumber:19},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:775,columnNumber:15},void 0):e.jsxDEV("div",{className:"text-center text-gray-500 py-10",children:[e.jsxDEV("p",{children:"Aucun formulaire s√©lectionn√©."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:821,columnNumber:17},void 0),e.jsxDEV("p",{children:"Veuillez s√©lectionner un formulaire dans la liste ou en cr√©er un nouveau."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:822,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:820,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:773,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:740,columnNumber:9},void 0):e.jsxDEV("div",{className:"p-4 text-center text-gray-500",children:e.jsxDEV("p",{children:"S√©lectionnez un formulaire pour commencer ou cr√©ez-en un nouveau."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:830,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:829,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:713,columnNumber:5},void 0):e.jsxDEV("div",{className:"p-4 text-center text-gray-500",children:e.jsxDEV("p",{children:"S√©lectionnez un formulaire pour commencer ou cr√©ez-en un nouveau."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:839,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/SectionsFormulaire.tsx",lineNumber:838,columnNumber:7},void 0);var me},Ge=()=>{try{const e=window;return e.__advSelectCache||(e.__advSelectCache={}),e.__advSelectCache}catch{return{}}};function Be(){const{get:e}=E(),[,r]=i.useState(0),s=i.useRef({}),t=i.useCallback(async i=>{var t;const o=Ge();if(!(null==(t=o[i])?void 0:t.loaded))return s.current[i]||(s.current[i]=(async()=>{try{const r=await e(`/api/option-nodes/field/${encodeURIComponent(i)}/tree`);let s=[];if(Array.isArray(r))s=r;else if(r&&"object"==typeof r&&"data"in r){const e=r.data;Array.isArray(e)&&(s=e)}const t={},n={},l=(e,r)=>{for(const i of e){if(!i||"object"!=typeof i)continue;const e=i;let s;try{if(e.data&&"object"==typeof e.data&&e.data.nextField){const r=e.data.nextField;s={type:r.type,placeholder:r.placeholder}}}catch{}const o={id:e.id,label:e.label,value:e.value||void 0,parentId:r,hasChildren:e.hasChildren||Array.isArray(e.children)&&e.children.length>0,hasExtra:!!e.hasExtra,pathIds:e.pathIds,pathLabels:e.pathLabels,nextFieldMeta:s};n[o.id]=o;const a=r||"root";t[a]||(t[a]=[]),t[a].push(o),Array.isArray(e.children)&&e.children.length>0&&l(e.children,e.id)}};l(s,null),o[i]={loaded:!0,nodesByParent:t,nodeById:n,ts:Date.now()}}catch(t){o[i]={loaded:!0,nodesByParent:{},nodeById:{},ts:Date.now(),error:(null==t?void 0:t.message)||"fetch error"}}finally{r(e=>e+1),delete s.current[i]}})()),s.current[i]},[e]),o=i.useCallback(async e=>{delete Ge()[e],r(e=>e+1),await t(e)},[t]),n=i.useCallback(e=>Ge()[e],[]);return i.useEffect(()=>{const e=Ge(),r=Date.now();for(const i of Object.keys(e))r-e[i].ts>18e5&&delete e[i]},[]),{ensureTree:t,forceReload:o,getTree:n}}const{Search:Ze}=L,{Text:We}=q,He=[{name:"IF",label:"IF(condition, alors, sinon)",description:"Condition logique",category:"Logique"},{name:"SUM",label:"SUM(valeur1, valeur2, ...)",description:"Somme de valeurs",category:"Math"},{name:"MULTIPLY",label:"MULTIPLY(valeur1, valeur2)",description:"Multiplication",category:"Math"},{name:"DIVIDE",label:"DIVIDE(dividende, diviseur)",description:"Division",category:"Math"},{name:"SUBTRACT",label:"SUBTRACT(valeur1, valeur2)",description:"Soustraction",category:"Math"},{name:"MIN",label:"MIN(valeur1, valeur2, ...)",description:"Valeur minimum",category:"Math"},{name:"MAX",label:"MAX(valeur1, valeur2, ...)",description:"Valeur maximum",category:"Math"},{name:"ROUND",label:"ROUND(nombre, d√©cimales)",description:"Arrondir un nombre",category:"Math"},{name:"CONCAT",label:"CONCAT(texte1, texte2, ...)",description:"Concat√©ner des textes",category:"Texte"},{name:"LENGTH",label:"LENGTH(texte)",description:"Longueur du texte",category:"Texte"},{name:"UPPER",label:"UPPER(texte)",description:"Convertir en majuscules",category:"Texte"},{name:"LOWER",label:"LOWER(texte)",description:"Convertir en minuscules",category:"Texte"},{name:"TODAY",label:"TODAY()",description:"Date d'aujourd'hui",category:"Date"},{name:"NOW",label:"NOW()",description:"Date et heure actuelles",category:"Date"},{name:"DATEDIFF",label:"DATEDIFF(date1, date2)",description:"Diff√©rence entre deux dates",category:"Date"}],Ye=[{symbol:"=",label:"√âgal √†",category:"Comparaison"},{symbol:"!=",label:"Diff√©rent de",category:"Comparaison"},{symbol:">",label:"Sup√©rieur √†",category:"Comparaison"},{symbol:">=",label:"Sup√©rieur ou √©gal √†",category:"Comparaison"},{symbol:"<",label:"Inf√©rieur √†",category:"Comparaison"},{symbol:"<=",label:"Inf√©rieur ou √©gal √†",category:"Comparaison"},{symbol:"+",label:"Addition",category:"Arithm√©tique"},{symbol:"-",label:"Soustraction",category:"Arithm√©tique"},{symbol:"*",label:"Multiplication",category:"Arithm√©tique"},{symbol:"/",label:"Division",category:"Arithm√©tique"},{symbol:"%",label:"Modulo",category:"Arithm√©tique"},{symbol:"&&",label:"ET logique",category:"Logique"},{symbol:"||",label:"OU logique",category:"Logique"},{symbol:"!",label:"NON logique",category:"Logique"}],Je=({visible:r,onClose:s,onSelect:t,targetZone:o="expr"})=>{var n;const[l,a]=i.useState("advanced_select"),[m,d]=i.useState(""),[c,u]=i.useState("all"),[p,v]=i.useState(null),[b,N]=i.useState([]),{blocks:x}=ge(),{getTree:f,ensureTree:D}=Be(),h=i.useMemo(()=>{const e=[];return x.forEach(r=>{var i;null==(i=r.sections)||i.forEach(i=>{var s;null==(s=i.fields)||s.forEach(s=>{e.push({id:String(s.id),label:s.label||String(s.id),type:s.type||"text",blockName:r.name||"",sectionName:i.name||i.label||""})})})}),e},[x]),E=i.useMemo(()=>h.filter(e=>{const r=!m||e.label.toLowerCase().includes(m.toLowerCase())||e.blockName.toLowerCase().includes(m.toLowerCase())||e.sectionName.toLowerCase().includes(m.toLowerCase()),i="all"===c||e.type===c;return r&&i}),[h,m,c]),C=i.useMemo(()=>{const e=new Set(h.map(e=>e.type));return Array.from(e).map(e=>({label:e,value:e}))},[h]),g=i.useMemo(()=>h.filter(e=>"advanced_select"===e.type),[h]),V=r=>{const i=f(r);if(!i||!i.nodes)return[];const s=(i,t="")=>{var o,n;const l=t?`${t}.${i.id}`:i.id;return{title:e.jsxDEV("div",{className:"flex justify-between items-center py-1",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(We,{strong:!(null==(o=i.children)?void 0:o.length),children:i.label||i.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:163,columnNumber:15},void 0),i.value&&e.jsxDEV(ie,{size:"small",color:"blue",children:i.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:164,columnNumber:30},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:162,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex gap-1",children:[e.jsxDEV(_,{size:"small",type:"text",onClick:()=>S(r,"selection",i.label||i.id),title:"Valeur s√©lectionn√©e",children:"S√©lection"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:167,columnNumber:15},void 0),e.jsxDEV(_,{size:"small",type:"text",onClick:()=>S(r,"extra",i.label||i.id),title:"Donn√©es extra du n≈ìud",children:"Extra"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:175,columnNumber:15},void 0),e.jsxDEV(_,{size:"small",type:"text",onClick:()=>S(r,"nodeId",i.label||i.id),title:"ID du n≈ìud",children:"NodeId"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:183,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:166,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:161,columnNumber:11},void 0),key:l,children:(null==(n=i.children)?void 0:n.map(e=>s(e,l)))||[]}};return i.nodes.map(e=>s(e))},S=(e,r,i)=>{const s={type:"adv_part",fieldId:e,part:r,value:`${e}.${r}`,label:`${i} (${r})`,id:`adv-${e}-${r}-${Date.now()}`};t(s,o)};i.useEffect(()=>{r&&p&&D(p)},[r,p,D]);const y=i.useMemo(()=>He.filter(e=>{const r=!m||e.name.toLowerCase().includes(m.toLowerCase())||e.label.toLowerCase().includes(m.toLowerCase())||e.description.toLowerCase().includes(m.toLowerCase()),i="all"===c||e.category===c;return r&&i}),[m,c]),A=i.useMemo(()=>{const e=new Set(He.map(e=>e.category));return Array.from(e).map(e=>({label:e,value:e}))},[]),O=i.useMemo(()=>Ye.filter(e=>{const r=!m||e.symbol.includes(m)||e.label.toLowerCase().includes(m.toLowerCase()),i="all"===c||e.category===c;return r&&i}),[m,c]),R=i.useMemo(()=>{const e=new Set(Ye.map(e=>e.category));return Array.from(e).map(e=>({label:e,value:e}))},[]),j=e=>{const r={type:"value",value:e,label:e,id:`val-${Date.now()}`};t(r,o)},M=()=>{d(""),u("all")};return e.jsxDEV(ee,{title:e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(ae,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:316,columnNumber:11},void 0),e.jsxDEV("span",{children:["Explorer - Ins√©rer dans ",null==o?void 0:o.toUpperCase()]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:317,columnNumber:11},void 0),e.jsxDEV(ie,{color:"blue",children:o},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:318,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:315,columnNumber:9},void 0),open:r,onCancel:s,footer:[e.jsxDEV(_,{onClick:s,children:"Fermer"},"close",!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:324,columnNumber:9},void 0)],width:900,className:"formula-explorer-modal",style:{zIndex:2e3},maskStyle:{zIndex:1999},children:[e.jsxDEV("div",{className:"mb-4",children:e.jsxDEV(P,{direction:"vertical",className:"w-full",children:e.jsxDEV(Ze,{placeholder:"Rechercher des champs, fonctions, op√©rateurs...",allowClear:!0,value:m,onChange:e=>d(e.target.value),style:{width:"100%"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:335,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:334,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:333,columnNumber:7},void 0),e.jsxDEV(re,{activeKey:l,onChange:a,items:[{key:"advanced_select",label:e.jsxDEV("span",{children:[e.jsxDEV(te,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:353,columnNumber:17},void 0),"G√©n√©alogie Advanced Select"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:352,columnNumber:15},void 0),children:e.jsxDEV("div",{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV(G,{title:"Champs Advanced Select disponibles",size:"small",children:e.jsxDEV("div",{className:"max-h-48 overflow-y-auto",children:[e.jsxDEV(T,{size:"small",dataSource:g,renderItem:r=>e.jsxDEV(T.Item,{className:"cursor-pointer hover:bg-blue-50 px-3 py-2 rounded "+(p===r.id?"bg-blue-100 border-blue-300":""),onClick:()=>{return e=r.id,v(e),void D(e);var e},children:e.jsxDEV("div",{className:"flex justify-between items-center w-full",children:[e.jsxDEV("div",{children:[e.jsxDEV(We,{strong:!0,children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:374,columnNumber:33},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:[r.blockName," ‚Üí ",r.sectionName]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:375,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:373,columnNumber:31},void 0),e.jsxDEV(ie,{color:"green",children:"Advanced Select"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:379,columnNumber:31},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:372,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:366,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:362,columnNumber:23},void 0),0===g.length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-4",children:"Aucun champ Advanced Select trouv√©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:385,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:361,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:360,columnNumber:19},void 0),p&&e.jsxDEV(G,{title:e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(te,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:396,columnNumber:27},void 0),e.jsxDEV("span",{children:["Arbre g√©n√©alogique - ",null==(n=g.find(e=>e.id===p))?void 0:n.label]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:397,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:395,columnNumber:25},void 0),size:"small",children:e.jsxDEV("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxDEV(se,{showLine:!0,expandedKeys:b,onExpand:N,treeData:V(p),className:"custom-tree"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:403,columnNumber:25},void 0),0===V(p).length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-4",children:[e.jsxDEV("div",{children:"Chargement de l'arbre..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:412,columnNumber:29},void 0),e.jsxDEV("div",{className:"text-xs mt-1",children:"Les donn√©es sont en cours de r√©cup√©ration depuis le serveur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:413,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:411,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:402,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:393,columnNumber:21},void 0),!p&&e.jsxDEV(G,{size:"small",children:e.jsxDEV("div",{className:"text-center text-gray-500 py-8",children:[e.jsxDEV(te,{className:"text-4xl mb-2 block"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:425,columnNumber:25},void 0),e.jsxDEV("div",{className:"font-medium",children:"S√©lectionnez un champ Advanced Select"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:426,columnNumber:25},void 0),e.jsxDEV("div",{className:"text-xs mt-1",children:"Choisissez un champ ci-dessus pour voir sa g√©n√©alogie et s√©lectionner un niveau sp√©cifique"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:427,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:424,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:423,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:359,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:358,columnNumber:15},void 0)},{key:"fields",label:e.jsxDEV("span",{children:[e.jsxDEV(oe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:441,columnNumber:17},void 0),"Champs (",h.length,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:440,columnNumber:15},void 0),children:e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV($,{placeholder:"Filtrer par type",allowClear:!0,value:"all"===c?void 0:c,onChange:e=>u(e||"all"),options:[{label:"Tous les types",value:"all"},...C],className:"w-48"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:448,columnNumber:19},void 0),(m||"all"!==c)&&e.jsxDEV(_,{size:"small",onClick:M,className:"ml-2",children:"R√©initialiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:457,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:447,columnNumber:17},void 0),e.jsxDEV("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxDEV("div",{className:"grid grid-cols-1 gap-2",children:E.map(r=>e.jsxDEV(G,{size:"small",hoverable:!0,onClick:()=>(e=>{const r={type:"field",value:e.id,label:e.label,id:`field-${e.id}-${Date.now()}`};t(r,o)})(r),className:"cursor-pointer hover:border-blue-500",children:e.jsxDEV("div",{className:"flex justify-between items-start",children:[e.jsxDEV("div",{className:"flex-1",children:[e.jsxDEV("div",{className:"font-medium text-blue-600",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:475,columnNumber:29},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:[r.blockName," ‚Üí ",r.sectionName]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:476,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:474,columnNumber:27},void 0),e.jsxDEV(ie,{color:"blue",className:"ml-2",children:r.type},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:480,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:473,columnNumber:25},void 0)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:466,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:464,columnNumber:19},void 0),0===E.length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-8",children:"Aucun champ trouv√© avec ces crit√®res"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:487,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:463,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:446,columnNumber:15},void 0)},{key:"functions",label:e.jsxDEV("span",{children:[e.jsxDEV(k,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:499,columnNumber:17},void 0),"Fonctions (",He.length,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:498,columnNumber:15},void 0),children:e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV($,{placeholder:"Filtrer par cat√©gorie",allowClear:!0,value:"all"===c?void 0:c,onChange:e=>u(e||"all"),options:[{label:"Toutes les cat√©gories",value:"all"},...A],className:"w-48"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:506,columnNumber:19},void 0),(m||"all"!==c)&&e.jsxDEV(_,{size:"small",onClick:M,className:"ml-2",children:"R√©initialiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:515,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:505,columnNumber:17},void 0),e.jsxDEV("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxDEV("div",{className:"grid grid-cols-1 gap-2",children:y.map(r=>e.jsxDEV(G,{size:"small",hoverable:!0,onClick:()=>(e=>{const r={type:"function",value:e.label,label:e.name,id:`func-${Date.now()}`};t(r,o)})(r),className:"cursor-pointer hover:border-purple-500",children:e.jsxDEV("div",{className:"flex justify-between items-start",children:[e.jsxDEV("div",{className:"flex-1",children:[e.jsxDEV("div",{className:"font-medium text-purple-600",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:533,columnNumber:29},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:534,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:532,columnNumber:27},void 0),e.jsxDEV(ie,{color:"purple",className:"ml-2",children:r.category},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:536,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:531,columnNumber:25},void 0)},r.name,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:524,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:522,columnNumber:19},void 0),0===y.length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-8",children:"Aucune fonction trouv√©e avec ces crit√®res"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:543,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:521,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:504,columnNumber:15},void 0)},{key:"operators",label:e.jsxDEV("span",{children:[e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:555,columnNumber:17},void 0),"Op√©rateurs (",Ye.length,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:554,columnNumber:15},void 0),children:e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV($,{placeholder:"Filtrer par cat√©gorie",allowClear:!0,value:"all"===c?void 0:c,onChange:e=>u(e||"all"),options:[{label:"Toutes les cat√©gories",value:"all"},...R],className:"w-48"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:562,columnNumber:19},void 0),(m||"all"!==c)&&e.jsxDEV(_,{size:"small",onClick:M,className:"ml-2",children:"R√©initialiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:571,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:561,columnNumber:17},void 0),e.jsxDEV("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:O.map(r=>e.jsxDEV(G,{size:"small",hoverable:!0,onClick:()=>(e=>{const r={type:"operator",value:e.symbol,label:e.symbol,id:`op-${Date.now()}`};t(r,o)})(r),className:"cursor-pointer hover:border-orange-500 text-center",children:e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-bold text-lg text-orange-600",children:r.symbol},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:588,columnNumber:27},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:589,columnNumber:27},void 0),e.jsxDEV(ie,{color:"orange",size:"small",className:"mt-1",children:r.category},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:590,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:587,columnNumber:25},void 0)},r.symbol,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:580,columnNumber:23},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:578,columnNumber:19},void 0),0===O.length&&e.jsxDEV("div",{className:"text-center text-gray-500 py-8",children:"Aucun op√©rateur trouv√© avec ces crit√®res"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:597,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:577,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:560,columnNumber:15},void 0)},{key:"values",label:e.jsxDEV("span",{children:[e.jsxDEV(le,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:609,columnNumber:17},void 0),"Valeurs"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:608,columnNumber:15},void 0),children:e.jsxDEV("div",{children:e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV(G,{title:"Ajouter une valeur num√©rique",size:"small",children:e.jsxDEV(P.Compact,{style:{width:"100%"},children:[e.jsxDEV(L,{placeholder:"Entrez un nombre (ex: 42, 3.14, -10)",onPressEnter:e=>{const r=e.target.value.trim();r&&!isNaN(Number(r))&&(j(r),e.target.value="")}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:618,columnNumber:23},void 0),e.jsxDEV(_,{type:"primary",onClick:e=>{var r;const i=null==(r=e.target.parentElement)?void 0:r.querySelector("input"),s=null==i?void 0:i.value.trim();s&&!isNaN(Number(s))&&(j(s),i.value="")},children:"Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:628,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:617,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:616,columnNumber:19},void 0),e.jsxDEV(G,{title:"Ajouter une valeur texte",size:"small",children:e.jsxDEV(P.Compact,{style:{width:"100%"},children:[e.jsxDEV(L,{placeholder:"Entrez du texte (ex: 'Bonjour', 'Statut')",onPressEnter:e=>{const r=e.target.value.trim();r&&(j(`"${r}"`),e.target.value="")}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:646,columnNumber:23},void 0),e.jsxDEV(_,{type:"primary",onClick:e=>{var r;const i=null==(r=e.target.parentElement)?void 0:r.querySelector("input"),s=null==i?void 0:i.value.trim();s&&(j(`"${s}"`),i.value="")},children:"Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:656,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:645,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:644,columnNumber:19},void 0),e.jsxDEV(G,{title:"Valeurs pr√©d√©finies",size:"small",children:e.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:["true","false","null","0","1",'""'].map(r=>e.jsxDEV(_,{onClick:()=>j(r),className:"text-center",children:r},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:675,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:673,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:672,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:615,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:614,columnNumber:15},void 0)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:345,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaExplorer.tsx",lineNumber:313,columnNumber:5},void 0)},Ke=({id:r,item:s,formulaId:t,onRemove:o,onUpdate:n})=>{const{attributes:a,listeners:m,setNodeRef:c,transform:u,transition:p}=d({id:r}),v=i.useMemo(()=>({transform:l.Transform.toString(u),transition:p}),[u,p]),{fetchFullTree:b}=Be(),[N,x]=i.useState({}),[f,D]=i.useState({}),[h,E]=i.useState(!1),[C,g]=i.useState("expr"),[V]=i.useState(()=>{try{return window.__condAdvNav||{}}catch{return{}}});i.useEffect(()=>{if("cond"!==s.type)return;const e=s.id||"no-id",r=V[e],i=null==r?void 0:r.fieldId;if(i)try{const e=ge.getState();let r;e:for(const s of e.blocks)for(const e of s.sections)for(const s of e.fields)if(String(s.id)===String(i)){r=s.type;break e}"advanced_select"===r&&b(i)}catch{}},[s.type,s.id,V,b]),i.useEffect(()=>{try{window.__condAdvNav=V}catch{}},[V]);const S=e=>{switch(e.type){case"operator":return"bg-yellow-50 border-yellow-300 text-yellow-700";case"field":return"bg-blue-50 border-blue-300 text-blue-700";case"value":return"bg-gray-50 border-gray-300 text-gray-700";case"function":return"bg-purple-50 border-purple-300 text-purple-700";case"formula_ref":return"bg-teal-50 border-teal-300 text-teal-700";case"adv_part":return"bg-amber-50 border-amber-300 text-amber-700";case"cond":return"bg-green-50 border-green-300 text-green-700";default:return"bg-white border-gray-200"}},y=e=>{const r=e.dataTransfer.getData("formula-element-type");if(!r)return null;if("field"===r){const r=e.dataTransfer.getData("field-id")||e.dataTransfer.getData("field-value"),i=e.dataTransfer.getData("field-label")||r;return r?{type:"field",value:r,label:i,id:`field-${r}-${Date.now()}`}:null}if("operator"===r){const r=e.dataTransfer.getData("operator-value");return{type:"operator",value:r,label:r,id:`op-${Date.now()}`}}if("function"===r){const r=e.dataTransfer.getData("function-value");return{type:"function",value:r,label:e.dataTransfer.getData("function-label")||r,id:`func-${Date.now()}`}}if("value"===r){const r=e.dataTransfer.getData("value-value");return{type:"value",value:r,label:r,id:`val-${Date.now()}`}}if("formula_ref"===r){const r=e.dataTransfer.getData("formula-ref-id");return r?{type:"formula_ref",refFormulaId:r,value:r,label:e.dataTransfer.getData("formula-ref-label")||r,id:`fref-${r}-${Date.now()}`}:null}if("adv_part"===r){const r=e.dataTransfer.getData("adv-field-id"),i=e.dataTransfer.getData("adv-part");return r&&i?{type:"adv_part",fieldId:r,part:i,value:`${r}.${i}`,label:e.dataTransfer.getData("adv-label")||`${r}.${i}`,id:`adv-${r}-${i}-${Date.now()}`}:null}return null},A=e=>r=>{r.preventDefault();const i=y(r);if(!i)return;const t={...s};"then"===e?t.then=[...t.then||[],i]:t.else=[...t.else||[],i],null==n||n(t)},k=(e,r)=>{const i={...s};"then"===e?(i.then=[...s.then||[]],i.then.splice(r,1)):(i.else=[...s.else||[]],i.else.splice(r,1)),null==n||n(i)},O=e=>{g(e),E(!0)};return e.jsxDEV("div",{ref:c,style:v,...a,className:`flex flex-col gap-1 p-2 rounded-md shadow-sm border ${"cond"===s.type?"bg-green-50 border-green-300":"switch"===s.type?"bg-indigo-50 border-indigo-300":"bg-white border-gray-200"} text-sm font-medium text-gray-800 relative group ${"cond"===s.type?"w-full":"min-w-[140px]"}`,children:[e.jsxDEV("div",{className:"flex items-center w-full",children:[e.jsxDEV("div",{...m,className:"cursor-grab touch-none p-1",children:e.jsxDEV(Se,{size:16,className:"text-gray-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:205,columnNumber:76},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:205,columnNumber:17},void 0),e.jsxDEV("span",{className:"mx-2 select-none truncate flex-1",children:"cond"===s.type?s.label||"Condition":s.label||s.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:206,columnNumber:17},void 0),e.jsxDEV("button",{type:"button",onClick:e=>{e.stopPropagation();const r=Date.now();!window.lastDeleteClickTime||r-window.lastDeleteClickTime>350?window.lastDeleteClickTime=r:null==o||o()},onPointerDown:e=>e.stopPropagation(),className:"ml-2 p-1 rounded-full bg-red-200 text-red-600 opacity-0 group-hover:opacity-100 hover:bg-red-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition-opacity",children:e.jsxDEV(ye,{size:14},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:207,columnNumber:287},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:207,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:204,columnNumber:13},void 0),e.jsxDEV(Je,{visible:h,onClose:()=>{E(!1)},onSelect:(e,r)=>{const i=r||C,t={...s};"expr"===i?t.condExpr=[...t.condExpr||[],e]:"then"===i?t.then=[...t.then||[],e]:"else"===i&&(t.else=[...t.else||[],e]),null==n||n(t),E(!1)},targetZone:C},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:211,columnNumber:13},void 0),"cond"===s.type&&e.jsxDEV("div",{className:"mt-1 space-y-2",children:[e.jsxDEV("div",{className:"bg-white/90 border border-green-200 rounded p-1 flex flex-col gap-1",children:[(()=>{var r,i;const t=s.condExpr||[],o=e=>!!e&&["field","value","formula_ref","adv_part","cond","function"].includes(e.type);let l=!1;if(t.length>0&&"function"===(null==(r=t[0])?void 0:r.type))l=!0;else if(l=t.length>=3,l)for(let e=0;e<t.length;e++)if(e%2==0){if(!o(t[e])){l=!1;break}}else if("operator"!==(null==(i=t[e])?void 0:i.type)){l=!1;break}const a=l?"text-green-600":"text-red-600",m=l?"OK":"Incomplet";return e.jsxDEV("div",{className:"flex items-center justify-between gap-2",children:[e.jsxDEV("span",{className:`text-[10px] font-semibold ${a}`,children:"SI (fonction comme IF) ou (champ/valeur op√©rateur champ/valeur) ‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:243,columnNumber:37},void 0),e.jsxDEV("div",{className:"flex items-center gap-1",children:[e.jsxDEV(ie,{color:l?"green":"red",className:"text-[10px] py-0 px-1",children:m},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:245,columnNumber:41},void 0),t.length>0&&e.jsxDEV(_,{size:"small",onClick:()=>n&&n({...s,condExpr:[]}),children:"Vider"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:247,columnNumber:45},void 0),e.jsxDEV(_,{size:"small",type:"primary",onClick:()=>O("expr"),children:"üìö Explorateur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:251,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:244,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:242,columnNumber:33},void 0)})(),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-blue-500/90 text-white px-2 py-0.5 rounded-full text-[10px] font-semibold pointer-events-none shadow-sm",children:"Expression"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:259,columnNumber:29},void 0),e.jsxDEV("div",{className:"formula-subdrop-zone min-w-[60px] min-h-[80px] px-2 py-2 rounded-lg flex items-center justify-center flex-wrap gap-1",id:`cond-expr-${t}-${s.id}`,"data-cond-item-id":s.id,onDragOver:e=>{if("cond"!==s.type)return;const r=e.dataTransfer.getData("formula-element-type");["field","operator","formula_ref","adv_part","value","function"].includes(r)&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.add("ring","ring-blue-300"))},onDragLeave:e=>{e.currentTarget.classList.remove("ring","ring-blue-300")},onDrop:e=>{if("cond"!==s.type)return;e.currentTarget.classList.remove("ring","ring-blue-300"),e.preventDefault(),e.stopPropagation();const r=e.dataTransfer.getData("formula-element-type");if(!["field","operator","formula_ref","adv_part","value","function"].includes(r))return;const i=((e,r)=>y(r))(0,e);if(!i)return;const t={...s,condExpr:[...s.condExpr||[],i]};n&&n(t)},children:[0===(s.condExpr||[]).length&&e.jsxDEV("div",{className:"empty-state",children:[e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"empty-icon",children:[e.jsxDEV("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:291,columnNumber:45},void 0),e.jsxDEV("path",{d:"M18 15v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8l6 6v6z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:292,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:290,columnNumber:41},void 0),e.jsxDEV("p",{className:"empty-title",children:"D√©poser une expression (ex: Champ 1 > Champ 2)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:294,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:289,columnNumber:37},void 0),(s.condExpr||[]).length>0&&e.jsxDEV("div",{className:"flex gap-1 flex-wrap w-full justify-start",children:(s.condExpr||[]).map((r,i)=>e.jsxDEV("span",{className:`px-1 py-0.5 rounded border text-[10px] flex items-center gap-1 ${S(r)}`,children:[r.label||r.value,e.jsxDEV("button",{type:"button",className:"text-red-500",onClick:()=>(e=>{const r={...s,condExpr:[...s.condExpr||[]]};r.condExpr.splice(e,1),null==n||n(r)})(i),children:"√ó"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:302,columnNumber:49},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:300,columnNumber:45},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:298,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:260,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:258,columnNumber:25},void 0),e.jsxDEV("p",{className:"text-[9px] text-gray-500 mt-0.5 leading-snug",children:"Construire l'expression: soit une fonction (IF, etc.) soit valeur (champ / part / formule / nombre) puis op√©rateur (+, -, >, =, etc.) puis autre valeur. R√©p√©ter pour cha√Æner: Champ1 > Champ2 && Champ3 < 10."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:309,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:224,columnNumber:21},void 0),"cond"===s.type&&(()=>{const r=s.id||"no-id",i=N[r]||{opt:"expr",formula:"expr"},o=e=>{x(s=>({...s,[r]:{...i,...e}}))};let l=[];try{const e=ge.getState();let r;e:for(const i of e.blocks)for(const e of i.sections)for(const i of e.fields)if(Array.isArray(i.formulas)&&i.formulas.some(e=>e&&String(e.id)===String(t))){r=String(i.id);break e}if(r)for(const i of e.blocks)for(const e of i.sections)for(const i of e.fields)if(String(i.id)===r&&Array.isArray(i.formulas))for(const e of i.formulas)e&&e.id&&String(e.id)!==String(t)&&l.push({id:String(e.id),name:e.name||`Formule ${e.id}`});l=Array.from(new Map(l.map(e=>[e.id,e])).values()).sort((e,r)=>e.name.localeCompare(r.name,"fr",{sensitivity:"base"}))}catch{}return e.jsxDEV("div",{className:"flex flex-col gap-2",children:e.jsxDEV("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxDEV("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxDEV("span",{className:"text-[10px] font-semibold text-green-700",children:"Options"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:349,columnNumber:41},void 0),e.jsxDEV(me,{size:"small",options:[{label:"Expr",value:"expr"},{label:"ALORS",value:"then"},{label:"SINON",value:"else"}],value:i.opt,onChange:e=>o({opt:e})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:350,columnNumber:41},void 0),e.jsxDEV(_,{size:"small",onClick:()=>{const e=s.id||"no-id";D(r=>({...r,[e]:!r[e]}))},children:f[s.id||"no-id"]?"Masquer":"Explorer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:351,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:348,columnNumber:37},void 0),e.jsxDEV("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxDEV("span",{className:"text-[10px] font-semibold text-green-700",children:"Formules"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:355,columnNumber:41},void 0),e.jsxDEV(me,{size:"small",options:[{label:"Expr",value:"expr"},{label:"ALORS",value:"then"},{label:"SINON",value:"else"}],value:i.formula,onChange:e=>o({formula:e})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:356,columnNumber:41},void 0),l.length>0?e.jsxDEV($,{size:"small",placeholder:"-- formule --",style:{minWidth:160},onChange:e=>{const r=l.find(r=>r.id===e);if(!r)return;const t={type:"formula_ref",refFormulaId:e,value:e,label:r.name,id:`fref-${e}-${Date.now()}`};((e,r)=>{const i={...s};"expr"===e?i.condExpr=[...i.condExpr||[],r]:"then"===e?i.then=[...i.then||[],r]:i.else=[...i.else||[],r],n&&n(i)})(i.formula,t)},options:l.map(e=>({value:e.id,label:e.name}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:358,columnNumber:45},void 0):e.jsxDEV("span",{className:"text-[9px] italic opacity-50",children:"Aucune"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:360,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:354,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:346,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:345,columnNumber:29},void 0)})(),e.jsxDEV("div",{className:"flex items-center gap-2 text-[10px] text-gray-600 flex-wrap",children:[e.jsxDEV("span",{children:"Si condition FAUSSE =>"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:370,columnNumber:25},void 0),e.jsxDEV(me,{size:"small",value:s.elseBehavior,onChange:e=>{n&&n({...s,elseBehavior:e})},options:[{label:"R√©sultat 0",value:"zero"},{label:"Ignorer",value:"ignore"}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:371,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:369,columnNumber:21},void 0),e.jsxDEV("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxDEV("div",{className:"border rounded bg-white/80 p-1",children:e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-green-600/90 text-white px-2 py-0.5 rounded-full text-[10px] font-semibold pointer-events-none shadow-sm",children:"ALORS"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:378,columnNumber:33},void 0),e.jsxDEV("div",{className:"flex justify-end mb-1",children:e.jsxDEV(_,{size:"small",type:"link",onClick:()=>O("then"),className:"text-[9px] p-0",children:"üìö"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:380,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:379,columnNumber:33},void 0),e.jsxDEV("div",{className:"formula-subdrop-zone min-h-[80px] flex flex-col gap-1 p-2",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("ring","ring-green-300")},onDragLeave:e=>{e.currentTarget.classList.remove("ring","ring-green-300")},onDrop:A("then"),children:[(s.then||[]).map((r,i)=>e.jsxDEV("div",{className:"px-1 py-0.5 bg-green-50 border border-green-200 rounded flex items-center justify-between text-[10px]",children:[e.jsxDEV("span",{className:"truncate",children:r.label||r.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:391,columnNumber:45},void 0),e.jsxDEV("button",{type:"button",className:"text-red-500 ml-1",onClick:()=>k("then",i),children:"√ó"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:392,columnNumber:45},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:390,columnNumber:41},void 0)),0===(s.then||[]).length&&e.jsxDEV("div",{className:"empty-state",children:[e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"empty-icon",children:[e.jsxDEV("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:398,columnNumber:49},void 0),e.jsxDEV("path",{d:"M18 15v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8l6 6v6z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:399,columnNumber:49},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:397,columnNumber:45},void 0),e.jsxDEV("p",{className:"empty-title",children:"D√©poser des √©l√©ments‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:401,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:396,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:384,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:377,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:376,columnNumber:25},void 0),e.jsxDEV("div",{className:"border rounded bg-white/80 p-1",children:e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 bg-red-600/90 text-white px-2 py-0.5 rounded-full text-[10px] font-semibold pointer-events-none shadow-sm",children:"SINON"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:409,columnNumber:33},void 0),e.jsxDEV("div",{className:"flex justify-end mb-1",children:e.jsxDEV(_,{size:"small",type:"link",onClick:()=>O("else"),className:"text-[9px] p-0",children:"üìö"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:411,columnNumber:37},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:410,columnNumber:33},void 0),e.jsxDEV("div",{className:"formula-subdrop-zone min-h-[80px] flex flex-col gap-1 p-2",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("ring","ring-red-300")},onDragLeave:e=>{e.currentTarget.classList.remove("ring","ring-red-300")},onDrop:A("else"),children:[(s.else||[]).map((r,i)=>e.jsxDEV("div",{className:"px-1 py-0.5 bg-red-50 border border-red-200 rounded flex items-center justify-between text-[10px]",children:[e.jsxDEV("span",{className:"truncate",children:r.label||r.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:422,columnNumber:45},void 0),e.jsxDEV("button",{type:"button",className:"text-red-500 ml-1",onClick:()=>k("else",i),children:"√ó"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:423,columnNumber:45},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:421,columnNumber:41},void 0)),0===(s.else||[]).length&&e.jsxDEV("div",{className:"empty-state",children:[e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"empty-icon",children:[e.jsxDEV("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:429,columnNumber:49},void 0),e.jsxDEV("path",{d:"M18 15v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8l6 6v6z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:430,columnNumber:49},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:428,columnNumber:45},void 0),e.jsxDEV("p",{className:"empty-title",children:"D√©poser des √©l√©ments‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:432,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:427,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:415,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:408,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:407,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:375,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:222,columnNumber:17},void 0),"switch"===s.type&&e.jsxDEV("div",{className:"mt-1 space-y-2",children:e.jsxDEV("div",{className:"bg-white/80 border border-indigo-200 rounded p-1 text-[10px] flex flex-col gap-1 ",children:[!1,(()=>{let r;if(s.switchFieldId)try{const e=ge.getState();e:for(const i of e.blocks)for(const e of i.sections)for(const i of e.fields)if(String(i.id)===String(s.switchFieldId)){r=i.label||String(i.id);break e}}catch{}return e.jsxDEV("div",{className:"flex items-center justify-between flex-wrap gap-1",children:[e.jsxDEV("span",{className:"font-semibold text-indigo-700 truncate max-w-[180px]",children:s.switchFieldId?`Switch sur ${r||s.switchFieldId}`:"Switch (glisser un champ adv_select ici)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:459,columnNumber:37},void 0),e.jsxDEV("div",{className:"flex items-center gap-1",children:[s.switchFieldId&&e.jsxDEV("div",{className:"flex gap-1",children:["selection","extra","nodeId"].map(r=>e.jsxDEV("button",{type:"button",className:"px-1 py-0.5 border rounded text-[9px] "+(s.switchPart===r?"bg-indigo-500 text-white border-indigo-500":"bg-white hover:bg-indigo-50"),onClick:()=>{const e={...s,switchPart:r};null==n||n(e)},children:r},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:466,columnNumber:53},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:464,columnNumber:45},void 0),e.jsxDEV("button",{type:"button",className:"text-[9px] px-1 py-0.5 border rounded bg-white hover:bg-indigo-50 disabled:opacity-40",disabled:!s.switchFieldId,onClick:()=>{if(!s.switchFieldId)return;const e={...s,cases:[...s.cases||[],{value:"",seq:[]}]};null==n||n(e)},children:"+ Cas"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:472,columnNumber:41},void 0),s.switchFieldId&&e.jsxDEV("button",{type:"button",className:"text-[9px] px-1 py-0.5 border rounded bg-white hover:bg-red-50",title:"Changer de champ",onClick:()=>{const e={...s,switchFieldId:void 0,cases:[],defaultSeq:[],switchPart:void 0};null==n||n(e)},children:"‚Ü∫"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:478,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:462,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:458,columnNumber:33},void 0)})(),!s.switchFieldId&&e.jsxDEV("div",{className:"border border-dashed border-indigo-300 rounded p-1 text-[10px] text-indigo-600 bg-indigo-50/50",onDragOver:e=>{const r=Array.from(e.dataTransfer.types||[]);(r.includes("field-id")||r.includes("adv-field-id"))&&(e.preventDefault(),e.currentTarget.classList.add("ring","ring-indigo-300"))},onDragLeave:e=>{e.currentTarget.classList.remove("ring","ring-indigo-300")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("ring","ring-indigo-300");const r=e.dataTransfer.getData("formula-element-type");if("field"===r||"adv_part"===r)if("field"===r){const r=e.dataTransfer.getData("field-id")||e.dataTransfer.getData("field-value");if(!r)return;let i;try{const e=ge.getState();e:for(const s of e.blocks)for(const e of s.sections)for(const s of e.fields)if(String(s.id)===String(r)){i=s.type;break e}}catch{}if("advanced_select"!==i)return;const t={...s,switchFieldId:r,switchPart:"selection"};null==n||n(t)}else if("adv_part"===r){const r=e.dataTransfer.getData("adv-field-id"),i=e.dataTransfer.getData("adv-part");if(!r||!i)return;let t;try{const e=ge.getState();e:for(const i of e.blocks)for(const e of i.sections)for(const i of e.fields)if(String(i.id)===String(r)){t=i.type;break e}}catch{}if("advanced_select"!==t)return;const o={...s,switchFieldId:r,switchPart:i};null==n||n(o)}},children:"D√©poser ici un champ advanced_select (ou une part) pour le baser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:488,columnNumber:29},void 0),!s.switchFieldId&&(()=>{try{const r=ge.getState(),i=[];for(const e of r.blocks)for(const r of e.sections)for(const e of r.fields)"advanced_select"===e.type&&i.push({id:String(e.id),label:e.label||String(e.id)});return 0===i.length?null:e.jsxDEV("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsxDEV("span",{className:"text-[9px] text-indigo-600",children:"Ou choisir:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:527,columnNumber:41},void 0),e.jsxDEV("select",{className:"text-[10px] border rounded px-1 py-0.5",onChange:e=>{const r=e.target.value;if(!r)return;const i={...s,switchFieldId:r,switchPart:"selection"};null==n||n(i)},children:[e.jsxDEV("option",{value:"",children:"-- champ --"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:529,columnNumber:45},void 0),i.map(r=>e.jsxDEV("option",{value:r.id,children:r.label},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:530,columnNumber:65},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:528,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:526,columnNumber:37},void 0)}catch{return null}})(),(()=>{const r=ge.getState(),i=s.switchFieldId?(()=>{for(const e of r.blocks)for(const r of e.sections)for(const e of r.fields)if(String(e.id)===String(s.switchFieldId))return(e.options||[]).map(e=>({value:String(e.value||e.id||""),label:String(e.label||String(e.value||e.id||""))}));return[]})():[];return e.jsxDEV("div",{className:"space-y-1",children:[s.switchFieldId&&i.length>0&&e.jsxDEV("div",{className:"flex flex-wrap gap-1 mb-1",children:[i.map(r=>e.jsxDEV("button",{type:"button",className:"px-1 py-0.5 border rounded bg-indigo-50 hover:bg-indigo-100 text-[9px]",onClick:()=>((e,r)=>{if(!e)return;if((s.cases||[]).some(r=>r.value===e))return;const i={...s,cases:[...s.cases||[],{value:e,label:r,seq:[]}]};null==n||n(i)})(String(r.value),r.label),children:r.label},r.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:548,columnNumber:49},void 0)),e.jsxDEV("button",{type:"button",className:"px-1 py-0.5 border rounded bg-green-50 hover:bg-green-100 text-[9px] font-semibold",onClick:()=>{const e=i.filter(e=>!(s.cases||[]).some(r=>r.value===e.value));if(0===e.length)return;const r={...s,cases:[...s.cases||[],...e.map(e=>({value:e.value,label:e.label,seq:[]}))]};null==n||n(r)},children:"+ Tous les cas"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:550,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:546,columnNumber:41},void 0),s.switchFieldId&&0===i.length&&e.jsxDEV("div",{className:"text-[9px] text-indigo-500 italic mb-1",children:"Aucune option pour ce champ (vous pouvez saisir des valeurs manuellement)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:559,columnNumber:41},void 0),(s.cases||[]).map((r,i)=>e.jsxDEV("div",{className:"border border-indigo-300 bg-indigo-50 rounded p-1",children:[e.jsxDEV("div",{className:"flex items-center gap-1 mb-1",children:[e.jsxDEV("input",{className:"h-5 px-1 text-[10px] border rounded flex-1",placeholder:"Valeur exacte",value:r.value,onChange:e=>{const t={...s,cases:[...s.cases||[]]};t.cases[i]={...r,value:e.target.value},null==n||n(t)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:564,columnNumber:49},void 0),e.jsxDEV("button",{type:"button",className:"text-red-500 text-xs",onClick:()=>{const e={...s,cases:[...s.cases||[]]};e.cases.splice(i,1),null==n||n(e)},children:"√ó"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:566,columnNumber:49},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:563,columnNumber:45},void 0),e.jsxDEV("div",{className:"min-h-[28px] text-[10px] flex flex-col gap-1 border border-dashed border-indigo-300 rounded p-1",onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();const r=y(e);if(!r)return;const t={...s,cases:[...s.cases||[]]},o=t.cases[i];o.seq=[...o.seq||[],r],null==n||n(t)},children:[0===(r.seq||[]).length&&e.jsxDEV("span",{className:"text-gray-400",children:"D√©poser √©l√©ments de calcul‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:579,columnNumber:80},void 0),(r.seq||[]).length>0&&r.seq.map((r,i)=>e.jsxDEV("span",{className:"px-1 py-0.5 rounded border bg-white flex items-center gap-1",children:r.label||r.value},i,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:581,columnNumber:53},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:568,columnNumber:45},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:562,columnNumber:41},void 0)),e.jsxDEV("div",{className:"border border-dashed border-indigo-300 rounded p-1 min-h-[28px]",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const r=y(e);if(!r)return;const i={...s,defaultSeq:[...s.defaultSeq||[],r]};null==n||n(i)},children:[e.jsxDEV("p",{className:"text-[9px] text-indigo-600 mb-1",children:"D√©faut"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:597,columnNumber:41},void 0),0===(s.defaultSeq||[]).length&&e.jsxDEV("span",{className:"text-gray-400 text-[10px]",children:"D√©poser s√©quence par d√©faut‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:598,columnNumber:82},void 0),(s.defaultSeq||[]).length>0&&e.jsxDEV("div",{className:"flex flex-wrap gap-1",children:s.defaultSeq.map((r,i)=>e.jsxDEV("span",{className:"px-1 py-0.5 rounded border bg-white text-[10px]",children:r.label||r.value},i,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:601,columnNumber:82},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:600,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:588,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:544,columnNumber:33},void 0)})()]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:443,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:442,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/SortableFormulaItem.tsx",lineNumber:203,columnNumber:9},void 0)};{const e=document.dispatchEvent;document.dispatchEvent=function(r){var i,s;return!("formula-updated"!==r.type&&"formula-force-reload"!==r.type||(null==(i=null==r?void 0:r.detail)?void 0:i.isDragEvent)||(null==(s=null==r?void 0:r.detail)?void 0:s.isEssential))||e.call(this,r)}}const Xe=({formula:r})=>{const s=r.id,t=o.useMemo(()=>r.sequence||[],[r.sequence]),n=t.map((e,r)=>`formula-${s}-item-${r}-${e.id||""}`),l=u(p(v,{activationConstraint:{distance:8}})),m=i.useRef(ge.getState()),{setNodeRef:d,isOver:f}=c({id:`formula-drop-zone-${s}`,data:{formulaId:s,type:"formula-drop-zone",itemData:{formulaId:s,formulaName:r.name}}});i.useEffect(()=>ge.subscribe(e=>{m.current=e}),[]);const[D,h]=i.useState({message:"",type:""}),E=i.useCallback(async e=>{var i;try{let t=r.fieldId;if(t||(t=null==(i=m.current.blocks.flatMap(e=>e.sections).flatMap(e=>e.fields).find(e=>{var r;return null==(r=e.formulas)?void 0:r.some(e=>e.id===s)}))?void 0:i.id),!t)throw new Error(`Impossible de trouver le fieldId pour la formule ${s}`);return h({message:"Formule mise √† jour avec succ√®s",type:"success"}),S(e=>e+1),fetch(`/api/fields/${t}/formulas/${s}`,{method:"PUT",headers:Ae(),body:JSON.stringify({id:s,sequence:e})}).then(e=>{e.ok}).catch(e=>{}),!0}catch(t){return h({message:`Erreur lors de la mise √† jour: ${t instanceof Error?t.message:"Erreur inconnue"}`,type:"error"}),!1}},[r,s]),C=i.useCallback(e=>{if(e.over&&e.over.id===`formula-drop-zone-${s}`){const i=e.active.data.current;if(i){let e;e="cond"===i.type?{id:`cond-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:"cond",value:"cond",label:"Condition",condExpr:[],then:[],else:[],elseBehavior:"zero"}:"switch"===i.type?{id:`switch-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:"switch",value:"switch",label:i.label||"Switch",switchFieldId:i.switchFieldId,switchPart:i.switchPart||"selection",cases:[],defaultSeq:[]}:{...i,id:`${i.type}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`};const o=[...t,e];r.sequence=o,S(e=>e+1),E(o),setTimeout(()=>{const e=new CustomEvent("formula-updated",{detail:{formulaId:s,isDragEvent:!0,isEssential:!0,forceLocal:!0}});document.dispatchEvent(e);try{if("undefined"!=typeof Notification&&"granted"===Notification.permission)new Notification("CRM",{body:"√âl√©ment ajout√© √† la formule",icon:"/public/vite.svg"});else{const e=document.getElementById(`formula-drop-zone-${s}`);e&&(e.classList.add("highlight-success"),setTimeout(()=>{e.classList.remove("highlight-success")},500))}}catch{}},50)}}},[t,E,s,r]),g=i.useCallback(e=>{if(e>=0&&e<t.length){const i=[...t],o=i[e];i.splice(e,1),r.sequence=i,E(i),h({message:`${o.label||o.value} supprim√©`,type:"success"}),S(e=>e+1),setTimeout(()=>{const e=new CustomEvent("formula-updated",{detail:{formulaId:s,isDragEvent:!0,isEssential:!0,forceLocal:!0}});document.dispatchEvent(e)},50)}},[t,E,r,s]);i.useEffect(()=>{if(D.message){const e=setTimeout(()=>{h({message:"",type:""})},3e3);return()=>clearTimeout(e)}},[D]);const[V,S]=i.useState(0),y=i.useCallback(()=>{S(e=>e+1)},[]);return i.useEffect(()=>{const e=e=>{const r=e.detail;(null==r?void 0:r.formulaId)===s&&y()};return document.addEventListener("formula-force-refresh",e),()=>{document.removeEventListener("formula-force-refresh",e)}},[s,y]),i.useEffect(()=>{const e=e=>{const i=e.detail;if(!i||i.formulaId!==s)return;let o=null;if("operator"===i.type?o={type:"operator",value:String(i.value||"+"),label:i.label||String(i.value||"+"),id:`operator-${Date.now()}`}:"value"===i.type&&(o={type:"value",value:String(i.value??"0"),label:i.label||String(i.value??"0"),id:`value-${Date.now()}`}),o){const e=[...t,o];r.sequence=e,S(e=>e+1),E(e)}};document.addEventListener("formula-toolbar-insert",e);const i=e=>{const i=e.detail;if(!i||i.formulaId!==s)return;const t=[];r.sequence=t,S(e=>e+1),E(t)};return document.addEventListener("formula-toolbar-clear",i),()=>{document.removeEventListener("formula-toolbar-insert",e),document.removeEventListener("formula-toolbar-clear",i)}},[t,E,r,s]),e.jsxDEV(b,{sensors:l,collisionDetection:N,onDragEnd:C,children:e.jsxDEV("div",{ref:d,className:`min-h-[140px] p-4 border-2 border-dashed rounded-lg formula-drop-zone \n                    ${f?"border-blue-400 bg-blue-50 ring-2 ring-blue-200/60":"border-gray-300 hover:border-blue-300 hover:bg-blue-50/40"} \n                    transition-all duration-200 shadow-sm`,style:{maxWidth:"100%",position:"relative"},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.add("border-green-400","bg-green-50"),e.currentTarget.classList.remove("border-blue-300","bg-white")},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("border-green-400","bg-green-50"),e.currentTarget.classList.add("border-blue-300","bg-white")},onDrop:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget.classList.remove("border-green-400","bg-green-50"),e.currentTarget.classList.add("border-blue-300","bg-white");const i=e.dataTransfer.getData("formula-element-type");if(i){let o;if("cond"===i)o={id:`cond-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:"cond",value:"cond",label:"Condition",condExpr:[],then:[],else:[],elseBehavior:"zero"};else if("switch"===i){const r=e.dataTransfer.getData("switch-field-id"),i=e.dataTransfer.getData("switch-field-label");o={id:`switch-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:"switch",value:"switch",label:i?`Switch ${i}`:"Switch (d√©poser un champ)",switchFieldId:r||void 0,switchPart:"selection",cases:[],defaultSeq:[]}}else if("operator"===i){const r=e.dataTransfer.getData("operator-value");o={type:"operator",value:r,label:e.dataTransfer.getData("operator-label")||r,id:`operator-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}else if("field"===i){o={type:"field",value:e.dataTransfer.getData("field-value"),label:e.dataTransfer.getData("field-label"),id:`field-${e.dataTransfer.getData("field-id")}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}else if("function"===i){const r=e.dataTransfer.getData("function-value");o={type:"function",value:r,label:e.dataTransfer.getData("function-label")||r,id:`function-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}else if("value"===i){const r=e.dataTransfer.getData("value-value");o={type:"value",value:r,label:e.dataTransfer.getData("value-label")||r,id:`value-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}else if("formula_ref"===i){const r=e.dataTransfer.getData("formula-ref-id"),i=e.dataTransfer.getData("formula-ref-label");if(!r)return;o={type:"formula_ref",refFormulaId:r,value:r,label:i||r,id:`formula_ref-${r}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}else{if("adv_part"!==i)return;{const r=e.dataTransfer.getData("adv-field-id"),i=e.dataTransfer.getData("adv-part"),s=e.dataTransfer.getData("adv-label");if(!r||!i)return;o={type:"adv_part",fieldId:r,part:i,value:`${r}.${i}`,label:s||`${r}.${i}`,id:`adv_part-${r}-${i}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}}}const n=[...t,o];r.sequence=n,E(n),h({message:`${o.label||o.value} ajout√© √† la formule`,type:"success"}),S(e=>e+1),setTimeout(()=>{const e=new CustomEvent("formula-updated",{detail:{formulaId:s,isDragEvent:!0,isEssential:!0,forceLocal:!0}});document.dispatchEvent(e)},50)}},children:[D.message&&e.jsxDEV("div",{className:"absolute top-0 right-0 m-2 p-2 rounded shadow-md text-sm "+("success"===D.type?"bg-green-100 text-green-800":"error"===D.type?"bg-red-100 text-red-800":""),children:D.message},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:550,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex flex-row gap-4 items-start",children:e.jsxDEV("div",{className:"flex-1",children:0===t.length?e.jsxDEV("div",{className:"empty-state",children:[e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"empty-icon",children:[e.jsxDEV("path",{d:"M14 3v4a1 1 0 0 0 1 1h4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:565,columnNumber:45},void 0),e.jsxDEV("path",{d:"M18 15v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h8l6 6v6z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:566,columnNumber:45},void 0),e.jsxDEV("path",{d:"M12 15V9"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:567,columnNumber:45},void 0),e.jsxDEV("path",{d:"m9 12 3-3 3 3"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:568,columnNumber:45},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:564,columnNumber:41},void 0),e.jsxDEV("p",{className:"empty-title",children:"Glissez-d√©posez ou cliquez sur un champ √† gauche‚Ä¶"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:570,columnNumber:41},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:563,columnNumber:37},void 0):e.jsxDEV(a,{items:n,strategy:x,children:e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:t.map((i,o)=>{const n=`formula-${s}-item-${o}-${i.id||""}`;return e.jsxDEV(Ke,{id:n,item:i,formulaId:r.id,onRemove:()=>g(o),onUpdate:e=>{const i=[...t];i[o]=e,r.sequence=i,S(e=>e+1),E(i)}},n,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:578,columnNumber:45},void 0)})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:574,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:573,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:561,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:560,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:382,columnNumber:13},void 0)},`formula-${s}-${V}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaSequenceEditor.tsx",lineNumber:375,columnNumber:5},void 0)},Qe=[{value:"+",label:"Addition : Ajoute deux valeurs (ex: 5 + 3)",category:"arithm√©tique"},{value:"-",label:"Soustraction : Soustrait la seconde valeur de la premi√®re (ex: 5 - 3)",category:"arithm√©tique"},{value:"*",label:"Multiplication : Multiplie deux valeurs (ex: 5 * 3)",category:"arithm√©tique"},{value:"/",label:"Division : Divise la premi√®re valeur par la seconde (ex: 15 / 3)",category:"arithm√©tique"},{value:"%",label:"Modulo : Renvoie le reste de la division enti√®re (ex: 7 % 3 = 1)",category:"arithm√©tique"},{value:"**",label:"Puissance : √âl√®ve la premi√®re valeur √† la puissance de la seconde (ex: 2 ** 3 = 8)",category:"arithm√©tique"},{value:"=",label:"√âgal : Compare si deux valeurs sont √©gales (ex: prix = 100)",category:"comparaison"},{value:"!=",label:'Diff√©rent : Compare si deux valeurs sont diff√©rentes (ex: statut != "Ferm√©")',category:"comparaison"},{value:">",label:"Sup√©rieur : V√©rifie si la premi√®re valeur est plus grande (ex: prix > 100)",category:"comparaison"},{value:"<",label:"Inf√©rieur : V√©rifie si la premi√®re valeur est plus petite (ex: prix < 100)",category:"comparaison"},{value:">=",label:"Sup√©rieur ou √©gal : V√©rifie si la premi√®re valeur est plus grande ou √©gale (ex: √¢ge >= 18)",category:"comparaison"},{value:"<=",label:"Inf√©rieur ou √©gal : V√©rifie si la premi√®re valeur est plus petite ou √©gale (ex: √¢ge <= 65)",category:"comparaison"},{value:"===",label:'Strictement √©gal : Compare si deux valeurs sont √©gales en valeur et en type (ex: type === "client")',category:"comparaison"},{value:"!==",label:"Strictement diff√©rent : Compare si deux valeurs sont diff√©rentes en valeur ou en type",category:"comparaison"},{value:"&&",label:"ET logique : Les deux conditions doivent √™tre vraies (ex: prix > 100 && quantit√© > 10)",category:"logique"},{value:"||",label:'OU logique : Au moins une des conditions doit √™tre vraie (ex: statut = "Actif" || statut = "En attente")',category:"logique"},{value:"!",label:'NON logique : Inverse une condition (ex: !termin√© signifie "non termin√©")',category:"logique"},{value:".",label:"Acc√®s √† une propri√©t√© : Acc√®de √† une propri√©t√© d'un objet (ex: client.nom)",category:"acc√®s"},{value:"[]",label:"Acc√®s √† un √©l√©ment : Acc√®de √† un √©l√©ment d'un tableau ou d'un objet (ex: contacts[0])",category:"acc√®s"},{value:"?:",label:'Op√©rateur ternaire : Condition ? si vrai : si faux (ex: age >= 18 ? "Majeur" : "Mineur")',category:"conditionnel"},{value:"?.",label:"Cha√Ænage optionnel : Acc√®de √† une propri√©t√© d'un objet qui peut √™tre null (ex: client?.adresse)",category:"acc√®s"},{value:"??",label:"Coalescence des nuls : Renvoie la valeur de droite si celle de gauche est null/undefined (ex: valeur ?? 0)",category:"conditionnel"},{value:"...",label:"Op√©rateur de d√©composition : D√©compose un tableau ou un objet (ex: ...tableau)",category:"sp√©cial"}],er=i.memo(({formulaId:r,formula:s})=>{const t=i.useCallback(e=>{if(!r)return;if(!s)return;if(!ke(s,"OperatorsPalette").isValid)return;const i={type:"operator",id:`operator-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,value:e,label:e},t=Ae(),o=[...(s&&Array.isArray(s.sequence)?s.sequence:[]).map(e=>e.id?e:{...e,id:`auto-fix-${e.type||"item"}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}),i],n=Oe({...s,sequence:o},"OperatorsPalette");fetch(`/api/formulas/${r}`,{method:"PUT",headers:t,body:JSON.stringify({id:r,name:s.name||"Nouvelle formule",sequence:n.sequence})}).then(e=>{e.ok&&setTimeout(()=>{const e=new CustomEvent("formula-updated",{detail:{formulaId:r,success:!0}});document.dispatchEvent(e)},300)}).catch(e=>{})},[r,s]),o=(r,i)=>e.jsxDEV(B,{title:r.label,children:e.jsxDEV(_,{size:"small",icon:i,onClick:()=>t(r.value),draggable:!0,onDragStart:e=>{e.dataTransfer.setData("operator-value",r.value),e.dataTransfer.setData("operator-label",r.label),e.dataTransfer.setData("formula-element-type","operator"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy",document.querySelectorAll(".formula-drop-zone").forEach(e=>e.classList.add("drop-target-highlight"))},children:r.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:137,columnNumber:17},void 0)},r.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:136,columnNumber:13},void 0);return e.jsxDEV("div",{className:"mt-2 p-2 bg-white rounded-md border border-gray-200",children:[e.jsxDEV("p",{className:"text-sm font-medium mb-2",children:"Op√©rateurs"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:158,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:162,columnNumber:101},void 0)," Arithm√©tiques"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:162,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:Qe.filter(e=>"arithm√©tique"===e.category).map(r=>o(r,e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:164,columnNumber:105},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:163,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:161,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(C,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:170,columnNumber:101},void 0)," Comparaison"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:170,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:Qe.filter(e=>"comparaison"===e.category).map(r=>o(r,e.jsxDEV(C,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:172,columnNumber:104},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:171,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:169,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(de,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:178,columnNumber:101},void 0)," Logiques"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:178,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:Qe.filter(e=>"logique"===e.category).map(r=>o(r,e.jsxDEV(de,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:180,columnNumber:100},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:179,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:177,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(ce,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:186,columnNumber:101},void 0)," Avanc√©s"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:186,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:Qe.filter(e=>["acc√®s","conditionnel","sp√©cial"].includes(e.category)).map(r=>o(r,e.jsxDEV(ce,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:188,columnNumber:133},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:187,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:185,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/OperatorsPalette.tsx",lineNumber:157,columnNumber:13},void 0)}),rr=e=>e?{id:e.id||"",name:e.name||"",targetProperty:e.targetProperty||"",targetFieldId:e.targetFieldId||e.fieldId||"",sequence:Array.isArray(e.sequence)?e.sequence.map(ir):[]}:null,ir=e=>{if(!e)return null;const r=e.id||`item-${Math.random().toString(36).slice(2,9)}`;if("field"===e.type)return{id:r,type:"field",value:e.value||"",label:e.label||String(e.value||""),fieldId:e.fieldId||("string"==typeof e.value?e.value:"")};if("value"===e.type)return{id:r,type:"value",value:e.value,label:e.label||String(e.value||""),valueType:e.valueType};if("operator"===e.type)return{id:r,type:"operator",value:e.value,label:e.label||String(e.value||"")};if("formula_ref"===e.type)return{id:r,type:"formula_ref",value:e.refFormulaId||e.value,refFormulaId:e.refFormulaId};if("adv_part"===e.type){const i=e;return{id:r,type:"adv_part",value:e.value,fieldId:i.fieldId,part:i.part}}if("cond"===e.type){const i=e;return{id:r,type:"cond",elseBehavior:i.elseBehavior,condExpr:Array.isArray(i.condExpr)?i.condExpr.map(ir).filter(Boolean):[],then:Array.isArray(i.then)?i.then.map(ir).filter(Boolean):[],else:Array.isArray(i.else)?i.else.map(ir).filter(Boolean):[]}}if("switch"===e.type){const i=e;return{id:r,type:"switch",switchFieldId:i.switchFieldId,switchPart:i.switchPart,cases:Array.isArray(i.cases)?i.cases.map(e=>({value:e.value,label:e.label,seq:Array.isArray(e.seq)?e.seq.map(ir).filter(Boolean):[]})):[],defaultSeq:Array.isArray(i.defaultSeq)?i.defaultSeq.map(ir).filter(Boolean):[]}}return{id:r,type:e.type,value:e.value,label:e.label||String(e.value||"")}},sr=({formula:r})=>{const s=ge(e=>e.blocks),t=o.useCallback(e=>{for(const r of s)for(const i of r.sections)for(const r of i.fields){const i=(r.formulas||[]).find(r=>r.id===e);if(i)return i}},[s]),n=o.useCallback((e,r,i,s,o,l)=>{var a;if(!e||s>5||o.has(e))return;o.add(e);const m=t(e);if(m)for(const t of m.sequence||[])if(t)if("field"===t.type){const e=t.fieldId||("string"==typeof t.value?t.value:void 0);e&&(r.all.add(e),r[l].add(e),i[e]=i[e]||t.label||e)}else"adv_part"===t.type?t.fieldId&&(r.all.add(t.fieldId),r[l].add(t.fieldId),i[t.fieldId]=i[t.fieldId]||t.label||t.fieldId):"formula_ref"===t.type&&t.refFormulaId?n(t.refFormulaId,r,i,s+1,o,l):"cond"===t.type&&(null==(a=[...t.condExpr||[],...t.then||[],...t.else||[]])||a.forEach(e=>{if("formula_ref"===(null==e?void 0:e.type)&&e.refFormulaId&&n(e.refFormulaId,r,i,s+1,o,l),"field"===(null==e?void 0:e.type)){const s=e.fieldId||("string"==typeof e.value?e.value:void 0);s&&(r.all.add(s),r[l].add(s),i[s]=i[s]||e.label||s)}"adv_part"===(null==e?void 0:e.type)&&e.fieldId&&(r.all.add(e.fieldId),r[l].add(e.fieldId),i[e.fieldId]=i[e.fieldId]||e.label||e.fieldId)}))},[t]),l=o.useCallback(e=>{const r={all:new Set,main:new Set,condition:new Set,then:new Set,else:new Set},i={},s=(e,t)=>{if(Array.isArray(e))for(const o of e){if(!o)continue;const e=(e,s)=>{e&&(r.all.add(e),r[t].add(e),i[e]||(i[e]=s||e))};"field"===o.type&&e(o.fieldId||("string"==typeof o.value?o.value:void 0),o.label),"adv_part"===o.type&&e(o.fieldId,o.label),"formula_ref"===o.type&&o.refFormulaId?n(o.refFormulaId,r,i,0,new Set,t):"cond"!==o.type?"switch"===o.type&&(e(o.switchFieldId,o.label),(o.cases||[]).forEach(e=>s(e.seq,t)),s(o.defaultSeq,t)):(s(o.condExpr,"condition"),s(o.then,"then"),s(o.else,"else"))}};return s(e.sequence,"main"),{all:Array.from(r.all),main:Array.from(r.main),condition:Array.from(r.condition),then:Array.from(r.then),else:Array.from(r.else),labels:i}},[n]),a=i.useMemo(()=>l(r),[r,l]),[m,d]=i.useState(()=>{const e={};return a.all.forEach(r=>{e[r]=0}),e});i.useEffect(()=>{d(e=>{let r=!1;const i={...e};return a.all.forEach(e=>{void 0===i[e]&&(i[e]=0,r=!0)}),r?i:e})},[a.all]);const c=i.useMemo(()=>{const e=[];return r.sequence.forEach((r,i)=>{if("cond"===r.type){let s="";if(r.condExpr&&r.condExpr.length>0)s=r.condExpr.map(e=>{if("field"===e.type)return a.labels[e.fieldId||("string"==typeof e.value?e.value:"")]||e.label||e.fieldId||e.value||"";if("operator"===e.type)return String(e.value||e.label||"");if("value"===e.type){const r=(e.value,e.value);return e.label?String(e.label):"string"==typeof r&&r.startsWith("nextField:")?"Champ suivant":String(r)}return"adv_part"===e.type&&(a.labels[e.fieldId||""]||e.label||e.fieldId)||""}).join(" ");else if(r.condition){const e=r.condition.fieldId;s=`${a.labels[e]||e} ${r.condition.operator||"="} ${r.condition.value}`}let t,o,n=!1;try{if(r.condExpr&&r.condExpr.length>0){const e={id:`cond_expr_preview_${i}`,name:"",targetProperty:"",sequence:r.condExpr},s=rr(e);if(s){const e=Re(s,m);n=Boolean(e.result)}else n=!1}else if(r.condition){const e=m[r.condition.fieldId],i=r.condition.value;switch(r.condition.operator){case">":n=e>i;break;case">=":n=e>=i;break;case"<":n=e<i;break;case"<=":n=e<=i;break;case"!=":n=String(e)!==String(i);break;default:n=String(e)===String(i)}}if(r.then&&r.then.length>0){const e={id:`then_sim_${i}`,name:"",targetProperty:"",sequence:r.then},s=rr(e);if(s){t=Re(s,m).result}}if(r.else&&r.else.length>0){const e={id:`else_sim_${i}`,name:"",targetProperty:"",sequence:r.else},s=rr(e);if(s){o=Re(s,m).result}}}catch{n=!1}e.push({index:i,expression:s,pass:n,thenResult:t,elseResult:o})}}),e},[r,m,a.labels]),u=i.useMemo(()=>r.sequence.filter(e=>"cond"!==e.type),[r]),p=i.useMemo(()=>{if(!u.length)return null;const e={...r,id:r.id+"_simple",sequence:u},i=rr(e);return Re(i,m)},[r,u,m]),v=rr(r),b=Re(v,m);if(0===a.all.length)return e.jsxDEV("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxDEV("p",{className:"text-sm text-yellow-700",children:"Cette formule ne contient pas de champs √† √©valuer."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:218,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:217,columnNumber:7},void 0);const N=r=>e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:r.map(r=>e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",title:r,children:a.labels[r]||r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:230,columnNumber:11},void 0),e.jsxDEV("input",{type:"number",value:m[r],onChange:e=>((e,r)=>{const i=parseFloat(r);d(r=>({...r,[e]:isNaN(i)?0:i}))})(r,e.target.value),className:"w-full p-2 border border-gray-300 rounded-md text-sm"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:231,columnNumber:11},void 0)]},r,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:229,columnNumber:9},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:227,columnNumber:5},void 0);return e.jsxDEV("div",{className:"border rounded-md overflow-hidden",children:[e.jsxDEV("div",{className:"bg-blue-50 p-3 border-b border-blue-100",children:[e.jsxDEV("h3",{className:"text-sm font-medium text-blue-800",children:"Test complet de la formule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:245,columnNumber:9},void 0),e.jsxDEV("p",{className:"text-xs text-blue-600 mt-1",children:"4 volets : Calcul simple, Condition(s), R√©sultat ALORS, R√©sultat SINON + r√©sultat final."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:248,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:244,columnNumber:7},void 0),e.jsxDEV("div",{className:"p-3 bg-white space-y-4",children:[e.jsxDEV("section",{className:"border rounded-md p-3 bg-gray-50 border-gray-200",children:[e.jsxDEV("h4",{className:"text-xs font-semibold uppercase text-gray-700 mb-2",children:"1. Calcul simple (s√©quence hors conditions)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:255,columnNumber:11},void 0),a.main.length?N(a.main):e.jsxDEV("p",{className:"text-[11px] text-gray-500",children:"Aucun √©l√©ment simple (tout est conditionnel)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:256,columnNumber:70},void 0),p&&e.jsxDEV("div",{className:"mt-3 p-2 rounded text-xs "+(p.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[e.jsxDEV("span",{className:"font-semibold",children:"R√©sultat calcul simple : "},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:259,columnNumber:15},void 0),e.jsxDEV("span",{children:p.success?String(p.result):"Erreur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:260,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:258,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:254,columnNumber:9},void 0),e.jsxDEV("section",{className:"border rounded-md p-3 bg-indigo-50 border-indigo-200",children:[e.jsxDEV("h4",{className:"text-xs font-semibold uppercase text-indigo-700 mb-2",children:"2. Condition(s) (TEST)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:267,columnNumber:11},void 0),!c.length&&e.jsxDEV("p",{className:"text-[11px] text-indigo-600",children:"Aucune condition."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:268,columnNumber:38},void 0),a.condition.length>0&&e.jsxDEV("div",{className:"mb-3",children:[e.jsxDEV("h5",{className:"text-[10px] font-semibold uppercase text-indigo-600 mb-1",children:"Champs utilis√©s dans les expressions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:271,columnNumber:15},void 0),N(a.condition)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:270,columnNumber:13},void 0),e.jsxDEV("div",{className:"space-y-2",children:c.map(r=>e.jsxDEV("div",{className:"bg-white rounded border border-indigo-200 p-2 text-[11px]",children:[e.jsxDEV("div",{className:"flex justify-between mb-1",children:[e.jsxDEV("span",{className:"font-medium truncate",title:r.expression,children:r.expression||"(condition vide)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:279,columnNumber:19},void 0),e.jsxDEV("span",{className:"px-1 rounded text-white "+(r.pass?"bg-green-500":"bg-red-500"),children:r.pass?"VRAI":"FAUX"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:280,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:278,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex gap-2 text-[10px]",children:[e.jsxDEV("span",{className:"px-1 rounded "+(r.pass?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"),children:["ALORS ",r.pass?"ACTIF":"IGNOR√â"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:283,columnNumber:19},void 0),e.jsxDEV("span",{className:"px-1 rounded "+(r.pass?"bg-gray-100 text-gray-500":"bg-green-100 text-green-700"),children:["SINON ",r.pass?"IGNOR√â":"ACTIF"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:284,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:282,columnNumber:17},void 0)]},r.index,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:277,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:275,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:266,columnNumber:9},void 0),e.jsxDEV("section",{className:"border rounded-md p-3 bg-green-50 border-green-200",children:[e.jsxDEV("h4",{className:"text-xs font-semibold uppercase text-green-700 mb-2",children:"3. R√©sultat ALORS (THEN)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:293,columnNumber:11},void 0),a.then.length>0?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("h5",{className:"text-[10px] font-semibold uppercase text-green-600 mb-1",children:"Champs utilis√©s"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:296,columnNumber:37},void 0),N(a.then)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:296,columnNumber:15},void 0),c.map(r=>e.jsxDEV("div",{className:"text-[11px] bg-white border border-green-200 rounded p-2 mb-2",children:[e.jsxDEV("div",{className:"flex justify-between mb-1",children:[e.jsxDEV("span",{className:"font-medium",children:["Condition #",r.index+1]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:299,columnNumber:62},void 0),e.jsxDEV("span",{className:"px-1 rounded "+(r.pass?"bg-green-600 text-white":"bg-gray-300 text-gray-700"),children:r.pass?"ACTIF":"IGNOR√â"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:299,columnNumber:122},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:299,columnNumber:19},void 0),e.jsxDEV("div",{children:["Valeur simul√©e THEN : ",e.jsxDEV("strong",{children:void 0===r.thenResult?"‚Äî":String(r.thenResult)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:300,columnNumber:46},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:300,columnNumber:19},void 0)]},r.index,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:298,columnNumber:17},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:295,columnNumber:13},void 0):e.jsxDEV("p",{className:"text-[11px] text-green-700",children:"Aucune branche THEN."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:304,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:292,columnNumber:9},void 0),e.jsxDEV("section",{className:"border rounded-md p-3 bg-orange-50 border-orange-200",children:[e.jsxDEV("h4",{className:"text-xs font-semibold uppercase text-orange-700 mb-2",children:"4. R√©sultat SINON (ELSE)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:309,columnNumber:11},void 0),a.else.length>0?e.jsxDEV(e.Fragment,{children:[e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("h5",{className:"text-[10px] font-semibold uppercase text-orange-600 mb-1",children:"Champs utilis√©s"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:312,columnNumber:37},void 0),N(a.else)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:312,columnNumber:15},void 0),c.map(r=>e.jsxDEV("div",{className:"text-[11px] bg-white border border-orange-200 rounded p-2 mb-2",children:[e.jsxDEV("div",{className:"flex justify-between mb-1",children:[e.jsxDEV("span",{className:"font-medium",children:["Condition #",r.index+1]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:315,columnNumber:62},void 0),e.jsxDEV("span",{className:"px-1 rounded "+(r.pass?"bg-gray-300 text-gray-700":"bg-orange-600 text-white"),children:r.pass?"IGNOR√â":"ACTIF"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:315,columnNumber:122},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:315,columnNumber:19},void 0),e.jsxDEV("div",{children:["Valeur simul√©e ELSE : ",e.jsxDEV("strong",{children:void 0===r.elseResult?"‚Äî":String(r.elseResult)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:316,columnNumber:46},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:316,columnNumber:19},void 0)]},r.index,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:314,columnNumber:17},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:311,columnNumber:13},void 0):e.jsxDEV("p",{className:"text-[11px] text-orange-700",children:"Aucune branche ELSE."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:320,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:308,columnNumber:9},void 0),e.jsxDEV("section",{className:"border rounded-md p-3 bg-gray-100 border-gray-300",children:[e.jsxDEV("h4",{className:"text-xs font-semibold uppercase text-gray-700 mb-2",children:"5. R√©sultat final de la formule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:325,columnNumber:11},void 0),e.jsxDEV("div",{className:"p-3 rounded-md text-sm "+(b.success?"bg-white border border-green-300":"bg-red-50 border border-red-300"),children:b.success?e.jsxDEV("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxDEV("span",{className:"font-bold text-green-700",children:"boolean"==typeof b.result?b.result?"Vrai":"Faux":b.result},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:329,columnNumber:17},void 0),e.jsxDEV("span",{className:"text-[10px] px-2 py-0.5 rounded bg-green-100 text-green-700",children:["Type: ",typeof b.result]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:330,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:328,columnNumber:15},void 0):e.jsxDEV("div",{className:"text-red-700 text-xs space-y-1",children:[e.jsxDEV("div",{children:["Erreur: ",b.error||"Erreur inconnue"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:334,columnNumber:17},void 0),b.error&&/divis/i.test(b.error)&&e.jsxDEV("div",{className:"text-[10px] text-red-600 bg-red-100/60 px-2 py-1 rounded",children:"Astuce: v√©rifiez que le d√©nominateur n'est pas 0 (ajustez les champs concern√©s ou la branche ignor√©e ne doit pas provoquer une division par 0)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:336,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:333,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:326,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:324,columnNumber:9},void 0),e.jsxDEV("details",{className:"border rounded-md p-3 bg-white border-gray-200",open:!0,children:[e.jsxDEV("summary",{className:"cursor-pointer text-xs font-semibold text-gray-700",children:"√âtapes de calcul (debug)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:347,columnNumber:11},void 0),e.jsxDEV("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-md overflow-hidden",children:e.jsxDEV("div",{className:"max-h-40 overflow-y-auto",children:e.jsxDEV("table",{className:"w-full text-left text-xs",children:[e.jsxDEV("thead",{className:"bg-gray-100",children:e.jsxDEV("tr",{children:[e.jsxDEV("th",{className:"px-2 py-1",children:"√âtape"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:92},void 0),e.jsxDEV("th",{className:"px-2 py-1",children:"Op√©ration"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:128},void 0),e.jsxDEV("th",{className:"px-2 py-1",children:"R√©sultat"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:168},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:88},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:57},void 0),e.jsxDEV("tbody",{children:b.debug.map((r,i)=>e.jsxDEV("tr",{className:i%2==0?"bg-white":"bg-gray-50",children:[e.jsxDEV("td",{className:"px-2 py-1 whitespace-nowrap",children:r.step},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:352,columnNumber:19},void 0),e.jsxDEV("td",{className:"px-2 py-1",children:r.operation},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:353,columnNumber:19},void 0),e.jsxDEV("td",{className:"px-2 py-1 font-mono",children:null===r.value?"-":"boolean"==typeof r.value?r.value?"Vrai":"Faux":r.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:354,columnNumber:19},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:351,columnNumber:17},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:220},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:349,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:348,columnNumber:94},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:348,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:346,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:252,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaEvaluator.tsx",lineNumber:243,columnNumber:5},void 0)};function tr(e,r){if(e===r)return!0;const i=function(){const e=ge.getState(),r={};return e.blocks.forEach(e=>e.sections.forEach(e=>e.fields.forEach(e=>(e.formulas||[]).forEach(e=>{if(!e)return;const i=Array.isArray(e.sequence)?e.sequence:[];r[e.id]={id:e.id,name:e.name||e.id,sequence:i,targetProperty:e.targetProperty,targetFieldId:e.targetFieldId}})))),r}(),s={};Object.values(i).forEach(e=>{const r=new Set;(e.sequence||[]).forEach(e=>{if(e&&("formula_ref"===e.type&&e.refFormulaId&&r.add(e.refFormulaId),"cond"===e.type)){const i=e=>null==e?void 0:e.forEach(e=>{"formula_ref"===(null==e?void 0:e.type)&&e.refFormulaId&&r.add(e.refFormulaId)});i(e.then),i(e.else)}}),s[e.id]=r}),s[e]||(s[e]=new Set),s[e].add(r);const t=new Set,o=[r];for(;o.length;){const r=o.pop();if(r===e)return!0;t.has(r)||(t.add(r),(s[r]||[]).forEach(e=>o.push(e)))}return!1}const or=({currentFormulaId:r})=>{const s=ge(e=>e.blocks),t=ge(e=>e.updateFormula),o=i.useMemo(()=>{const e=[];return s.forEach(i=>{i.sections.forEach(s=>{s.fields.forEach(t=>{(t.formulas||[]).forEach(o=>{o&&o.id!==r&&e.push({formula:o,field:t,section:s,block:i})})})})}),e},[s,r]);return e.jsxDEV("div",{className:"mt-4 p-2 bg-white border border-purple-200 rounded-md",children:[e.jsxDEV(q.Text,{strong:!0,children:"Formules existantes"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:72,columnNumber:7},void 0),0===o.length&&e.jsxDEV("div",{className:"text-xs text-purple-500 italic mt-1",children:"Aucune autre formule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:74,columnNumber:9},void 0),e.jsxDEV(P,{size:6,wrap:!0,className:"mt-2",children:o.map(({formula:i,field:s})=>e.jsxDEV(B,{title:`Utiliser le r√©sultat de ${i.name}`,children:e.jsxDEV(_,{icon:e.jsxDEV(ue,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:80,columnNumber:21},void 0),size:"small",onClick:()=>(e=>{const i=ge.getState();let s;for(const t of i.blocks){for(const e of t.sections){for(const i of e.fields){const e=(i.formulas||[]).find(e=>e.id===r);if(e){s=e;break}}if(s)break}if(s)break}if(!s)return;if(tr(r,e.id))return void alert("R√©f√©rence impossible: cr√©erait un cycle de d√©pendances");const o={type:"formula_ref",refFormulaId:e.id,id:`formula_ref-${e.id}-${Date.now()}`,label:e.name||e.id,value:e.id},n=[...s.sequence||[],o];t(r,{sequence:n})})(i),draggable:!0,onDragStart:e=>{e.dataTransfer.setData("formula-element-type","formula_ref"),e.dataTransfer.setData("formula-ref-id",i.id),e.dataTransfer.setData("formula-ref-label",i.name||i.id),e.dataTransfer.effectAllowed="copy"},children:[i.name||i.id,e.jsxDEV(ie,{style:{marginLeft:6},color:"purple",bordered:!1,children:s.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:92,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:79,columnNumber:13},void 0)},i.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:78,columnNumber:11},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:76,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaRefsPalette.tsx",lineNumber:71,columnNumber:5},void 0)},nr=[{value:"IF(condition, alors, sinon)",label:"IF",description:"√âvalue une condition et renvoie une valeur si vraie, une autre si fausse"},{value:"SWITCH(valeur, cas1, r√©sultat1, ...)",label:"SWITCH",description:"Compare une valeur √† plusieurs cas et renvoie le r√©sultat correspondant"},{value:"CASE(condition1, valeur1, condition2, valeur2, ..., d√©faut)",label:"CASE",description:"√âvalue plusieurs conditions dans l'ordre et renvoie la valeur correspondant √† la premi√®re vraie"},{value:"IFS(condition1, valeur1, condition2, valeur2, ..., d√©faut)",label:"IFS",description:"Version avanc√©e de IF permettant d'√©valuer plusieurs conditions en s√©quence"},{value:"ROUND(valeur, d√©cimales)",label:"ROUND",description:"Arrondit un nombre au nombre de d√©cimales sp√©cifi√©"},{value:"MIN(valeur1, valeur2, ...)",label:"MIN",description:"Renvoie la plus petite valeur parmi les arguments"},{value:"MAX(valeur1, valeur2, ...)",label:"MAX",description:"Renvoie la plus grande valeur parmi les arguments"},{value:"SUM(liste)",label:"SUM",description:"Calcule la somme des valeurs dans une liste"},{value:"AVERAGE(liste)",label:"AVERAGE",description:"Calcule la moyenne des valeurs dans une liste"},{value:"ABS(valeur)",label:"ABS",description:"Renvoie la valeur absolue d'un nombre"},{value:"CEILING(valeur, pr√©cision)",label:"CEILING",description:"Arrondit un nombre √† l'entier sup√©rieur ou au multiple sp√©cifi√©"},{value:"FLOOR(valeur, pr√©cision)",label:"FLOOR",description:"Arrondit un nombre √† l'entier inf√©rieur ou au multiple sp√©cifi√©"},{value:"POWER(base, exposant)",label:"POWER",description:"√âl√®ve un nombre √† la puissance sp√©cifi√©e"},{value:"SQRT(valeur)",label:"SQRT",description:"Calcule la racine carr√©e d'un nombre"},{value:"LENGTH(texte)",label:"LENGTH",description:"Renvoie le nombre de caract√®res dans une cha√Æne de texte"},{value:"CONCAT(valeurs...)",label:"CONCAT",description:"Concat√®ne (joint) plusieurs cha√Ænes de texte"},{value:"UPPER(texte)",label:"UPPER",description:"Convertit un texte en majuscules"},{value:"LOWER(texte)",label:"LOWER",description:"Convertit un texte en minuscules"},{value:"TRIM(texte)",label:"TRIM",description:"Supprime les espaces au d√©but et √† la fin d'un texte"},{value:"SUBSTRING(texte, d√©but, longueur)",label:"SUBSTRING",description:"Extrait une partie d'une cha√Æne de texte"},{value:"REPLACE(texte, ancien, nouveau)",label:"REPLACE",description:"Remplace toutes les occurrences d'un texte par un autre"},{value:"NOW()",label:"NOW",description:"Renvoie la date et l'heure actuelles"},{value:"DATE_DIFF(date1, date2)",label:"DATE_DIFF",description:"Calcule la diff√©rence entre deux dates en jours"},{value:"TODAY()",label:"TODAY",description:"Renvoie la date du jour (sans l'heure)"},{value:"FORMAT_DATE(date, format)",label:"FORMAT_DATE",description:"Formate une date selon le mod√®le sp√©cifi√©"},{value:"ADD_DAYS(date, jours)",label:"ADD_DAYS",description:"Ajoute un nombre de jours √† une date"},{value:"ADD_MONTHS(date, mois)",label:"ADD_MONTHS",description:"Ajoute un nombre de mois √† une date"},{value:"YEAR(date)",label:"YEAR",description:"Extrait l'ann√©e d'une date"},{value:"MONTH(date)",label:"MONTH",description:"Extrait le mois d'une date"},{value:"DAY(date)",label:"DAY",description:"Extrait le jour d'une date"},{value:"IS_EMPTY(champ)",label:"IS_EMPTY",description:"V√©rifie si un champ est vide (null, undefined, cha√Æne vide)"},{value:"IS_NULL(valeur)",label:"IS_NULL",description:"V√©rifie si une valeur est null ou undefined"},{value:"IS_NUMBER(valeur)",label:"IS_NUMBER",description:"V√©rifie si une valeur est un nombre"},{value:"IS_TEXT(valeur)",label:"IS_TEXT",description:"V√©rifie si une valeur est une cha√Æne de texte"},{value:"IS_BOOLEAN(valeur)",label:"IS_BOOLEAN",description:"V√©rifie si une valeur est un bool√©en (vrai/faux)"},{value:"IS_DATE(valeur)",label:"IS_DATE",description:"V√©rifie si une valeur est une date valide"},{value:"LOOKUP(table, cl√©)",label:"LOOKUP",description:"Recherche une valeur dans une table de r√©f√©rence √† partir d'une cl√©"},{value:"INDEX(liste, position)",label:"INDEX",description:"Renvoie l'√©l√©ment √† une position sp√©cifique dans une liste"},{value:"FILTER(liste, condition)",label:"FILTER",description:"Filtre une liste selon une condition"},{value:"COUNT(liste)",label:"COUNT",description:"Compte le nombre d'√©l√©ments dans une liste"},{value:"IN(valeur, liste)",label:"IN",description:"V√©rifie si une valeur existe dans une liste"},{value:"DISTINCT(liste)",label:"DISTINCT",description:"Renvoie les valeurs uniques d'une liste"},{value:"TRUE()",label:"TRUE",description:"Renvoie la valeur bool√©enne vrai"},{value:"FALSE()",label:"FALSE",description:"Renvoie la valeur bool√©enne faux"},{value:"NULL()",label:"NULL",description:"Renvoie une valeur nulle"},{value:"BLANK()",label:"BLANK",description:"Renvoie une valeur vide"},{value:"PI()",label:"PI",description:"Renvoie la valeur de œÄ (pi)"},{value:"E()",label:"E",description:"Renvoie la valeur de e (nombre d'Euler)"}],lr=i.memo(({formulaId:r,formula:s})=>{const t=i.useCallback(e=>{if(!r)return;if(!s)return;if(!ke(s,"FunctionsPalette").isValid)return;const i={type:"function",id:`function-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,value:e,label:e.split("(")[0]},t=Ae(),o=[...(s&&Array.isArray(s.sequence)?s.sequence:[]).map(e=>e.id?e:{...e,id:`auto-fix-${e.type||"item"}-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}),i],n=Oe({...s,sequence:o},"FunctionsPalette");fetch(`/api/formulas/${r}`,{method:"PUT",headers:t,body:JSON.stringify({id:r,name:s.name||"Nouvelle formule",sequence:n.sequence})}).then(e=>{e.ok&&setTimeout(()=>{const e=new CustomEvent("formula-updated",{detail:{formulaId:r,success:!0}});document.dispatchEvent(e)},300)}).catch(e=>{})},[r,s]),o=(r,i)=>e.jsxDEV(B,{title:e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-semibold",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:175,columnNumber:51},void 0),e.jsxDEV("div",{className:"opacity-80 text-xs",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:175,columnNumber:100},void 0),e.jsxDEV("div",{className:"mt-1 text-[11px] font-mono",children:r.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:175,columnNumber:160},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:175,columnNumber:46},void 0),children:e.jsxDEV(_,{size:"small",icon:i,onClick:()=>t(r.value),draggable:!0,onDragStart:e=>{e.dataTransfer.setData("function-value",r.value),e.dataTransfer.setData("function-label",r.label),e.dataTransfer.setData("formula-element-type","function"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy",document.querySelectorAll(".formula-drop-zone").forEach(e=>e.classList.add("drop-target-highlight"))},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:176,columnNumber:17},void 0)},r.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:175,columnNumber:13},void 0);return e.jsxDEV("div",{className:"mt-2 p-2 bg-white rounded-md border border-gray-200",children:[e.jsxDEV("p",{className:"text-sm font-medium mb-2",children:"Fonctions avanc√©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:196,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(de,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:200,columnNumber:101},void 0)," Conditionnelles"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:200,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>e.value.startsWith("IF")||e.value.startsWith("SWITCH")||e.value.startsWith("CASE")||e.value.startsWith("IFS")).map(r=>o(r,e.jsxDEV(de,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:203,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:201,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:199,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:209,columnNumber:101},void 0)," Math√©matiques"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:209,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>["ROUND","MIN","MAX","SUM","AVERAGE","ABS","CEILING","FLOOR","POWER","SQRT"].includes(e.label)).map(r=>o(r,e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:212,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:210,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:208,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(I,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:218,columnNumber:101},void 0)," Texte"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:218,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>["LENGTH","CONCAT","UPPER","LOWER","TRIM","SUBSTRING","REPLACE"].includes(e.label)).map(r=>o(r,e.jsxDEV(I,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:221,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:219,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:217,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(M,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:227,columnNumber:101},void 0)," Date & heure"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:227,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>["NOW","DATE_DIFF","TODAY","FORMAT_DATE","ADD_DAYS","ADD_MONTHS","YEAR","MONTH","DAY"].includes(e.label)).map(r=>o(r,e.jsxDEV(M,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:230,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:228,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:226,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(R,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:236,columnNumber:101},void 0)," V√©rifications"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:236,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>e.label.startsWith("IS_")).map(r=>o(r,e.jsxDEV(R,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:238,columnNumber:101},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:237,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:235,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1 flex items-center gap-1",children:[e.jsxDEV(pe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:244,columnNumber:101},void 0)," Recherche & agr√©gation"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:244,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>["LOOKUP","INDEX","FILTER","COUNT","IN","DISTINCT"].includes(e.label)).map(r=>o(r,e.jsxDEV(pe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:247,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:245,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:243,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-xs font-medium text-gray-500 mb-1",children:"Constantes"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:253,columnNumber:21},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:nr.filter(e=>["TRUE","FALSE","NULL","BLANK","PI","E"].includes(e.label)).map(r=>o(r,e.jsxDEV(ne,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:256,columnNumber:56},void 0)))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:254,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:252,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FunctionsPalette.tsx",lineNumber:195,columnNumber:13},void 0)}),ar=()=>e.jsxDEV("div",{className:"mt-4 p-2 bg-white border border-green-200 rounded-md",children:[e.jsxDEV(q.Text,{strong:!0,children:"Bloc Condition"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:15,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-2",children:e.jsxDEV(B,{title:"Glisser pour cr√©er un bloc condition (IF/ALORS/SINON)",children:e.jsxDEV(_,{icon:e.jsxDEV(de,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:18,columnNumber:25},void 0),size:"small",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("formula-element-type","cond"),e.dataTransfer.setData("cond-kind","expr"),e.dataTransfer.effectAllowed="copy"},children:"Condition (IF)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:18,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:17,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:16,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-2 text-[10px] text-green-700 leading-snug",children:"Apr√®s d√©p√¥t: glissez op√©randes (champs / formules / parties) et op√©rateurs (=, >, <, etc.) dans la ligne de condition."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:23,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ConditionBlockPalette.tsx",lineNumber:14,columnNumber:5},void 0),mr=i.memo(({formulaId:r,formula:s})=>{const[t,n]=i.useState(""),[l,a]=i.useState("auto"),[m,d]=i.useState(""),[c,u]=i.useState(!1),[p,v]=i.useState("sequence"),[b,N]=i.useState(void 0),x=i.useMemo(()=>s&&Array.isArray(s.sequence)?s.sequence.filter(e=>e&&"cond"===e.type):[],[s]);o.useEffect(()=>{b&&!x.some(e=>e.id===b)&&N(void 0)},[x,b]);const f=i.useCallback(e=>{if("string"===l)return"string";if("number"===l)return"number";const r=e.trim();return/^-?\d+(\.\d+)?%$/.test(r)||/^-?\d+(\.\d+)?$/.test(r)?"number":"string"},[l]),D=i.useCallback(()=>{var e;if(c)return;if(!r||!s)return void d("Formule indisponible");const i=t.trim();if(!i)return void d("Valeur vide");const o=s.fieldId||s.targetFieldId;if(!o)return void d("fieldId manquant");const l=f(i),a=(Array.isArray(s.sequence)?[...s.sequence]:[]).map((e,r)=>e.id?e:{...e,id:`auto-${e.type||"item"}-${r}-${Date.now()}`}),m={type:"value",value:i,label:i,id:`val-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,valueType:l};let v=a;if("sequence"===p)v=[...a,m];else{const r=b||(null==(e=x[0])?void 0:e.id);if(!r)return void d("Pas de condition");v=a.map(e=>{if(e.id!==r)return e;const i={...e};return"expr"===p?i.condExpr=[...i.condExpr||[],m]:"then"===p?i.then=[...i.then||[],m]:"else"===p&&(i.else=[...i.else||[],m]),i})}ke({...s,sequence:v},"ValueConstantsPalette"),u(!0),d("Envoi..."),fetch(`/api/fields/${o}/formulas/${r}`,{method:"PUT",headers:Ae(),body:JSON.stringify({id:r,name:s.name||"Nouvelle formule",sequence:v})}).then(e=>{if(!e.ok)throw new Error(e.statusText||"Bad Request");d("Ajout√©"),n(""),document.dispatchEvent(new CustomEvent("formula-updated",{detail:{formulaId:r,isEssential:!0,action:"add"}})),setTimeout(()=>d(""),1500)}).catch(e=>{d("Erreur API")}).finally(()=>u(!1))},[c,r,s,t,f,p,b,x]),h=f(t);return e.jsxDEV("div",{className:"mt-2 p-2 bg-white rounded-md border border-gray-200",children:[e.jsxDEV("p",{className:"text-sm font-medium mb-2",children:["Constantes ",e.jsxDEV("span",{className:"text-[10px] text-gray-500",children:"(nombres, % ou texte)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:107,columnNumber:58},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:107,columnNumber:7},void 0),e.jsxDEV(P,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxDEV(P.Compact,{style:{width:"100%"},children:[e.jsxDEV(L,{placeholder:"Ex: 1.2 ou 15% ou kWh",value:t,onChange:e=>n(e.target.value),onPressEnter:D},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:110,columnNumber:11},void 0),e.jsxDEV($,{value:l,onChange:e=>a(e),style:{width:120},options:[{value:"auto",label:"Auto"},{value:"number",label:"Nombre"},{value:"string",label:"Texte"}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:116,columnNumber:11},void 0),e.jsxDEV(_,{type:"primary",disabled:!t.trim()||!r||c,onClick:D,children:c?"...":"Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:122,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:109,columnNumber:9},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:["Type d√©duit: ",e.jsxDEV("span",{className:"font-semibold",children:h},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:124,columnNumber:61},void 0)," ",m&&e.jsxDEV("span",{className:"ml-2 text-gray-700",children:m},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:124,columnNumber:132},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:124,columnNumber:9},void 0),e.jsxDEV(P,{size:6,wrap:!0,children:[t.trim()&&e.jsxDEV(B,{title:"Glisser pour d√©poser la constante",children:e.jsxDEV(ie,{color:"default",style:{cursor:"grab"},draggable:!0,onDragStart:e=>{const r=t.trim();e.dataTransfer.setData("formula-element-type","value"),e.dataTransfer.setData("value-value",r),e.dataTransfer.setData("value-label",r),e.dataTransfer.setData("value-valueType",h),e.dataTransfer.effectAllowed="copy"},children:t.trim()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:128,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:127,columnNumber:13},void 0),["0","1","100","10%","50%"].map(r=>e.jsxDEV(_,{size:"small",onClick:()=>n(r),children:r},r,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:144,columnNumber:13},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:125,columnNumber:9},void 0),x.length>0&&e.jsxDEV("div",{className:"flex flex-wrap items-center gap-2 text-[10px] text-gray-600",children:[e.jsxDEV("span",{children:"Destination:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:149,columnNumber:13},void 0),e.jsxDEV($,{size:"small",value:p,onChange:e=>v(e),options:[{value:"sequence",label:"S√©quence"},{value:"expr",label:"Condition (SI)"},{value:"then",label:"ALORS"},{value:"else",label:"SINON"}],style:{width:140}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:150,columnNumber:13},void 0),"sequence"!==p&&x.length>1&&e.jsxDEV($,{size:"small",value:b||"",onChange:e=>N(e||void 0),style:{minWidth:160},options:[{value:"",label:"(1√®re condition)"},...x.map(e=>({value:e.id,label:e.label||e.id}))]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:152,columnNumber:15},void 0),"sequence"!==p&&1===x.length&&e.jsxDEV("span",{className:"italic opacity-60",children:x[0].label||"Condition"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:156,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:148,columnNumber:11},void 0),e.jsxDEV("div",{className:"text-[10px] text-gray-400 leading-snug",children:"Drag & drop possible du tag ou cliquez sur Ajouter pour ins√©rer. Auto d√©tecte nombre/%/texte. ‚Äú15%‚Äù devient 0.15."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:160,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:108,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/ValueConstantsPalette.tsx",lineNumber:106,columnNumber:5},void 0)}),dr=({title:r,defaultOpen:s=!1,small:t,children:o})=>{const[n,l]=i.useState(s);return e.jsxDEV("div",{className:"border border-gray-200 rounded-md bg-white shadow-xs w-full",children:[e.jsxDEV("button",{type:"button",onClick:()=>l(e=>!e),className:`flex items-center justify-start w-full ${t?"px-2 py-1":"px-3 py-2"} text-left bg-gray-50 hover:bg-gray-100 rounded-t-md`,children:e.jsxDEV("span",{className:"font-semibold text-xs text-gray-700 flex items-center gap-1",children:[e.jsxDEV(ve,{className:"transition-transform "+(n?"rotate-90":""),style:{fontSize:10,lineHeight:1}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/CollapsiblePanel.tsx",lineNumber:20,columnNumber:11},void 0),r]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/CollapsiblePanel.tsx",lineNumber:19,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/CollapsiblePanel.tsx",lineNumber:14,columnNumber:7},void 0),n&&e.jsxDEV("div",{className:`p-2 ${t?"text-[11px]":"text-sm"} overflow-x-auto`,children:[" ",o," "]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/CollapsiblePanel.tsx",lineNumber:25,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/CollapsiblePanel.tsx",lineNumber:13,columnNumber:5},void 0)},cr=({formula:r,isOpen:s,isExpanded:t,onToggleOpen:o,onToggleExpand:n,onDelete:l,onUpdate:a})=>{const m=void 0!==t?t:s,d=n||o,c=!r||!r.id,u=r.name||"Nouvelle formule",[p,v]=i.useState(u),[b,N]=i.useState("edit");i.useEffect(()=>{r&&r.name&&v(r.name)},[r]);const x=()=>{if(r&&r.id&&p!==r.name){if(!ke(r,"FormulaItemEditor").isValid)return;const e={id:r.id,name:p,sequence:r.sequence||[],targetProperty:r.targetProperty,expression:r.expression,targetFieldId:r.targetFieldId,fieldId:r.fieldId||r.targetFieldId},i=Ae(),s=r.fieldId||r.targetFieldId;if(!s)return;const t=`/api/fields/${s}/formulas/${r.id}`;fetch(t,{method:"PUT",headers:i,body:JSON.stringify(e)}).then(async e=>{if(e.ok){const e=new CustomEvent("formula-updated",{detail:{formulaId:r.id,success:!0,action:"rename"}});document.dispatchEvent(e),a&&a({...r,name:p})}else{let r="";try{const i=await e.json();r=i.error||i.message||""}catch{}const i=document.createElement("div");i.className="fixed bottom-4 right-4 bg-red-100 text-red-800 p-2 rounded shadow z-50",i.innerText=`Erreur de sauvegarde: ${e.statusText}${r?`\n${r}`:""}`,document.body.appendChild(i),setTimeout(()=>i.remove(),5e3)}}).catch(e=>{})}},f=e=>{const i=new CustomEvent("formula-toolbar-insert",{detail:{type:"operator",value:e,label:e,formulaId:r.id}});document.dispatchEvent(i)};return c?e.jsxDEV("div",{className:"p-2 bg-red-50 text-red-800 text-xs rounded border border-red-200",children:"Erreur: Formule invalide ou corrompue"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:161,columnNumber:12},void 0):e.jsxDEV(G,{size:"small",title:e.jsxDEV("div",{className:"flex items-center gap-2 cursor-pointer select-none",onClick:d,children:[e.jsxDEV("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:"#1677ff"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:170,columnNumber:11},void 0),e.jsxDEV("span",{className:"font-medium",children:r.name||"Formule sans nom"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:171,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:169,columnNumber:9},void 0),extra:e.jsxDEV(be,{title:"Supprimer cette formule ?",okText:"Oui",cancelText:"Non",onConfirm:()=>{l()},children:e.jsxDEV(_,{size:"small",danger:!0,icon:e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:181,columnNumber:45},void 0),onClick:e=>e.stopPropagation()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:181,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:175,columnNumber:9},void 0),styles:{header:{background:"#fafafa",borderBottom:"1px solid #f0f0f0",padding:"8px 12px"},body:{padding:12,background:"#f8fafc"}},style:{borderLeft:"4px solid #1677ff",marginBottom:8},children:m&&e.jsxDEV("div",{children:e.jsxDEV("div",{className:"flex flex-col gap-4 max-w-full",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Nom de la formule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:194,columnNumber:17},void 0),e.jsxDEV("form",{onSubmit:e=>{e.preventDefault(),x()},children:e.jsxDEV("div",{className:"flex gap-2",children:e.jsxDEV("input",{type:"text",value:p,onChange:e=>v(e.target.value),onBlur:x,onKeyDown:e=>"Enter"===e.key&&x(),placeholder:"Nom de la formule",className:"input input-bordered input-sm w-full "+(r.name!==p?"border-blue-500 bg-blue-50":""),autoComplete:"off"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:200,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:199,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:195,columnNumber:17},void 0),r.name!==p&&e.jsxDEV("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsxDEV("span",{className:"font-bold",children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:214,columnNumber:21},void 0)," Appuyez sur Entr√©e ou cliquez ailleurs pour sauvegarder le nom"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:213,columnNumber:19},void 0),r.name===p&&p&&e.jsxDEV("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsxDEV("span",{className:"font-bold",children:"‚úì"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:219,columnNumber:21},void 0)," Nom actuel: ",p]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:218,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:193,columnNumber:15},void 0),e.jsxDEV("div",{className:"w-full max-w-full",children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Construction"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:224,columnNumber:17},void 0),e.jsxDEV("div",{className:"mb-2",children:e.jsxDEV(P,{size:6,wrap:!0,children:[e.jsxDEV(B,{title:"Constante 0",children:e.jsxDEV(_,{size:"small",shape:"circle",onClick:()=>{const e=new CustomEvent("formula-toolbar-insert",{detail:{type:"value",value:"0",label:"0",formulaId:r.id}});document.dispatchEvent(e)},draggable:!0,onDragStart:e=>{e.dataTransfer.setData("formula-element-type","value"),e.dataTransfer.setData("value-value","0"),e.dataTransfer.setData("value-label","0"),e.dataTransfer.effectAllowed="copy"},children:"0"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:230,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:229,columnNumber:21},void 0),[{v:"+",t:"Addition"},{v:"-",t:"Soustraction"},{v:"*",t:"Multiplication"},{v:"/",t:"Division"}].map(i=>e.jsxDEV(B,{title:i.t,children:e.jsxDEV(_,{size:"small",shape:"circle",onClick:()=>{const e=new CustomEvent("formula-toolbar-insert",{detail:{type:"operator",value:i.v,label:i.v,formulaId:r.id}});document.dispatchEvent(e)},draggable:!0,onDragStart:e=>{e.dataTransfer.setData("formula-element-type","operator"),e.dataTransfer.setData("operator-value",i.v),e.dataTransfer.setData("operator-label",i.v),e.dataTransfer.effectAllowed="copy"},children:i.v},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:257,columnNumber:25},void 0)},`op-btn-${i.v}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:256,columnNumber:23},void 0)),e.jsxDEV(K,{menu:{items:[{key:"eq",label:"==",onClick:()=>f("==")},{key:"seq",label:"===",onClick:()=>f("===")},{key:"neq",label:"!=",onClick:()=>f("!=")},{key:"sneq",label:"!==",onClick:()=>f("!==")},{key:"gt",label:">",onClick:()=>f(">")},{key:"lt",label:"<",onClick:()=>f("<")},{key:"gte",label:">=",onClick:()=>f(">=")},{key:"lte",label:"<=",onClick:()=>f("<=")}]},trigger:["click"],children:e.jsxDEV(B,{title:"Op√©rateurs de comparaison",children:e.jsxDEV(_,{size:"small",children:["Comp ",e.jsxDEV(H,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:294,columnNumber:51},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:294,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:293,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:278,columnNumber:21},void 0),e.jsxDEV(K,{menu:{items:[{key:"and",label:"&&",onClick:()=>f("&&")},{key:"or",label:"||",onClick:()=>f("||")},{key:"not",label:"!",onClick:()=>f("!")},{key:"ternary",label:"?:",onClick:()=>f("?:")},{key:"nullish",label:"??",onClick:()=>f("??")}]},trigger:["click"],children:e.jsxDEV(B,{title:"Op√©rateurs logiques",children:e.jsxDEV(_,{size:"small",children:["Log ",e.jsxDEV(H,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:312,columnNumber:50},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:312,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:311,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:299,columnNumber:21},void 0),e.jsxDEV(B,{title:"Vider la s√©quence",children:e.jsxDEV(_,{size:"small",shape:"circle",danger:!0,onClick:()=>{if(window.confirm("Vider la s√©quence de cette formule ?")){const e=new CustomEvent("formula-toolbar-clear",{detail:{formulaId:r.id}});document.dispatchEvent(e)}},draggable:!0,onDragStart:e=>e.preventDefault(),icon:e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:330,columnNumber:31},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:318,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:317,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:227,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:226,columnNumber:17},void 0),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 bg-blue-500/90 text-white px-3 py-1 rounded-full text-xs font-medium pointer-events-none shadow-sm",style:{zIndex:1},children:"Zone de d√©p√¥t"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:336,columnNumber:19},void 0),e.jsxDEV(Xe,{formula:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:339,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:335,columnNumber:17},void 0),r&&r.id&&e.jsxDEV("div",{className:"grid grid-cols-2 gap-2 mt-4 items-start content-start",children:[e.jsxDEV("div",{className:"flex flex-col gap-2",children:[e.jsxDEV(dr,{title:"Op√©rateurs disponibles",small:!0,children:e.jsxDEV(er,{formulaId:r.id,formula:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:348,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:347,columnNumber:23},void 0),e.jsxDEV(dr,{title:"Formules existantes",small:!0,children:e.jsxDEV(or,{currentFormulaId:r.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:352,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:351,columnNumber:23},void 0),e.jsxDEV(dr,{title:"Constantes (nombres / texte)",small:!0,children:e.jsxDEV(mr,{formulaId:r.id,formula:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:356,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:355,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:345,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex flex-col gap-2",children:[e.jsxDEV(dr,{title:"Fonctions avanc√©es",small:!0,children:e.jsxDEV(lr,{formulaId:r.id,formula:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:363,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:362,columnNumber:23},void 0),e.jsxDEV(dr,{title:"Bloc Condition (IF)",small:!0,children:e.jsxDEV(ar,{formulaId:r.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:367,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:366,columnNumber:23},void 0),e.jsxDEV(dr,{title:"Tester",small:!0,children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:e.jsxDEV("button",{className:"px-2 py-1 text-xs rounded "+("test"===b?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),onClick:()=>N("test"===b?"edit":"test"),children:"test"===b?"Masquer":"Ouvrir test"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:372,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:371,columnNumber:25},void 0),"test"===b&&e.jsxDEV(sr,{formula:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:377,columnNumber:49},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:370,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:360,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:343,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:223,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:192,columnNumber:12},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:191,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FormulaItemEditor.tsx",lineNumber:166,columnNumber:5},void 0)};function ur({title:e,titleId:r,...s},t){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),e?i.createElement("title",{id:r},e):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const pr=i.forwardRef(ur),vr=({fieldId:r})=>{const[s,t]=i.useState([]),[o,n]=i.useState(!0),[l,a]=i.useState(null),[m,d]=i.useState([]),{fetchBlocks:c,createFormula:u}=ge(),p=i.useCallback(()=>{const e=ge.getState().blocks;for(const i of e)for(const e of i.sections){const i=e.fields.find(e=>e.id===r);if(i)return i.formulas||[]}return[]},[r]),v=i.useCallback(async e=>{n(!0),a(null);try{if(null==e?void 0:e.bypassStore){const e=Ae();let o=0,n=[];for(;o<2;)try{const i=await fetch(`/api/fields/${r}/formulas`,{headers:e,cache:"no-cache"});if(!i.ok)throw new Error(`Erreur HTTP ${i.status}`);n=await i.json();break}catch(i){o++}const l=n.filter(e=>{const i=String(e.fieldId||e.targetFieldId)===String(r);return i}).map(e=>({...e,targetProperty:e.targetProperty||"",fieldId:r}));t(l);try{await c()}catch(s){}return l}{await c();const e=p();if(0===e.length)return v({bypassStore:!0});const i=e.filter(e=>String(e.fieldId||e.targetFieldId)===String(r));return i.length,e.length,t(i),i}}catch(o){a("Impossible de charger les formules")}finally{n(!1)}},[r,c,p]);i.useEffect(()=>{(async()=>{await v({bypassStore:!0});d([])})();let e=0;const i=async i=>{const s=i.detail,t=null==s?void 0:s.fieldId;if(t&&t!==r)return;e++;const o=e;try{await v({bypassStore:!0}),o===e&&await v({bypassStore:!0})}catch(n){}},s=async r=>{const i=r.detail;if((null==i?void 0:i.isDragEvent)||(null==i?void 0:i.isEssential))return(null==i?void 0:i.forceLocal)?void((null==i?void 0:i.formulaId)&&d(e=>e.includes(i.formulaId)?e:[...e,i.formulaId])):void(await v({bypassStore:!0}));e++;const s=e;try{await v({bypassStore:!0});(null==i?void 0:i.formulaId)&&d(e=>e.includes(i.formulaId)?e:[...e,i.formulaId]),s===e&&await v({bypassStore:!0})}catch(o){}if("delete"===(null==i?void 0:i.action)){(null==i?void 0:i.formulaId)&&"number"==typeof(null==i?void 0:i.index)&&t(e=>e.map(e=>{if(e.id===i.formulaId){const r=[...Array.isArray(e.sequence)?e.sequence:[]];return i.index<r.length&&r.splice(i.index,1),{...e,sequence:r}}return e}));try{const e=await v({bypassStore:!0});if(e&&e.length>0){const r=e.map(e=>e.id);d(r)}else d([])}catch(o){}}else await v({bypassStore:!0})};return document.addEventListener("formula-updated",s),document.addEventListener("formula-force-reload",i),()=>{document.removeEventListener("formula-updated",s),document.removeEventListener("formula-force-reload",i)}},[r,v]);return e.jsxDEV("div",{className:"bg-white shadow-sm rounded-md p-4",children:[e.jsxDEV("h3",{className:"text-lg font-medium mb-4",children:"Formules de calcul"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:433,columnNumber:7},void 0),l&&e.jsxDEV("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded-md mb-4 flex justify-between items-center",children:[e.jsxDEV("div",{children:l},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:437,columnNumber:11},void 0),e.jsxDEV("button",{onClick:()=>a(null),className:"text-red-500 hover:text-red-700",children:"√ó"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:438,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:436,columnNumber:9},void 0),o?e.jsxDEV("div",{className:"flex justify-center my-8",children:e.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:449,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:448,columnNumber:9},void 0):e.jsxDEV("div",{className:"space-y-4",children:[0===s.length?e.jsxDEV("div",{className:"text-center py-8 text-gray-500",children:"Aucune formule n'est d√©finie pour ce champ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:454,columnNumber:13},void 0):s.map(i=>e.jsxDEV("div",{className:"border rounded-md",children:e.jsxDEV(cr,{formula:i,isExpanded:m.includes(i.id),onToggleExpand:()=>{return e=i.id,void(m.includes(e)?d(m.filter(r=>r!==e)):d([...m,e]));var e},onDelete:()=>(async e=>{try{const i=Ae(),o=await fetch(`/api/formulas/${e}`,{method:"DELETE",headers:i});if(!o.ok)throw new Error(`Erreur API lors de la suppression: ${o.statusText}`);t(s.filter(r=>r.id!==e)),d(m.filter(r=>r!==e)),document.dispatchEvent(new CustomEvent("formula-force-reload",{detail:{fieldId:r}}))}catch(i){a("Impossible de supprimer la formule")}})(i.id),onUpdate:e=>(e=>{t(r=>r.map(r=>r.id===e.id?{...r,...e}:r))})(e),onFormulaChange:v},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:460,columnNumber:17},void 0)},i.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:459,columnNumber:15},void 0)),e.jsxDEV("div",{className:"mt-4",children:e.jsxDEV("button",{onClick:async()=>{try{if(!r)return;const e={name:`Nouvelle formule ${s.length+1}`,sequence:[],targetProperty:"",fieldId:r},i=await u(r,e);if(i){const r={...e,...i};t([...s,r]),d([...m,i.id])}}catch(e){a("Impossible de cr√©er la formule")}},className:"w-full flex items-center justify-center py-2 px-4 border border-gray-300 \r\n                       rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 \r\n                       hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsxDEV(pr,{className:"h-5 w-5 mr-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:479,columnNumber:15},void 0),"Ajouter une formule"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:473,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:472,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:452,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/formulas/FieldFormulasEditorNew.tsx",lineNumber:432,columnNumber:5},void 0)},br=[{value:"required",label:"Obligatoire",category:"simple",description:"V√©rifie que le champ n'est pas vide",example:"Le champ nom doit √™tre rempli",function:"IS_REQUIRED(valeur)"},{value:"min_value",label:"Valeur Min",category:"simple",description:"V√©rifie qu'une valeur num√©rique est sup√©rieure ou √©gale √† un minimum",example:"Le prix doit √™tre sup√©rieur ou √©gal √† 0",function:"valeur >= min"},{value:"max_value",label:"Valeur Max",category:"simple",description:"V√©rifie qu'une valeur num√©rique est inf√©rieure ou √©gale √† un maximum",example:"La quantit√© doit √™tre inf√©rieure ou √©gale √† 100",function:"valeur <= max"},{value:"between",label:"Entre",category:"simple",description:"V√©rifie qu'une valeur est comprise entre deux bornes",example:"La temp√©rature doit √™tre entre 15 et 30 degr√©s",function:"BETWEEN(valeur, min, max)"},{value:"compare_fields",label:"Comparer Champs",category:"simple",description:"Compare la valeur avec celle d'un autre champ",example:"La date de fin doit √™tre post√©rieure √† la date de d√©but",function:"valeur1 OPERATOR valeur2"},{value:"min_length",label:"Longueur Min",category:"simple",description:"V√©rifie que la longueur du texte est sup√©rieure ou √©gale √† un minimum",example:"Le mot de passe doit contenir au moins 8 caract√®res",function:"LENGTH(valeur) >= min_length"},{value:"max_length",label:"Longueur Max",category:"simple",description:"V√©rifie que la longueur du texte est inf√©rieure ou √©gale √† un maximum",example:"La description ne doit pas d√©passer 500 caract√®res",function:"LENGTH(valeur) <= max_length"},{value:"is_number",label:"Est un nombre",category:"type",description:"V√©rifie que la valeur est un nombre valide",example:"42, 3.14, -5",function:"IS_NUMBER(valeur)"},{value:"is_text",label:"Est du texte",category:"type",description:"V√©rifie que la valeur est une cha√Æne de texte",example:"Tout texte",function:"IS_TEXT(valeur)"},{value:"is_date",label:"Est une date",category:"type",description:"V√©rifie que la valeur est une date valide",example:"14/07/2025",function:"IS_DATE(valeur)"},{value:"is_boolean",label:"Est un bool√©en",category:"type",description:"V√©rifie que la valeur est un bool√©en (vrai/faux)",example:"true, false",function:"IS_BOOLEAN(valeur)"},{value:"is_null",label:"Est null",category:"logique",description:"V√©rifie si la valeur est null",example:"Le champ doit √™tre explicitement null",function:"IS_NULL(valeur)"},{value:"is_empty",label:"Est vide",category:"logique",description:"V√©rifie si la valeur est vide (cha√Æne vide, tableau vide, etc.)",example:"Le champ ne doit contenir aucune valeur",function:"IS_EMPTY(valeur)"},{value:"in_list",label:"Dans la liste",category:"logique",description:"V√©rifie si la valeur est pr√©sente dans une liste de valeurs autoris√©es",example:'Le statut doit √™tre "En cours", "Termin√©" ou "En attente"',function:"IN(valeur, liste_autoris√©e)"},{value:"not_in_list",label:"Pas dans la liste",category:"logique",description:"V√©rifie que la valeur n'est pas dans une liste de valeurs interdites",example:"Le mot de passe ne doit pas contenir de mots interdits",function:"NOT_IN(valeur, liste_interdite)"},{value:"regex",label:"Regex",category:"format",description:"V√©rifie que la valeur correspond √† un motif d'expression r√©guli√®re",example:"Format: lettres, chiffres et tirets uniquement",function:"MATCH(valeur, pattern)"},{value:"email",label:"Email",category:"format",description:"V√©rifie que la valeur est une adresse email valide",example:"exemple@domaine.com",function:"IS_EMAIL(valeur)"},{value:"phone",label:"T√©l√©phone",category:"format",description:"V√©rifie que la valeur est un num√©ro de t√©l√©phone valide",example:"+33 6 12 34 56 78",function:"IS_PHONE(valeur)"},{value:"iban",label:"IBAN",category:"format",description:"V√©rifie que la valeur est un num√©ro IBAN valide",example:"FR76 3000 6000 0112 3456 7890 189",function:"IS_IBAN(valeur)"},{value:"vat",label:"TVA",category:"format",description:"V√©rifie que la valeur est un num√©ro de TVA valide",example:"FR12345678901",function:"IS_TVA(valeur, pays)"},{value:"postal_code",label:"Code Postal",category:"format",description:"V√©rifie que la valeur est un code postal valide selon le pays s√©lectionn√©",example:"75001 (France) ou 1000 (Belgique)",function:"IS_POSTAL_CODE(valeur, pays)"},{value:"conditional",label:"Conditionnelle",category:"advanced",description:"Applique une validation uniquement si une condition est remplie",example:"Si Pays = Belgique, alors Code postal = 4 chiffres"},{value:"blacklist",label:"Liste noire",category:"advanced",description:"V√©rifie que la valeur ne figure pas dans une liste de valeurs interdites",example:'Le mot de passe ne doit pas contenir "password", "123456", etc.'},{value:"cross_field",label:"Multi-champ",category:"advanced",description:"Validation qui implique plusieurs champs en m√™me temps",example:"Montant pay√© doit √™tre inf√©rieur ou √©gal au total d√ª"}],Nr=i.memo(({validationId:r,fieldId:s,onAddValidation:t})=>{const o=i.useCallback(e=>{if(!s)return;if(t)return void t(e);const r=je();fetch("/api/validations",{method:"POST",headers:r,body:JSON.stringify({fieldId:s,type:e,message:`Validation ${e}`,active:!0})}).then(e=>{e.ok&&setTimeout(()=>{const e=new CustomEvent("validation-updated",{detail:{fieldId:s,success:!0}});document.dispatchEvent(e)},300)}).catch(e=>{})},[s,t]),n=br.filter(e=>"simple"===e.category),l=br.filter(e=>"type"===e.category),a=br.filter(e=>"logique"===e.category),m=br.filter(e=>"format"===e.category),d=br.filter(e=>"advanced"===e.category);return e.jsxDEV("div",{className:"mt-2 p-2 bg-gray-50 rounded-md border border-gray-200",children:[e.jsxDEV("p",{className:"text-sm font-semibold mb-3 text-blue-700",children:"Types de validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:279,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("p",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"üéØ V√©rifications de valeur simple"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:283,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:n.map(r=>e.jsxDEV("div",{className:"relative group",children:[e.jsxDEV("button",{type:"button",className:"px-2 py-1 bg-green-100 border border-green-300 rounded text-xs hover:bg-green-200 text-green-800 shadow-sm",onClick:()=>o(r.value),draggable:"true",title:r.label,onDragStart:e=>{const i={type:"validation",id:r.value,value:r.value,label:r.label,category:r.category};e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("validation-type",r.value),e.dataTransfer.setData("validation-label",r.label),e.dataTransfer.setData("element-type","validation"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy"},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:287,columnNumber:29},void 0),e.jsxDEV("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 max-w-xs pointer-events-none z-10 shadow-lg",children:[e.jsxDEV("p",{className:"font-bold mb-1 text-green-300",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:314,columnNumber:33},void 0),e.jsxDEV("p",{className:"mb-2",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:315,columnNumber:33},void 0),e.jsxDEV("p",{className:"text-gray-300 italic text-xs",children:["Exemple: ",r.example]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:316,columnNumber:33},void 0),r.function&&e.jsxDEV("p",{className:"mt-1 text-amber-300 font-mono text-xs",children:r.function},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:318,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:313,columnNumber:29},void 0)]},r.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:286,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:284,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:282,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("p",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"üîç V√©rifications de type"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:328,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:l.map(r=>e.jsxDEV("div",{className:"relative group",children:[e.jsxDEV("button",{type:"button",className:"px-2 py-1 bg-blue-100 border border-blue-300 rounded text-xs hover:bg-blue-200 text-blue-800 shadow-sm",onClick:()=>o(r.value),draggable:"true",title:r.label,onDragStart:e=>{const i={type:"validation",id:r.value,value:r.value,label:r.label,category:r.category};e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("validation-type",r.value),e.dataTransfer.setData("validation-label",r.label),e.dataTransfer.setData("element-type","validation"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy"},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:332,columnNumber:29},void 0),e.jsxDEV("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 max-w-xs pointer-events-none z-10 shadow-lg",children:[e.jsxDEV("p",{className:"font-bold mb-1 text-blue-300",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:358,columnNumber:33},void 0),e.jsxDEV("p",{className:"mb-2",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:359,columnNumber:33},void 0),e.jsxDEV("p",{className:"text-gray-300 italic text-xs",children:["Exemple: ",r.example]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:360,columnNumber:33},void 0),r.function&&e.jsxDEV("p",{className:"mt-1 text-amber-300 font-mono text-xs",children:r.function},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:362,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:357,columnNumber:29},void 0)]},r.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:331,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:329,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:327,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("p",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"üïπÔ∏è Tests logiques"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:372,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:a.map(r=>e.jsxDEV("div",{className:"relative group",children:[e.jsxDEV("button",{type:"button",className:"px-2 py-1 bg-orange-100 border border-orange-300 rounded text-xs hover:bg-orange-200 text-orange-800 shadow-sm",onClick:()=>o(r.value),draggable:"true",title:r.label,onDragStart:e=>{const i={type:"validation",id:r.value,value:r.value,label:r.label,category:r.category};e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("validation-type",r.value),e.dataTransfer.setData("validation-label",r.label),e.dataTransfer.setData("element-type","validation"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy"},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:376,columnNumber:29},void 0),e.jsxDEV("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 max-w-xs pointer-events-none z-10 shadow-lg",children:[e.jsxDEV("p",{className:"font-bold mb-1 text-orange-300",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:402,columnNumber:33},void 0),e.jsxDEV("p",{className:"mb-2",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:403,columnNumber:33},void 0),e.jsxDEV("p",{className:"text-gray-300 italic text-xs",children:["Exemple: ",r.example]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:404,columnNumber:33},void 0),r.function&&e.jsxDEV("p",{className:"mt-1 text-amber-300 font-mono text-xs",children:r.function},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:406,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:401,columnNumber:29},void 0)]},r.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:375,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:373,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:371,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("p",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"üîí V√©rifications de format"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:416,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:m.map(r=>e.jsxDEV("div",{className:"relative group",children:[e.jsxDEV("button",{type:"button",className:"px-2 py-1 bg-purple-100 border border-purple-300 rounded text-xs hover:bg-purple-200 text-purple-800 shadow-sm",onClick:()=>o(r.value),draggable:"true",title:r.label,onDragStart:e=>{const i={type:"validation",id:r.value,value:r.value,label:r.label,category:r.category};e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("validation-type",r.value),e.dataTransfer.setData("validation-label",r.label),e.dataTransfer.setData("element-type","validation"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy"},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:420,columnNumber:29},void 0),e.jsxDEV("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 max-w-xs pointer-events-none z-10 shadow-lg",children:[e.jsxDEV("p",{className:"font-bold mb-1 text-purple-300",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:447,columnNumber:33},void 0),e.jsxDEV("p",{className:"mb-2",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:448,columnNumber:33},void 0),e.jsxDEV("p",{className:"text-gray-300 italic text-xs",children:["Exemple: ",r.example]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:449,columnNumber:33},void 0),r.function&&e.jsxDEV("p",{className:"mt-1 text-amber-300 font-mono text-xs",children:r.function},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:451,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:446,columnNumber:29},void 0)]},r.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:419,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:417,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:415,columnNumber:13},void 0),e.jsxDEV("div",{className:"mb-2",children:[e.jsxDEV("p",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"üîó Validations avanc√©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:461,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:d.map(r=>e.jsxDEV("div",{className:"relative group",children:[e.jsxDEV("button",{type:"button",className:"px-2 py-1 bg-red-100 border border-red-300 rounded text-xs hover:bg-red-200 text-red-800 shadow-sm",onClick:()=>o(r.value),draggable:"true",title:r.label,onDragStart:e=>{const i={type:"validation",id:r.value,value:r.value,label:r.label,category:r.category};e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("validation-type",r.value),e.dataTransfer.setData("validation-label",r.label),e.dataTransfer.setData("element-type","validation"),e.dataTransfer.setData("text/plain",r.value),e.dataTransfer.effectAllowed="copy"},children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:465,columnNumber:29},void 0),e.jsxDEV("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 max-w-xs pointer-events-none z-10 shadow-lg",children:[e.jsxDEV("p",{className:"font-bold mb-1 text-red-300",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:492,columnNumber:33},void 0),e.jsxDEV("p",{className:"mb-2",children:r.description},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:493,columnNumber:33},void 0),e.jsxDEV("p",{className:"text-gray-300 italic text-xs",children:["Exemple: ",r.example]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:494,columnNumber:33},void 0),r.function&&e.jsxDEV("p",{className:"mt-1 text-amber-300 font-mono text-xs",children:r.function},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:496,columnNumber:37},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:491,columnNumber:29},void 0)]},r.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:464,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:462,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:460,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationsPalette.tsx",lineNumber:278,columnNumber:9},void 0)}),xr=({validationId:r,sequence:s,onSequenceChange:t})=>{const[o,n]=i.useState(s),[l,a]=i.useState(!1),m=i.useRef(null);i.useEffect(()=>{n(s)},[s]);i.useEffect(()=>{const e=e=>{const r=e.detail;if(r){const e=[...o,r];t(e)}};return document.addEventListener("validation-sequence-item-added",e),()=>{document.removeEventListener("validation-sequence-item-added",e)}},[o,t]);const d=({item:r,onRemove:i})=>e.jsxDEV("div",{className:`flex items-center gap-1 px-2 py-1 border rounded text-sm ${(()=>{switch(r.type){case"field":return"bg-blue-50 border-blue-200 text-blue-700";case"operator":return"bg-purple-50 border-purple-200 text-purple-700";case"value":return"bg-green-50 border-green-200 text-green-700";case"validation":return"bg-orange-50 border-orange-200 text-orange-700";default:return"bg-gray-50 border-gray-200 text-gray-700"}})()}`,children:[e.jsxDEV("span",{children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:195,columnNumber:9},void 0),e.jsxDEV("button",{onClick:i,className:"ml-1 text-gray-500 hover:text-gray-700",title:"Retirer",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:202,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:201,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:196,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:194,columnNumber:7},void 0);return e.jsxDEV("div",{children:[e.jsxDEV("div",{id:`validation-dropzone-${r}`,ref:m,className:"min-h-[100px] p-3 border-2 border-dashed rounded-md bg-white mb-4 relative transition-all "+(l?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-blue-300 hover:bg-blue-50/30"),"data-droppable":"true",onDragOver:e=>{e.preventDefault();const r=e.dataTransfer.types.includes("application/x-validation-value"),i=e.dataTransfer.types.includes("application/json");(r||i||e.dataTransfer.types.includes("field-id"))&&(a(!0),e.dataTransfer.dropEffect="copy")},onDragLeave:()=>{a(!1)},onDrop:e=>{e.preventDefault(),a(!1);try{e.dataTransfer.types.includes("application/x-validation-value");let i=e.dataTransfer.getData("application/json"),s=null;if(i)try{s=JSON.parse(i),"value"===s.type&&void 0!==s.originalValue&&(s.value=s.originalValue)}catch(r){}else{const r=e.dataTransfer.getData("field-id"),i=e.dataTransfer.getData("field-label");if(!r||!i)return;s={type:"field",id:r,value:r,label:i}}if(!s)return;const n={type:s.type||"unknown",id:s.id||`item-${Date.now()}`,value:void 0!==s.value?s.value:s.id,label:s.label||"Sans nom",referenceSectionId:s.referenceSectionId,originalValue:s.originalValue};"value"===s.type&&void 0!==s.originalValue&&(n.value=s.originalValue);const l=[...o,n];t(l);const a=m.current;a&&(a.classList.add("bg-green-50"),setTimeout(()=>{a.classList.remove("bg-green-50")},300))}catch(r){}},children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:e.jsxDEV("span",{className:"text-xs font-medium text-gray-500",children:"Zone de validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:222,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:221,columnNumber:9},void 0),0===o.length&&e.jsxDEV("div",{className:"flex items-center justify-center h-[60px]",children:e.jsxDEV("div",{className:"text-center",children:e.jsxDEV("p",{className:"text-gray-400 text-sm",children:"Glissez les champs, op√©rateurs, valeurs ou types de validation ici"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:228,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:227,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:226,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:o.map((r,i)=>e.jsxDEV(d,{item:r,index:i,onRemove:()=>(e=>{const r=[...o];r.splice(e,1),t(r)})(i)},`${r.type}-${r.id}-${i}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:236,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:234,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:212,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-2",children:[e.jsxDEV("h4",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"Types de validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:248,columnNumber:9},void 0),e.jsxDEV("div",{className:"border rounded-md",children:e.jsxDEV(Nr,{fieldId:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:250,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:249,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:247,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationZone.tsx",lineNumber:210,columnNumber:5},void 0)},fr=({sequence:r})=>{if(!r||0===r.length)return e.jsxDEV("div",{className:"text-xs text-gray-500 p-2 bg-gray-50 border border-dashed border-gray-200 rounded-md",children:"Aucune validation d√©finie"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationPreview.tsx",lineNumber:14,columnNumber:7},void 0);return e.jsxDEV("div",{className:"p-2 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsxDEV("h5",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Aper√ßu:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationPreview.tsx",lineNumber:50,columnNumber:7},void 0),e.jsxDEV("div",{className:"text-sm bg-white p-2 rounded-md border border-gray-100",children:(i=r,i.map(e=>"field"===e.type?`[${e.label}]`:"operator"===e.type?{equals:"=",notEquals:"‚â†",greaterThan:">",lessThan:"<",greaterThanOrEquals:"‚â•",lessThanOrEquals:"‚â§",and:"ET",or:"OU",not:"NON"}[String(e.value)]||String(e.value):"formula"===e.type?`{${e.label}}`:String(e.value)).join(" "))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationPreview.tsx",lineNumber:51,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationPreview.tsx",lineNumber:49,columnNumber:5},void 0);var i},Dr=({validation:r,allFields:s,validationRules:t,onUpdate:o,onDelete:n})=>{const[l,a]=i.useState(!1),[m,d]=i.useState("edit"),[c,u]=i.useState(()=>{try{if(r.value)return r.value.startsWith("[")||r.value.startsWith("{")?JSON.parse(r.value):[{type:"value",id:`value-${Date.now()}`,value:r.value,label:r.value}]}catch(e){}return[]}),[p,v]=i.useState(r.message||""),b=e=>{let i;u(e),i=0===e.length?null:1===e.length&&"value"===e[0].type&&"string"==typeof e[0].value?e[0].value:JSON.stringify(e),o({id:r.id,value:i})};i.useEffect(()=>{r.message!==p&&o({id:r.id,message:p})},[p,r.id]);const[N,x]=i.useState([]);i.useEffect(()=>{(async()=>{try{const e=await fetch("/api/formulas/all",{headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}});if(!e.ok)return;const r=await e.json();x(r)}catch(e){x([{id:"form-1",name:"Calcul de prix HT",fieldId:"price-field",fieldLabel:"Prix"},{id:"form-2",name:"Calcul de TVA",fieldId:"tax-field",fieldLabel:"Taxe"},{id:"form-3",name:"Total avec remise",fieldId:"total-field",fieldLabel:"Total"}])}})()},[]);return i.useEffect(()=>{t&&t.length},[t,r.id]),i.useEffect(()=>{const e=JSON.stringify(c),i=1===c.length&&"value"===c[0].type&&"string"==typeof c[0].value;if(!(null===r.value&&0===c.length||i&&c[0].value===r.value||r.value&&r.value.startsWith("[")&&e===r.value))try{if(r.value)if(r.value.startsWith("[")||r.value.startsWith("{")){const e=JSON.parse(r.value);u(e)}else u([{type:"value",id:`value-${Date.now()}`,value:r.value,label:r.value}]);else u([])}catch(s){}},[r.value,r.id,c]),e.jsxDEV("div",{className:"bg-white w-full max-w-full border border-gray-200 rounded-md mb-2 shadow-sm",children:[e.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-gray-50 border-b border-gray-200",children:[e.jsxDEV("div",{className:"flex-grow flex items-center cursor-pointer",onClick:()=>a(!l),children:[e.jsxDEV("div",{className:"mr-2",children:l?e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:211,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:210,columnNumber:15},void 0):e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:215,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:214,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:208,columnNumber:11},void 0),e.jsxDEV("span",{className:"font-medium",children:p||"R√®gle de validation sans nom"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:219,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:204,columnNumber:9},void 0),e.jsxDEV("button",{onClick:e=>{e.stopPropagation(),n(r.id)},className:"ml-2 px-2 py-1 text-xs bg-red-50 text-red-700 hover:bg-red-100 rounded-md",children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:221,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:203,columnNumber:7},void 0),l&&e.jsxDEV("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxDEV("div",{className:"flex flex-col gap-4 max-w-full",children:[e.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Nom de la validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:239,columnNumber:17},void 0),e.jsxDEV("form",{onSubmit:e=>{e.preventDefault()},children:e.jsxDEV("div",{className:"flex gap-2",children:e.jsxDEV("input",{type:"text",value:p,onChange:e=>v(e.target.value),placeholder:"Nom de la validation",className:"input input-bordered input-sm w-full "+(r.message!==p?"border-blue-500 bg-blue-50":""),autoComplete:"off"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:244,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:243,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:240,columnNumber:17},void 0),r.message!==p&&e.jsxDEV("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsxDEV("span",{className:"font-bold",children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:256,columnNumber:21},void 0)," Appuyez sur Entr√©e ou cliquez ailleurs pour sauvegarder le nom"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:255,columnNumber:19},void 0),r.message===p&&p&&e.jsxDEV("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsxDEV("span",{className:"font-bold",children:"‚úì"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:261,columnNumber:21},void 0)," Nom actuel: ",p]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:260,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:238,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Formule √† utiliser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:268,columnNumber:17},void 0),e.jsxDEV("select",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 text-sm",onChange:e=>(e=>{const r=N.find(r=>r.id===e);if(r){const e={type:"formula",id:`formula-ref-${r.id}`,value:r.id,label:`Formule: ${r.name}`,referenceFieldId:r.fieldId};b([...c,e])}})(e.target.value),defaultValue:"",children:[e.jsxDEV("option",{value:"",disabled:!0,children:"S√©lectionner une formule..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:274,columnNumber:19},void 0),N.map(r=>e.jsxDEV("option",{value:r.id,children:[r.name," (",r.fieldLabel||r.fieldId,")"]},r.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:276,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:269,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:267,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:236,columnNumber:13},void 0),e.jsxDEV("div",{className:"w-full max-w-full",children:e.jsxDEV("div",{className:"relative",children:[e.jsxDEV("div",{className:"absolute -top-5 left-1/2 transform -translate-x-1/2 bg-blue-500 text-white px-2 py-1 rounded-t-md text-xs font-medium z-10",children:"Zone de d√©p√¥t"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:287,columnNumber:17},void 0),e.jsxDEV("div",{className:"border border-dashed border-gray-300 rounded-md",children:[e.jsxDEV(xr,{validationId:r.id,sequence:c,onSequenceChange:b,availableFields:s.map(e=>({id:e.id,label:e.label,sectionId:e.sectionId}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:292,columnNumber:19},void 0),0===c.length&&e.jsxDEV("div",{className:"p-8 flex flex-col items-center justify-center"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:303,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:291,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:286,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:285,columnNumber:13},void 0),e.jsxDEV("div",{className:"mt-6",children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-2",children:[e.jsxDEV("h3",{className:"text-sm font-semibold text-gray-700",children:"Tester la validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:313,columnNumber:17},void 0),e.jsxDEV("button",{className:"px-3 py-1 text-xs rounded "+("test"===m?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"),onClick:()=>d("test"===m?"edit":"test"),children:"Test"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:314,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:312,columnNumber:15},void 0),"test"===m&&e.jsxDEV(fr,{sequence:c},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:323,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:311,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:234,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:233,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/ValidationRuleEditor.tsx",lineNumber:201,columnNumber:5},void 0)},hr=[{id:"required",label:"Champ Requis",inputType:"none",defaultMessage:"Ce champ est obligatoire."},{id:"email",label:"Adresse e-mail valide",inputType:"none",defaultMessage:"Veuillez saisir une adresse e-mail valide."},{id:"url",label:"URL valide",inputType:"none",defaultMessage:"Veuillez saisir une URL valide."},{id:"numeric",label:"Doit √™tre un nombre",inputType:"none",defaultMessage:"La valeur doit √™tre un nombre."},{id:"minLength",label:"Longueur minimale",inputType:"dynamic",valueDataType:"number",defaultMessage:"Ce champ doit contenir au moins {value} caract√®res.",valuePlaceholder:"Nombre min. de caract√®res"},{id:"maxLength",label:"Longueur maximale",inputType:"dynamic",valueDataType:"number",defaultMessage:"Ce champ ne doit pas d√©passer {value} caract√®res.",valuePlaceholder:"Nombre max. de caract√®res"},{id:"min",label:"Valeur minimale",inputType:"dynamic",valueDataType:"number",defaultMessage:"La valeur doit √™tre sup√©rieure ou √©gale √† {value}.",valuePlaceholder:"Valeur minimale"},{id:"max",label:"Valeur maximale",inputType:"dynamic",valueDataType:"number",defaultMessage:"La valeur doit √™tre inf√©rieure ou √©gale √† {value}.",valuePlaceholder:"Valeur maximale"},{id:"regex",label:"Format personnalis√© (RegEx)",inputType:"singleValue",valueDataType:"text",defaultMessage:"Le format de ce champ est invalide.",valuePlaceholder:"Expression r√©guli√®re"}],Er=({fieldId:r})=>{const[s,t]=i.useState([]),[o,n]=i.useState([]),[l,a]=i.useState(!0),[m,d]=i.useState(null),{get:c,post:u,patch:p,delete:v}=E(),b=i.useCallback(async()=>{a(!0),d(null);try{const e=await c(`/api/fields/${r}/validations`);let i=[];i=e.success&&Array.isArray(e.data)?e.data:Array.isArray(e)?e:[{id:`prisma-valid-1-${Date.now()}`,type:"required",message:"Ce champ est requis",comparisonType:"static",value:null,comparisonFieldId:null},{id:`prisma-valid-2-${Date.now()}`,type:"format",message:"Format invalide",comparisonType:"static",value:"email",comparisonFieldId:null}];let s=[];try{const e=await c("/fields");e.success&&Array.isArray(e.data)?s=e.data:Array.isArray(e)&&(s=e)}catch{}0===s.length&&(s=[{id:"field-1",name:"nom",label:"Nom",type:"text",sectionId:"section-1"},{id:"field-2",name:"email",label:"Email",type:"email",sectionId:"section-1"},{id:"field-3",name:"telephone",label:"T√©l√©phone",type:"tel",sectionId:"section-1"}]),t(i),n(s.filter(e=>e.id!==r))}catch(e){d("Impossible de charger les donn√©es de validation.")}finally{a(!1)}},[r,c]);i.useEffect(()=>{b()},[b]);const N=async e=>{const r=[...s];t(r=>r.filter(r=>r.id!==e));try{if(e.startsWith("temp-"))return;if(e.startsWith("prisma-valid-"))return;if(!(await v(`/api/validations/${e}`)).success)throw t(r),new Error("√âchec de la suppression c√¥t√© serveur")}catch(i){d("Impossible de supprimer la r√®gle."),t(r)}},x=i.useCallback(async e=>{t(r=>r.map(r=>r.id===e.id?{...r,...e}:r));try{if(e.id.startsWith("temp-")||e.id.startsWith("prisma-valid-"))return;if(!(await p(`/api/validations/${e.id}`,e)).success)throw new Error("La mise √† jour a √©chou√© c√¥t√© serveur")}catch(r){d("Impossible de mettre √† jour la r√®gle.")}},[p]);return e.jsxDEV("div",{className:"bg-white shadow-sm rounded-md p-4 mt-4",children:[e.jsxDEV("h3",{className:"text-lg font-medium mb-4",children:"R√®gles de Validation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:224,columnNumber:7},void 0),m&&e.jsxDEV("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:e.jsxDEV("span",{className:"block sm:inline",children:m},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:228,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:227,columnNumber:9},void 0),l?e.jsxDEV("div",{className:"flex justify-center my-8",children:e.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:234,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:233,columnNumber:9},void 0):e.jsxDEV("div",{className:"space-y-4",children:[0===s.length?e.jsxDEV("p",{className:"text-gray-500 text-center py-4",children:"Aucune r√®gle de validation d√©finie."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:239,columnNumber:13},void 0):s.map(r=>e.jsxDEV(Dr,{validation:r,allFields:o,validationRules:hr,onUpdate:x,onDelete:N},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:242,columnNumber:15},void 0)),e.jsxDEV("div",{className:"pt-2",children:e.jsxDEV("button",{onClick:async()=>{const e=hr[0],i={type:e.id,message:e.defaultMessage,comparisonType:"static",value:null,comparisonFieldId:null};try{const e=await u(`/api/fields/${r}/validations`,i);let s;s=e.success&&e.data?e.data:{...i,id:`temp-${Date.now()}`},t(e=>[...e,s])}catch(s){d("Impossible d'ajouter la r√®gle.")}},className:"w-full flex items-center justify-center py-2 px-4 border border-dashed border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsxDEV(pr,{className:"h-5 w-5 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:258,columnNumber:15},void 0),"Ajouter une r√®gle de validation"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:254,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:253,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:237,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/validations/FieldValidationsEditor.tsx",lineNumber:223,columnNumber:5},void 0)},Cr=({id:r,type:s,label:t,description:o,color:n="gray",disabled:l=!1})=>{const a=i.useRef(null);i.useEffect(()=>{const e=a.current;e&&!l&&e.setAttribute("draggable","true")},[l]);return e.jsxDEV("div",{ref:a,onDragStart:e=>{const i={id:r,type:s,label:t,description:o};try{switch(s){case"field":e.dataTransfer.setData("field-id",r),e.dataTransfer.setData("field-name",t);break;case"action":e.dataTransfer.setData("dependency-action",r);break;case"operator":e.dataTransfer.setData("dependency-operator",r);break;case"formula":e.dataTransfer.setData("formula-id",r);break;case"test":e.dataTransfer.setData("dependency-test",r)}e.dataTransfer.setData("application/json",JSON.stringify(i)),e.dataTransfer.setData("text/plain",`${s}:${r}`)}catch(n){}e.dataTransfer.effectAllowed="copy"},className:`px-2 py-1 rounded text-xs flex items-center justify-between transition-all ${(()=>{let e="bg-gray-100",r="text-gray-700",i="border-gray-200",s="hover:bg-gray-200";switch(n){case"blue":e="bg-blue-50",r="text-blue-700",i="border-blue-200",s="hover:bg-blue-100";break;case"green":e="bg-green-50",r="text-green-700",i="border-green-200",s="hover:bg-green-100";break;case"amber":e="bg-amber-50",r="text-amber-700",i="border-amber-200",s="hover:bg-amber-100";break;case"purple":e="bg-purple-50",r="text-purple-700",i="border-purple-200",s="hover:bg-purple-100";break;case"red":e="bg-red-50",r="text-red-700",i="border-red-200",s="hover:bg-red-100";break;case"indigo":e="bg-indigo-50",r="text-indigo-700",i="border-indigo-200",s="hover:bg-indigo-100"}return`${e} ${r} border ${i} ${s} ${l?"opacity-50 cursor-not-allowed":"cursor-grab active:cursor-grabbing"}`})()}`,title:o||t,"data-id":r,"data-type":s,children:[e.jsxDEV("span",{className:"truncate",children:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DraggableItem.tsx",lineNumber:142,columnNumber:7},void 0),!l&&e.jsxDEV("span",{className:"ml-1 text-gray-400",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DraggableItem.tsx",lineNumber:146,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DraggableItem.tsx",lineNumber:145,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DraggableItem.tsx",lineNumber:144,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DraggableItem.tsx",lineNumber:134,columnNumber:5},void 0)},gr=({dependencyId:r})=>{const[s,t]=i.useState(!1);i.useEffect(()=>{const e=setTimeout(()=>{t(!0)},100);return()=>clearTimeout(e)},[]);return e.jsxDEV("div",{className:"p-3",children:[e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("h5",{className:"text-xs font-medium text-gray-700 mb-2 pb-1 border-b border-gray-100",children:"Actions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:93,columnNumber:9},void 0),e.jsxDEV("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:s?[{name:"Visibilit√©",bgColor:"bg-blue-50",borderColor:"border-blue-200",textColor:"text-blue-800",actions:[{id:"show",label:"Afficher",description:"Rendre le champ visible"},{id:"hide",label:"Masquer",description:"Rendre le champ invisible"}]},{name:"Activation",bgColor:"bg-green-50",borderColor:"border-green-200",textColor:"text-green-800",actions:[{id:"enable",label:"Activer",description:"Activer le champ"},{id:"disable",label:"D√©sactiver",description:"D√©sactiver le champ"}]},{name:"Obligation",bgColor:"bg-amber-50",borderColor:"border-amber-200",textColor:"text-amber-800",actions:[{id:"require",label:"Obligatoire",description:"Rendre le champ obligatoire"},{id:"optional",label:"Facultatif",description:"Rendre le champ facultatif"}]},{name:"Valeur",bgColor:"bg-purple-50",borderColor:"border-purple-200",textColor:"text-purple-800",actions:[{id:"prefill",label:"Pr√©renseigner",description:"Pr√©remplir le champ avec une valeur"},{id:"clear",label:"Effacer",description:"Effacer la valeur du champ"}]}].map(r=>e.jsxDEV("div",{className:`${r.bgColor} ${r.borderColor} border rounded-md p-2`,children:[e.jsxDEV("h6",{className:`text-xs font-medium ${r.textColor} mb-1 text-center`,children:r.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:101,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex flex-col gap-1",children:r.actions.map(r=>e.jsxDEV(Cr,{id:r.id,type:"action",label:r.label,description:r.description},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:104,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:102,columnNumber:17},void 0)]},r.name,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:97,columnNumber:15},void 0)):e.jsxDEV("div",{className:"col-span-4 py-2 text-center text-sm text-gray-400",children:"Chargement des actions..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:116,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:94,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:92,columnNumber:7},void 0),e.jsxDEV("div",{className:"mb-4",children:[e.jsxDEV("h5",{className:"text-xs font-medium text-gray-700 mb-2 pb-1 border-b border-gray-100",children:"Op√©rateurs logiques"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:125,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-1",children:s?[{id:"if",label:"IF",description:"Condition IF"},{id:"and",label:"AND",description:"Op√©rateur logique ET"},{id:"or",label:"OR",description:"Op√©rateur logique OU"},{id:"not",label:"NOT",description:"N√©gation logique"}].map(r=>e.jsxDEV(Cr,{id:r.id,type:"operator",label:r.label,description:r.description,color:"indigo"},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:129,columnNumber:15},void 0)):e.jsxDEV("div",{className:"w-full py-2 text-center text-sm text-gray-400",children:"Chargement des op√©rateurs..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:139,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:126,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:124,columnNumber:7},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h5",{className:"text-xs font-medium text-gray-700 mb-2 pb-1 border-b border-gray-100",children:"Tests de valeur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:148,columnNumber:9},void 0),e.jsxDEV("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-1",children:s?[{id:"is_null",label:"null",description:"Est null"},{id:"is_empty",label:"vide",description:"Est vide"},{id:"equals",label:"√©gal",description:"Est √©gal √†"},{id:"not_equals",label:"diff√©rent",description:"N'est pas √©gal √†"},{id:"in",label:"dans liste",description:"Est dans la liste"},{id:"gt",label:"sup. √†",description:"Est sup√©rieur √†"},{id:"lt",label:"inf. √†",description:"Est inf√©rieur √†"}].map(r=>e.jsxDEV(Cr,{id:r.id,type:"test",label:r.label,description:r.description,color:"red"},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:152,columnNumber:15},void 0)):e.jsxDEV("div",{className:"col-span-4 py-2 text-center text-sm text-gray-400",children:"Chargement des tests..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:162,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:149,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:147,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependenciesPalette.tsx",lineNumber:90,columnNumber:5},void 0)},Vr=({dependencyId:r,conditions:s,onConditionsChange:t,availableFields:o=[]})=>{const[n,l]=i.useState(s),[a,m]=i.useState(!1),[d,c]=i.useState(!1),[u,p]=i.useState(!1),[v,b]=i.useState([]),N=i.useRef(null);i.useEffect(()=>{l(s)},[s]),i.useEffect(()=>{const e=setTimeout(()=>{c(!0)},300);return()=>clearTimeout(e)},[r]);const x=e=>{b(r=>r.filter(r=>r.id!==e))},f=e=>{switch(e){case"show":case"hide":return"blue";case"enable":case"disable":return"green";case"require":case"optional":return"amber";case"prefill":case"clear":return"purple";default:return"gray"}},D=e=>{switch(e){case"show":return"üëÅÔ∏è";case"hide":return"üëÅÔ∏è‚Äçüó®Ô∏è";case"enable":return"‚úÖ";case"disable":return"‚ùå";case"require":return"‚ö†Ô∏è";case"optional":return"üìù";case"prefill":return"‚úèÔ∏è";case"clear":return"üßπ";default:return"üîÑ"}},h=e=>{switch(e){case"show":return"Afficher";case"hide":return"Masquer";case"enable":return"Activer";case"disable":return"D√©sactiver";case"require":return"Rendre obligatoire";case"optional":return"Rendre facultatif";case"prefill":return"Pr√©remplir";case"clear":return"Effacer";default:return e}},E=e=>{switch(e){case"is_null":return"Est null";case"is_empty":return"Est vide";case"equals":return"Est √©gal √†";case"not_equals":return"N'est pas √©gal √†";case"in":return"Est dans la liste";case"gt":return"Est sup√©rieur √†";case"lt":return"Est inf√©rieur √†";default:return e}},C=({condition:r,onRemove:i})=>{const s=o.find(e=>e.id===r.targetFieldId);return e.jsxDEV("div",{className:"flex items-center gap-1 px-2 py-1 border border-blue-200 bg-blue-50 text-blue-700 rounded text-sm",children:[e.jsxDEV("span",{children:(null==s?void 0:s.name)||r.targetFieldId},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:425,columnNumber:9},void 0),e.jsxDEV("span",{className:"text-xs mx-1",children:"equals"===r.operator?"est √©gal √†":"not_equals"===r.operator?"n'est pas √©gal √†":"contains"===r.operator?"contient":"is_empty"===r.operator?"est vide":"n'est pas vide"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:426,columnNumber:9},void 0),"is_empty"!==r.operator&&"is_not_empty"!==r.operator&&e.jsxDEV("span",{className:"bg-gray-100 px-1 py-0.5 text-xs rounded",children:r.value||"(aucune valeur)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:433,columnNumber:11},void 0),e.jsxDEV("button",{onClick:i,className:"ml-1 text-gray-500 hover:text-gray-700",title:"Retirer",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:441,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:440,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:435,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:424,columnNumber:7},void 0)},g=({item:r,onRemove:i})=>e.jsxDEV("div",{className:`flex items-center gap-1 px-2 py-1 border border-${r.color||"gray"}-200 bg-${r.color||"gray"}-50 text-${r.color||"gray"}-700 rounded text-sm`,children:[e.jsxDEV("span",{children:r.icon||"üîÑ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:455,columnNumber:9},void 0),e.jsxDEV("span",{className:"text-xs font-medium",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:456,columnNumber:9},void 0),e.jsxDEV("button",{onClick:i,className:"ml-1 text-gray-500 hover:text-gray-700",title:"Retirer",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:463,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:462,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:457,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:454,columnNumber:7},void 0),V=({item:r,onRemove:i})=>e.jsxDEV("div",{className:"flex items-center gap-1 px-2 py-1 border border-indigo-200 bg-indigo-50 text-indigo-700 rounded text-sm",children:[e.jsxDEV("span",{children:"‚öôÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:476,columnNumber:9},void 0),e.jsxDEV("span",{className:"text-xs font-bold",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:477,columnNumber:9},void 0),e.jsxDEV("button",{onClick:i,className:"ml-1 text-gray-500 hover:text-gray-700",title:"Retirer",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:484,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:483,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:478,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:475,columnNumber:7},void 0),S=({item:r,onRemove:i})=>e.jsxDEV("div",{className:"flex items-center gap-1 px-2 py-1 border border-red-200 bg-red-50 text-red-700 rounded text-sm",children:[e.jsxDEV("span",{children:"üîç"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:497,columnNumber:9},void 0),e.jsxDEV("span",{className:"text-xs font-medium",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:498,columnNumber:9},void 0),e.jsxDEV("button",{onClick:i,className:"ml-1 text-gray-500 hover:text-gray-700",title:"Retirer",children:e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsxDEV("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:505,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:504,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:499,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:496,columnNumber:7},void 0);return e.jsxDEV("div",{children:[e.jsxDEV("div",{id:`dependency-dropzone-${r}`,ref:N,className:"min-h-[100px] p-3 border-2 border-dashed rounded-md bg-white mb-4 relative transition-all "+(a?"border-blue-400 bg-blue-50":d?"border-gray-300 hover:border-blue-300 hover:bg-blue-50/30":"border-gray-300 bg-gray-50"),"data-droppable":"true","data-ready":d?"true":"false",onDragOver:e=>{e.preventDefault();const r=e.dataTransfer.types.includes("application/json"),i=e.dataTransfer.types.includes("field-id"),s=e.dataTransfer.types.includes("dependency-action"),t=e.dataTransfer.types.includes("dependency-operator"),o=e.dataTransfer.types.includes("dependency-test");(r||i||s||t||o)&&(m(!0),e.dataTransfer.dropEffect="copy")},onDragLeave:()=>{m(!1)},onDrop:e=>{if(e.preventDefault(),m(!1),d)try{const s=e.dataTransfer.getData("dependency-action");if(s){const i=e.dataTransfer.getData("action-color")||"",t=e.dataTransfer.getData("action-icon")||"",o=e.dataTransfer.getData("field-name")||s,n=new CustomEvent("dependency-action-added",{detail:{dependencyId:r,actionType:s,actionColor:i,actionIcon:t,actionLabel:o},bubbles:!0});return document.dispatchEvent(n),p(!0),setTimeout(()=>p(!1),1500),void b(e=>[...e,{id:`action-${Date.now()}`,type:"action",label:h(s),color:f(s),icon:D(s)}])}const o=e.dataTransfer.getData("dependency-operator");if(o){const e=new CustomEvent("dependency-operator-added",{detail:{dependencyId:r,operatorType:o},bubbles:!0});return document.dispatchEvent(e),void b(e=>[...e,{id:`operator-${Date.now()}`,type:"operator",label:o.toUpperCase()}])}const l=e.dataTransfer.getData("dependency-test");if(l){const e=new CustomEvent("dependency-test-added",{detail:{dependencyId:r,testType:l},bubbles:!0});return document.dispatchEvent(e),void b(e=>[...e,{id:`test-${Date.now()}`,type:"test",label:E(l)}])}let a=e.dataTransfer.getData("application/json"),m=null;if(a)try{m=JSON.parse(a)}catch(i){}else{const r=e.dataTransfer.getData("field-id"),i=e.dataTransfer.getData("field-name")||e.dataTransfer.getData("field-label");r&&(m={type:"field",id:r,name:i||`Champ ${r}`});const s=e.dataTransfer.getData("dependency-action");if(s&&(m={type:"action",id:s,name:s}),!m)return}if(!m)return;let d=null;switch(m.type){case"field":d={id:`condition-${Date.now()}`,targetFieldId:m.id,operator:"equals",value:""};break;case"action":b(e=>[...e,{id:`action-${Date.now()}`,type:"action",label:h(m.id),color:f(m.id),icon:D(m.id)}]);const e=new CustomEvent("dependency-action-added",{detail:{dependencyId:r,actionType:m.id},bubbles:!0,cancelable:!0});document.dispatchEvent(e),p(!0),setTimeout(()=>p(!1),2e3);break;case"operator":b(e=>[...e,{id:`operator-${Date.now()}`,type:"operator",label:m.id.toUpperCase()}]);break;case"test":b(e=>[...e,{id:`test-${Date.now()}`,type:"test",label:E(m.id)}]);break;case"formula":const i=new CustomEvent("dependency-formula-added",{detail:{dependencyId:r,formulaId:m.id}});document.dispatchEvent(i)}if(d){const e=[...n,d];t(e);const r=N.current;r&&(r.classList.add("bg-green-50"),setTimeout(()=>{r.classList.remove("bg-green-50")},300))}}catch(i){}},children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-1",children:[e.jsxDEV("span",{className:"text-xs font-medium text-gray-500",children:"Zone de d√©pendance"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:530,columnNumber:11},void 0),!d&&e.jsxDEV("span",{className:"text-xs bg-amber-100 text-amber-700 px-1 py-0.5 rounded",children:"Initialisation..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:534,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:529,columnNumber:9},void 0),u&&e.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-green-50/90 z-10 rounded-md animate-fadeIn",children:e.jsxDEV("div",{className:"bg-white shadow-lg rounded-lg p-3 border border-green-200 flex items-center gap-2 animate-scaleIn",children:[e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:545,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:544,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("span",{className:"text-green-700 font-medium",children:"Action ajout√©e avec succ√®s!"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:548,columnNumber:17},void 0),e.jsxDEV("p",{className:"text-xs text-gray-500 mt-0.5",children:"L'action sera appliqu√©e quand la condition sera remplie"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:549,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:547,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:543,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:542,columnNumber:11},void 0),0===n.length&&0===v.length&&!u&&e.jsxDEV("div",{className:"flex items-center justify-center h-[60px]",children:e.jsxDEV("div",{className:"text-center",children:e.jsxDEV("p",{className:"text-gray-400 text-sm",children:"Glissez les champs, actions ou op√©rateurs ici"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:560,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:559,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:558,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex flex-wrap gap-2",children:[n.map((r,i)=>e.jsxDEV(C,{condition:r,index:i,onRemove:()=>(e=>{const r=[...n];r.splice(e,1),t(r)})(i)},`condition-${r.id}-${i}`,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:569,columnNumber:13},void 0)),v.map(r=>"action"===r.type?e.jsxDEV(g,{item:r,onRemove:()=>x(r.id)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:581,columnNumber:17},void 0):"operator"===r.type?e.jsxDEV(V,{item:r,onRemove:()=>x(r.id)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:589,columnNumber:17},void 0):"test"===r.type?e.jsxDEV(S,{item:r,onRemove:()=>x(r.id)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:597,columnNumber:17},void 0):null)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:566,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:515,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-2",children:[e.jsxDEV("h4",{className:"text-xs font-medium text-gray-700 mb-2 border-b border-gray-200 pb-1",children:"Actions de d√©pendance"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:611,columnNumber:9},void 0),e.jsxDEV("div",{className:"border rounded-md",children:e.jsxDEV(gr,{dependencyId:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:613,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:612,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:610,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyZone.tsx",lineNumber:513,columnNumber:5},void 0)},Sr=({dependency:r,allFields:s,onUpdate:t,onDelete:n,onTest:l})=>{const[a,m]=i.useState(!1),[d,c]=i.useState(!r.targetFieldId&&!r.formulaId),[u,p]=i.useState(r.action),[v,b]=i.useState(null),[N,x]=i.useState(null),[f,D]=i.useState(()=>{var e;return r.targetFieldId&&!r.formulaId?[{id:`condition-init-${Date.now()}`,targetFieldId:r.targetFieldId,operator:r.operator||"equals",value:r.value||"",displayName:null==(e=s.find(e=>e.id===r.targetFieldId))?void 0:e.name}]:[]});i.useEffect(()=>{const e=setTimeout(()=>{m(!0),r.targetFieldId||r.formulaId||c(!0)},150);return()=>clearTimeout(e)},[r.id,r.targetFieldId,r.formulaId]),i.useEffect(()=>{r.action!==u&&p(r.action)},[r.action,u]);const h=r.name||"D√©pendance sans nom";o.useEffect(()=>{const e=e=>{const i=e,{dependencyId:s,actionType:o,actionColor:n,actionIcon:l,actionLabel:a}=i.detail;if(s===r.id&&o){p(o),t({id:r.id,action:o}),d||c(!0);const e=document.createElement("div");e.className=`fixed bottom-4 right-4 bg-${n||"green"}-50 border border-${n||"green"}-200 text-${n||"green"}-700 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-scaleIn`,e.innerHTML=`\n          <span class="text-xl">${l||"‚úì"}</span>\n          <span>${a||`Action ${o} ajout√©e`}</span>\n        `,document.body.appendChild(e),setTimeout(()=>{e.classList.add("animate-fadeOut"),setTimeout(()=>{document.body.removeChild(e)},300)},3e3)}},i=e=>{const i=e,{dependencyId:s,operatorType:t}=i.detail;if(s===r.id&&t){b(t),d||c(!0);const e=document.createElement("div");e.className="fixed bottom-4 right-4 bg-indigo-50 border border-indigo-200 text-indigo-700 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-scaleIn",e.innerHTML=`\n          <span class="text-xl">‚öôÔ∏è</span>\n          <span>Op√©rateur ${t.toUpperCase()} ajout√©</span>\n        `,document.body.appendChild(e),setTimeout(()=>{e.classList.add("animate-fadeOut"),setTimeout(()=>{document.body.removeChild(e)},300)},3e3)}},s=e=>{const i=e,{dependencyId:s,testType:t}=i.detail;if(s===r.id&&t){x(t),d||c(!0);let e=t;switch(t){case"is_null":e="est null";break;case"is_empty":e="est vide";break;case"equals":e="est √©gal √†";break;case"not_equals":e="n'est pas √©gal √†";break;case"in":e="est dans la liste";break;case"gt":e="est sup√©rieur √†";break;case"lt":e="est inf√©rieur √†"}const r=document.createElement("div");r.className="fixed bottom-4 right-4 bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded-lg shadow-lg z-50 flex items-center gap-2 animate-scaleIn",r.innerHTML=`\n          <span class="text-xl">üîç</span>\n          <span>Test "${e}" ajout√©</span>\n        `,document.body.appendChild(r),setTimeout(()=>{r.classList.add("animate-fadeOut"),setTimeout(()=>{document.body.removeChild(r)},300)},3e3)}},o=e=>{const i=e,{dependencyId:s,formulaId:o}=i.detail;s===r.id&&o&&t({id:r.id,formulaId:o})};return document.addEventListener("dependency-action-added",e),document.addEventListener("dependency-operator-added",i),document.addEventListener("dependency-test-added",s),document.addEventListener("dependency-formula-added",o),()=>{document.removeEventListener("dependency-action-added",e),document.removeEventListener("dependency-operator-added",i),document.removeEventListener("dependency-test-added",s),document.removeEventListener("dependency-formula-added",o)}},[r.id,t]);const E=e=>{switch(e){case"show":case"hide":return"bg-blue-50 border-blue-200 text-blue-800";case"enable":case"disable":return"bg-green-50 border-green-200 text-green-800";case"require":case"optional":return"bg-amber-50 border-amber-200 text-amber-800";case"prefill":case"clear":return"bg-purple-50 border-purple-200 text-purple-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},C=e=>{switch(e){case"show":return"üëÅÔ∏è";case"hide":return"üëÅÔ∏è‚Äçüó®Ô∏è";case"enable":return"‚úÖ";case"disable":return"‚ùå";case"require":return"‚ö†Ô∏è";case"optional":return"üìù";case"prefill":return"‚úèÔ∏è";case"clear":return"üßπ";default:return"üîÑ"}},g=e=>{switch(e){case"show":return"Afficher";case"hide":return"Masquer";case"enable":return"Activer";case"disable":return"D√©sactiver";case"require":return"Rendre obligatoire";case"optional":return"Rendre facultatif";case"prefill":return"Pr√©remplir";case"clear":return"Effacer";default:return e}};return e.jsxDEV("div",{className:"bg-white shadow-sm border border-gray-200 rounded-md overflow-hidden mb-4",children:[e.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-gray-50 border-b border-gray-200",children:[e.jsxDEV("div",{className:"flex items-center",children:[e.jsxDEV("button",{onClick:()=>c(!d),className:"mr-2 text-gray-600 hover:text-gray-800","aria-expanded":d,"aria-label":d?"R√©duire":"D√©velopper",children:e.jsxDEV("svg",{className:"h-5 w-5 transition-transform "+(d?"transform rotate-90":""),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsxDEV("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:356,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:355,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:349,columnNumber:11},void 0),e.jsxDEV("h3",{className:"text-sm font-medium flex items-center",children:[h,(u||r.action)&&e.jsxDEV("span",{className:`ml-2 px-1.5 py-0.5 text-xs rounded-full ${E(u||r.action||"")}`,children:[C(u||r.action||"")," ",g(u||r.action||"")]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:362,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:359,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:348,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV("button",{onClick:()=>null==l?void 0:l(r.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 rounded-md",children:"Tester"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:369,columnNumber:11},void 0),e.jsxDEV("button",{onClick:()=>n(r.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 hover:bg-red-100 rounded-md",children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:375,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:368,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:347,columnNumber:7},void 0),d&&e.jsxDEV("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:a?e.jsxDEV("div",{className:"flex flex-col gap-4 max-w-full",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Nom de la d√©pendance"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:401,columnNumber:19},void 0),e.jsxDEV("input",{type:"text",value:r.name||"",onChange:e=>{t({id:r.id,name:e.target.value})},placeholder:"Nom de la d√©pendance",className:"input input-bordered input-sm w-full rounded-md border-gray-300",autoComplete:"off"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:402,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:400,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-semibold text-gray-600 mb-1",children:"Action actuelle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:414,columnNumber:19},void 0),u||r.action?e.jsxDEV("div",{className:`px-3 py-2 text-sm rounded border shadow-sm ${E(u||r.action||"")}`,children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("span",{className:"text-lg",children:C(u||r.action||"")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:420,columnNumber:25},void 0),e.jsxDEV("div",{className:"flex-1",children:[e.jsxDEV("div",{className:"font-medium",children:g(u||r.action||"")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:422,columnNumber:27},void 0),e.jsxDEV("div",{className:"text-xs mt-0.5 opacity-80",children:(e=>{switch(e){case"show":return"Rendre le champ visible";case"hide":return"Rendre le champ invisible";case"enable":return"Activer le champ pour permettre la saisie";case"disable":return"D√©sactiver le champ pour emp√™cher la saisie";case"require":return"Rendre la saisie du champ obligatoire";case"optional":return"Rendre la saisie du champ facultative";case"prefill":return"Pr√©remplir le champ avec une valeur";case"clear":return"Effacer la valeur du champ";default:return"Action sur le champ cible"}})(u||r.action||"")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:423,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:421,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:419,columnNumber:23},void 0),("prefill"===u||"prefill"===r.action)&&e.jsxDEV("div",{className:"mt-2 bg-white/60 p-1.5 rounded border border-purple-200",children:[e.jsxDEV("label",{className:"text-xs text-purple-800 font-medium mb-1 block",children:"Valeur √† pr√©renseigner:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:431,columnNumber:27},void 0),e.jsxDEV("input",{type:"text",value:r.prefillValue||"",onChange:e=>t({id:r.id,prefillValue:e.target.value}),placeholder:"Saisissez une valeur...",className:"w-full p-1 text-sm border border-purple-200 rounded bg-white"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:432,columnNumber:27},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:430,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:416,columnNumber:21},void 0):e.jsxDEV("div",{className:"px-3 py-1.5 text-sm bg-gray-100 rounded border border-gray-200",children:"Aucune action s√©lectionn√©e"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:446,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:413,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:398,columnNumber:15},void 0),"prefill"===r.action&&e.jsxDEV("div",{className:"mt-2 bg-purple-50 border border-purple-100 rounded p-2",children:[e.jsxDEV("label",{className:"text-xs text-purple-800 font-medium mb-1 block",children:"Valeur √† pr√©renseigner:"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:458,columnNumber:19},void 0),e.jsxDEV("input",{type:"text",value:r.prefillValue||"",onChange:e=>t({id:r.id,prefillValue:e.target.value}),placeholder:"Saisissez une valeur...",className:"w-full p-1 text-sm border border-purple-200 rounded"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:459,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:457,columnNumber:17},void 0),e.jsxDEV("div",{className:"mt-4 relative",children:e.jsxDEV("div",{className:"border border-dashed border-gray-300 rounded-md",children:e.jsxDEV(Vr,{dependencyId:r.id,conditions:f,onConditionsChange:e=>{if(D(e),e.length>0){const i=e[0];t({id:r.id,targetFieldId:i.targetFieldId,operator:i.operator,value:i.value})}},availableFields:s},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:475,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:474,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:473,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:396,columnNumber:13},void 0):e.jsxDEV("div",{className:"text-center py-4 text-gray-500",children:[e.jsxDEV("svg",{className:"animate-spin h-5 w-5 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsxDEV("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:390,columnNumber:17},void 0),e.jsxDEV("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:391,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:389,columnNumber:15},void 0),e.jsxDEV("p",{className:"text-sm",children:"Chargement de l'√©diteur..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:393,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:388,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:386,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/DependencyRuleEditorSimplified.tsx",lineNumber:345,columnNumber:5},void 0)},yr=({fieldId:r})=>{const[s,t]=i.useState([]),[o,n]=i.useState(!0),[l,a]=i.useState(null),{api:m}=E(),d=ge(e=>e.blocks),c=i.useMemo(()=>d.flatMap(e=>e.sections.flatMap(e=>e.fields)).map(e=>({id:e.id,name:e.label})).filter(e=>e.id!==r),[d,r]),u=i.useCallback(async()=>{n(!0),a(null);try{const e=await m.get(`/api/fields/${r}/dependencies`),i=Array.isArray(e)?e:(null==e?void 0:e.data)??[];t(i)}catch(e){a("Impossible de charger les d√©pendances.")}finally{n(!1)}},[r,m]);i.useEffect(()=>{u()},[u]);const p=async e=>{const r=[...s];t(r=>r.filter(r=>r.id!==e));try{const r=await m.delete(`/api/dependencies/${e}`),i=Array.isArray(r)?r:(null==r?void 0:r.data)??[];t(i)}catch(i){a("Impossible de supprimer la d√©pendance."),t(r)}},v=async e=>{const r=[...s];t(r=>r.map(r=>r.id===e.id?{...r,...e}:r));try{const r={name:e.name,description:e.description,sequence:e.sequence,targetFieldId:e.targetFieldId,operator:e.operator,value:e.value,action:e.action,prefillValue:e.prefillValue},i=await m.put(`/api/dependencies/${e.id}`,r),s=Array.isArray(i)?i:(null==i?void 0:i.data)??[];t(s)}catch(i){a("Impossible de mettre √† jour la d√©pendance."),t(r)}},b=async e=>{try{{const r={status:"success",evaluated:!0,result:Math.random()>.5},i=r.result?"La condition est v√©rifi√©e ‚úì":"La condition n'est pas v√©rifi√©e ‚úó";return void t(s=>s.map(s=>s.id===e?{...s,_testResult:{status:r.status,message:i,success:r.result}}:s))}}catch(r){t(r=>r.map(r=>r.id===e?{...r,_testResult:{status:"error",message:"Erreur lors du test de la d√©pendance"}}:r))}};return e.jsxDEV("div",{className:"bg-white w-full max-w-full border border-gray-200 rounded-md mb-4 shadow-sm",children:[e.jsxDEV("div",{className:"flex items-center justify-between p-3 bg-gray-50 border-b border-gray-200",children:e.jsxDEV("h3",{className:"text-lg font-medium",children:"D√©pendances Conditionnelles"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:192,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:191,columnNumber:7},void 0),e.jsxDEV("div",{className:"p-4",children:[l&&e.jsxDEV("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:e.jsxDEV("span",{className:"block sm:inline",children:l},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:198,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:197,columnNumber:11},void 0),o?e.jsxDEV("div",{className:"flex justify-center my-8",children:e.jsxDEV("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:204,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:203,columnNumber:11},void 0):e.jsxDEV("div",{className:"space-y-4",children:[0===s.length?e.jsxDEV("p",{className:"text-gray-500 text-center py-4",children:"Aucune d√©pendance d√©finie."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:209,columnNumber:15},void 0):s.map(r=>e.jsxDEV(Sr,{dependency:r,allFields:c,onDelete:p,onUpdate:v,onTest:b},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:212,columnNumber:17},void 0)),e.jsxDEV("div",{className:"mt-6",children:e.jsxDEV("button",{onClick:async()=>{const e=c.find(e=>e.id!==r);if(!e)return void a("Ajoutez au moins un autre champ au formulaire avant de cr√©er une d√©pendance.");const i={action:"show",targetFieldId:e.id,operator:"equals",value:"",name:"Nouvelle d√©pendance",sequence:{conditions:[[{id:`c-${Date.now()}`,targetFieldId:e.id,operator:"equals",value:""}]],action:"show",targetFieldId:e.id}};try{const e=await m.post(`/api/fields/${r}/dependencies`,i),s=Array.isArray(e)?e:(null==e?void 0:e.data)??[];t(s)}catch(s){a("Impossible d'ajouter la d√©pendance (API). Passage en mode local.");const e={...i,id:`dep-${Date.now()}`};t(r=>[...r,e])}},className:"w-full flex items-center justify-center bg-blue-500 text-white rounded-md px-4 py-2 hover:bg-blue-600 transition shadow-sm",children:[e.jsxDEV(pr,{className:"h-5 w-5 mr-2","aria-hidden":"true"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:228,columnNumber:17},void 0),"Ajouter une d√©pendance"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:224,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:223,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:207,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:195,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/dependencies/FieldDependenciesEditor.tsx",lineNumber:190,columnNumber:5},void 0)},Ar=[{value:"text",label:"Texte"},{value:"number",label:"Nombre"},{value:"currency",label:"Devise (‚Ç¨)"},{value:"percentage",label:"Pourcentage (%)"},{value:"date",label:"Date"}],kr=({config:r={},onChange:s})=>{const[t,o]=i.useState(()=>Array.isArray(r.columns)?r.columns:[]),[n,l]=i.useState(()=>Array.isArray(r.rows)?r.rows:[]),[a,m]=i.useState(()=>Array.isArray(r.templates)?r.templates:[]),[d,c]=i.useState(()=>Array.isArray(r.data)?r.data:[]),u=i.useRef(s);i.useEffect(()=>{u.current=s},[s]);const p=i.useMemo(()=>r.crossingData||{},[r.crossingData]);i.useEffect(()=>{Array.isArray(r.columns)&&o(r.columns),Array.isArray(r.rows)&&l(r.rows),Array.isArray(r.templates)&&m(r.templates),Array.isArray(r.data)&&c(r.data)},[r.columns,r.rows,r.templates,r.data]),i.useEffect(()=>{u.current({columns:t,rows:n,templates:a,data:d,crossingData:p})},[t,n,a,d,p]),i.useEffect(()=>{if(!r.crossingData&&r.data&&Array.isArray(r.data)&&r.data.length>0){const e={};r.data.forEach((r,i)=>{var s;const t=(null==(s=n[i])?void 0:s.key)||`row_migrated_${i}`;Object.entries(r).forEach(([r,i])=>{if("_rowKey"!==r&&"_colKey"!==r&&"_value"!==r){e[`${t}_${r}`]=i}})}),s({...r,crossingData:e})}},[r.data,r.crossingData,n,s,r]);const v=(e,r)=>{const i=[...n];i[e]={...i[e],...r},l(i)},b=(e,r)=>{const i=[...t];i[e]={...i[e],...r},o(i)},N=(e,r)=>{const i=[...a];i[e]={...i[e],...r},m(i)},x=(e,i)=>{var s;const t=`${e}_${i}`;return(null==(s=r.crossingData)?void 0:s[t])||""},f=(e,r)=>{if(null==e||""===e)return"";const i=String(e);switch(r){case"number":{const e=parseFloat(i.replace(/[^\d.-]/g,""));return isNaN(e)?0:e}case"currency":{const e=parseFloat(i.replace(/[^\d.-]/g,""));return isNaN(e)?0:e}case"percentage":{const e=parseFloat(i.replace(/[^\d.-]/g,""));return isNaN(e)?0:e}case"date":{const e=new Date(i);return isNaN(e.getTime())?i:e.toISOString().split("T")[0]}default:return i}},D=e=>{if(0===e.length)return"text";let r=0,i=0,s=0;for(const o of e){if(null==o||""===o)continue;const e=String(o);if(/[‚Ç¨$¬£¬•]/.test(e))s++;else{if(e.includes("%"))return"percentage";!isNaN(Date.parse(e))&&e.length>8?i++:isNaN(Number(e))||r++}}const t=e.filter(e=>null!=e&&""!==e).length;return s/t>.5?"currency":i/t>.5?"date":r/t>.7?"number":"text"};return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-blue-800",children:"Import Excel"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:477,columnNumber:11},void 0),e.jsxDEV("div",{className:"text-xs text-blue-600",children:"Importez un fichier Excel pour cr√©er automatiquement colonnes, lignes et donn√©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:478,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:476,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-center gap-4",children:[e.jsxDEV("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var i;const t=null==(i=e.target.files)?void 0:i[0];if(!t)return;const o=new FileReader;o.onload=i=>{var t;try{const o=null==(t=i.target)?void 0:t.result,n=Me(o,{type:"array"}),l=n.SheetNames[0],a=n.Sheets[l],m=Ue.sheet_to_json(a,{header:1});if(m.length<2)return void alert("Le fichier Excel doit contenir au moins 2 lignes (en-t√™tes + donn√©es)");const d=m[0],c=[],u={};for(let e=1;e<d.length;e++)if(d[e]){u[e]=[];for(let r=1;r<m.length;r++){const i=m[r];void 0!==i[e]&&null!==i[e]&&u[e].push(i[e])}c.push({key:`col_${Date.now()}_${e}`,label:String(d[e]),type:D(u[e])})}const p=[],v={};for(let e=1;e<m.length;e++){const r=m[e];if(r.length>0&&r[0]){const i=`row_${Date.now()}_${e}`;p.push({key:i,label:String(r[0])});for(let e=1;e<r.length&&e-1<c.length;e++){const s=c[e-1],t=s.key,o=r[e];if(null!=o&&""!==o){const e=`${i}_${t}`,r=f(o,s.type);v[e]=r}}}}const b={...r,columns:c,rows:p,crossingData:v};s(b),e.target.value="";const N=Object.keys(v).length,x=c.reduce((e,r)=>(e[r.type]=(e[r.type]||0)+1,e),{}),h=Object.entries(x).map(([e,r])=>`${r} ${e}`).join(", ");alert(`Import r√©ussi ! \n${c.length} colonnes (${h}) \n${p.length} lignes \n${N} cellules avec donn√©es import√©es.`)}catch(o){alert("Erreur lors de l'import Excel. V√©rifiez le format du fichier.")}},o.readAsArrayBuffer(t)},className:"hidden",id:"excel-import-input"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:483,columnNumber:11},void 0),e.jsxDEV("label",{htmlFor:"excel-import-input",className:"cursor-pointer inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors",children:"üìä Importer Excel"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:490,columnNumber:11},void 0),e.jsxDEV("button",{type:"button",onClick:()=>{const e=Ue.aoa_to_sheet([["","Janvier","F√©vrier","Mars","Avril"],["Ventes",1500,1800,2100,1950],["Co√ªts",800,900,1e3,850],["B√©n√©fices",700,900,1100,1100],["Taux (%)","15%","20%","25%","22%"]]),r=Ue.book_new();Ue.book_append_sheet(r,e,"Exemple"),Fe(r,"exemple-tableau-croisement.xlsx")},className:"inline-flex items-center px-3 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-md hover:bg-gray-200 transition-colors",children:"üì• T√©l√©charger exemple"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:496,columnNumber:11},void 0),t.length>0&&n.length>0&&e.jsxDEV("button",{type:"button",onClick:()=>{if(0===t.length||0===n.length)return void alert("Aucune donn√©e √† exporter. Cr√©ez d'abord des colonnes et des lignes.");const e=[],r=["",...t.map(e=>e.label)];e.push(r),n.forEach(r=>{const i=[r.label];t.forEach(e=>{const s=x(r.key,e.key);i.push(s||"")}),e.push(i)});const i=Ue.aoa_to_sheet(e),s=Ue.book_new();Ue.book_append_sheet(s,i,"Tableau"),Fe(s,"tableau-croisement-export.xlsx")},className:"inline-flex items-center px-3 py-2 bg-green-100 text-green-700 text-sm font-medium rounded-md hover:bg-green-200 transition-colors",children:"üì§ Exporter Excel"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:504,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-xs text-gray-600",children:"Format attendu : Premi√®re ligne = en-t√™tes des colonnes, Premi√®re colonne = libell√©s des lignes"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:512,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:482,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:475,columnNumber:7},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-gray-700",children:"Colonnes du tableau"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:521,columnNumber:11},void 0),e.jsxDEV("button",{type:"button",onClick:()=>{const e={key:`col_${Date.now()}`,label:`Colonne ${t.length+1}`,type:"text"};o([...t,e])},className:"btn btn-sm btn-primary",children:"+ Ajouter une colonne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:522,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:520,columnNumber:9},void 0),0===t.length?e.jsxDEV("div",{className:"text-sm text-gray-500 p-4 bg-gray-50 rounded border-2 border-dashed",children:"Aucune colonne d√©finie. Ajoutez au moins une colonne pour cr√©er votre tableau."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:532,columnNumber:11},void 0):e.jsxDEV("div",{className:"space-y-3",children:t.map((r,i)=>e.jsxDEV("div",{className:"border border-gray-200 rounded p-3 bg-white",children:e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Nom de la colonne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:541,columnNumber:21},void 0),e.jsxDEV("input",{type:"text",value:r.label,onChange:e=>b(i,{label:e.target.value}),className:"input input-bordered input-sm w-full",placeholder:"Ex: Nom du produit"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:544,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:540,columnNumber:19},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Cl√© technique"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:554,columnNumber:21},void 0),e.jsxDEV("input",{type:"text",value:r.key,onChange:e=>b(i,{key:e.target.value}),className:"input input-bordered input-sm w-full",placeholder:"Ex: nom_produit"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:557,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:553,columnNumber:19},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Type de donn√©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:567,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex gap-1",children:[e.jsxDEV("select",{value:r.type,onChange:e=>b(i,{type:e.target.value}),className:"select select-bordered select-sm flex-1",children:Ar.map(r=>e.jsxDEV("option",{value:r.value,children:r.label},r.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:577,columnNumber:27},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:571,columnNumber:23},void 0),e.jsxDEV("button",{type:"button",onClick:()=>(e=>{o(t.filter((r,i)=>i!==e))})(i),className:"btn btn-sm btn-error btn-outline",title:"Supprimer cette colonne",children:"üóëÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:582,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:570,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:566,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:539,columnNumber:17},void 0)},r.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:538,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:536,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:519,columnNumber:7},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-gray-700",children:"Lignes du tableau"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:602,columnNumber:11},void 0),e.jsxDEV("button",{type:"button",onClick:()=>{const e={key:`row_${Date.now()}`,label:`Ligne ${n.length+1}`};l([...n,e])},className:"btn btn-sm btn-secondary",children:"+ Ajouter une ligne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:603,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:601,columnNumber:9},void 0),0===n.length?e.jsxDEV("div",{className:"text-sm text-gray-500 p-4 bg-gray-50 rounded border-2 border-dashed",children:"Aucune ligne d√©finie. Ajoutez des lignes pour structurer votre tableau de croisement."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:613,columnNumber:11},void 0):e.jsxDEV("div",{className:"space-y-3",children:n.map((r,i)=>e.jsxDEV("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Nom de la ligne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:622,columnNumber:21},void 0),e.jsxDEV("input",{type:"text",value:r.label,onChange:e=>v(i,{label:e.target.value}),className:"input input-bordered input-sm w-full",placeholder:"Ex: Produit A"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:625,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:621,columnNumber:19},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Cl√© technique"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:635,columnNumber:21},void 0),e.jsxDEV("input",{type:"text",value:r.key,onChange:e=>v(i,{key:e.target.value}),className:"input input-bordered input-sm w-full",placeholder:"Ex: produit_a"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:638,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:634,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:620,columnNumber:17},void 0),e.jsxDEV("div",{className:"mt-2 flex justify-end",children:e.jsxDEV("button",{type:"button",onClick:()=>(e=>{l(n.filter((r,i)=>i!==e))})(i),className:"text-red-600 hover:text-red-800 text-sm",title:"Supprimer cette ligne",children:"üóëÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:649,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:648,columnNumber:17},void 0)]},r.key,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:619,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:617,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:600,columnNumber:7},void 0),t.length>0&&n.length>0&&e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-gray-700",children:"Donn√©es de croisement"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:668,columnNumber:13},void 0),e.jsxDEV("div",{className:"text-xs text-gray-500",children:"Remplissez les cellules aux intersections lignes √ó colonnes"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:669,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:667,columnNumber:11},void 0),e.jsxDEV("div",{className:"border border-gray-300 rounded overflow-hidden bg-white",children:e.jsxDEV("table",{className:"min-w-full text-sm border-collapse",children:[e.jsxDEV("thead",{children:e.jsxDEV("tr",{className:"bg-gray-100",children:[e.jsxDEV("th",{className:"px-3 py-2 text-center font-medium text-gray-700 border border-gray-300 bg-gray-200"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:678,columnNumber:19},void 0),t.map(r=>e.jsxDEV("th",{className:"px-3 py-2 text-center font-medium text-gray-700 border border-gray-300",children:r.label},r.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:682,columnNumber:21},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:677,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:676,columnNumber:15},void 0),e.jsxDEV("tbody",{children:n.map(i=>e.jsxDEV("tr",{children:[e.jsxDEV("td",{className:"px-3 py-2 text-center font-medium text-gray-700 bg-gray-100 border border-gray-300",children:i.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:691,columnNumber:21},void 0),t.map(t=>e.jsxDEV("td",{className:"border border-gray-300 p-1",children:e.jsxDEV("input",{type:"number"===t.type||"currency"===t.type||"percentage"===t.type?"number":"date"===t.type?"date":"text",step:"currency"===t.type||"percentage"===t.type?"0.01":void 0,value:String(x(i.key,t.key)),onChange:e=>{let o=e.target.value;"number"!==t.type&&"currency"!==t.type&&"percentage"!==t.type||(o=""===e.target.value?0:parseFloat(e.target.value)||0),((e,i,t)=>{const o=`${e}_${i}`,n={...r.crossingData,[o]:t};s({...r,crossingData:n})})(i.key,t.key,o)},className:"w-full px-2 py-1 text-sm border-0 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center",placeholder:"currency"===t.type?"0.00":"percentage"===t.type?"0%":"..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:696,columnNumber:25},void 0)},t.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:695,columnNumber:23},void 0))]},i.key,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:690,columnNumber:19},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:688,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:675,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:674,columnNumber:11},void 0),e.jsxDEV("div",{className:"mt-2 text-xs text-gray-600",children:["üìä Tableau de ",n.length," √ó ",t.length," = ",n.length*t.length," cellules de croisement"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:718,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:666,columnNumber:9},void 0),(0===t.length||0===n.length)&&e.jsxDEV("div",{className:"bg-yellow-50 p-4 rounded border border-yellow-200",children:e.jsxDEV("div",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è D√©finissez d'abord les colonnes et les lignes pour pouvoir saisir les donn√©es de croisement"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:727,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:726,columnNumber:9},void 0),t.length>0&&0===n.length&&e.jsxDEV("div",{className:"bg-yellow-50 p-4 rounded border border-yellow-200",children:e.jsxDEV("div",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Ajoutez des lignes pour voir l'aper√ßu du tableau de croisement"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:736,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:735,columnNumber:9},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"flex items-center justify-between mb-3",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-gray-700",children:"Templates de donn√©es"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:745,columnNumber:11},void 0),e.jsxDEV("button",{type:"button",onClick:()=>{const e={name:`Template ${a.length+1}`,description:"Nouveau template",data:[]};m([...a,e])},disabled:0===t.length,className:"btn btn-sm btn-secondary",title:0===t.length?"D√©finissez d'abord les colonnes":"",children:"+ Ajouter un template"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:746,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:744,columnNumber:9},void 0),0===a.length?e.jsxDEV("div",{className:"text-sm text-gray-500 p-4 bg-gray-50 rounded border-2 border-dashed",children:"Aucun template d√©fini. Les templates permettent d'ajouter rapidement des donn√©es pr√©-configur√©es."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:758,columnNumber:11},void 0):e.jsxDEV("div",{className:"space-y-3",children:a.map((r,i)=>e.jsxDEV("div",{className:"border border-gray-200 rounded p-3 bg-white",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Nom du template"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:767,columnNumber:21},void 0),e.jsxDEV("input",{type:"text",value:r.name,onChange:e=>N(i,{name:e.target.value}),className:"input input-bordered input-sm w-full",placeholder:"Ex: Panneaux solaires"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:770,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:766,columnNumber:19},void 0),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Description"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:780,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex gap-1",children:[e.jsxDEV("input",{type:"text",value:r.description||"",onChange:e=>N(i,{description:e.target.value}),className:"input input-bordered input-sm flex-1",placeholder:"Ex: Gamme standard"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:784,columnNumber:23},void 0),e.jsxDEV("button",{type:"button",onClick:()=>(e=>{m(a.filter((r,i)=>i!==e))})(i),className:"btn btn-sm btn-error btn-outline",title:"Supprimer ce template",children:"üóëÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:791,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:783,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:779,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:765,columnNumber:17},void 0),e.jsxDEV("div",{className:"mt-4 space-y-3",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("h5",{className:"text-xs font-medium text-gray-700",children:"Donn√©es pr√©-remplies"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:806,columnNumber:21},void 0),e.jsxDEV("button",{type:"button",onClick:()=>(e=>{const r={};t.forEach(e=>{r[e.key]="number"===e.type||"currency"===e.type||"percentage"===e.type?0:""});const i=[...a];i[e]={...i[e],data:[...i[e].data,r]},m(i)})(i),disabled:0===t.length,className:"btn btn-xs btn-success",title:"Ajouter une ligne de donn√©es",children:"+ Ligne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:807,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:805,columnNumber:19},void 0),0===r.data.length?e.jsxDEV("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded border border-dashed",children:'Aucune donn√©e. Cliquez sur "+ Ligne" pour ajouter des donn√©es pr√©-remplies.'},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:819,columnNumber:21},void 0):e.jsxDEV("div",{className:"border border-gray-300 rounded overflow-hidden",children:e.jsxDEV("table",{className:"min-w-full text-xs",children:[e.jsxDEV("thead",{className:"bg-gray-100",children:e.jsxDEV("tr",{children:[t.map(r=>e.jsxDEV("th",{className:"px-2 py-1 text-left font-medium text-gray-700",children:r.label},r.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:828,columnNumber:31},void 0)),e.jsxDEV("th",{className:"px-2 py-1 text-center w-16",children:"Actions"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:832,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:826,columnNumber:27},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:825,columnNumber:25},void 0),e.jsxDEV("tbody",{className:"divide-y divide-gray-200",children:r.data.map((r,s)=>e.jsxDEV("tr",{className:"hover:bg-gray-50",children:[t.map(t=>e.jsxDEV("td",{className:"px-2 py-1",children:e.jsxDEV("input",{type:"number"===t.type||"currency"===t.type||"percentage"===t.type?"number":"date"===t.type?"date":"text",step:"currency"===t.type||"percentage"===t.type?"0.01":void 0,value:String(r[t.key]||""),onChange:e=>{let r=e.target.value;"number"!==t.type&&"currency"!==t.type&&"percentage"!==t.type||(r=""===e.target.value?0:parseFloat(e.target.value)||0),((e,r,i,s)=>{const t=[...a],o=[...t[e].data];o[r]={...o[r],[i]:s},t[e]={...t[e],data:o},m(t)})(i,s,t.key,r)},className:"w-full px-1 py-0.5 text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:t.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:840,columnNumber:35},void 0)},t.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:839,columnNumber:33},void 0)),e.jsxDEV("td",{className:"px-2 py-1 text-center",children:e.jsxDEV("button",{type:"button",onClick:()=>((e,r)=>{const i=[...a];i[e]={...i[e],data:i[e].data.filter((e,i)=>i!==r)},m(i)})(i,s),className:"text-red-600 hover:text-red-800 text-xs",title:"Supprimer cette ligne",children:"üóëÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:857,columnNumber:33},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:856,columnNumber:31},void 0)]},s,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:837,columnNumber:29},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:835,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:824,columnNumber:23},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:823,columnNumber:21},void 0),r.data.length>0&&e.jsxDEV("div",{className:"text-xs text-gray-600",children:["üìä ",r.data.length," ligne(s) de donn√©es - Ces donn√©es seront disponibles lors de la cr√©ation de devis"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:874,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:804,columnNumber:17},void 0)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:764,columnNumber:15},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:762,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:743,columnNumber:7},void 0),t.length>0&&e.jsxDEV("div",{className:"bg-blue-50 p-4 rounded border border-blue-200",children:[e.jsxDEV("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"üìä Aper√ßu du tableau"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:888,columnNumber:11},void 0),e.jsxDEV("div",{className:"text-xs text-blue-700",children:[e.jsxDEV("div",{children:[e.jsxDEV("strong",{children:"Colonnes :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:890,columnNumber:18},void 0)," ",t.map(e=>`${e.label} (${e.type})`).join(", ")]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:890,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("strong",{children:"Donn√©es :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:891,columnNumber:18},void 0)," ",d.length," ligne(s) de donn√©es principales"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:891,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("strong",{children:"Templates :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:892,columnNumber:18},void 0)," ",a.length," template(s) d√©fini(s)"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:892,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("strong",{children:"Usage :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:893,columnNumber:18},void 0)," Ce tableau sera disponible dans les devis avec les donn√©es pr√©-remplies"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:893,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:889,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:887,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TableauConfigEditor.tsx",lineNumber:473,columnNumber:5},void 0)},{Text:Or,Title:Rr}=q,{Option:jr}=$,Mr=({type:r})=>{switch(r){case"O":return e.jsxDEV(Ne,{className:"text-blue-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:44,columnNumber:14},void 0);case"O+C":return e.jsxDEV(j,{className:"text-green-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:46,columnNumber:14},void 0);case"C":return e.jsxDEV(oe,{className:"text-yellow-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:48,columnNumber:14},void 0)}},Ur=({type:r})=>e.jsxDEV("span",{className:`px-2 py-1 rounded-full text-xs font-bold border ${{O:"bg-blue-100 text-blue-800 border-blue-300","O+C":"bg-green-100 text-green-800 border-green-300",C:"bg-yellow-100 text-yellow-800 border-yellow-300"}[r]}`,children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:61,columnNumber:5},void 0);function Fr(e){const[r,s]=i.useState([]),[t,o]=i.useState(!1),{api:n}=E(),l=i.useCallback(async()=>{if(e){o(!0);try{const r=await n.get(`/api/option-nodes/field/${e}/tree`);if(r.success&&r.tree){const e=r.tree.map(e=>({id:e.id,label:e.label,type:e.fieldType?"O+C":"O",parentId:e.parentId,fieldId:e.fieldId,order:e.order||0,level:e.level||0,fieldType:e.fieldType,fieldConfig:e.fieldConfig,children:[]}));s(function(e){const r=new Map,i=[];return e.forEach(e=>{r.set(e.id,{...e,children:[]})}),e.forEach(e=>{const s=r.get(e.id);if(e.parentId&&r.has(e.parentId)){r.get(e.parentId).children.push(s)}else i.push(s)}),i.sort((e,r)=>e.order-r.order)}(e))}}catch(r){}finally{o(!1)}}},[e,n]),a=i.useCallback(async(i,s,t,o,a)=>{try{(await n.post("/api/option-nodes",{label:s,value:s.toLowerCase().replace(/\s+/g,"-"),parentId:i,fieldId:e,nodeType:"C"===t?"field-only":"O+C"===t?"option-with-field":"option",fieldType:o,fieldConfig:a,order:r.length})).success&&await l()}catch(m){}},[n,e,r.length,l]),m=i.useCallback(async(e,r)=>{try{await n.put(`/api/option-nodes/${e}`,r),await l()}catch(i){}},[n,l]),d=i.useCallback(async e=>{try{await n.delete(`/api/option-nodes/${e}`),await l()}catch(r){}},[n,l]);return{tree:r,loading:t,loadTree:l,addNode:a,updateNode:m,deleteNode:d}}const wr=({node:r,level:s,onEdit:t,onDelete:o,onAddChild:n,onDrop:l,isDragOver:a,onDragOver:m,onDragLeave:d})=>{var c;const[u,p]=i.useState(!1),[v,b]=i.useState(""),N=r.children&&r.children.length>0,x=24*s;return e.jsxDEV("div",{className:"select-none",children:[e.jsxDEV("div",{className:"flex items-center py-2 px-3 hover:bg-gray-50 rounded cursor-pointer group transition-all duration-200 "+(a?"bg-yellow-100 border-2 border-yellow-400 border-dashed scale-105":""),style:{paddingLeft:x+12},onDrop:e=>{e.preventDefault(),e.stopPropagation();const i=e.dataTransfer.getData("text/plain");i&&l(r.id,i)},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),m(r.id)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),d()},children:[a&&e.jsxDEV("div",{className:"absolute inset-0 flex items-center justify-center bg-yellow-200 bg-opacity-75 rounded",children:e.jsxDEV(Or,{className:"font-bold text-yellow-800",children:"üéØ D√âPOSER ICI"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:245,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:244,columnNumber:11},void 0),e.jsxDEV("div",{className:"w-4 flex justify-center mr-2",children:N?e.jsxDEV(_,{type:"text",size:"small",icon:u?e.jsxDEV(xe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:257,columnNumber:32},void 0):e.jsxDEV(fe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:257,columnNumber:56},void 0),onClick:()=>p(!u),className:"w-4 h-4 p-0 flex items-center justify-center"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:254,columnNumber:13},void 0):e.jsxDEV("span",{className:"w-4 h-4 flex items-center justify-center",children:e.jsxDEV("span",{className:"w-1 h-1 bg-gray-400 rounded-full"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:263,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:262,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:252,columnNumber:9},void 0),e.jsxDEV(Mr,{type:r.type},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:269,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex items-center flex-1 mr-4",children:[e.jsxDEV("span",{className:"font-medium text-gray-800 mr-3",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:273,columnNumber:11},void 0),e.jsxDEV(Ur,{type:r.type},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:274,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:272,columnNumber:9},void 0),e.jsxDEV("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex items-center space-x-1",children:[e.jsxDEV(B,{title:"Modifier",children:e.jsxDEV(_,{type:"text",size:"small",icon:e.jsxDEV(Q,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:283,columnNumber:21},void 0),onClick:e=>{e.stopPropagation(),t(r)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:280,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:279,columnNumber:11},void 0),e.jsxDEV(B,{title:"Ajouter enfant",children:e.jsxDEV(_,{type:"text",size:"small",icon:e.jsxDEV(z,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:295,columnNumber:21},void 0),onClick:e=>{e.stopPropagation(),n(r.id)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:292,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:291,columnNumber:11},void 0),e.jsxDEV(B,{title:"Supprimer",children:e.jsxDEV(_,{type:"text",danger:!0,size:"small",icon:e.jsxDEV(W,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:308,columnNumber:21},void 0),onClick:e=>{e.stopPropagation(),o(r.id)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:304,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:303,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:278,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:233,columnNumber:7},void 0),("O+C"===r.type||"C"===r.type)&&u&&e.jsxDEV("div",{className:"mb-2",style:{paddingLeft:x+40},children:e.jsxDEV("div",{className:"bg-gray-50 border border-gray-200 rounded p-3",children:[e.jsxDEV(Or,{className:"text-xs text-gray-600 block mb-2",children:"Aper√ßu du champ pour les utilisateurs :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:322,columnNumber:13},void 0),e.jsxDEV(L,{placeholder:(null==(c=r.fieldConfig)?void 0:c.placeholder)||`Valeur pour ${r.label}`,value:v,onChange:e=>b(e.target.value),className:"w-full"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:325,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:321,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:320,columnNumber:9},void 0),u&&N&&e.jsxDEV("div",{className:"border-l border-gray-200 ml-3",style:{marginLeft:x+16},children:r.children.map(r=>e.jsxDEV(wr,{node:r,level:s+1,onEdit:t,onDelete:o,onAddChild:n,onDrop:l,isDragOver:a&&"current-drag-over"===r.id,onDragOver:m,onDragLeave:d},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:339,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:337,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:231,columnNumber:5},void 0)},Ir=({isOpen:r,node:s,onClose:t,onConfirm:o})=>{const[n,l]=i.useState(""),[a,m]=i.useState("O"),[d,c]=i.useState("text"),[u,p]=i.useState(!1),[v,b]=i.useState("");i.useEffect(()=>{var e,r;s?(l(s.label),m(s.type),c(s.fieldType||"text"),p((null==(e=s.fieldConfig)?void 0:e.required)||!1),b((null==(r=s.fieldConfig)?void 0:r.placeholder)||"")):(l(""),m("O"),c("text"),p(!1),b(""))},[s,r]);return e.jsxDEV(ee,{title:s?"Modifier l'√©l√©ment":"Nouvel √©l√©ment",open:r,onOk:()=>{const e={label:n,type:a,fieldType:"O+C"===a||"C"===a?d:void 0,fieldConfig:"O+C"===a||"C"===a?{required:u,placeholder:v||`Saisir ${n.toLowerCase()}...`}:void 0};o(e),t()},onCancel:t,okText:"Confirmer",cancelText:"Annuler",width:600,children:e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{children:[e.jsxDEV(Or,{strong:!0,children:"Label de l'√©l√©ment :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:414,columnNumber:11},void 0),e.jsxDEV(L,{value:n,onChange:e=>l(e.target.value),placeholder:"Ex: Isolation murale",className:"mt-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:415,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:413,columnNumber:9},void 0),e.jsxDEV("div",{children:[e.jsxDEV(Or,{strong:!0,children:"Type d'√©l√©ment :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:424,columnNumber:11},void 0),e.jsxDEV($,{value:a,onChange:m,className:"mt-2 w-full",children:[e.jsxDEV(jr,{value:"O",children:[e.jsxDEV(Ne,{className:"text-blue-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:431,columnNumber:15},void 0),"O - Option seule (choix fixe)"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:430,columnNumber:13},void 0),e.jsxDEV(jr,{value:"O+C",children:[e.jsxDEV(j,{className:"text-green-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:435,columnNumber:15},void 0),"O+C - Option + Champ (choix + saisie)"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:434,columnNumber:13},void 0),e.jsxDEV(jr,{value:"C",children:[e.jsxDEV(oe,{className:"text-yellow-600 mr-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:439,columnNumber:15},void 0),"C - Champ seul (saisie libre)"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:438,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:425,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:423,columnNumber:9},void 0),("O+C"===a||"C"===a)&&e.jsxDEV(e.Fragment,{children:[e.jsxDEV(De,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:447,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV(Or,{strong:!0,children:"Configuration du champ :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:449,columnNumber:15},void 0),e.jsxDEV("div",{className:"mt-4 space-y-4",children:[e.jsxDEV("div",{children:[e.jsxDEV(Or,{children:"Type de champ :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:453,columnNumber:19},void 0),e.jsxDEV($,{value:d,onChange:c,className:"mt-2 w-full",children:[e.jsxDEV(jr,{value:"text",children:"Texte"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:459,columnNumber:21},void 0),e.jsxDEV(jr,{value:"number",children:"Nombre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:460,columnNumber:21},void 0),e.jsxDEV(jr,{value:"date",children:"Date"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:461,columnNumber:21},void 0),e.jsxDEV(jr,{value:"select",children:"Liste d√©roulante"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:462,columnNumber:21},void 0),e.jsxDEV(jr,{value:"boolean",children:"Oui/Non"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:463,columnNumber:21},void 0),e.jsxDEV(jr,{value:"file",children:"Fichier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:464,columnNumber:21},void 0),e.jsxDEV(jr,{value:"image",children:"Image"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:465,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:454,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:452,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV(Or,{children:"Placeholder :"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:470,columnNumber:19},void 0),e.jsxDEV(L,{value:v,onChange:e=>b(e.target.value),placeholder:`Ex: Saisir ${n.toLowerCase()}...`,className:"mt-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:471,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:469,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-center",children:[e.jsxDEV(Z,{checked:u,onChange:p,className:"mr-3"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:480,columnNumber:19},void 0),e.jsxDEV(Or,{children:"Champ obligatoire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:485,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:479,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:451,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:448,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:446,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:412,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:403,columnNumber:5},void 0)},Tr=({onDragStart:r})=>e.jsxDEV("div",{className:"w-48 bg-gradient-to-b from-blue-50 to-green-50 border-r-2 border-gray-300 p-4",children:[e.jsxDEV(Rr,{level:5,className:"text-center mb-4",children:"üéØ Palette Drag & Drop"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:508,columnNumber:7},void 0),e.jsxDEV("div",{className:"space-y-4",children:[e.jsxDEV("div",{draggable:!0,onDragStart:e=>{r("O"),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain","O")},className:"bg-blue-400 border-2 border-blue-600 rounded-lg p-3 cursor-grab active:cursor-grabbing hover:bg-blue-500 hover:scale-105 transition-all duration-200 shadow-lg",children:e.jsxDEV("div",{className:"flex items-center justify-center text-white",children:[e.jsxDEV(Ne,{className:"mr-2 text-lg"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:524,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-bold",children:"O"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:526,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-xs",children:"Option seule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:527,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:525,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:523,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:514,columnNumber:9},void 0),e.jsxDEV("div",{draggable:!0,onDragStart:e=>{r("O+C"),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain","O+C")},className:"bg-green-500 border-2 border-green-700 rounded-lg p-3 cursor-grab active:cursor-grabbing hover:bg-green-600 hover:scale-105 transition-all duration-200 shadow-lg",children:e.jsxDEV("div",{className:"flex items-center justify-center text-white",children:[e.jsxDEV(j,{className:"mr-2 text-lg"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:543,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-bold",children:"O + C"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:545,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-xs",children:"Option + Champ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:546,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:544,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:542,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:533,columnNumber:9},void 0),e.jsxDEV("div",{draggable:!0,onDragStart:e=>{r("C"),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain","C")},className:"bg-yellow-400 border-2 border-yellow-600 rounded-lg p-3 cursor-grab active:cursor-grabbing hover:bg-yellow-500 hover:scale-105 transition-all duration-200 shadow-lg",children:e.jsxDEV("div",{className:"flex items-center justify-center text-white",children:[e.jsxDEV(oe,{className:"mr-2 text-lg"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:562,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-bold",children:"C"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:564,columnNumber:15},void 0),e.jsxDEV("div",{className:"text-xs",children:"Champ seul"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:565,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:563,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:561,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:552,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:512,columnNumber:7},void 0),e.jsxDEV("div",{className:"mt-6 p-3 bg-white rounded-lg border border-gray-200",children:e.jsxDEV("div",{className:"text-xs text-gray-600 text-center",children:[e.jsxDEV("div",{className:"font-bold mb-2",children:"üñ±Ô∏è Glisser-D√©poser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:573,columnNumber:11},void 0),e.jsxDEV("div",{children:"Faites glisser les √©l√©ments vers l'arbre ‚Üí"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:574,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:572,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:571,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:507,columnNumber:5},void 0),Pr=({fieldId:r,onTreeChange:s})=>{const[t,o]=i.useState({isOpen:!1,node:null,parentId:null}),[n,l]=i.useState({draggedType:null,dragOverNode:null}),{tree:a,loading:m,loadTree:d,addNode:c,updateNode:u,deleteNode:p}=Fr(r);i.useEffect(()=>{d()},[d]),i.useEffect(()=>{s&&s(a)},[a,s]);const v=e=>{l(r=>({...r,dragOverNode:e}))},b=()=>{l(e=>({...e,dragOverNode:null}))},N=async(e,r)=>{try{const i=a.filter(r=>r.parentId===e),s=`${"O"===r?"Option":"O+C"===r?"Option+Champ":"Champ"} ${i.length+1}`;"O+C"===r||"C"===r?o({isOpen:!0,node:null,parentId:e}):await c(e,s,r),l({draggedType:null,dragOverNode:null})}catch(i){}},x=async e=>{e.preventDefault();const r=e.dataTransfer.getData("text/plain");r&&await N(null,r)},f=e=>{e.preventDefault()},D=e=>{o({isOpen:!0,node:null,parentId:e})},h=e=>{o({isOpen:!0,node:e,parentId:e.parentId})},E=e=>{ee.confirm({title:"Supprimer cet √©l√©ment ?",content:"Cette action supprimera √©galement tous les √©l√©ments enfants.",okText:"Supprimer",cancelText:"Annuler",okType:"danger",onOk:()=>p(e)})};return m?e.jsxDEV(G,{className:"h-96",children:e.jsxDEV("div",{className:"flex items-center justify-center h-full",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:725,columnNumber:13},void 0),e.jsxDEV(Or,{children:"Chargement de l'explorateur..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:726,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:724,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:723,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:722,columnNumber:7},void 0):e.jsxDEV(G,{className:"w-full shadow-lg",children:[e.jsxDEV("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 text-white p-6 -m-6 mb-6 rounded-t-lg",children:e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV(Rr,{level:3,className:"text-white mb-2",children:"üéØ Explorateur G√©n√©alogique Pro - DRAG & DROP"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:738,columnNumber:11},void 0),e.jsxDEV(Or,{className:"text-blue-100",children:"Interface Super Admin ‚Ä¢ Glisser-D√©poser ‚Ä¢ Types O/O+C/C ‚Ä¢ Structure Infinie"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:741,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:737,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:736,columnNumber:7},void 0),e.jsxDEV("div",{className:"flex border-2 border-gray-300 rounded-lg overflow-hidden",style:{minHeight:"600px"},children:[e.jsxDEV(Tr,{onDragStart:e=>{l(r=>({...r,draggedType:e}))}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:750,columnNumber:9},void 0),e.jsxDEV("div",{className:"flex-1 flex flex-col",children:[e.jsxDEV("div",{className:"p-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center",children:[e.jsxDEV("div",{className:"flex space-x-2",children:e.jsxDEV(_,{type:"primary",icon:e.jsxDEV(z,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:759,columnNumber:23},void 0),onClick:()=>{o({isOpen:!0,node:null,parentId:null})},size:"small",children:"Ajouter manuellement"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:757,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:756,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex items-center space-x-4 text-xs",children:[e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV(Ur,{type:"O"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:769,columnNumber:17},void 0),e.jsxDEV(Or,{className:"text-gray-600",children:"Options seules"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:770,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:768,columnNumber:15},void 0),e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV(Ur,{type:"O+C"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:773,columnNumber:17},void 0),e.jsxDEV(Or,{className:"text-gray-600",children:"Options + Champs"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:774,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:772,columnNumber:15},void 0),e.jsxDEV("div",{className:"flex items-center space-x-2",children:[e.jsxDEV(Ur,{type:"C"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:777,columnNumber:17},void 0),e.jsxDEV(Or,{className:"text-gray-600",children:"Champs seuls"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:778,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:776,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:767,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:755,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex-1 bg-white overflow-auto",onDrop:x,onDragOver:f,children:0===a.length?e.jsxDEV("div",{className:"flex items-center justify-center h-full",children:e.jsxDEV("div",{className:"text-center p-8",children:[e.jsxDEV("div",{className:"text-6xl mb-4",children:"üå≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:792,columnNumber:19},void 0),e.jsxDEV(Rr,{level:4,className:"mb-4",children:"Arbre vide - Glissez pour cr√©er !"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:793,columnNumber:19},void 0),e.jsxDEV(Or,{className:"text-gray-600 block mb-6",children:["Faites glisser les √©l√©ments de la palette vers cette zone",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:797,columnNumber:78},void 0),'ou utilisez le bouton "Ajouter manuellement"']},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:796,columnNumber:19},void 0),e.jsxDEV("div",{className:"bg-yellow-50 border-2 border-dashed border-yellow-300 rounded-lg p-8 animate-pulse",children:e.jsxDEV(Or,{className:"text-yellow-700 font-bold",children:"üéØ ZONE DE D√âP√îT PRINCIPALE"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:801,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:800,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:791,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:790,columnNumber:15},void 0):e.jsxDEV("div",{className:"p-4",children:[a.map(r=>e.jsxDEV(wr,{node:r,level:0,onEdit:h,onDelete:E,onAddChild:D,onDrop:N,isDragOver:n.dragOverNode===r.id,onDragOver:v,onDragLeave:b},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:810,columnNumber:19},void 0)),e.jsxDEV("div",{className:"mt-4 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-colors duration-200",onDrop:x,onDragOver:f,children:e.jsxDEV("div",{className:"text-center text-gray-500",children:[e.jsxDEV(z,{className:"text-2xl mb-2"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:831,columnNumber:21},void 0),e.jsxDEV("div",{children:"Glissez ici pour ajouter un nouvel √©l√©ment racine"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:832,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:830,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:825,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:808,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:784,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:753,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:748,columnNumber:7},void 0),e.jsxDEV(Ir,{isOpen:t.isOpen,node:t.node,onClose:()=>o({isOpen:!1,node:null,parentId:null}),onConfirm:async e=>{t.node?await u(t.node.id,e):await c(t.parentId,e.label,e.type,e.fieldType,e.fieldConfig),o({isOpen:!1,node:null,parentId:null})}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:842,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/GenealogyExplorer/index.tsx",lineNumber:734,columnNumber:5},void 0)},{Text:qr}=q,{Title:Lr,Text:$r}=q,{TabPane:_r}=re,zr=e=>e.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-"),Gr=[{key:"parametres",label:"Param√®tres",icon:e.jsxDEV(he,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:37,columnNumber:11},void 0),tooltip:"Propri√©t√©s simples du champ"},{key:"formules",label:"Formules",icon:e.jsxDEV(k,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:43,columnNumber:9},void 0),tooltip:"√âditeur de formules dynamiques"},{key:"validations",label:"Validations",icon:e.jsxDEV(Ce,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:49,columnNumber:11},void 0),tooltip:"R√®gles de validation du champ"},{key:"dependances",label:"D√©pendances",icon:e.jsxDEV(ue,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:55,columnNumber:11},void 0),tooltip:"D√©pendances et conditions"}],Br=({selectedField:r})=>{const[s,t]=i.useState(void 0),[o,n]=i.useState("parametres"),{blocks:l,updateField:a,fieldMetaCounts:m}=ge(),{get:d}=E(),[c,u]=i.useState([]),p=i.useRef(new Set),v=null==r?void 0:r.fieldId,b=i.useMemo(()=>{if(!v)return null;for(const e of l)for(const r of e.sections??[]){const e=r.fields.find(e=>String(e.id)===String(v));if(e)return e}return null},[v,l]);i.useEffect(()=>{c.length},[c]),i.useEffect(()=>{},[b]);const N=(null==b?void 0:b.advancedConfig)||{},[x,f]=i.useState({}),[D,h]=i.useState({}),[C,g]=i.useState({});i.useEffect(()=>{v&&v!==s&&(g({}),p.current.clear(),t(v))},[v,s]),i.useEffect(()=>{if("formules"===o&&v){const{fetchFieldMetaCounts:e}=ge.getState();e([v])}},[o,v]);const V=e=>v?a(String(v),e):Promise.reject(new Error("No field selected")),S=(e,r)=>{if(!v)return;g(i=>({...i,[e]:r})),f(r=>({...r,[e]:!0})),h(r=>({...r,[e]:null}));const i={...N,[e]:r};V({advancedConfig:i}).then(()=>{f(r=>({...r,[e]:!1}))}).catch(r=>{f(r=>({...r,[e]:!1})),h(i=>({...i,[e]:(null==r?void 0:r.message)||"Erreur de sauvegarde"}))})},y=e=>{if(!v)return;const r=e.target.value;g(e=>({...e,label:r})),f(e=>({...e,label:!0})),h(e=>({...e,label:null})),V({label:r}).then(()=>f(e=>({...e,label:!1}))).catch(e=>{f(e=>({...e,label:!1})),h(r=>({...r,label:(null==e?void 0:e.message)||"Erreur de sauvegarde"}))})},A=e=>{if(!v)return;const r=e.target.value;g(e=>({...e,type:r})),f(e=>({...e,type:!0})),h(e=>({...e,type:null})),V({type:r}).then(()=>f(e=>({...e,type:!1}))).catch(e=>{f(e=>({...e,type:!1})),h(r=>({...r,type:(null==e?void 0:e.message)||"Erreur de sauvegarde"}))})},k=e=>{if(!v)return;const r=e.target.checked;g(e=>({...e,required:r})),f(e=>({...e,required:!0})),h(e=>({...e,required:null})),V({required:r}).then(()=>f(e=>({...e,required:!1}))).catch(e=>{f(e=>({...e,required:!1})),h(r=>({...r,required:(null==e?void 0:e.message)||"Erreur de sauvegarde"}))})},O=e=>{if(!v)return;const r=e.target.value;g(e=>({...e,width:r})),f(e=>({...e,width:!0})),h(e=>({...e,width:null})),V({width:r}).then(()=>f(e=>({...e,width:!1}))).catch(e=>{f(e=>({...e,width:!1})),h(r=>({...r,width:(null==e?void 0:e.message)||"Erreur de sauvegarde"}))})};i.useEffect(()=>{let e=!0;return(async()=>{try{const r=await d("/api/field-types");let i=[];Array.isArray(r)?i=r:r&&"object"==typeof r&&"data"in r&&(i=r.data||[]),e&&u(i)}catch(r){}})(),()=>{e=!1}},[d]);const R=i.useCallback(async()=>{let e=0;for(;e<3;)try{const r=await d("/api/field-types");let i=[];if(Array.isArray(r)?i=r:r&&"object"==typeof r&&"data"in r&&(i=r.data||[]),i.length>0)return void u(i);e++,e<3&&await new Promise(e=>setTimeout(e,1e3))}catch(r){e++}},[d]);if(i.useEffect(()=>{if(0===c.length){const e=setTimeout(()=>{0===c.length&&R()},2e3);return()=>clearTimeout(e)}},[c,R]),!r||!v||!b)return e.jsxDEV("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",color:"#bfbfbf"},children:e.jsxDEV("div",{children:[e.jsxDEV(he,{style:{fontSize:"24px",marginBottom:"8px",display:"block"}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:303,columnNumber:11},void 0),e.jsxDEV("span",{style:{fontSize:"14px",fontStyle:"italic"},children:"Aucun champ s√©lectionn√©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:304,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:302,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:294,columnNumber:7},void 0);const j=Gr.map(r=>{var i,s,t;let o=0;v&&("formules"===r.key&&(o=(null==(i=m[v])?void 0:i.formulas)||0),"validations"===r.key&&(o=(null==(s=m[v])?void 0:s.validations)||0),"dependances"===r.key&&(o=(null==(t=m[v])?void 0:t.dependencies)||0));const n=o>0,l=e.jsxDEV(B,{title:r.tooltip,children:e.jsxDEV("span",{className:"cfg-tab-label","data-kind":r.key,"data-has":n,children:[e.jsxDEV("span",{className:"cfg-tab-icon",children:r.icon},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:324,columnNumber:11},void 0),e.jsxDEV("span",{className:"cfg-tab-text",children:r.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:325,columnNumber:11},void 0),n&&e.jsxDEV("span",{className:"cfg-tab-count","aria-label":`Nombre: ${o}`,children:o},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:326,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:323,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:322,columnNumber:7},void 0);return{key:r.key,label:l,children:e.jsxDEV("div",{className:"cfg-tab-pane",children:M(r.key)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:334,columnNumber:17},void 0)}});return e.jsxDEV("div",{className:"cfg-advanced-panel",style:{height:"100%",padding:"8px"},children:e.jsxDEV(G,{className:"cfg-advanced-card",bordered:!0,size:"small",style:{boxShadow:"none"},styles:{body:{padding:12}},children:e.jsxDEV(re,{activeKey:o,onChange:n,items:j,size:"small",style:{height:"100%"},tabBarStyle:{marginBottom:8}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:347,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:340,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:339,columnNumber:5},void 0);function M(r){var i,s;switch(r){case"parametres":return e.jsxDEV("div",{className:"cfg-pane-card parametres-root","data-kind":"parametres",style:{padding:12,margin:0},children:[e.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"16px"},children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px"},children:"Nom du champ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:367,columnNumber:17},this),e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsxDEV("input",{type:"text",style:{width:"100%",height:"32px",padding:"4px 8px",border:"1px solid #d9d9d9",borderRadius:"4px",fontSize:"14px"},value:C.label??(b.label||""),onChange:y},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:369,columnNumber:19},this),x.label&&e.jsxDEV("span",{style:{color:"#1890ff"},children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:382,columnNumber:36},this),D.label&&e.jsxDEV("span",{style:{color:"#ff4d4f"},title:D.label,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:383,columnNumber:39},this),!x.label&&!D.label&&void 0!==C.label&&C.label!==b.label&&e.jsxDEV("span",{style:{color:"#52c41a"},children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:384,columnNumber:129},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:368,columnNumber:17},this),e.jsxDEV("div",{style:{fontSize:"12px",color:"#8c8c8c",marginTop:"4px"},children:"Le label affich√© √† l'utilisateur."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:386,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:366,columnNumber:15},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{style:{display:"block",fontSize:"14px",fontWeight:"500",marginBottom:"4px"},children:"Type de champ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:390,columnNumber:17},this),e.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsxDEV("select",{style:{width:"100%",height:"32px",padding:"4px 8px",border:"1px solid #d9d9d9",borderRadius:"4px",fontSize:"14px"},value:C.type??(b.type||""),onChange:A,children:[0===c.length&&e.jsxDEV("option",{value:"",children:"Chargement des types..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:404,columnNumber:49},this),c.map(r=>e.jsxDEV("option",{value:r.name,children:r.label},r.name,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:406,columnNumber:23},this))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:392,columnNumber:19},this),x.type&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:409,columnNumber:35},this),D.type&&e.jsxDEV("span",{className:"text-red-500",title:D.type,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:410,columnNumber:38},this),!x.type&&!D.type&&void 0!==C.type&&C.type!==b.type&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:411,columnNumber:124},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:391,columnNumber:17},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Format de saisie (texte, nombre, date, liste, etc.)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:413,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:389,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:365,columnNumber:13},this),e.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Taille"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:420,columnNumber:17},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("select",{className:"select select-bordered h-10 text-sm flex-1",value:C.width??(b.width||"1/1"),onChange:O,children:[e.jsxDEV("option",{value:"1/4",children:"1/4 (petit)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:423,columnNumber:21},this),e.jsxDEV("option",{value:"1/2",children:"1/2 (moyen)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:424,columnNumber:21},this),e.jsxDEV("option",{value:"3/4",children:"3/4 (large)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:425,columnNumber:21},this),e.jsxDEV("option",{value:"1/1",children:"Pleine largeur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:426,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:422,columnNumber:19},this),x.width&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:428,columnNumber:36},this),D.width&&e.jsxDEV("span",{className:"text-red-500",title:D.width,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:429,columnNumber:39},this),!x.width&&!D.width&&void 0!==C.width&&C.width!==b.width&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:430,columnNumber:129},this),e.jsxDEV("label",{className:"flex items-center gap-2 whitespace-nowrap ml-1",children:[e.jsxDEV("input",{type:"checkbox",checked:C.required??(b.required||!1),onChange:k},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:432,columnNumber:21},this),e.jsxDEV("span",{className:"text-sm",children:"Obligatoire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:433,columnNumber:21},this),x.required&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:434,columnNumber:41},this),D.required&&e.jsxDEV("span",{className:"text-red-500",title:D.required,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:435,columnNumber:44},this),!x.required&&!D.required&&void 0!==C.required&&C.required!==b.required&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:436,columnNumber:146},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:431,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:421,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:419,columnNumber:15},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Valeur par d√©faut"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:443,columnNumber:17},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"text",className:"input input-bordered w-full h-10 text-sm",value:C.defaultValue??N.defaultValue??"",onChange:e=>S("defaultValue",e.target.value),placeholder:"Exemple: Particulier, 1, true..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:445,columnNumber:19},this),x.defaultValue&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:446,columnNumber:43},this),D.defaultValue&&e.jsxDEV("span",{className:"text-red-500",title:D.defaultValue,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:447,columnNumber:46},this),!x.defaultValue&&!D.defaultValue&&void 0!==C.defaultValue&&C.defaultValue!==N.defaultValue&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:448,columnNumber:173},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:444,columnNumber:17},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Pr√©remplie automatiquement."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:450,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:442,columnNumber:15},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Placeholder / Info-bulle"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:455,columnNumber:17},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"text",className:"input input-bordered w-full h-10 text-sm",value:C.placeholder??N.placeholder??"",onChange:e=>S("placeholder",e.target.value),placeholder:"Exemple: Saisissez votre nom..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:457,columnNumber:19},this),x.placeholder&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:458,columnNumber:42},this),D.placeholder&&e.jsxDEV("span",{className:"text-red-500",title:D.placeholder,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:459,columnNumber:45},this),!x.placeholder&&!D.placeholder&&void 0!==C.placeholder&&C.placeholder!==N.placeholder&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:460,columnNumber:168},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:456,columnNumber:17},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Texte d'aide gris√©."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:462,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:454,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:417,columnNumber:13},this),(()=>{const r=c.find(e=>e.name===(C.type??b.type));return(null==r?void 0:r.has_options)?"advanced_select"===(C.type??b.type)?e.jsxDEV(Ee,{size:"small",bordered:!1,defaultActiveKey:["options-advanced"],items:[{key:"options-advanced",label:"Options (liste avanc√©e en cascade)",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV(Yr,{fieldId:String(v)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:477,columnNumber:25},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:476,columnNumber:23},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:472,columnNumber:19},this):e.jsxDEV(Ee,{size:"small",bordered:!1,defaultActiveKey:["options-simple"],items:[{key:"options-simple",label:"Options de la liste d√©roulante",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV(Zr,{fieldId:String(v),options:b.options??[]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:489,columnNumber:23},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:488,columnNumber:21},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:484,columnNumber:17},this):null})(),e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"appearance",label:"Apparence du champ",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium mb-1 text-indigo-700",children:"Couleur de fond"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:507,columnNumber:23},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"color",className:"w-10 h-10 p-0 border-none rounded",value:we(C.color??N.color,"#f4f4f4"),onChange:e=>S("color",e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:509,columnNumber:25},this),e.jsxDEV("input",{type:"text",className:"input input-bordered flex-1 h-10 text-xs font-mono",value:C.color??N.color??"#f4f4f4",onChange:e=>S("color",e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:510,columnNumber:25},this),x.color&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:511,columnNumber:42},this),D.color&&e.jsxDEV("span",{className:"text-red-500",title:D.color,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:512,columnNumber:45},this),!x.color&&!D.color&&void 0!==C.color&&C.color!==N.color&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:513,columnNumber:144},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:508,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:506,columnNumber:21},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium mb-1 text-indigo-700",children:"Couleur du texte"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:517,columnNumber:23},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"color",className:"w-10 h-10 p-0 border-none rounded",value:we(C.textColor??N.textColor,"#000000"),onChange:e=>S("textColor",e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:519,columnNumber:25},this),e.jsxDEV("input",{type:"text",className:"input input-bordered flex-1 h-10 text-xs font-mono",value:C.textColor??N.textColor??"#000000",onChange:e=>S("textColor",e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:520,columnNumber:25},this),x.textColor&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:521,columnNumber:46},this),D.textColor&&e.jsxDEV("span",{className:"text-red-500",title:D.textColor,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:522,columnNumber:49},this),!x.textColor&&!D.textColor&&void 0!==C.textColor&&C.textColor!==N.textColor&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:523,columnNumber:164},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:518,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:516,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:505,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:504,columnNumber:17},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:500,columnNumber:13},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Ic√¥ne associ√©e"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:533,columnNumber:15},this),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"text",className:"input input-bordered w-full h-10 text-sm",value:C.icon??N.icon??"",onChange:e=>S("icon",e.target.value),placeholder:"ex: üìÖ, üî¢, üìù"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:535,columnNumber:17},this),x.icon&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:536,columnNumber:33},this),D.icon&&e.jsxDEV("span",{className:"text-red-500",title:D.icon,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:537,columnNumber:36},this),!x.icon&&!D.icon&&void 0!==C.icon&&C.icon!==N.icon&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:538,columnNumber:131},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:534,columnNumber:15},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Ic√¥ne affich√©e √† c√¥t√© du champ (emoji ou texte court)."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:540,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:532,columnNumber:13},this),e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"advanced-options",label:"Options avanc√©es",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("label",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"checkbox",checked:C.readOnly??!!N.readOnly,onChange:e=>S("readOnly",e.target.checked)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:551,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm",children:"Lecture seule"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:552,columnNumber:23},this),x.readOnly&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:553,columnNumber:43},this),D.readOnly&&e.jsxDEV("span",{className:"text-red-500",title:D.readOnly,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:554,columnNumber:46},this),!x.readOnly&&!D.readOnly&&void 0!==C.readOnly&&C.readOnly!==N.readOnly&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:555,columnNumber:157},this),e.jsxDEV("span",{className:"text-xs text-gray-500",children:"Non modifiable par l'utilisateur"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:556,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:550,columnNumber:21},this),e.jsxDEV("label",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"checkbox",checked:C.hidden??!!N.hidden,onChange:e=>S("hidden",e.target.checked)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:559,columnNumber:23},this),e.jsxDEV("span",{className:"text-sm",children:"Masqu√© au rendu final"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:560,columnNumber:23},this),x.hidden&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:561,columnNumber:41},this),D.hidden&&e.jsxDEV("span",{className:"text-red-500",title:D.hidden,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:562,columnNumber:44},this),!x.hidden&&!D.hidden&&void 0!==C.hidden&&C.hidden!==N.hidden&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:563,columnNumber:147},this),e.jsxDEV("span",{className:"text-xs text-gray-500",children:"N'appara√Æt pas dans le formulaire"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:564,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:558,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:549,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:548,columnNumber:17},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:544,columnNumber:13},this),["image_user","fichier_user"].includes(C.type??b.type)&&e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"files-config",label:"Configuration fichiers",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxDEV("label",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{type:"checkbox",checked:C.multiple??!!N.multiple,onChange:e=>S("multiple",e.target.checked)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:580,columnNumber:25},this),e.jsxDEV("span",{className:"text-sm",children:"Autoriser plusieurs fichiers"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:581,columnNumber:25},this),x.multiple&&e.jsxDEV("span",{className:"animate-spin text-blue-500",children:"‚è≥"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:582,columnNumber:45},this),D.multiple&&e.jsxDEV("span",{className:"text-red-500",title:D.multiple,children:"‚ö†Ô∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:583,columnNumber:48},this),!x.multiple&&!D.multiple&&void 0!==C.multiple&&C.multiple!==N.multiple&&e.jsxDEV("span",{className:"text-green-500",children:"‚úîÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:584,columnNumber:159},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:579,columnNumber:23},this),e.jsxDEV("div",{children:[e.jsxDEV("label",{className:"block text-xs font-medium mb-1 text-purple-700",children:"Types accept√©s (accept)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:587,columnNumber:25},this),e.jsxDEV("input",{type:"text",className:"input input-bordered w-full h-10 text-sm",placeholder:"image_user"===(C.type??b.type)?"image/*":"*/*",value:C.accept??N.accept??"",onChange:e=>S("accept",e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:588,columnNumber:25},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-1",children:"Exemples: image/*, application/pdf,.doc,.docx"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:595,columnNumber:25},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:586,columnNumber:23},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:578,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:577,columnNumber:19},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:573,columnNumber:15},this),"produit"===(C.type??b.type)&&e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"product-config",label:"Configuration produit",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV(Wr,{columns:Array.isArray(null==(s=null==(i=b.advancedConfig)?void 0:i.product)?void 0:s.columns)?b.advancedConfig.product.columns:[],onChange:e=>{const r={...(b.advancedConfig||{}).product||{},columns:e};S("product",r)}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:610,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:609,columnNumber:19},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:605,columnNumber:15},this),"donnee"===(C.type??b.type)&&e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"data-config",label:"Configuration donn√©es",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV(Jr,{composer:N.composer||void 0,onChange:e=>S("composer",e)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:632,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:631,columnNumber:19},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:627,columnNumber:15},this),"tableau"===(C.type??b.type)&&e.jsxDEV(Ee,{size:"small",bordered:!1,items:[{key:"table-config",label:"Configuration du tableau",children:e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"parametres",children:e.jsxDEV(kr,{config:(()=>{var e;const r={columns:[],rows:[],templates:[],data:[],...(null==(e=b.advancedConfig)?void 0:e.tableau)||b.config};if(r.data&&Array.isArray(r.data)&&r.data.length>0){const e=r.crossingData||{};if(!(Object.keys(e).length>0)){const e={};r.data.forEach((r,i)=>{r&&"object"==typeof r&&Object.entries(r).forEach(([s,t])=>{if("id"!==s&&null!=t&&""!==t){const o=r.id||`row_${Date.now()}_${i}`;e[`${o}_${s}`]=t}})}),Object.keys(e).length>0&&(r.crossingData=e)}}return r})(),onChange:e=>{var r;const i=b.id.toString();if(p.current.has(i))return;const s=Date.now(),t=`lastSave_${i}`;if(s-(window[t]||0)<2e3)return;const o=`oscillation_${i}`,n=window[o]||[],l=JSON.stringify({colCount:"number"==typeof e.columns?e.columns:Array.isArray(e.columns)?e.columns.length:0,rowCount:"number"==typeof e.rows?e.rows:Array.isArray(e.rows)?e.rows.length:0,crossingKeys:Object.keys(e.crossingData||{}).sort()});if(n.includes(l)&&n.length>=2)return;n.push(l),n.length>5&&n.shift(),window[o]=n;const a=null==(r=null==b?void 0:b.advancedConfig)?void 0:r.tableau;((a?JSON.stringify({colCount:"number"==typeof a.columns?a.columns:Array.isArray(a.columns)?a.columns.length:0,rowCount:"number"==typeof a.rows?a.rows:Array.isArray(a.rows)?a.rows.length:0,crossingKeys:Object.keys(a.crossingData||{}).sort()}):"null")!==l||!a)&&(window[t]=s,S("tableau",e))}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:648,columnNumber:21},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:647,columnNumber:19},this)}]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:643,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:363,columnNumber:11},this);case"formules":return e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"formules",children:e.jsxDEV(vr,{fieldId:b.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:795,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:794,columnNumber:11},this);case"validations":return e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"validations",children:e.jsxDEV(Er,{fieldId:b.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:801,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:800,columnNumber:11},this);case"dependances":return e.jsxDEV("div",{className:"cfg-pane-card","data-kind":"dependances",children:e.jsxDEV(yr,{fieldId:b.id},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:807,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:806,columnNumber:11},this);default:return null}}};function Zr({fieldId:r,options:i}){const{addOptionToField:s,removeOptionFromField:t}=ge(),[n,l]=o.useState(""),[a,m]=o.useState(!1),[d,c]=o.useState({}),u=async()=>{if(!n.trim()||!r)return;m(!0);const e={label:n,value:zr(n),order:i.length};try{await s(r,e),l("")}catch(t){}finally{m(!1)}};return e.jsxDEV("div",{className:"space-y-2 p-2 bg-gray-50 rounded",children:[i.map(i=>e.jsxDEV("div",{className:"flex gap-2 items-center bg-white p-2 rounded border",children:[e.jsxDEV("span",{className:"flex-1 text-sm font-medium h-10 flex items-center",children:i.label},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:864,columnNumber:11},this),e.jsxDEV("span",{className:"text-xs font-mono text-gray-500 bg-gray-100 px-2 rounded h-10 flex items-center",children:i.value},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:865,columnNumber:11},this),e.jsxDEV("button",{type:"button",className:"btn btn-error btn-ghost h-8 min-h-0 px-2 "+(d[i.id]?"loading":""),title:"Supprimer l'option",onClick:()=>i.id&&(async e=>{if(e){c(r=>({...r,[e]:!0}));try{await t(r,String(e))}catch(i){c(r=>({...r,[e]:!1}))}}})(i.id),disabled:!i.id||!!d[i.id],children:d[i.id]?"":"üóëÔ∏è"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:866,columnNumber:11},this)]},i.id,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:863,columnNumber:9},this)),0===i.length&&e.jsxDEV("div",{className:"text-xs text-gray-500 italic text-center p-2",children:"Aucune option d√©finie."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:877,columnNumber:32},this),e.jsxDEV("div",{className:"flex gap-2 items-center mt-2 pt-2 border-t",children:[e.jsxDEV("input",{placeholder:"Label de la nouvelle option",className:"input input-bordered flex-1 h-10 text-sm",value:n,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&u()},disabled:a},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:879,columnNumber:9},this),e.jsxDEV("button",{type:"button",className:"btn btn-primary h-10 min-h-0 "+(a?"loading":""),onClick:u,disabled:a||!n.trim(),children:a?"":"+ Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:887,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:878,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:861,columnNumber:5},this)}function Wr({columns:r,onChange:s}){const[t,o]=i.useState(r),[n,l]=i.useState(""),[a,m]=i.useState("text");i.useEffect(()=>{o(r)},[r]);const d=e=>{o(e),s(e)},c=()=>{if(!n.trim())return;const e={key:zr(n),label:n.trim(),type:a,options:"select"===a?[]:void 0};d([...t||[],e]),l(""),m("text")},u=(e,r)=>{d((t||[]).map(i=>i.key===e?{...i,...r,options:"select"===(r.type??i.type)?i.options||[]:void 0}:i))},p=(e,r)=>{const i=[...t||[]],s=e+r;if(s<0||s>=i.length)return;const[o]=i.splice(e,1);i.splice(s,0,o),d(i)};return e.jsxDEV("div",{className:"p-2 bg-gray-50 rounded border",children:[e.jsxDEV("div",{className:"font-medium mb-2",children:"Colonnes du produit"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:968,columnNumber:7},this),0===(t||[]).length&&e.jsxDEV("div",{className:"text-xs text-gray-500 mb-2",children:"Aucune colonne. Ajoutez-en ci-dessous."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:969,columnNumber:42},this),e.jsxDEV("div",{className:"space-y-2",children:(t||[]).map((r,i)=>e.jsxDEV("div",{className:"bg-white p-2 rounded border",children:[e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{className:"input input-bordered flex-1 h-10 text-sm",value:r.label,onChange:e=>u(r.key,{label:e.target.value})},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:974,columnNumber:17},this),e.jsxDEV("select",{className:"select select-bordered h-10 text-sm",value:r.type||"text",onChange:e=>u(r.key,{type:e.target.value}),children:[e.jsxDEV("option",{value:"text",children:"Texte"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:984,columnNumber:17},this),e.jsxDEV("option",{value:"number",children:"Nombre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:985,columnNumber:17},this),e.jsxDEV("option",{value:"date",children:"Date"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:986,columnNumber:17},this),e.jsxDEV("option",{value:"select",children:"S√©lection"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:987,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:979,columnNumber:15},this),e.jsxDEV("button",{type:"button",className:"btn h-8 min-h-0 px-2",onClick:()=>p(i,-1),disabled:0===i,children:"‚Üë"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:989,columnNumber:15},this),e.jsxDEV("button",{type:"button",className:"btn h-8 min-h-0 px-2",onClick:()=>p(i,1),disabled:i===((null==t?void 0:t.length)||0)-1,children:"‚Üì"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:990,columnNumber:15},this),e.jsxDEV("button",{type:"button",className:"btn btn-error h-8 min-h-0 px-2",onClick:()=>{return e=r.key,void d((t||[]).filter(r=>r.key!==e));var e},children:"Supprimer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:991,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:973,columnNumber:13},this),"select"===r.type&&e.jsxDEV("div",{className:"mt-2 p-2 bg-gray-50 rounded",children:[e.jsxDEV("div",{className:"text-xs text-gray-600 mb-1",children:"Options"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:995,columnNumber:17},this),e.jsxDEV("div",{className:"flex flex-wrap gap-2 mb-2",children:[(r.options||[]).map(i=>e.jsxDEV("span",{className:"text-xs bg-white border rounded px-2 py-0.5 inline-flex items-center gap-2",children:[i.label,e.jsxDEV("button",{type:"button",className:"text-red-500",onClick:()=>{return e=r.key,s=i.value,void d((t||[]).map(r=>{if(r.key!==e)return r;const i=Array.isArray(r.options)?r.options:[];return{...r,options:i.filter(e=>e.value!==s)}}));var e,s},children:"‚úï"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1e3,columnNumber:23},this)]},i.value,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:998,columnNumber:21},this)),0===(r.options||[]).length&&e.jsxDEV("span",{className:"text-xs text-gray-500",children:"Aucune option"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1004,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:996,columnNumber:17},this),e.jsxDEV(Hr,{onAdd:e=>{return i=r.key,void((s=e).trim()&&d((t||[]).map(e=>{if(e.key!==i)return e;const r=Array.isArray(e.options)?e.options:[];return{...e,options:[...r,{label:s.trim(),value:zr(s)}]}})));var i,s}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1007,columnNumber:17},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:994,columnNumber:15},this),e.jsxDEV("div",{className:"text-xxs text-gray-400 mt-1",children:["cl√©: ",e.jsxDEV("code",{className:"font-mono",children:r.key},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1010,columnNumber:63},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1010,columnNumber:13},this)]},r.key,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:972,columnNumber:11},this))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:970,columnNumber:7},this),e.jsxDEV("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxDEV("input",{className:"input input-bordered flex-1 h-10 text-sm",placeholder:"Nom de la colonne (ex: Marque)",value:n,onChange:e=>l(e.target.value),onKeyDown:e=>{"Enter"===e.key&&c()}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1015,columnNumber:3},this),e.jsxDEV("select",{className:"select select-bordered h-10 text-sm",value:a,onChange:e=>m(e.target.value),children:[e.jsxDEV("option",{value:"text",children:"Texte"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1023,columnNumber:11},this),e.jsxDEV("option",{value:"number",children:"Nombre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1024,columnNumber:11},this),e.jsxDEV("option",{value:"date",children:"Date"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1025,columnNumber:11},this),e.jsxDEV("option",{value:"select",children:"S√©lection"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1026,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1022,columnNumber:3},this),e.jsxDEV("button",{type:"button",className:"btn btn-primary h-10 min-h-0",onClick:c,children:"+ Ajouter une colonne"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1028,columnNumber:3},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1014,columnNumber:7},this),e.jsxDEV("div",{className:"text-xs text-gray-500 mt-2",children:"D√©finissez les colonnes (structure) du produit. Les lignes seront ajout√©es par l‚Äôutilisateur dans l‚Äôonglet Devis."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1030,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:967,columnNumber:5},this)}function Hr({onAdd:r}){const[s,t]=i.useState("");return e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("input",{className:"input input-bordered input-xs",placeholder:"Nouvelle option",value:s,onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(r(s),t(""))}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1039,columnNumber:7},this),e.jsxDEV("button",{className:"btn btn-xs",type:"button",onClick:()=>{r(s),t("")},children:"+ Ajouter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1040,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1038,columnNumber:5},this)}function Yr({fieldId:r}){const{forceReload:s}=Be(),t=i.useCallback(async()=>{await s(r)},[r,s]);return e.jsxDEV("div",{children:e.jsxDEV(Pr,{fieldId:r,onTreeChange:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1059,columnNumber:7},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1058,columnNumber:5},this)}function Jr({composer:r,onChange:s}){const t={mode:(null==r?void 0:r.mode)||"template",template:"string"==typeof(null==r?void 0:r.template)?null==r?void 0:r.template:"",picks:Array.isArray(null==r?void 0:r.picks)?null==r?void 0:r.picks:[]},[o,n]=i.useState(t.mode),[l,a]=i.useState(t.template||""),[m,d]=i.useState(t.picks||[]),[c,u]=i.useState({key:"",from:"values",fieldId:"",path:""}),[p,v]=i.useState(!1),b=i.useRef(null);i.useEffect(()=>{p||(n(t.mode),a(t.template||""),d(t.picks||[]))},[r]);const N=()=>{v(!0),b.current&&window.clearTimeout(b.current),b.current=window.setTimeout(()=>{s({mode:o,template:l,picks:m}),v(!1)},500)},x=e=>{d(e),N()};return e.jsxDEV("div",{className:"mt-4 p-3 bg-purple-50 border border-purple-200 rounded space-y-3",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("h3",{className:"font-medium text-sm text-purple-700",children:["Data Composer ",p&&e.jsxDEV("span",{className:"text-xs text-orange-600 ml-2",children:"(modifi√©‚Ä¶)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1127,columnNumber:85},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1127,columnNumber:9},this),e.jsxDEV("select",{className:"select select-bordered select-sm h-8 text-xs",value:o,onChange:e=>{return r=e.target.value,n(r),void N();var r},children:[e.jsxDEV("option",{value:"template",children:"Template"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1129,columnNumber:11},this),e.jsxDEV("option",{value:"picks",children:"Picks (JSON)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1130,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1128,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1126,columnNumber:7},this),"template"===o&&e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV("textarea",{className:"textarea textarea-bordered w-full text-xs h-32 font-mono",value:l,onChange:e=>{return r=e.target.value,a(r),void N();var r},placeholder:"Ex: Client: {{values.client_nom}} / Choix: {{advancedSelect.categorie.selection}}"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1135,columnNumber:11},this),e.jsxDEV("div",{className:"text-xxs text-gray-600 leading-relaxed",children:["Tokens: ","{{values.FIELD_ID}}",", ","{{values.FIELD_ID.sous}}",", ","{{advancedSelect.FIELD_ID.selection}}",", ","{{advancedSelect.FIELD_ID.extra}}",", ","{{errors.FIELD_ID}}","."]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1141,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1134,columnNumber:9},this),"picks"===o&&e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV("div",{className:"text-xxs text-gray-600",children:"Assemble un objet JSON depuis plusieurs champs."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1148,columnNumber:11},this),e.jsxDEV("div",{className:"space-y-2",children:[m.map((r,i)=>e.jsxDEV("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsxDEV("input",{className:"input input-bordered input-xs col-span-2",placeholder:"cl√©",value:r.key,onChange:e=>x(m.map((r,s)=>s===i?{...r,key:e.target.value}:r))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1152,columnNumber:17},this),e.jsxDEV("select",{className:"select select-bordered select-xs col-span-3",value:r.from,onChange:e=>x(m.map((r,s)=>s===i?{...r,from:e.target.value}:r)),children:[e.jsxDEV("option",{value:"values",children:"values"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1154,columnNumber:19},this),e.jsxDEV("option",{value:"advancedSelect",children:"advancedSelect"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1155,columnNumber:19},this),e.jsxDEV("option",{value:"errors",children:"errors"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1156,columnNumber:19},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1153,columnNumber:17},this),e.jsxDEV("input",{className:"input input-bordered input-xs col-span-3",placeholder:"fieldId",value:r.fieldId,onChange:e=>x(m.map((r,s)=>s===i?{...r,fieldId:e.target.value}:r))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1158,columnNumber:17},this),e.jsxDEV("input",{className:"input input-bordered input-xs col-span-3",placeholder:"path/part (option)",value:r.path||"",onChange:e=>x(m.map((r,s)=>s===i?{...r,path:e.target.value}:r))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1159,columnNumber:17},this),e.jsxDEV("button",{className:"btn btn-xs btn-error col-span-1",type:"button",onClick:()=>(e=>{x(m.filter((r,i)=>i!==e))})(i),children:"‚úï"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1160,columnNumber:17},this)]},i,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1151,columnNumber:15},this)),0===m.length&&e.jsxDEV("div",{className:"text-xs text-gray-500 italic",children:"Aucun pick."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1163,columnNumber:36},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1149,columnNumber:11},this),e.jsxDEV("div",{className:"grid grid-cols-12 gap-2 items-center bg-white p-2 rounded border",children:[e.jsxDEV("input",{className:"input input-bordered input-xs col-span-2",placeholder:"cl√©",value:c.key,onChange:e=>u(r=>({...r,key:e.target.value}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1166,columnNumber:13},this),e.jsxDEV("select",{className:"select select-bordered select-xs col-span-3",value:c.from,onChange:e=>u(r=>({...r,from:e.target.value})),children:[e.jsxDEV("option",{value:"values",children:"values"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1168,columnNumber:15},this),e.jsxDEV("option",{value:"advancedSelect",children:"advancedSelect"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1169,columnNumber:15},this),e.jsxDEV("option",{value:"errors",children:"errors"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1170,columnNumber:15},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1167,columnNumber:13},this),e.jsxDEV("input",{className:"input input-bordered input-xs col-span-3",placeholder:"fieldId",value:c.fieldId,onChange:e=>u(r=>({...r,fieldId:e.target.value}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1172,columnNumber:13},this),e.jsxDEV("input",{className:"input input-bordered input-xs col-span-3",placeholder:"path/part (option)",value:c.path,onChange:e=>u(r=>({...r,path:e.target.value}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1173,columnNumber:13},this),e.jsxDEV("button",{className:"btn btn-xs btn-primary col-span-1",type:"button",onClick:()=>{var e;c.key.trim()&&c.fieldId.trim()&&(x([...m,{...c,key:c.key.trim(),fieldId:c.fieldId.trim(),path:(null==(e=c.path)?void 0:e.trim())||void 0}]),u({key:"",from:"values",fieldId:"",path:""}))},children:"Ôºã"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1174,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1165,columnNumber:11},this),e.jsxDEV("div",{className:"text-xxs text-gray-600",children:"from=advancedSelect: path=selection|extra. errors: message d'erreur."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1176,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1147,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/ConfigAvancee.tsx",lineNumber:1125,columnNumber:5},this)}const Kr=()=>{const[r,t]=i.useState(null),{blocks:o,addBlock:n,reorderSectionsOfBlock:l,moveFieldToSection:a,updateFormula:m,updateValidation:d,updateDependency:c,addItemsToFormulaSequence:x,addFieldToSection:E}=ge(),{blockId:C}=s(),g=o.find(e=>String(e.id)===C),V=u(p(v),p(D,{coordinateGetter:f}));return e.jsxDEV(b,{sensors:V,onDragEnd:e=>{var r,i,s,t,n,u,p,v,b,N,f,D,V;const{active:S,over:y}=e;if(!y||!g)return;const A=S.data.current,k=y.data.current,O=null==A?void 0:A.type;if("formula-sequence-item"===O&&k&&("formula-sequence-item"===k.type||"formula-drop-zone"===k.type)){const{id:e}=S,{id:t}=y,o=null==(i=null==(r=S.data.current)?void 0:r.item)?void 0:i.formulaId;if(!o)return void Ve.error("ID de formule manquant dans l'√©l√©ment d√©plac√©");if(e!==t){const e=null==g?void 0:g.sections.flatMap(e=>e.fields).find(e=>{var r;return null==(r=e.formulas)?void 0:r.some(e=>e.id===o)}),r=null==(s=null==e?void 0:e.formulas)?void 0:s.find(e=>e.id===o);if(null==r?void 0:r.sequence){const e=r.sequence.findIndex(e=>{var r;return e.id===(null==(r=S.data.current)?void 0:r.item.id)}),i="formula-drop-zone"===k.type?r.sequence.length-1:r.sequence.findIndex(e=>{var r;return e.id===(null==(r=y.data.current)?void 0:r.item.id)});if(-1!==e&&-1!==i){const s=h(r.sequence,e,i);m(o,{sequence:s}),Ve.info("S√©quence de la formule mise √† jour.")}}}return}if("palette-field"===O&&A){const e=A.fieldType;let r=null,i=null;if("section"===(null==k?void 0:k.type)){r=y.id.toString();const e=g.sections.find(e=>e.id.toString()===r);e&&(i=e.fields.length)}else if("form-field"===(null==k?void 0:k.type)){r=k.sectionId;const e=g.sections.find(e=>e.id.toString()===r);if(e){const r=e.fields.findIndex(e=>e.id===y.id);i=r>=0?r:e.fields.length}}return void(r&&null!==i&&e?(E(r,{type:e,label:`Nouveau champ ${e}`,order:i}),Ve.success(`Champ '${e}' ajout√©.`)):Ve.warn("D√©posez le champ sur une section pour l'ajouter."))}if("form-field"===O&&A&&(null==(t=null==k?void 0:k.type)?void 0:t.endsWith("-drop-zone"))){const e=A.field,{itemData:r}=k,i={type:"field",id:`field-${e.id}-${Date.now()}`,label:e.label,value:e.id};if("formula-drop-zone"===k.type){let s=null==r?void 0:r.formulaId;null==r||r.formulaName;if(!s){const e=String((null==y?void 0:y.id)||"").match(/formula-drop-zone-(.*)/);e&&e[1]&&(s=e[1])}if(!s)return void Ve.error("Impossible d'identifier la formule cible. Veuillez r√©essayer.");if("string"!=typeof s||""===s.trim())return void Ve.error("L'ID de la formule cible n'est pas valide.");let t=null;for(const e of o){for(const r of e.sections){for(const e of r.fields)if(null==(n=e.formulas)?void 0:n.some(e=>e&&e.id===s)){t=e;break}if(t)break}if(t)break}if(t||o.forEach((e,r)=>{e.sections.forEach((e,r)=>{e.fields.forEach((e,r)=>{e.formulas&&e.formulas.length})})}),t)try{x(t.id,s,[i]),Ve.success(`Champ "${e.label}" ajout√© √† la formule.`)}catch(j){Ve.error(`Erreur lors de l'ajout: ${j instanceof Error?j.message:"Erreur inconnue"}`)}else Ve.error("Champ parent de la formule introuvable.")}else"validation-drop-zone"===k.type?Ve.warn("Logique de validation √† impl√©menter."):"dependency-condition-drop-zone"===k.type&&Ve.warn("Logique de d√©pendance √† impl√©menter.");return}const R=null==(u=y.data.current)?void 0:u.droppableId;if(null==R?void 0:R.startsWith("formula-editor-drop-zone-")){if("form-field"===(null==(p=S.data.current)?void 0:p.type)){const e=S.data.current.field,r=R.replace("formula-editor-drop-zone-",""),i=g.sections.flatMap(e=>e.fields.flatMap(e=>e.formulas||[])).find(e=>e.id===r);if(i){const s=[...i.sequence||[],{type:"field",id:e.id,label:e.label}];m(r,{sequence:s}),Ve.info(`Champ "${e.label}" ajout√© √† la formule.`)}else Ve.error("Erreur: Impossible de trouver la formule cible.")}}else if(null==R?void 0:R.startsWith("validation-drop-area-")){if("form-field"===(null==(v=S.data.current)?void 0:v.type)){const e=S.data.current.field,r=y.data.current,i=null==r?void 0:r.validationId,s=null==r?void 0:r.sequencePart;if(i&&s){const r=g.sections.flatMap(e=>e.fields.flatMap(e=>e.validations||[])).find(e=>e.id===i);if(r){const t={validationSequence:[],operator:"equals",comparisonSequence:[],errorMessage:""},o=r.sequence||t,n=[...o[s]||[],{type:"field",id:e.id,label:e.label}],l={...o,[s]:n};d(i,{sequence:l}),Ve.info(`Champ "${e.label}" ajout√© √† la validation.`)}else Ve.error("Erreur: Impossible de trouver la validation cible.")}}}else if(null==R?void 0:R.startsWith("dependency-drop-area-")){if("form-field"===(null==(b=S.data.current)?void 0:b.type)){const e=S.data.current.field,r=y.data.current,i=null==r?void 0:r.dependencyId,s=null==r?void 0:r.conditionIndex;if(i&&"number"==typeof s){const r=g.sections.flatMap(e=>e.fields.flatMap(e=>e.dependencies||[])).find(e=>e.id===i);if(r){const t={conditions:[[]],action:"show",targetFieldId:r.targetFieldId},o=r.sequence||t,n=[...o.conditions];for(;n.length<=s;)n.push([]);const l=[...n[s]];l.push({type:"field",id:e.id,label:e.label}),n[s]=l;const a={...o,conditions:n};c(i,{sequence:a}),Ve.info(`Champ "${e.label}" ajout√© √† la d√©pendance.`)}else Ve.error("Erreur: Impossible de trouver la d√©pendance cible.")}}}else{if("form-field"===O&&A){const e=A.field,r=A.sectionId,i="section"===(null==k?void 0:k.type)?y.id.toString():null==k?void 0:k.sectionId;if(!i)return;const s=g.sections.find(e=>e.id.toString()===r),t=g.sections.find(e=>e.id.toString()===i);if(!s||!t)return;const o=s.fields.findIndex(r=>r.id===e.id);let n;if("form-field"===(null==(N=y.data.current)?void 0:N.type))n=t.fields.findIndex(e=>e.id===y.id);else if("section"===(null==(f=y.data.current)?void 0:f.type))n=t.fields.length;else{g.sections.some(e=>String(e.id)===String(y.id))?n=t.fields.length:(n=t.fields.findIndex(e=>e.id===y.id),-1===n&&(n=t.fields.length))}return void(-1!==o&&a(e.id,r,i,n))}if("section"===(null==(D=S.data.current)?void 0:D.type)&&"section"===(null==(V=y.data.current)?void 0:V.type)&&S.id!==y.id){const e=g.sections.findIndex(e=>String(e.id)===S.id.toString()),r=g.sections.findIndex(e=>String(e.id)===y.id.toString());if(-1!==e&&-1!==r){const i=h(g.sections,e,r);ge.setState(e=>({blocks:e.blocks.map(e=>String(e.id)===C?{...e,sections:i.map((e,r)=>({...e,order:r}))}:e)})),l(g.id,i.map(e=>({id:e.id,order:e.order})))}}}},collisionDetection:N,children:e.jsxDEV("div",{className:"form-builder-layout",children:[e.jsxDEV("div",{className:"fields-palette",children:e.jsxDEV(qe,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:420,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:419,columnNumber:9},void 0),e.jsxDEV("div",{className:"form-sections",children:e.jsxDEV(ze,{selectedField:r,setSelectedField:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:425,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:424,columnNumber:9},void 0),e.jsxDEV("div",{className:"advanced-config",children:r&&e.jsxDEV(Br,{selectedField:r,onClose:()=>t(null)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:434,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:432,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:417,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/Formulaire/FormulaireLayout.tsx",lineNumber:412,columnNumber:5},void 0)};export{Kr as default};
