import{j as e}from"./index-C0S0DpaX.js";import{r}from"./react-vendor-Al_k-ZB6.js";import{u as t}from"./useAuthenticatedApi-BbQI8SDU.js";import"./antd-vendor-zFcGztvE.js";const a=()=>{const{badge:a,data:o,loading:i,fallbackWarning:n}=function(e=6e4){const{api:a}=t(),[o,i]=r.useState(!0),[n,l]=r.useState(),[s,d]=r.useState(),c=r.useCallback(e=>e?"live"===e.mode?{text:e.degraded?"IA Live (Dégradée)":"IA Live",color:e.degraded?"orange":"green",title:`Gemini actif (${e.model})`+(e.degraded?" - mode dégradé temporaire":"")}:e.hasApiKey?{text:"IA Fallback",color:"orange",title:"Clé fournie mais réponses mock (invalide ? quotas ?)"}:{text:"IA Simulée",color:"gray",title:"Mode simplifié en l’absence de clé valide"}:null,[]),[u,m]=r.useState(null),g=r.useCallback(async()=>{var e,r;try{i(!0),l(void 0);const t=await a.get("/api/ai/status"),o=(null==(e=t.data)?void 0:e.data)||t.data;if(d(o),(null==o?void 0:o.hasApiKey)&&"mock"===(null==o?void 0:o.mode)){const e=(null==(r=o.lastError)?void 0:r.match(/API key not valid|API_KEY_INVALID|unauthorized|permission|401|403/i))?"clé invalide/permissions":"appels en échec/quotas";m(`IA en mode de secours (${e}). Vérifiez la clé ou les quotas.`)}else m(null)}catch(t){l(t.message)}finally{i(!1)}},[a]);return r.useEffect(()=>{g()},[g]),r.useEffect(()=>{if(!e)return;const r=setInterval(g,e);return()=>clearInterval(r)},[e,g]),{loading:o,error:n,data:s,refresh:g,badge:c(s),fallbackWarning:u}}(3e4);if(i&&!a)return null;const l=a||{text:"IA",color:"gray",title:"Statut IA inconnu"};return e.jsxDEV("div",{className:"fixed bottom-3 right-3 z-40 flex flex-col items-end gap-1",children:[e.jsxDEV("div",{className:`text-xs text-white px-2 py-1 rounded shadow cursor-default select-none ${{green:"bg-green-600",orange:"bg-orange-500",gray:"bg-gray-500"}[l.color]||"bg-gray-500"}`,title:l.title+((null==o?void 0:o.lastError)?`\nDernière erreur: ${o.lastError}`:"")+((null==o?void 0:o.degraded)?`\nMode dégradé jusqu'à: ${o.degradedUntil}`:""),children:l.text},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AIBadge.tsx",lineNumber:11,columnNumber:7},void 0),n&&e.jsxDEV("div",{className:"text-[10px] text-orange-700 bg-orange-100 border border-orange-300 rounded px-2 py-1 max-w-xs shadow",children:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AIBadge.tsx",lineNumber:18,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/AIBadge.tsx",lineNumber:10,columnNumber:5},void 0)};export{a as AIBadge,a as default};
