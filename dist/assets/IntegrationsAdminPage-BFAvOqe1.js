import{u as e,j as i}from"./index-C0S0DpaX.js";import{r as s}from"./react-vendor-Al_k-ZB6.js";import{a as n}from"./Notifications-Bhgc2wzd.js";import"./antd-vendor-zFcGztvE.js";const r=({isOpen:e,onClose:n,onSave:r,integrationType:t,initialConfig:a})=>{const[m,d]=s.useState({host:"",port:587,login:"",password:""}),[o,l]=s.useState({apiKey:""});if(s.useEffect(()=>{"mail"===t&&d({host:"",port:587,login:"",password:"",...a}),"telnyx"===t&&l({apiKey:"",...a})},[a,t]),!e||!t)return null;return i.jsxDEV("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:i.jsxDEV("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[i.jsxDEV("h2",{className:"text-xl font-bold mb-4",children:["Configurer l'intégration ",t]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:59,columnNumber:9},void 0),i.jsxDEV("form",{onSubmit:e=>{let i;if(e.preventDefault(),"mail"===t){const e={...m};e.password||delete e.password,i={type:"mail",config:e,enabled:!0}}else{const e={...o};e.apiKey||delete e.apiKey,i={type:"telnyx",config:e,enabled:!0}}r(i)},children:["mail"===t&&i.jsxDEV("div",{className:"mb-6 border p-4 rounded",children:[i.jsxDEV("h3",{className:"font-semibold mb-2",children:"Paramètres de la boîte mail (SMTP)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:63,columnNumber:15},void 0),i.jsxDEV("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Hôte SMTP"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:66,columnNumber:19},void 0),i.jsxDEV("input",{type:"text",value:m.host,onChange:e=>d({...m,host:e.target.value}),className:"w-full border rounded px-2 py-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:67,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:65,columnNumber:17},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Port SMTP"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:70,columnNumber:19},void 0),i.jsxDEV("input",{type:"number",value:m.port,onChange:e=>d({...m,port:parseInt(e.target.value)}),className:"w-full border rounded px-2 py-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:71,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:69,columnNumber:17},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Login/Email"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:74,columnNumber:19},void 0),i.jsxDEV("input",{type:"text",value:m.login,onChange:e=>d({...m,login:e.target.value}),className:"w-full border rounded px-2 py-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:75,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:73,columnNumber:17},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Mot de passe"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:78,columnNumber:19},void 0),i.jsxDEV("input",{type:"password",placeholder:"Laisser vide pour ne pas changer",onChange:e=>d({...m,password:e.target.value}),className:"w-full border rounded px-2 py-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:79,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:77,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:64,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:62,columnNumber:13},void 0),"telnyx"===t&&i.jsxDEV("div",{className:"mb-6 border p-4 rounded",children:[i.jsxDEV("h3",{className:"font-semibold mb-2",children:"Paramètres Telnyx"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:87,columnNumber:15},void 0),i.jsxDEV("div",{children:[i.jsxDEV("label",{className:"block text-sm font-medium mb-1",children:"Clé API Telnyx"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:89,columnNumber:17},void 0),i.jsxDEV("input",{type:"password",value:o.apiKey,placeholder:"Laisser vide pour ne pas changer",onChange:e=>l({apiKey:e.target.value}),className:"w-full border rounded px-2 py-1"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:90,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:88,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:86,columnNumber:13},void 0),i.jsxDEV("div",{className:"flex justify-end gap-4",children:[i.jsxDEV("button",{type:"button",onClick:n,className:"px-4 py-2 rounded bg-gray-200 hover:bg-gray-300",children:"Annuler"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:96,columnNumber:13},void 0),i.jsxDEV("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",children:"Enregistrer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:99,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:95,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:60,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:58,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:57,columnNumber:5},void 0)},t=()=>{var t,a,m;const{api:d,user:o,can:l}=e(),[c,u]=s.useState([]),[g,p]=s.useState(!0),[v,N]=s.useState(!1),[b,x]=s.useState(null),[D,h]=s.useState({}),C=null==(t=null==o?void 0:o.currentOrganization)?void 0:t.id,f=s.useCallback(async()=>{if(C&&d){p(!0);try{const{data:e}=await d.get(`/organizations/${C}/integrations`);e.success?u(e.data||[]):n.error(e.message||"Erreur lors de la récupération des intégrations.")}catch(e){n.error("Impossible de charger les intégrations.")}finally{p(!1)}}},[C,d]);s.useEffect(()=>{f()},[f]);const E=e=>{const i=c.find(i=>i.type===e);h((null==i?void 0:i.config)||{}),x(e),N(!0)},A=async(e,i)=>{if(C&&d)try{const{data:s}=await d.put(`/organizations/${C}/integrations/${e}/toggle`,{enabled:i});s.success?(n.success(`Intégration ${e} ${i?"activée":"désactivée"}.`),f()):n.error(s.message||"Erreur lors du changement de statut.")}catch(s){n.error("Une erreur est survenue.")}};if(g)return i.jsxDEV("div",{children:"Chargement des intégrations..."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:188,columnNumber:12},void 0);const V=l&&l("integration:manage");return i.jsxDEV("div",{className:"p-6 bg-gray-50 min-h-screen",children:[i.jsxDEV("h1",{className:"text-2xl font-bold mb-6",children:"Gestion des Intégrations"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:195,columnNumber:7},void 0),i.jsxDEV("div",{className:"bg-white p-8 rounded-lg shadow-md",children:i.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxDEV("div",{className:"border p-4 rounded-lg flex justify-between items-center",children:[i.jsxDEV("div",{children:[i.jsxDEV("h3",{className:"font-bold text-lg",children:"Intégration Email"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:202,columnNumber:15},void 0),i.jsxDEV("p",{className:"text-sm text-gray-600",children:"Connectez une boîte mail pour envoyer des emails depuis le CRM."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:203,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:201,columnNumber:13},void 0),i.jsxDEV("div",{className:"flex items-center gap-2",children:[i.jsxDEV("button",{onClick:()=>E("mail"),disabled:!V,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:"Configurer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:206,columnNumber:15},void 0),i.jsxDEV("label",{className:"switch",children:[i.jsxDEV("input",{type:"checkbox",checked:(null==(a=c.find(e=>"mail"===e.type))?void 0:a.enabled)||!1,onChange:e=>A("mail",e.target.checked),disabled:!V},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:213,columnNumber:17},void 0),i.jsxDEV("span",{className:"slider round"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:219,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:212,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:205,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:200,columnNumber:11},void 0),i.jsxDEV("div",{className:"border p-4 rounded-lg flex justify-between items-center",children:[i.jsxDEV("div",{children:[i.jsxDEV("h3",{className:"font-bold text-lg",children:"Intégration Telnyx"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:227,columnNumber:15},void 0),i.jsxDEV("p",{className:"text-sm text-gray-600",children:"Connectez Telnyx pour les fonctionnalités SMS et téléphonie."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:228,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:226,columnNumber:13},void 0),i.jsxDEV("div",{className:"flex items-center gap-2",children:[i.jsxDEV("button",{onClick:()=>E("telnyx"),disabled:!V,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:"Configurer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:231,columnNumber:15},void 0),i.jsxDEV("label",{className:"switch",children:[i.jsxDEV("input",{type:"checkbox",checked:(null==(m=c.find(e=>"telnyx"===e.type))?void 0:m.enabled)||!1,onChange:e=>A("telnyx",e.target.checked),disabled:!V},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:238,columnNumber:17},void 0),i.jsxDEV("span",{className:"slider round"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:244,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:237,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:230,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:225,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:198,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:197,columnNumber:7},void 0),i.jsxDEV(r,{isOpen:v,onClose:()=>N(!1),onSave:async e=>{if(!C||!d)return;const i=c.find(i=>i.type===e.type),s=`/organizations/${C}/integrations/${e.type}`,r=i?"put":"post";try{const{data:i}=await d[r](s,{config:e.config});i.success?(n.success(`Intégration ${e.type} mise à jour.`),f()):n.error(i.message||"Erreur lors de la sauvegarde.")}catch(t){n.error("Une erreur est survenue.")}N(!1)},integrationType:b,initialConfig:D},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:251,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/admin/IntegrationsAdminPage.tsx",lineNumber:194,columnNumber:5},void 0)};export{t as default};
