import{u as e,j as i}from"./index-C0S0DpaX.js";import{l as s,u as t,r}from"./react-vendor-Al_k-ZB6.js";import{a as n,N as a}from"./Notifications-Bhgc2wzd.js";import{F as c,a as o,a2 as m,b as l,T as u,B as d,I as p}from"./antd-vendor-zFcGztvE.js";const{Title:v,Text:N}=u;function h(){const[u]=s(),h=t(),{user:g}=e(),D=u.get("token"),[b,x]=r.useState(null),[E,C]=r.useState(!0),[V,A]=r.useState(null),[f,j]=r.useState(!1),[k]=c.useForm(),I=r.useCallback(async()=>{if(!D)return A("Jeton d'invitation manquant ou invalide."),void C(!1);try{const e=await fetch(`/api/invitations/verify?token=${D}`),i=await e.json();if(!e.ok)throw new Error(i.message||"Jeton invalide ou expiré.");x(i.data)}catch(e){A(e.message),n.error(e.message)}finally{C(!1)}},[D]);r.useEffect(()=>{I()},[I]);const S=async(e={})=>{j(!0);try{const i=await fetch("/api/invitations/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:D,...e})}),s=await i.json();if(!i.ok)throw new Error(s.message||"Erreur lors de l'acceptation de l'invitation.");n.success(s.message||"Opération réussie !"),h(g?"/dashboard":"/login")}catch(i){A(i.message),n.error(i.message)}finally{j(!1)}};return i.jsxDEV("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:[i.jsxDEV(a,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:151,columnNumber:7},this),i.jsxDEV(o,{className:"w-full max-w-md shadow-lg",children:(()=>{if(E)return i.jsxDEV("div",{className:"text-center",children:i.jsxDEV(m,{size:"large"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:77,columnNumber:43},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:77,columnNumber:14},this);if(V)return i.jsxDEV(l,{message:"Erreur",description:V,type:"error",showIcon:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:81,columnNumber:14},this);if(!b)return i.jsxDEV(l,{message:"Erreur",description:"Impossible de charger les détails de l'invitation.",type:"error",showIcon:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:85,columnNumber:14},this);if(b.isExistingUser){const e=!!g&&g.email!==b.email;return i.jsxDEV("div",{children:[i.jsxDEV(v,{level:3,className:"text-center",children:["Rejoindre ",b.organization.name]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:93,columnNumber:11},this),i.jsxDEV(N,{className:"block text-center mb-4",children:["Vous êtes invité(e) à rejoindre l'organisation en tant que ",i.jsxDEV("strong",{children:b.role.label||b.role.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:95,columnNumber:72},this),"."]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:94,columnNumber:11},this),e&&i.jsxDEV(l,{message:"Compte incorrect",description:`Cette invitation est pour ${b.email}, mais vous êtes connecté(e) en tant que ${g.email}. Veuillez vous déconnecter pour accepter cette invitation.`,type:"warning",showIcon:!0,className:"mb-4"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:98,columnNumber:14},this),i.jsxDEV(d,{type:"primary",onClick:()=>S(),loading:f,block:!0,disabled:e,children:"Accepter l'invitation"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:106,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:92,columnNumber:9},this)}return i.jsxDEV("div",{children:[i.jsxDEV(v,{level:3,className:"text-center",children:"Finaliser votre inscription"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:122,columnNumber:9},this),i.jsxDEV(N,{className:"block text-center mb-4",children:["Pour rejoindre ",i.jsxDEV("strong",{children:b.organization.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:124,columnNumber:26},this)," en tant que ",i.jsxDEV("strong",{children:b.role.label||b.role.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:124,columnNumber:86},this),"."]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:123,columnNumber:9},this),i.jsxDEV(c,{form:k,layout:"vertical",onFinish:S,children:[i.jsxDEV(c.Item,{label:"Prénom",name:"firstName",rules:[{required:!0,message:"Le prénom est requis."}],children:i.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:128,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:127,columnNumber:11},this),i.jsxDEV(c.Item,{label:"Nom",name:"lastName",rules:[{required:!0,message:"Le nom est requis."}],children:i.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:131,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:130,columnNumber:11},this),i.jsxDEV(c.Item,{label:"Email",children:i.jsxDEV(p,{value:b.email,disabled:!0},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:134,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:133,columnNumber:11},this),i.jsxDEV(c.Item,{label:"Mot de passe",name:"password",rules:[{required:!0,message:"Le mot de passe est requis."},{min:8,message:"8 caractères minimum."}],children:i.jsxDEV(p.Password,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:137,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:136,columnNumber:11},this),i.jsxDEV(c.Item,{children:i.jsxDEV(d,{type:"primary",htmlType:"submit",loading:f,block:!0,children:"Créer le compte et rejoindre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:140,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:139,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:126,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:121,columnNumber:7},this)})()},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:152,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/AcceptInvitationPage.tsx",lineNumber:150,columnNumber:5},this)}export{h as default};
