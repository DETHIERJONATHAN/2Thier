import{j as e}from"./index-C0S0DpaX.js";import{u as i,r as s}from"./react-vendor-Al_k-ZB6.js";import{u as t}from"./useAuthenticatedApi-BbQI8SDU.js";import{s as n,T as a,a as m,b1 as r,an as l,I as d,ba as u,B as o,b9 as c,aC as v,o as D,aG as h,a3 as p,cD as N,b5 as C,ab as k,$ as b}from"./antd-vendor-zFcGztvE.js";const{Title:x,Paragraph:A}=a;function E(){const{api:E}=t(),g=i(),[f,V]=s.useState(!1),[S,j]=s.useState([]),[I,O]=s.useState([]),[R,M]=s.useState(""),[U,y]=s.useState(null),[w,T]=s.useState(void 0),[L,z]=s.useState(void 0),[P,B]=s.useState(void 0),[q,$]=s.useState([]),[K,Q]=s.useState([]),[G,F]=s.useState([]),H=s.useCallback(async()=>{V(!0);try{const e={};if((null==U?void 0:U[0])&&(e.from=U[0].startOf("day").toISOString()),(null==U?void 0:U[1])&&(e.to=U[1].endOf("day").toISOString()),L&&(e.source=L),w){const i=q.find(e=>e.id===w);i&&(e.status=i.name)}P&&(e.assignedTo=P),R&&(e.q=R),e.origin="d1m";const i=await E.get("/api/leads",{params:e});j((null==i?void 0:i.data)||[])}catch(e){n.error("Impossible de charger les leads")}finally{V(!1)}},[E,U,L,w,P,R,q]);s.useEffect(()=>{H()},[H]),s.useEffect(()=>{let e=!0;return(async()=>{try{const[i,s,t]=await Promise.all([E.get("/api/lead-statuses"),E.get("/api/lead-generation/campaigns"),E.get("/api/users")]);if(!e)return;$((null==i?void 0:i.data)||[]),Q(((null==s?void 0:s.data)||[]).map(e=>({value:e.name,label:e.name}))),F(((null==t?void 0:t.data)||[]).map(e=>({value:e.id,label:[e.firstName,e.lastName].filter(Boolean).join(" ")||e.email||"Utilisateur"})))}catch(i){}})(),()=>{e=!1}},[E]);const J=s.useMemo(()=>{if(!R)return S;const e=R.toLowerCase();return S.filter(i=>{var s;const t=i.data||{};return[i.source,i.status,null==(s=i.leadStatus)?void 0:s.name,t.firstName,t.lastName,t.email,t.phone,t.name].filter(Boolean).join(" ").toLowerCase().includes(e)})},[S,R]),W=s.useCallback(async(e,i)=>{try{await Promise.all(e.map(e=>E.put(`/api/leads/${e}`,{status:i}))),n.success("Statut mis à jour"),O([]),H()}catch(s){n.error("Échec de la mise à jour du statut")}},[E,H]),X=[{key:"contacted",icon:e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:125,columnNumber:31},this),label:"Qualifier (Contacté)",onClick:()=>W(I,"contacted")},{key:"lost",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:126,columnNumber:26},this),label:"Rejeter (Perdu)",onClick:()=>W(I,"lost")},{key:"completed",icon:e.jsxDEV(C,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:127,columnNumber:31},this),label:"Clôturer (Terminé)",onClick:()=>W(I,"completed")}],Y=[{title:"Créé le",dataIndex:"createdAt",key:"createdAt",width:160,render:e=>new Date(e).toLocaleString()},{title:"Prospect",key:"prospect",render:(i,s)=>{const t=s.data||{},n=t.name||[t.firstName,t.lastName].filter(Boolean).join(" ")||t.email||t.phone||s.id.slice(0,8);return e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"font-medium",children:n||"Inconnu"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:147,columnNumber:13},this),e.jsxDEV("div",{className:"text-xs text-gray-500",children:[t.email,t.phone].filter(Boolean).join(" · ")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:148,columnNumber:13},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:146,columnNumber:11},this)}},{title:"Source",dataIndex:"source",key:"source",render:i=>e.jsxDEV(k,{color:"blue",children:i||"direct"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:157,columnNumber:30},this)},{title:"Statut",key:"status",render:(i,s)=>{var t,n;return e.jsxDEV(k,{color:(null==(t=s.leadStatus)?void 0:t.name)?"geekblue":"default",children:(null==(n=s.leadStatus)?void 0:n.name)||s.status},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:162,columnNumber:45},this)}},{title:"Assigné à",key:"assignedTo",render:(e,i)=>{var s,t;return(null==(s=i.assignedTo)?void 0:s.email)||(null==(t=i.assignedTo)?void 0:t.firstName)||"—"}},{title:"Actions",key:"actions",render:(i,s)=>e.jsxDEV(b,{children:[e.jsxDEV(o,{size:"small",icon:e.jsxDEV(p,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:174,columnNumber:38},this),onClick:()=>W([s.id],"contacted"),children:"Qualifier"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:174,columnNumber:11},this),e.jsxDEV(o,{size:"small",icon:e.jsxDEV(N,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:175,columnNumber:38},this),onClick:()=>W([s.id],"lost"),children:"Rejeter"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:175,columnNumber:11},this),e.jsxDEV(o,{size:"small",danger:!0,icon:e.jsxDEV(C,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:176,columnNumber:45},this),onClick:()=>W([s.id],"completed"),children:"Clôturer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:176,columnNumber:11},this),e.jsxDEV(o,{size:"small",onClick:()=>g(`/leads/${s.id}`),children:"Ouvrir dans CRM"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:177,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:173,columnNumber:9},this)}];return e.jsxDEV("div",{className:"p-6",children:[e.jsxDEV(a,{children:[e.jsxDEV(x,{level:3,children:"Centre de tri des leads"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:186,columnNumber:9},this),e.jsxDEV(A,{type:"secondary",children:"Tous les leads entrants sont centralisés ici avant orientation automatique via les règles de Dispatch."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:187,columnNumber:9},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:185,columnNumber:7},this),e.jsxDEV(m,{className:"mb-3",size:"small",children:e.jsxDEV("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxDEV(r.RangePicker,{onChange:e=>y(e??null),value:U??void 0,allowEmpty:[!0,!0]},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:193,columnNumber:11},this),e.jsxDEV(l,{allowClear:!0,placeholder:"Statut",style:{width:180},value:w,onChange:T,options:q.map(e=>({value:e.id,label:e.name}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:198,columnNumber:11},this),e.jsxDEV(l,{allowClear:!0,showSearch:!0,placeholder:"Source",style:{width:200},value:L,onChange:z,options:K,filterOption:(e,i)=>(null==i?void 0:i.label).toLowerCase().includes(e.toLowerCase())},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:206,columnNumber:11},this),e.jsxDEV(l,{allowClear:!0,showSearch:!0,placeholder:"Assigné à",style:{width:220},value:P,onChange:B,options:G,filterOption:(e,i)=>(null==i?void 0:i.label).toLowerCase().includes(e.toLowerCase())},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:216,columnNumber:11},this),e.jsxDEV(d,{allowClear:!0,prefix:e.jsxDEV(u,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:226,columnNumber:37},this),placeholder:"Recherche texte",value:R,onChange:e=>M(e.target.value),style:{width:260}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:226,columnNumber:11},this),e.jsxDEV(o,{icon:e.jsxDEV(c,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:227,columnNumber:25},this),onClick:H,children:"Appliquer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:227,columnNumber:11},this),e.jsxDEV(o,{onClick:()=>{y(null),T(void 0),z(void 0),B(void 0),M("")},children:"Réinitialiser"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:228,columnNumber:11},this),e.jsxDEV(v,{type:"vertical"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:229,columnNumber:11},this),e.jsxDEV(D,{menu:{items:X},disabled:!I.length,children:e.jsxDEV(o,{type:"primary",children:["Actions groupées (",I.length,")"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:231,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:230,columnNumber:11},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:192,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:191,columnNumber:7},this),e.jsxDEV(m,{children:e.jsxDEV(h,{rowKey:"id",loading:f,dataSource:J,columns:Y,rowSelection:{selectedRowKeys:I,onChange:O},pagination:{pageSize:10}},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:236,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:235,columnNumber:7},this)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/pages/devis1minute/admin/Devis1minuteAdminIntake.tsx",lineNumber:184,columnNumber:5},this)}export{E as default};
