import{j as e,u as r}from"./index-C0S0DpaX.js";import{r as n,R as t,m as s}from"./react-vendor-Al_k-ZB6.js";import{u as i}from"./useAuthenticatedApi-BbQI8SDU.js";import{s as a,a as o,B as l,ad as c,T as d,ae as m}from"./antd-vendor-zFcGztvE.js";const u=({children:r,className:n=""})=>e.jsxDEV("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs text-slate-600 border-slate-200 bg-white/70 ${n}`,children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Badge.tsx",lineNumber:4,columnNumber:3},void 0),b=({label:r,index:n,activeTab:t,setActiveTab:s})=>e.jsxDEV("button",{onClick:()=>s(n),className:["px-4 py-2 rounded-2xl border whitespace-nowrap",t===n?"bg-slate-900 text-white border-slate-900 shadow":"bg-white hover:bg-slate-50 border-slate-200 text-slate-700"].join(" "),children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:16,columnNumber:5},void 0),f=({lead:r,debug:n,setDebug:t,tabs:s,activeTab:i,setActiveTab:a,unsaved:o})=>e.jsxDEV("header",{className:"sticky top-0 z-20 backdrop-blur bg-white/80 border-b border-slate-200",children:[e.jsxDEV("div",{className:"mx-auto max-w-7xl px-4 py-3 flex items-center justify-between",children:[e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV("div",{className:"h-9 w-9 rounded-xl bg-slate-900 text-white grid place-items-center font-bold",children:"TBL"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:34,columnNumber:21},void 0),e.jsxDEV("div",{children:[e.jsxDEV("div",{className:"text-lg font-semibold text-slate-900",children:"SystÃ¨me Multi-secteurs â€” Devis"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:36,columnNumber:25},void 0),e.jsxDEV("div",{className:"text-xs text-slate-500 flex items-center gap-2 flex-wrap",children:[e.jsxDEV("span",{children:["Lead: ",e.jsxDEV("b",{children:r.name},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:38,columnNumber:41},void 0)," Â· ",r.address," Â· ",r.phone]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:38,columnNumber:29},void 0),o&&e.jsxDEV("span",{className:"inline-flex items-center gap-1 rounded-md bg-amber-100 text-amber-800 px-2 py-[2px] border border-amber-200",children:[e.jsxDEV("span",{className:"h-1.5 w-1.5 rounded-full bg-amber-500"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:41,columnNumber:37},void 0),"Non sauvegardÃ©"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:40,columnNumber:33},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:37,columnNumber:25},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:35,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:33,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV(u,{children:"Progression : 0%"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:49,columnNumber:21},void 0),e.jsxDEV("label",{className:"inline-flex items-center gap-2 text-sm text-slate-600",children:[e.jsxDEV("input",{type:"checkbox",className:"accent-slate-900",checked:n,onChange:e=>t(e.target.checked)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:51,columnNumber:25},void 0),"Mode debug admin"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:50,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:48,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:32,columnNumber:13},void 0),e.jsxDEV("div",{className:"mx-auto max-w-7xl px-4 pb-3",children:e.jsxDEV("div",{className:"flex gap-2 overflow-x-auto no-scrollbar",children:s.map(r=>e.jsxDEV(b,{label:r.label,index:r.key,activeTab:i,setActiveTab:a},r.key,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:59,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:57,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:56,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Header.tsx",lineNumber:31,columnNumber:9},void 0),p=({answers:r,derivedValues:n,tabs:t,activeTab:s,setActiveTab:i})=>{var a,o;return e.jsxDEV("aside",{className:"xl:sticky xl:top-[148px] h-fit",children:[e.jsxDEV("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("h3",{className:"text-sm font-semibold text-slate-900",children:"RÃ©sumÃ© & Variables"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:34,columnNumber:21},void 0),e.jsxDEV("span",{className:"text-xs text-slate-500",children:"Auto"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:35,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:33,columnNumber:17},void 0),e.jsxDEV("div",{className:"mt-3 space-y-2 text-sm",children:[e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("span",{children:"@budget"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:38,columnNumber:72},void 0),e.jsxDEV("b",{children:[null==(a=r.budget)?void 0:a.toLocaleString("fr-BE")," â‚¬"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:38,columnNumber:92},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:38,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("span",{children:"@surface"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:39,columnNumber:72},void 0),e.jsxDEV("b",{children:[r.surface," mÂ²"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:39,columnNumber:93},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:39,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("span",{children:"@cout_total"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:40,columnNumber:72},void 0),e.jsxDEV("b",{children:[null==(o=n.coutTotal)?void 0:o.toLocaleString("fr-BE")," â‚¬"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:40,columnNumber:96},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:40,columnNumber:21},void 0),e.jsxDEV("div",{className:"flex items-center justify-between",children:[e.jsxDEV("span",{children:"@rendement_pv"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:41,columnNumber:72},void 0),e.jsxDEV("b",{children:[n.rendementPv??"â€”","%"]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:41,columnNumber:98},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:41,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:37,columnNumber:17},void 0),e.jsxDEV("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsxDEV(u,{children:"ðŸ“Š"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:44,columnNumber:21},void 0),e.jsxDEV(u,{children:"ðŸ§®"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:45,columnNumber:21},void 0),e.jsxDEV(u,{children:"âš–ï¸"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:46,columnNumber:21},void 0),e.jsxDEV(u,{children:"ðŸ§©"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:47,columnNumber:21},void 0),e.jsxDEV(u,{children:"ðŸ”Œ"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:48,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:43,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:32,columnNumber:13},void 0),e.jsxDEV("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxDEV("button",{onClick:()=>{var e;const r=t.findIndex(e=>e.key===s),n=Math.max(0,r-1);i((null==(e=t[n])?void 0:e.key)??s)},className:"rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm hover:bg-slate-50",children:"â—€ï¸Ž PrÃ©cÃ©dent"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:53,columnNumber:17},void 0),e.jsxDEV("button",{onClick:()=>{var e;const r=t.findIndex(e=>e.key===s),n=Math.min(t.length-1,r+1);i((null==(e=t[n])?void 0:e.key)??s)},className:"rounded-xl bg-slate-900 text-white px-4 py-2 text-sm shadow hover:opacity-95",children:"Suivant â–¶ï¸Ž"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:59,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:52,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Sidebar.tsx",lineNumber:31,columnNumber:9},void 0)},h=({activeTabLabel:r,onSaveDraft:n,onComplete:t,saving:s})=>e.jsxDEV("footer",{className:"sticky bottom-0 z-10 border-t border-slate-200 bg-white/80 backdrop-blur",children:e.jsxDEV("div",{className:"mx-auto max-w-7xl px-4 py-3 flex items-center justify-between text-sm",children:[e.jsxDEV("span",{className:"text-slate-600",children:["Onglet actif : ",e.jsxDEV("b",{children:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:14,columnNumber:65},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:14,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV("button",{className:"rounded-xl border border-slate-300 bg-white px-4 py-2 hover:bg-slate-50 disabled:opacity-60",onClick:()=>{n&&n()},disabled:s,children:s?"Enregistrementâ€¦":"Enregistrer le brouillon"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:16,columnNumber:21},void 0),e.jsxDEV("button",{className:"rounded-xl bg-emerald-600 text-white px-4 py-2 shadow hover:opacity-95 disabled:opacity-60",onClick:()=>{t&&t()},disabled:s,children:"Soumettre"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:21,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:15,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:13,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Footer.tsx",lineNumber:12,columnNumber:9},void 0),v={id:"tree-tbl-new",name:"SystÃ¨me Multi-secteurs â€” Devis",variables:[],nodes:[{id:"tab-general",parentId:null,title:"Mesures gÃ©nÃ©rales",type:"GROUP",leafType:null,order:0,markers:[],children:[{id:"leaf-type-client",parentId:"tab-general",title:"Type de client",subtitle:"Choisissez le type de client",type:"LEAF",leafType:"FIELD",order:0,markers:[],children:[],fieldConfig:{id:"cfg-type-client",fieldType:"SELECT",selectConfig:{options:[{label:"Particulier",value:"particulier"},{label:"Entreprise",value:"entreprise"},{label:"Autre",value:"autre"}],defaultValue:"particulier"}},conditionConfig:null,formulaConfig:null},{id:"leaf-budget",parentId:"tab-general",title:"Budget global",subtitle:"Montant disponible pour le projet",type:"LEAF",leafType:"FIELD",order:1,markers:[],children:[],fieldConfig:{id:"cfg-budget",fieldType:"NUMBER",numberConfig:{min:2e3,max:6e4,step:500,defaultValue:12e3,ui:"slider"}},conditionConfig:null,formulaConfig:null},{id:"leaf-surface",parentId:"tab-general",title:"Surface utile (mÂ²)",subtitle:"Surface estimÃ©e disponible (toiture/faÃ§ades)",type:"LEAF",leafType:"FIELD",order:2,markers:[],children:[],fieldConfig:{id:"cfg-surface",fieldType:"NUMBER",numberConfig:{min:10,max:200,step:5,defaultValue:40,ui:"slider"}},conditionConfig:null,formulaConfig:null},{id:"leaf-orientation",parentId:"tab-general",title:"Orientation",type:"LEAF",leafType:"FIELD",order:3,markers:[],children:[],fieldConfig:{id:"cfg-orientation",fieldType:"SELECT",selectConfig:{options:[{label:"Sud",value:"sud"},{label:"Est",value:"est"},{label:"Ouest",value:"ouest"},{label:"Nord",value:"nord"}],defaultValue:"sud"}},conditionConfig:null,formulaConfig:null},{id:"leaf-inclinaison",parentId:"tab-general",title:"Inclinaison",type:"LEAF",leafType:"FIELD",order:4,markers:[],children:[],fieldConfig:{id:"cfg-inclinaison",fieldType:"SELECT",selectConfig:{options:[{label:"15Â°",value:"15"},{label:"25Â°",value:"25"},{label:"35Â°",value:"35"},{label:"45Â°",value:"45"}],defaultValue:"35"}},conditionConfig:null,formulaConfig:null},{id:"leaf-toiture-type",parentId:"tab-general",title:"Type de toiture",type:"LEAF",leafType:"FIELD",order:5,markers:[],children:[],fieldConfig:{id:"cfg-toiture",fieldType:"SELECT",selectConfig:{options:[{label:"Tuiles",value:"tuiles"},{label:"Ardoises",value:"ardoises"},{label:"Bac acier",value:"bacacier"}],defaultValue:"tuiles"}},conditionConfig:null,formulaConfig:null}]},{id:"tab-pv",parentId:null,title:"PhotovoltaÃ¯que",type:"GROUP",leafType:null,order:1,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-toiture",parentId:null,title:"Toiture",type:"GROUP",leafType:null,order:2,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-pacAA",parentId:null,title:"PAC Air-Air",type:"GROUP",leafType:null,order:3,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-pacAE",parentId:null,title:"PAC Air-Eau",type:"GROUP",leafType:null,order:4,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-thermo",parentId:null,title:"Thermodynamique",type:"GROUP",leafType:null,order:5,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-eau",parentId:null,title:"Traitement de l'eau",type:"GROUP",leafType:null,order:6,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-isolation",parentId:null,title:"Isolation murs",type:"GROUP",leafType:null,order:7,markers:[],children:[],conditionConfig:null,formulaConfig:null},{id:"tab-docs",parentId:null,title:"Docs & Devis",type:"GROUP",leafType:null,order:8,markers:[],children:[],conditionConfig:null,formulaConfig:null}]};function N(e){if(!e||"object"!=typeof e)return;const r=e;return"string"==typeof r.id?{id:r.id,name:"string"==typeof r.name?r.name:r.id}:"data"in e?N(e.data):void 0}function C(e){const r="data"in e?e.data:e;if(Array.isArray(r))return r.filter(Boolean).map(e=>{const r=e;return{id:String(r.id??""),parentId:null==r.parentId?null:String(r.parentId),label:"string"==typeof r.label?r.label:String(r.label??""),description:"string"==typeof r.description?r.description:null,type:"string"==typeof r.type?r.type:"leaf_field",subType:"string"==typeof r.subType?r.subType:null,order:"number"==typeof r.order?r.order:null}})}function D(e,r){if(!e||!r||0===r.length)return null;const n=new Map,t=(e,r)=>{const n=(r||"").toUpperCase(),t=e.toLowerCase();return"leaf_number"===t||"NUMBER"===n?{id:`cfg-${Math.random().toString(36).slice(2,8)}`,fieldType:"NUMBER",numberConfig:{min:0,max:100,step:1,defaultValue:0,ui:"input"}}:"leaf_select"===t||"SELECT"===n?{id:`cfg-${Math.random().toString(36).slice(2,8)}`,fieldType:"SELECT",selectConfig:{options:[]}}:"leaf_checkbox"===t||"CHECKBOX"===n?{id:`cfg-${Math.random().toString(36).slice(2,8)}`,fieldType:"CHECKBOX"}:"leaf_date"===t||"DATE"===n?{id:`cfg-${Math.random().toString(36).slice(2,8)}`,fieldType:"DATE"}:{id:`cfg-${Math.random().toString(36).slice(2,8)}`,fieldType:"TEXT",textConfig:{placeholder:""}}};r.forEach(e=>{if(!e.id)return;const{type:r,leafType:s}=(e=>{const r=e.toLowerCase();return"branch"===r||"group"===r?{type:"GROUP",leafType:null}:"leaf_option"===r?{type:"LEAF",leafType:"OPTION"}:"leaf_option_field"===r?{type:"LEAF",leafType:"OPTION_FIELD"}:{type:"LEAF",leafType:"FIELD"}})(e.type);n.set(e.id,{id:e.id,parentId:e.parentId,title:e.label,subtitle:e.description||void 0,type:r,leafType:s,order:e.order??0,markers:[],children:[],fieldConfig:"LEAF"===r?t(e.type,e.subType):null,conditionConfig:null,formulaConfig:null})}),n.forEach(e=>{e.parentId&&n.has(e.parentId)&&n.get(e.parentId).children.push(e)}),n.forEach(e=>{var r;if("LEAF"===e.type&&"SELECT"===(null==(r=e.fieldConfig)?void 0:r.fieldType)){const r=e.children.filter(e=>"LEAF"===e.type&&"OPTION"===e.leafType);r.length>0&&(e.fieldConfig.selectConfig=e.fieldConfig.selectConfig||{options:[]},e.fieldConfig.selectConfig.options=r.map(e=>({label:e.title,value:e.id})))}});const s=Array.from(n.values()).filter(e=>!e.parentId);return{id:e.id,name:e.name,variables:[],nodes:s}}function x(e){const{api:r}=i(),[t,s]=n.useState(null),[a,o]=n.useState(!0),[l,c]=n.useState(null);n.useEffect(()=>{let n=!1;return(async()=>{var t;o(!0),c(null);try{const[t,i]=await Promise.all([r.get(`/api/treebranchleaf/trees/${e}`),r.get(`/api/treebranchleaf/trees/${e}/nodes`)]),a=D(N(t),C(i));if(a&&!n)return void s(a);throw new Error("Invalid tree payload")}catch{if(n)return;try{const e=function(e){const r="data"in e?e.data:e;return Array.isArray(r)?r.map(e=>N(e)).filter(e=>Boolean(e)):[]}(await r.get("/api/treebranchleaf/trees")),i=null==(t=e[0])?void 0:t.id;if(i){const[e,t]=await Promise.all([r.get(`/api/treebranchleaf/trees/${i}`),r.get(`/api/treebranchleaf/trees/${i}/nodes`)]),a=D(N(e),C(t));if(a&&!n)return s(a),void c(null)}}catch{}s(v),c("Impossible de charger lâ€™arbre TBL (mode dÃ©mo)")}finally{n||o(!1)}})(),()=>{n=!0}},[r,e]);const d=n.useMemo(()=>t?t.nodes.filter(e=>null==e.parentId&&"GROUP"===e.type).sort((e,r)=>(e.order??0)-(r.order??0)).map(e=>({key:e.id,label:e.title})):[],[t]);return{tree:t,tabs:d,loading:a,error:l}}const E=({list:r=[],show:n=!1})=>n&&0!==r.length?e.jsxDEV("div",{className:"ml-2 hidden md:flex items-center gap-1 text-sm",children:r.map((r,n)=>e.jsxDEV("span",{className:"opacity-80",children:r},n,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/CapBadges.tsx",lineNumber:8,columnNumber:9},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/CapBadges.tsx",lineNumber:6,columnNumber:5},void 0):null,g=({title:r,subtitle:n,badges:t,children:s,debugMode:i})=>e.jsxDEV("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm",children:[e.jsxDEV("div",{className:"flex items-start justify-between",children:e.jsxDEV("div",{children:[e.jsxDEV("h3",{className:"text-base font-semibold text-slate-900 flex items-center",children:[r,e.jsxDEV(E,{show:i,list:t},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:18,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:16,columnNumber:9},void 0),n&&e.jsxDEV("p",{className:"mt-1 text-sm text-slate-500",children:n},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:21,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:15,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:14,columnNumber:5},void 0),e.jsxDEV("div",{className:"mt-4 space-y-4",children:s},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:25,columnNumber:5},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/SectionCard.tsx",lineNumber:13,columnNumber:3},void 0),T=()=>e.jsxDEV("span",{title:"Option (O)",className:"mr-2 text-base",children:"â—‹"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Icons.tsx",lineNumber:3,columnNumber:28},void 0),V=()=>e.jsxDEV("span",{title:"Option + Champ (O+C)",className:"mr-2 text-base",children:"â—"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Icons.tsx",lineNumber:4,columnNumber:29},void 0),w=()=>e.jsxDEV("span",{title:"Champ (C)",className:"mr-2 text-base",children:"â—"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Icons.tsx",lineNumber:5,columnNumber:28},void 0),S=({node:r,value:n,onChange:t})=>{var s,i,a,o,l;const c=r.fieldConfig;if(!c)return null;switch(c.fieldType){case"TEXT":return e.jsxDEV("input",{type:"text",className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-300",placeholder:(null==(s=c.textConfig)?void 0:s.placeholder)||"",value:n??(null==(i=c.textConfig)?void 0:i.defaultValue)??"",onChange:e=>t(e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:17,columnNumber:9},void 0);case"NUMBER":{const r=e=>{var r;return"number"==typeof e?e:Number(e??(null==(r=c.numberConfig)?void 0:r.defaultValue)??0)};return"slider"===(null==(a=c.numberConfig)?void 0:a.ui)?e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV("input",{type:"range",min:c.numberConfig.min??0,max:c.numberConfig.max??100,step:c.numberConfig.step??1,value:r(n),onChange:e=>t(Number(e.target.value)),className:"w-full"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:30,columnNumber:13},void 0),e.jsxDEV("div",{className:"w-20 text-right text-sm font-medium tabular-nums",children:r(n)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:39,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:29,columnNumber:11},void 0):e.jsxDEV("input",{type:"number",className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-300",value:r(n),onChange:e=>t(Number(e.target.value))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:44,columnNumber:9},void 0)}case"SELECT":return e.jsxDEV("select",{className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm",value:n??(null==(o=c.selectConfig)?void 0:o.defaultValue)??"",onChange:e=>t(e.target.value),children:((null==(l=c.selectConfig)?void 0:l.options)??[]).map(r=>e.jsxDEV("option",{value:r.value,children:r.label},r.value,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:60,columnNumber:13},void 0))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:54,columnNumber:9},void 0);case"CHECKBOX":return e.jsxDEV("label",{className:"inline-flex items-center gap-2 text-sm text-slate-700",children:[e.jsxDEV("input",{type:"checkbox",className:"accent-slate-900",checked:Boolean(n),onChange:e=>t(e.target.checked)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:67,columnNumber:11},void 0),r.title]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:66,columnNumber:9},void 0);case"DATE":return e.jsxDEV("input",{type:"date",className:"mt-2 w-full rounded-lg border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-300",value:n??"",onChange:e=>t(e.target.value)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/FieldRenderer.tsx",lineNumber:78,columnNumber:9},void 0);default:return null}},y=r=>{switch(r){case"OPTION":return e.jsxDEV(T,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:16,columnNumber:27},void 0);case"OPTION_FIELD":return e.jsxDEV(V,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:17,columnNumber:33},void 0);default:return e.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:20,columnNumber:14},void 0)}},k=({groupNode:r,values:n,onChange:t,debugMode:s})=>{const i=r.children||[],a=i.filter(e=>"GROUP"===e.type),o=i.filter(e=>"LEAF"===e.type);return e.jsxDEV(e.Fragment,{children:[o.map(r=>e.jsxDEV(g,{title:e.jsxDEV("div",{className:"flex items-center",children:[y(r.leafType)," ",r.title]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:35,columnNumber:18},void 0),subtitle:r.subtitle||void 0,badges:s?[r.leafType||""]:void 0,debugMode:s,children:e.jsxDEV(S,{node:r,value:n[r.id],onChange:e=>t(r.id,e)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:40,columnNumber:11},void 0)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:33,columnNumber:9},void 0)),a.map(r=>e.jsxDEV(g,{title:e.jsxDEV("div",{className:"flex items-center",children:[y()," ",r.title]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:52,columnNumber:18},void 0),subtitle:r.subtitle||void 0,debugMode:s,children:e.jsxDEV(k,{groupNode:r,values:n,onChange:t,debugMode:s},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:56,columnNumber:11},void 0)},r.id,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:50,columnNumber:9},void 0))]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/tabs/DynamicTab.tsx",lineNumber:30,columnNumber:5},void 0)};function A(e){const r=function(e={}){const{initialTreeId:r,initialSubmissionId:t=null,initialFormData:s={},initialLeadId:a,debounceMs:o=500,autoRecoverDrafts:l=!0}=e,{api:c}=i(),[d,m]=n.useState(r),[u,b]=n.useState(t),[f,p]=n.useState(null),[h,v]=n.useState(s),[N,C]=n.useState([]),[D,x]=n.useState(!1),[E,g]=n.useState(!1),[T,V]=n.useState(!1),[w,S]=n.useState(!1),[y,k]=n.useState(null),[A,R]=n.useState([]),L=n.useRef(null),M=n.useRef(!1),O=n.useCallback(e=>m(e),[]),B=n.useCallback(e=>b(e),[]),U=n.useCallback(e=>N.find(r=>r.nodeId===e),[N]),j=n.useCallback(async()=>{var e,r;x(!0),k(null);try{const n={stageId:f,treeId:d,submissionId:u,formData:h},t=await c.post("/api/tbl/submissions/stage",n);p((null==(r=null==(e=t.data)?void 0:e.stage)?void 0:r.id)??null)}catch(n){k((null==n?void 0:n.message)||"Erreur lors du staging")}finally{x(!1)}},[c,f,d,u,h]),I=n.useCallback(async()=>{var e;g(!0),k(null);try{f||await(async()=>{var e,r;const n=await c.post("/api/tbl/submissions/stage",{stageId:null,treeId:d,submissionId:u,formData:h});p((null==(r=null==(e=n.data)?void 0:e.stage)?void 0:r.id)??null)})();const r=f||await(async()=>{var e,r;const n=(null==(r=null==(e=(await c.post("/api/tbl/submissions/stage",{stageId:null,treeId:d,submissionId:u,formData:h})).data)?void 0:e.stage)?void 0:r.id)??null;return p(n),n})();if(!r)return;const n=await c.post("/api/tbl/submissions/stage/preview",{stageId:r});C(Array.isArray(null==(e=n.data)?void 0:e.results)?n.data.results:[])}catch(r){k((null==r?void 0:r.message)||"Erreur lors de la prÃ©visualisation")}finally{g(!1)}},[c,f,d,u,h]),F=n.useCallback(()=>{L.current&&window.clearTimeout(L.current),L.current=window.setTimeout(()=>{I()},o)},[I,o]),P=n.useCallback((e,r)=>{v(n=>({...n,[e]:r})),S(!0),L.current&&window.clearTimeout(L.current),L.current=window.setTimeout(async()=>{var n,t,s,i,a;try{const o=await c.post("/api/tbl/submissions/stage",{stageId:f,treeId:d,submissionId:u,formData:{[e]:r}});p((null==(t=null==(n=o.data)?void 0:n.stage)?void 0:t.id)??f);const l=(null==(i=null==(s=o.data)?void 0:s.stage)?void 0:i.id)??f;if(l){const e=await c.post("/api/tbl/submissions/stage/preview",{stageId:l});C(Array.isArray(null==(a=e.data)?void 0:a.results)?e.data.results:[])}}catch(o){k((null==o?void 0:o.message)||"Erreur lors de la mise Ã  jour")}},o)},[c,f,d,u,o]),H=n.useCallback(e=>{v(r=>({...r,...e})),S(!0),F()},[F]),$=n.useCallback(async()=>{var e,r,n,t;if(f||u){V(!0),k(null);try{if(!f){const n=await c.post("/api/tbl/submissions/stage",{stageId:null,treeId:d,submissionId:u,formData:h});p((null==(r=null==(e=n.data)?void 0:e.stage)?void 0:r.id)??null)}const s=f||null;if(!s)return;const i=await c.post("/api/tbl/submissions/stage/commit",{stageId:s,asNew:!1});return(null==(n=i.data)?void 0:n.submissionId)&&b(i.data.submissionId),S(!1),{submissionId:(null==(t=i.data)?void 0:t.submissionId)??u}}catch(s){k((null==s?void 0:s.message)||"Erreur lors de la sauvegarde")}finally{V(!1)}}},[c,f,u,d,h]),_=n.useCallback(async()=>{var e,r,n,t;V(!0),k(null);try{if(!f){const n=await c.post("/api/tbl/submissions/stage",{stageId:null,treeId:d,submissionId:u,formData:h});p((null==(r=null==(e=n.data)?void 0:e.stage)?void 0:r.id)??null)}const s=f||null;if(!s)return;const i=await c.post("/api/tbl/submissions/stage/commit",{stageId:s,asNew:!0});return(null==(n=i.data)?void 0:n.submissionId)&&b(i.data.submissionId),S(!1),{submissionId:null==(t=i.data)?void 0:t.submissionId}}catch(s){k((null==s?void 0:s.message)||"Erreur lors de la crÃ©ation du nouveau devis")}finally{V(!1)}},[c,f,u,d,h]),G=n.useCallback(async()=>{if(f)try{await c.post("/api/tbl/submissions/stage/discard",{stageId:f})}catch{}finally{p(null),S(!1)}},[c,f]),z=n.useCallback(()=>{C([]),S(!1),k(null),v(s||{}),p(null)},[s]),X=n.useCallback(async()=>{var e;try{const r=new URLSearchParams;a&&r.append("leadId",a),d&&r.append("treeId",d);const n=(null==(e=(await c.get(`/api/tbl/submissions/my-drafts?${r.toString()}`)).data)?void 0:e.drafts)||[];return R(n),n}catch(r){return[]}},[c,a,d]),q=n.useCallback(async e=>{var r;try{x(!0);const n=(await X()).find(r=>r.stageId===e);if(!n)throw new Error("Brouillon non trouvÃ©");p(n.stageId),v(n.formData),m(n.treeId),S(!0);const t=await c.post("/api/tbl/submissions/stage/preview",{stageId:n.stageId});C(Array.isArray(null==(r=t.data)?void 0:r.results)?t.data.results:[])}catch(n){k("Erreur lors de la restauration du brouillon")}finally{x(!1)}},[c,X]);n.useEffect(()=>{l&&!M.current&&a&&(M.current=!0,(async()=>{try{(await X()).length}catch(e){}})())},[l,a,X,f]);const K=n.useRef(!1);return n.useEffect(()=>{if(K.current)return;if(!(Boolean(t)||Object.keys(s||{}).length>0)||N.length>0)return;K.current=!0;let e=!1;return(async()=>{var n,i,a;try{const o=await c.post("/api/tbl/submissions/stage",{stageId:null,treeId:r,submissionId:t,formData:s});if(e)return;const l=(null==(i=null==(n=o.data)?void 0:n.stage)?void 0:i.id)??null;if(p(l),!l)return;const d=await c.post("/api/tbl/submissions/stage/preview",{stageId:l});if(e)return;C(Array.isArray(null==(a=d.data)?void 0:a.results)?d.data.results:[])}catch{}})(),()=>{e=!0}},[c,t,s,r,N.length]),n.useMemo(()=>({treeId:d,submissionId:u,stageId:f,formData:h,results:N,loading:D,previewing:E,committing:T,dirty:w,error:y,availableDrafts:A,setTreeId:O,setSubmissionId:B,setField:P,setMany:H,previewNow:I,stageNow:j,commitToExisting:$,commitAsNew:_,discardStage:G,reset:z,checkForDrafts:X,restoreDraft:q,getNodeResult:U}),[d,u,f,h,N,D,E,T,w,y,A,O,B,P,H,I,j,$,_,G,z,X,q,U])}({initialTreeId:e,debounceMs:500}),[t,s]=n.useState({submissionId:r.submissionId,status:"draft",data:{},calculatedData:{}});n.useEffect(()=>{r.submissionId!==t.submissionId&&s(e=>({...e,submissionId:r.submissionId}))},[r.submissionId,t.submissionId]);const o=n.useCallback((e,n)=>{s(r=>({...r,data:{...r.data,[e]:null==n?"":String(n)}})),r.setField(e,n)},[r]),l=n.useCallback((e,n)=>{s(r=>({...r,calculatedData:{...r.calculatedData,[e]:null==n?"":String(n)}})),r.setField(e,n)},[r]),c=n.useCallback(async()=>{if(!r.submissionId){const e=await r.commitAsNew();return void((null==e?void 0:e.submissionId)&&a.success("Brouillon crÃ©Ã© et enregistrÃ©"))}await r.commitToExisting(),a.success("Brouillon enregistrÃ©")},[r]),d=n.useCallback(async()=>{if(r.submissionId)await r.commitToExisting();else{const e=await r.commitAsNew();(null==e?void 0:e.submissionId)&&a.success("Soumission crÃ©Ã©e")}s(e=>({...e,status:"completed"})),a.success("Soumission complÃ©tÃ©e")},[r]),m=r.committing,u=r.error,b=n.useMemo(()=>({setValue:o,setCalculatedValue:l,saveDraft:c,complete:d}),[o,l,c,d]);return{state:t,setState:s,isSaving:m,error:u,...b}}const R=({treeId:s})=>{var u;const[b,v]=n.useState(""),[N,C]=n.useState(!1),[D]=n.useState({name:"Dupont Alice",email:"alice.dupont@example.com",phone:"+32 477 12 34 56",address:"Rue des Fleurs 12, 1000 Bruxelles"}),[E]=n.useState({typeClient:"particulier",tva:"",budget:12e3,surface:40,orientation:"sud",inclinaison:35,toitureType:"tuiles",images:[],include:{}}),{tree:g,tabs:T}=x(s||"tree-tbl-new"),[V,w]=n.useState({}),{state:S,setValue:y,setCalculatedValue:R,saveDraft:L,complete:M,isSaving:O}=A((null==g?void 0:g.id)||s||"tree-tbl-new"),B=(e,r)=>{w(n=>({...n,[e]:r})),y(e,r)},{isSuperAdmin:U}=r(),j=e=>{var r,n,t,s,i,a,o,l,c,d;if(!e)return"";switch(e.fieldType){case"TEXT":return(null==(r=e.textConfig)?void 0:r.defaultValue)??(null==(n=e.textConfig)?void 0:n.placeholder)??"Valeur de test";case"NUMBER":{const r=(null==(t=e.numberConfig)?void 0:t.min)??0,n=(null==(s=e.numberConfig)?void 0:s.max)??100,o=(null==(i=e.numberConfig)?void 0:i.step)??1;if("number"==typeof(null==(a=e.numberConfig)?void 0:a.defaultValue))return e.numberConfig.defaultValue;return r+Math.floor((n-r)/2/o)*o}case"SELECT":{const r=null==(o=e.selectConfig)?void 0:o.defaultValue;if(r)return r;return(null==(d=null==(c=null==(l=e.selectConfig)?void 0:l.options)?void 0:c[0])?void 0:d.value)??""}case"CHECKBOX":return!0;case"DATE":return(new Date).toISOString().slice(0,10);default:return""}},I=async e=>{var r;if(!(null==(r=null==g?void 0:g.nodes)?void 0:r.length))return void a.warning("Aucun nÅ“ud TBL Ã  remplir");const n=g.nodes.filter(e=>"LEAF"===e.type&&e.fieldConfig);let t=0;for(const s of n){const e=j(s.fieldConfig);B(s.id,e),t++}e?(await L(),a.success(`Champs remplis (${t}) et brouillon enregistrÃ©`)):a.success(`Champs remplis (${t}). Vous pouvez maintenant enregistrer.`)},F=O,{data:P}=function(e,r){const{api:t}=i(),[s,a]=n.useState(null),[o,l]=n.useState(!1),[c,d]=n.useState(null),m=n.useMemo(()=>!!e,[e]);return n.useEffect(()=>{let r=!1;if(m)return(async()=>{try{l(!0),d(null);const n=await t.get(`/api/treebranchleaf/submissions/${e}/summary`);r||a(n)}catch(n){r||d((null==n?void 0:n.message)||"Erreur lors du chargement du rÃ©sumÃ©")}finally{r||l(!1)}})(),()=>{r=!0}},[t,m,e,r]),{data:s,loading:o,error:c}}(S.submissionId,F),{items:H}=function(e,r){const{api:t}=i(),[s,a]=n.useState(null),[o,l]=n.useState(!1),[c,d]=n.useState(null),m=n.useMemo(()=>!!e,[e]);return n.useEffect(()=>{let r=!1;if(m)return(async()=>{try{l(!0),d(null);const n=await t.get(`/api/treebranchleaf/submissions/${e}/operations`);r||a(n.items)}catch(n){r||d((null==n?void 0:n.message)||"Erreur lors du chargement des opÃ©rations")}finally{r||l(!1)}})(),()=>{r=!0}},[t,m,e,r]),{items:s,loading:o,error:c}}(S.submissionId,F);t.useEffect(()=>{!b&&T.length>0&&v(T[0].key)},[T,b]);const $=n.useMemo(()=>{const e=Number(E.surface??0),r=Number(E.budget??0),n=e>0?Math.round(250*e):void 0,t={sud:{15:95,25:98,35:100,45:97},est:{15:86,25:89,35:92,45:90},ouest:{15:86,25:89,35:92,45:90},nord:{15:65,25:70,35:72,45:71}}[E.orientation],s=E.inclinaison??35;return{coutTotal:n,rendementPv:(null==t?void 0:t[s])??void 0,isSolvable:n&&r?r>=n:void 0}},[E]);t.useEffect(()=>{void 0!==$.coutTotal&&R("cout_total",$.coutTotal),void 0!==$.rendementPv&&R("rendement_pv",$.rendementPv),void 0!==$.isSolvable&&R("is_solvable",$.isSolvable)},[$,R]);return e.jsxDEV("div",{className:"min-h-screen bg-slate-50",children:[e.jsxDEV(f,{lead:D,debug:N,setDebug:C,tabs:T,activeTab:b,setActiveTab:v,unsaved:!S.submissionId},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:183,columnNumber:3},void 0),e.jsxDEV("main",{className:"mx-auto max-w-7xl px-4 py-6 grid grid-cols-1 xl:grid-cols-[1fr_340px] gap-6",children:[e.jsxDEV("div",{className:"space-y-6",children:[U&&e.jsxDEV(o,{size:"small",children:e.jsxDEV("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxDEV("div",{className:"text-slate-700 font-medium",children:"Outils Super Admin"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:198,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex items-center gap-2",children:[e.jsxDEV(l,{onClick:()=>{I(!1)},children:"Remplir tout (admin)"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:200,columnNumber:19},void 0),e.jsxDEV(l,{type:"primary",onClick:()=>{I(!0)},loading:O,children:"Remplir + Enregistrer"},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:201,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:199,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:197,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:196,columnNumber:13},void 0),(()=>{var r;const n=b,t=(null==g?void 0:g.nodes.find(e=>e.id===n))??{id:n,parentId:null,title:(null==(r=T.find(e=>e.key===n))?void 0:r.label)||n,subtitle:void 0,type:"GROUP",leafType:null,order:0,markers:[],children:[]};return e.jsxDEV(k,{groupNode:t,values:V,onChange:B,debugMode:N},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:178,columnNumber:12},void 0)})(),P?e.jsxDEV(o,{size:"small",title:"RÃ©sumÃ© de la soumission",children:e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[e.jsxDEV("div",{children:e.jsxDEV(c,{percent:Math.round(P.completion.percent)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:215,columnNumber:19},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:214,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV(d.Text,{children:["Champs: ",P.counts.fields.filled,"/",P.counts.fields.total]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:218,columnNumber:19},void 0),e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:218,columnNumber:122},void 0),e.jsxDEV(d.Text,{type:"secondary",children:["Vides: ",P.counts.fields.empty]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:219,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:217,columnNumber:17},void 0),e.jsxDEV("div",{children:[e.jsxDEV(d.Text,{children:["Options + Champ: ",P.counts.optionFields.filled,"/",P.counts.optionFields.total]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:222,columnNumber:19},void 0),e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:222,columnNumber:143},void 0),e.jsxDEV(d.Text,{type:"secondary",children:["Variables: ",P.counts.variables.total]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:223,columnNumber:19},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:221,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:213,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:212,columnNumber:13},void 0):e.jsxDEV(o,{size:"small",title:"RÃ©sumÃ© de la soumission",children:e.jsxDEV(d.Text,{type:"secondary",children:"Pas encore de donnÃ©es enregistrÃ©es. Modifiez un champ pour commencer, puis sauvegardez."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:229,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:228,columnNumber:13},void 0),H&&H.length>0?e.jsxDEV(o,{size:"small",title:"Historique des opÃ©rations",children:e.jsxDEV(m,{items:H.map(r=>({children:e.jsxDEV("div",{children:[e.jsxDEV(d.Text,{strong:!0,children:"string"==typeof r.operationResult?r.operationResult:"object"==typeof r.operationResult&&null!==r.operationResult?String(r.operationResult):String(r.operationResult??"---")},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:240,columnNumber:23},void 0),e.jsxDEV("div",{className:"text-slate-500 text-xs",children:[r.operationSource,r.operationDetail?` Â· ${r.operationDetail}`:""," Â· ",new Date(r.lastResolved).toLocaleString("fr-BE")]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:248,columnNumber:23},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:239,columnNumber:21},void 0)}))},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:236,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:235,columnNumber:13},void 0):e.jsxDEV(o,{size:"small",title:"Historique des opÃ©rations",children:e.jsxDEV(d.Text,{type:"secondary",children:"Aucune opÃ©ration pour le moment. Saisissez des rÃ©ponses pour voir lâ€™historique apparaÃ®tre."},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:258,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:257,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:194,columnNumber:9},void 0),e.jsxDEV(p,{answers:E,derivedValues:$,tabs:T,activeTab:b,setActiveTab:v},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:263,columnNumber:3},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:193,columnNumber:7},void 0),e.jsxDEV(h,{activeTabLabel:null==(u=T.find(e=>e.key===b))?void 0:u.label,onSaveDraft:()=>{L()},onComplete:()=>{M()},saving:O},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:272,columnNumber:3},void 0)]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblContainer.tsx",lineNumber:182,columnNumber:5},void 0)},L=()=>{const{id:r}=s();return e.jsxDEV(R,{treeId:r},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/TblNew.tsx",lineNumber:9,columnNumber:10},void 0)};export{L as default};
