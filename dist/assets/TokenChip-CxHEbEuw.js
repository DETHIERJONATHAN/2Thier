import{j as e}from"./index-C0S0DpaX.js";import{r}from"./react-vendor-Al_k-ZB6.js";import{u as o}from"./useAuthenticatedApi-BbQI8SDU.js";import{a7 as n,ab as t}from"./antd-vendor-zFcGztvE.js";const a={tree:{backgroundColor:"#1f2937",textColor:"#ffffff",borderColor:"#374151",icon:"ðŸŒ³"},branch:{backgroundColor:"#3b82f6",textColor:"#ffffff",borderColor:"#2563eb",icon:"ðŸŒ¿"},leaf_field:{backgroundColor:"#10b981",textColor:"#ffffff",borderColor:"#059669",icon:"ðŸ“"},leaf_option:{backgroundColor:"#f59e0b",textColor:"#ffffff",borderColor:"#d97706",icon:"âšª"},leaf_option_field:{backgroundColor:"#8b5cf6",textColor:"#ffffff",borderColor:"#7c3aed",icon:"ðŸŽ¯"},section:{backgroundColor:"#6b7280",textColor:"#ffffff",borderColor:"#4b5563",icon:"ðŸ“‹"}},l={},i={},s=e=>{if(!e)return"";return Array.from(e).filter(e=>{const r=e.charCodeAt(0);return 8203!==r&&8204!==r&&8205!==r&&65279!==r&&(8206!==r&&8207!==r&&(!(r>=8234&&r<=8238)&&(!(r>=8294&&r<=8297)&&(160!==r&&!(r<32||r>=127&&r<=159)))))}).join("").trim()},u=({token:u,onRemove:f})=>{const{api:c}=o(),d=r.useMemo(()=>s(u),[u]),m=r.useMemo(()=>(e=>{const r=s(e);return r.includes("node-formula:")?"nodeFormula":r.startsWith("formula:")?"formula":r.startsWith("@value.")||r.includes("@value.")?"nodeValue":r.startsWith("@select.")||r.includes("@select.")?"nodeOption":r.startsWith("#")?"marker":["+","-","*","/","(",")","CONCAT"].includes(r)?"operator":/^".*"$/.test(r)?"string":/^[-+]?\d*\.?\d+$/.test(r)?"number":/@value\.[A-Za-z0-9_-]+/.test(r)?"nodeValue":/@select\.[A-Za-z0-9_-]+/.test(r)?"nodeOption":"other"})(d),[d]),[b,p]=r.useState(""),[h,v]=r.useState(""),[C,g]=r.useState(""),[$,k]=r.useState("default");r.useEffect(()=>{let e=!1;return(async()=>{var r,o,n;try{if(d.includes("node-formula:"),"nodeValue"===m||"nodeOption"===m){const n="nodeValue"===m?d.slice(7):d.slice(8).split(".")[0];if(n.startsWith("node-formula:"))return void(e||(k("red"),p("Erreur: Formule orpheline"),v("âš ï¸"),g("Cette formule n'existe plus ou est mal rÃ©fÃ©rencÃ©e")));if(k("nodeValue"===m?"green":"blue"),g(u),l[n]){const o=l[n],t=(null==(r=a[o.type||"leaf_field"])?void 0:r.icon)||"ðŸ”˜";return void(e||(p(o.label||n),v(t)))}try{const r=await c.get(`/api/treebranchleaf/nodes/${n}`);if(!r)return void(e||(k("red"),p("RÃ©fÃ©rence introuvable"),v("âš ï¸"),g(d)));const t={label:(null==r?void 0:r.label)||n,type:null==r?void 0:r.type};l[n]=t;const i=(null==(o=a[t.type||"leaf_field"])?void 0:o.icon)||"ðŸ”˜";e||(p(t.label),v(i))}catch{e||(k("red"),p("RÃ©fÃ©rence introuvable"),v("âš ï¸"),g(d))}return}if("nodeFormula"===m){const r=d.slice(13);if(k("purple"),g("Formule rÃ©utilisable"),v("ðŸ§®"),i[`node-formula:${r}`]){const o=i[`node-formula:${r}`];return void(e||p(o.name))}try{const o=await c.get("/api/treebranchleaf/reusables/formulas"),t=null==(n=null==o?void 0:o.items)?void 0:n.find(e=>e.id===r);if(t&&!e){const e=`${t.name}${t.nodeLabel?` (${t.nodeLabel})`:""}`;i[`node-formula:${r}`]={name:e},p(e),v("ðŸ§®"),k("purple")}else if(!e){const e=`Formule â€” ${r.slice(0,8)}...`;i[`node-formula:${r}`]={name:e},p(e),v("ðŸ§®"),k("orange")}}catch{if(!e){const e=`Formule â€” ${r.slice(0,8)}...`;i[`node-formula:${r}`]={name:e},p(e),v("âš ï¸"),k("red")}}return}if("formula"===m){const r=d.slice(8);k("purple"),g("Formule rÃ©utilisable");const o="Formule";if(i[r])return void(e||(p(`${o} â€” ${i[r].name}`),v("ðŸ§®")));try{const n=await c.get(`/api/treebranchleaf/reusables/formulas/${r}`),t=(null==n?void 0:n.name)&&String(n.name)||r;i[r]={name:t},e||(p(`${o} â€” ${t}`),v("ðŸ§®"))}catch{e||(p(`${o} â€” ${r}`),v("ðŸ§®"))}return}if("operator"===m)return k("gold"),p(u),v("âž•"),void g("OpÃ©rateur");if("string"===m)return k("cyan"),p(u),v('"'),void g("Texte");if("number"===m)return k("geekblue"),p(u),v("123"),void g("Nombre");if("marker"===m)return k("magenta"),p(u),v("ðŸ·ï¸"),void g("Marqueur");k("default"),p(d),v(""),g(d)}catch{e||(k("default"),p(d),v(""),g(d))}})(),()=>{e=!0}},[c,d,m,u]),r.useEffect(()=>{},[m,u,d,b,h,$,C]);const x=r.useMemo(()=>"nodeValue"===m||"nodeOption"===m||"formula"===m||"nodeFormula"===m?b||"â€¦":b||d,[m,b,d]),N=e.jsxDEV("span",{children:[h?e.jsxDEV("span",{style:{marginRight:6},children:h},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/shared/TokenChip.tsx",lineNumber:251,columnNumber:15},void 0):null,x]},void 0,!0,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/shared/TokenChip.tsx",lineNumber:250,columnNumber:5},void 0);return e.jsxDEV(n,{title:C||u,children:e.jsxDEV(t,{color:$,closable:!!f,onClose:e=>{e.preventDefault(),null==f||f(u)},style:{marginBottom:4},children:N},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/shared/TokenChip.tsx",lineNumber:258,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/dethi/OneDrive/Desktop/CRM SAVE/crm/src/components/TreeBranchLeaf/treebranchleaf-new/components/Parameters/shared/TokenChip.tsx",lineNumber:257,columnNumber:5},void 0)};export{u as T};
