/**
 * Script de seed pour initialiser les sites web
 * Site Vitrine 2Thier + Devis1Minute
 */

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± D√©but du seed des sites web...');

  // R√©cup√©rer l'organisation 2Thier (Super Admin)
  const org2Thier = await prisma.organization.findFirst({
    where: {
      OR: [
        { name: { contains: '2thier', mode: 'insensitive' } },
        { name: { contains: '2Thier', mode: 'insensitive' } },
      ]
    }
  });

  if (!org2Thier) {
    console.error('‚ùå Organisation 2Thier non trouv√©e !');
    console.log('üí° Cr√©ation de l\'organisation 2Thier...');
    
    const newOrg = await prisma.organization.create({
      data: {
        id: '2thier-org-id',
        name: '2Thier',
        status: 'active',
        features: ['all'],
        address: 'Route de Gosselies 23, 6220 Fleurus',
        phone: '071/XX.XX.XX',
        website: 'https://2thier.be',
        description: 'Votre partenaire en transition √©nerg√©tique'
      }
    });
    
    console.log('‚úÖ Organisation 2Thier cr√©√©e !');
  }

  const organization = org2Thier || await prisma.organization.findFirst({
    where: { name: { contains: '2thier', mode: 'insensitive' } }
  });

  if (!organization) {
    throw new Error('Impossible de trouver ou cr√©er l\'organisation 2Thier');
  }

  console.log(`‚úÖ Organisation trouv√©e : ${organization.name}`);

  // ==========================================
  // SITE 1 : SITE VITRINE 2THIER
  // ==========================================
  
  console.log('\nüì± Cr√©ation du Site Vitrine 2Thier...');

  // V√©rifier si le site existe d√©j√†
  let siteVitrine = await prisma.webSite.findFirst({
    where: {
      organizationId: organization.id,
      slug: 'site-vitrine-2thier'
    }
  });

  if (siteVitrine) {
    console.log('‚ö†Ô∏è  Site Vitrine existe d√©j√†, suppression et recr√©ation...');
    await prisma.webSite.delete({ where: { id: siteVitrine.id } });
  }

  siteVitrine = await prisma.webSite.create({
    data: {
      organizationId: organization.id,
      siteName: '2Thier SRL',
      siteType: 'vitrine',
      slug: 'site-vitrine-2thier',
      domain: '2thier.be',
      isActive: true,
      isPublished: true,
      maintenanceMode: false
    }
  });

  console.log('‚úÖ Site Vitrine cr√©√© !');

  // Configuration du site vitrine
  await prisma.webSiteConfig.create({
    data: {
      websiteId: siteVitrine.id,
      primaryColor: '#10b981',
      secondaryColor: '#3b82f6',
      phone: '071/XX.XX.XX',
      email: 'info@2thier.be',
      address: 'Route de Gosselies 23',
      city: 'Fleurus',
      postalCode: '6220',
      country: 'Belgique',
      mapUrl: 'https://maps.google.com/?q=Route+de+Gosselies+23,+6220+Fleurus',
      businessHours: {
        lundi: '8h-18h',
        mardi: '8h-18h',
        mercredi: '8h-18h',
        jeudi: '8h-18h',
        vendredi: '8h-18h',
        samedi: 'Ferm√©',
        dimanche: 'Ferm√©'
      },
      socialLinks: {
        facebook: 'https://facebook.com/2thier',
        instagram: 'https://instagram.com/2thier',
        linkedin: 'https://linkedin.com/company/2thier'
      },
      heroTitle: 'Votre Partenaire en Transition √ânerg√©tique',
      heroSubtitle: 'Photovolta√Øque ‚Ä¢ Batteries ‚Ä¢ Bornes de Recharge ‚Ä¢ Pompes √† Chaleur ‚Ä¢ Isolation ‚Ä¢ Toiture ‚Ä¢ √âlectricit√© ‚Ä¢ Gros ≈íuvre',
      heroCtaPrimary: 'Demander un devis gratuit',
      heroCtaSecondary: 'Nos r√©alisations',
      metaTitle: '2Thier Energy - Transition √ânerg√©tique en Wallonie',
      metaDescription: 'Expert en installation de panneaux solaires, batteries, pompes √† chaleur et isolation en Wallonie. +500 installations r√©alis√©es.',
      metaKeywords: 'panneaux solaires, photovolta√Øque, batteries, pompe √† chaleur, isolation, toiture, Charleroi, Wallonie',
      stats: {
        installations: 500,
        powerMW: 15,
        satisfaction: 4.9,
        region: 'Wallonie'
      },
      aboutText: '2Thier Energy est votre partenaire de confiance pour tous vos projets de transition √©nerg√©tique. Depuis notre cr√©ation, nous accompagnons particuliers et professionnels dans leur d√©marche vers l\'autonomie √©nerg√©tique.',
      valuesJson: [
        {
          icon: 'SafetyCertificateOutlined',
          title: 'Expertise Multi-Services',
          description: 'Un seul partenaire pour tous vos projets √©nerg√©tiques et de construction'
        },
        {
          icon: 'StarFilled',
          title: 'Qualit√© Premium',
          description: 'Produits durables et installations r√©alis√©es par des techniciens certifi√©s'
        },
        {
          icon: 'CustomerServiceOutlined',
          title: 'Service Personnalis√©',
          description: 'Suivi de A √† Z, m√™me apr√®s installation'
        },
        {
          icon: 'CheckCircleOutlined',
          title: 'Garanties √âtendues',
          description: 'Garanties constructeur jusqu\'√† 30 ans et service apr√®s-vente r√©actif'
        }
      ]
    }
  });

  console.log('‚úÖ Configuration du Site Vitrine cr√©√©e !');

  // Services du site vitrine
  const services = [
    {
      key: 'photovoltaique',
      icon: 'ThunderboltOutlined',
      title: 'Panneaux Photovolta√Øques',
      description: 'Installation de panneaux solaires haute performance pour r√©duire vos factures d\'√©nergie et augmenter votre autonomie.',
      features: ['Panneaux jusqu\'√† 440 Wp', 'Garantie 25-30 ans', 'Monitoring en temps r√©el', 'Primes et d√©ductions fiscales'],
      ctaText: 'Configurer mon installation',
      displayOrder: 1
    },
    {
      key: 'batteries',
      icon: 'BulbOutlined',
      title: 'Batteries de Stockage',
      description: 'Stockez votre √©nergie solaire pour l\'utiliser quand vous en avez besoin et maximisez votre autoconsommation.',
      features: ['Capacit√© 10-20 kWh', 'Compatible tous syst√®mes', 'Gestion intelligente', 'Autonomie maximale'],
      ctaText: 'Calculer mes besoins',
      displayOrder: 2
    },
    {
      key: 'bornes',
      icon: 'CarOutlined',
      title: 'Bornes de Recharge',
      description: 'Rechargez votre v√©hicule √©lectrique √† domicile avec l\'√©nergie verte de vos panneaux solaires.',
      features: ['Jusqu\'√† 22 kW', 'Charge intelligente', 'Application mobile', 'Installation certifi√©e'],
      ctaText: 'Demander un devis',
      displayOrder: 3
    },
    {
      key: 'pac',
      icon: 'FireOutlined',
      title: 'Pompes √† Chaleur',
      description: 'Chauffage et climatisation √©cologique pour votre confort toute l\'ann√©e avec des √©conomies jusqu\'√† 70%.',
      features: ['Air/Air et Air/Eau', 'COP jusqu\'√† 4.5', '√âconomies jusqu\'√† 70%', 'Primes disponibles'],
      ctaText: 'D√©couvrir les mod√®les',
      displayOrder: 4
    },
    {
      key: 'isolation',
      icon: 'HomeOutlined',
      title: 'Isolation Compl√®te',
      description: 'Isolation thermique des murs, toits et sols pour r√©duire vos pertes d\'√©nergie et am√©liorer votre confort.',
      features: ['Murs / Toiture / Sols', 'Am√©lioration PEB', '√âconomies durables', 'Subventions r√©gionales'],
      ctaText: 'Audit √©nerg√©tique gratuit',
      displayOrder: 5
    },
    {
      key: 'toiture',
      icon: 'CloudOutlined',
      title: 'Toiture',
      description: 'Construction et r√©novation de tous types de toitures avec garantie d√©cennale et mat√©riaux de qualit√©.',
      features: ['Toiture plate et versants', 'Charpente compl√®te', 'Zinguerie', 'Garantie d√©cennale'],
      ctaText: 'Devis toiture',
      displayOrder: 6
    },
    {
      key: 'electricite',
      icon: 'ThunderboltOutlined',
      title: '√âlectricit√© G√©n√©rale',
      description: 'Mise en conformit√© et installation √©lectrique compl√®te par des √©lectriciens agr√©√©s et certifi√©s.',
      features: ['Mise en conformit√©', 'Tableau √©lectrique', 'Domotique', 'Contr√¥le RGIE'],
      ctaText: 'Consultation √©lectrique',
      displayOrder: 7
    },
    {
      key: 'gros-oeuvre',
      icon: 'ToolOutlined',
      title: 'Gros ≈íuvre',
      description: 'Fondations, ma√ßonnerie et r√©novation compl√®te pour tous vos projets de construction et r√©novation.',
      features: ['Fondations solides', 'Ma√ßonnerie', 'Extension', 'R√©novation compl√®te'],
      ctaText: 'Projet de construction',
      displayOrder: 8
    }
  ];

  for (const service of services) {
    await prisma.webSiteService.create({
      data: {
        websiteId: siteVitrine.id,
        ...service,
        features: service.features,
        isActive: true
      }
    });
  }

  console.log(`‚úÖ ${services.length} services cr√©√©s !`);

  // Projets/R√©alisations
  const projects = [
    {
      title: '12.5 kWp + Batterie 15 kWh',
      location: 'Charleroi',
      details: '30 panneaux solaires 440 Wp + batterie de stockage 15 kWh + borne de recharge 11 kW. Installation compl√®te avec monitoring intelligent.',
      tags: ['Photovolta√Øque', 'Batterie', 'Borne de recharge'],
      completedAt: new Date('2025-10-01'),
      isFeatured: true,
      displayOrder: 1
    },
    {
      title: 'Pompe √† Chaleur Air/Eau 12 kW',
      location: 'Namur',
      details: 'Installation pompe √† chaleur Air/Eau avec syst√®me de chauffage au sol et production eau chaude sanitaire.',
      tags: ['Pompe √† chaleur'],
      completedAt: new Date('2025-09-15'),
      isFeatured: true,
      displayOrder: 2
    },
    {
      title: 'Isolation Compl√®te + PV 8 kWp',
      location: 'Li√®ge',
      details: 'Isolation toiture 180m¬≤ + isolation murs + installation de 20 panneaux photovolta√Øques 8 kWp.',
      tags: ['Isolation', 'Photovolta√Øque'],
      completedAt: new Date('2025-09-10'),
      isFeatured: true,
      displayOrder: 3
    },
    {
      title: 'Toiture Plate 120m¬≤ + PV',
      location: 'Mons',
      details: 'R√©novation toiture plate avec membrane EPDM + installation de panneaux photovolta√Øques int√©gr√©s.',
      tags: ['Toiture', 'Photovolta√Øque'],
      completedAt: new Date('2025-08-20'),
      isFeatured: false,
      displayOrder: 4
    }
  ];

  for (const project of projects) {
    await prisma.webSiteProject.create({
      data: {
        websiteId: siteVitrine.id,
        ...project,
        tags: project.tags,
        isActive: true
      }
    });
  }

  console.log(`‚úÖ ${projects.length} projets cr√©√©s !`);

  // T√©moignages
  const testimonials = [
    {
      customerName: 'Marie Dupont',
      location: 'Charleroi',
      service: 'Panneaux solaires 10 kWp',
      rating: 5,
      text: 'Installation impeccable r√©alis√©e en une journ√©e. L\'√©quipe √©tait professionnelle, ponctuelle et a pris le temps de tout m\'expliquer en d√©tail. Mes factures d\'√©lectricit√© ont d√©j√† diminu√© de moiti√© ! Je recommande vivement 2Thier pour leur expertise et leur service client.',
      publishedAt: new Date('2025-09-15'),
      isFeatured: true,
      displayOrder: 1
    },
    {
      customerName: 'Jean Martin',
      location: 'Namur',
      service: 'Pompe √† chaleur Air/Eau',
      rating: 5,
      text: 'Excellent service du d√©but √† la fin. √âtude technique pr√©cise, devis d√©taill√©, installation soign√©e. La pompe √† chaleur fonctionne parfaitement et nos factures de chauffage ont √©t√© divis√©es par deux. Service apr√®s-vente au top !',
      publishedAt: new Date('2025-08-25'),
      isFeatured: true,
      displayOrder: 2
    },
    {
      customerName: 'Sophie Lambert',
      location: 'Li√®ge',
      service: 'Isolation toiture + PV 8 kWp',
      rating: 5,
      text: 'Projet complet g√©r√© par 2Thier de A √† Z : isolation de notre toiture et installation de panneaux solaires. Coordination parfaite entre les diff√©rents corps de m√©tier, travail tr√®s soign√© et d√©lais respect√©s. Notre maison est maintenant confortable et √©conome en √©nergie !',
      publishedAt: new Date('2025-07-30'),
      isFeatured: true,
      displayOrder: 3
    }
  ];

  for (const testimonial of testimonials) {
    await prisma.webSiteTestimonial.create({
      data: {
        websiteId: siteVitrine.id,
        ...testimonial,
        isActive: true
      }
    });
  }

  console.log(`‚úÖ ${testimonials.length} t√©moignages cr√©√©s !`);

  // ==========================================
  // SITE 2 : DEVIS1MINUTE
  // ==========================================

  console.log('\nüöÄ Cr√©ation du site Devis1Minute...');

  let siteDevis1Minute = await prisma.webSite.findFirst({
    where: {
      organizationId: organization.id,
      slug: 'devis1minute'
    }
  });

  if (siteDevis1Minute) {
    console.log('‚ö†Ô∏è  Devis1Minute existe d√©j√†, suppression et recr√©ation...');
    await prisma.webSite.delete({ where: { id: siteDevis1Minute.id } });
  }

  siteDevis1Minute = await prisma.webSite.create({
    data: {
      organizationId: organization.id,
      siteName: 'Devis1Minute',
      siteType: 'landing_page',
      slug: 'devis1minute',
      domain: 'devis1minute.be',
      isActive: true,
      isPublished: true,
      maintenanceMode: false
    }
  });

  console.log('‚úÖ Site Devis1Minute cr√©√© !');

  // Configuration Devis1Minute
  await prisma.webSiteConfig.create({
    data: {
      websiteId: siteDevis1Minute.id,
      primaryColor: '#10b981',
      secondaryColor: '#f59e0b',
      phone: '071/XX.XX.XX',
      email: 'devis@2thier.be',
      address: 'Route de Gosselies 23',
      city: 'Fleurus',
      postalCode: '6220',
      country: 'Belgique',
      heroTitle: 'Votre Devis en 1 Minute Chrono',
      heroSubtitle: 'Panneaux solaires, batteries, pompes √† chaleur et plus encore. R√©ponse imm√©diate garantie !',
      heroCtaPrimary: 'Obtenir mon devis gratuit',
      heroCtaSecondary: 'En savoir plus',
      metaTitle: 'Devis1Minute - Devis Gratuit Panneaux Solaires & √ânergie',
      metaDescription: 'Obtenez votre devis gratuit en 1 minute pour panneaux solaires, batteries, pompes √† chaleur. Installation professionnelle en Wallonie.',
      metaKeywords: 'devis gratuit, panneaux solaires, devis rapide, photovolta√Øque, Wallonie',
      stats: {
        devis_generated: 1000,
        response_time: '1 minute',
        satisfaction: 4.8
      }
    }
  });

  console.log('‚úÖ Configuration Devis1Minute cr√©√©e !');

  // Services simplifi√©s pour Devis1Minute
  const servicesDevis = [
    {
      key: 'pv',
      icon: 'ThunderboltOutlined',
      title: 'Panneaux Solaires',
      description: 'Installation cl√© en main',
      features: ['Devis gratuit', 'Installation rapide', 'Garantie 25 ans'],
      ctaText: 'Obtenir un devis',
      displayOrder: 1
    },
    {
      key: 'batteries',
      icon: 'BulbOutlined',
      title: 'Batteries',
      description: 'Stockage d\'√©nergie',
      features: ['Autonomie', 'Compatible', 'Intelligent'],
      ctaText: 'Obtenir un devis',
      displayOrder: 2
    },
    {
      key: 'pac',
      icon: 'FireOutlined',
      title: 'Pompes √† Chaleur',
      description: 'Chauffage √©cologique',
      features: ['√âconomies 70%', 'Primes', 'Installation pro'],
      ctaText: 'Obtenir un devis',
      displayOrder: 3
    }
  ];

  for (const service of servicesDevis) {
    await prisma.webSiteService.create({
      data: {
        websiteId: siteDevis1Minute.id,
        ...service,
        features: service.features,
        isActive: true
      }
    });
  }

  console.log(`‚úÖ ${servicesDevis.length} services Devis1Minute cr√©√©s !`);

  console.log('\nüéâ Seed termin√© avec succ√®s !');
  console.log(`\nüìä R√©sum√© :`);
  console.log(`   - 2 sites web cr√©√©s`);
  console.log(`   - Site Vitrine : ${services.length} services, ${projects.length} projets, ${testimonials.length} t√©moignages`);
  console.log(`   - Devis1Minute : ${servicesDevis.length} services`);
  console.log(`\n‚úÖ Vous pouvez maintenant acc√©der aux sites :`);
  console.log(`   - http://localhost:5173/site-vitrine-2thier`);
  console.log(`   - http://localhost:5173/devis1minute`);
}

main()
  .catch((e) => {
    console.error('‚ùå Erreur lors du seed :', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
